const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./raw-in9isEBO.js","./basedecoder-B2c5_Eok.js","./lzw-_aCqfs4w.js","./jpeg-CKYXsxFN.js","./deflate-B9JhHpvg.js","./pako.esm-Cram60i4.js","./packbits-DDWKfGV_.js","./lerc-BiJm_dO3.js","./index-Dq_b4_gu.js","./index-cKK9EHRv.css","./render-CsnpLT4w.js","./_plugin-vue_export-helper-P15FNwLs.js","./webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
import{c as lg,g as hg,f as qu,j as Fn,k as Om,E as Fm,a as Yt,h as tr,$ as Qi,r as gi,w as ml,o as Dm,b as Gm,N as Nm,O as rh,V as Ws,Z as cg,S as km,R as Um,Q as Bm}from"./index-Dq_b4_gu.js";import{h as zm,u as Xm,d as jm,c as Vm}from"./render-CsnpLT4w.js";import{u as $m,a as Wm,_ as qm,m as Km}from"./_plugin-vue_export-helper-P15FNwLs.js";const Hm=lg({name:"QPage",props:{padding:Boolean,styleFn:Function},setup(i,{slots:t}){const{proxy:{$q:e}}=hg(),n=qu(Om,Fn);if(n===Fn)return console.error("QPage needs to be a deep child of QLayout"),Fn;if(qu(Fm,Fn)===Fn)return console.error("QPage needs to be child of QPageContainer"),Fn;const r=Yt(()=>{const o=(n.header.space===!0?n.header.size:0)+(n.footer.space===!0?n.footer.size:0);if(typeof i.styleFn=="function"){const l=n.isContainer.value===!0?n.containerHeight.value:e.screen.height;return i.styleFn(o,l)}return{minHeight:n.isContainer.value===!0?n.containerHeight.value-o+"px":e.screen.height===0?o!==0?`calc(100vh - ${o}px)`:"100vh":e.screen.height-o+"px"}}),a=Yt(()=>`q-page${i.padding===!0?" q-layout-padding":""}`);return()=>tr("main",{class:a.value,style:r.value},zm(t.default))}}),Ym={xs:2,sm:4,md:6,lg:10,xl:14};function Ku(i,t,e){return{transform:t===!0?`translateX(${e.lang.rtl===!0?"-":""}100%) scale3d(${-i},1,1)`:`scale3d(${i},1,1)`}}const Zm=lg({name:"QLinearProgress",props:{...$m,...Xm,value:{type:Number,default:0},buffer:Number,color:String,trackColor:String,reverse:Boolean,stripe:Boolean,indeterminate:Boolean,query:Boolean,rounded:Boolean,animationSpeed:{type:[String,Number],default:2100},instantFeedback:Boolean},setup(i,{slots:t}){const{proxy:e}=hg(),n=Wm(i,e.$q),s=jm(i,Ym),r=Yt(()=>i.indeterminate===!0||i.query===!0),a=Yt(()=>i.reverse!==i.query),o=Yt(()=>({...s.value!==null?s.value:{},"--q-linear-progress-speed":`${i.animationSpeed}ms`})),l=Yt(()=>"q-linear-progress"+(i.color!==void 0?` text-${i.color}`:"")+(i.reverse===!0||i.query===!0?" q-linear-progress--reverse":"")+(i.rounded===!0?" rounded-borders":"")),h=Yt(()=>Ku(i.buffer!==void 0?i.buffer:1,a.value,e.$q)),c=Yt(()=>`with${i.instantFeedback===!0?"out":""}-transition`),u=Yt(()=>`q-linear-progress__track absolute-full q-linear-progress__track--${c.value} q-linear-progress__track--${n.value===!0?"dark":"light"}`+(i.trackColor!==void 0?` bg-${i.trackColor}`:"")),f=Yt(()=>Ku(r.value===!0?1:i.value,a.value,e.$q)),_=Yt(()=>`q-linear-progress__model absolute-full q-linear-progress__model--${c.value} q-linear-progress__model--${r.value===!0?"in":""}determinate`),g=Yt(()=>({width:`${i.value*100}%`})),x=Yt(()=>`q-linear-progress__stripe absolute-${i.reverse===!0?"right":"left"} q-linear-progress__stripe--${c.value}`);return()=>{const y=[tr("div",{class:u.value,style:h.value}),tr("div",{class:_.value,style:f.value})];return i.stripe===!0&&r.value===!1&&y.push(tr("div",{class:x.value,style:g.value})),tr("div",{class:l.value,style:o.value,role:"progressbar","aria-valuemin":0,"aria-valuemax":1,"aria-valuenow":i.indeterminate===!0?void 0:i.value},Vm(t.default,y))}}}),ge={ADD:"add",REMOVE:"remove"},xs={PROPERTYCHANGE:"propertychange"},Y={CHANGE:"change",ERROR:"error",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",TOUCHMOVE:"touchmove",WHEEL:"wheel"};class Wr{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function Qm(i,t,e){let n,s;e=e||si;let r=0,a=i.length,o=!1;for(;r<a;)n=r+(a-r>>1),s=+e(i[n],t),s<0?r=n+1:(a=n,o=!s);return o?r:~r}function si(i,t){return i>t?1:i<t?-1:0}function ug(i,t){return i<t?1:i>t?-1:0}function Do(i,t,e){if(i[0]<=t)return 0;const n=i.length;if(t<=i[n-1])return n-1;if(typeof e=="function"){for(let s=1;s<n;++s){const r=i[s];if(r===t)return s;if(r<t)return e(t,i[s-1],r)>0?s-1:s}return n-1}if(e>0){for(let s=1;s<n;++s)if(i[s]<t)return s-1;return n-1}if(e<0){for(let s=1;s<n;++s)if(i[s]<=t)return s;return n-1}for(let s=1;s<n;++s){if(i[s]==t)return s;if(i[s]<t)return i[s-1]-t<t-i[s]?s-1:s}return n-1}function Jm(i,t,e){for(;t<e;){const n=i[t];i[t]=i[e],i[e]=n,++t,--e}}function ri(i,t){const e=Array.isArray(t)?t:[t],n=e.length;for(let s=0;s<n;s++)i[i.length]=e[s]}function Ji(i,t){const e=i.length;if(e!==t.length)return!1;for(let n=0;n<e;n++)if(i[n]!==t[n])return!1;return!0}function tp(i,t,e){const n=t||si;return i.every(function(s,r){if(r===0)return!0;const a=n(i[r-1],s);return!(a>0||a===0)})}function Sr(){return!0}function Go(){return!1}function Rr(){}function fg(i){let t,e,n;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==n||!Ji(s,e))&&(n=this,e=s,t=i.apply(this,arguments)),t}}function Jh(i){function t(){let e;try{e=i()}catch(n){return Promise.reject(n)}return e instanceof Promise?e:Promise.resolve(e)}return t()}function Ps(i){for(const t in i)delete i[t]}function qi(i){let t;for(t in i)return!1;return!t}class Ke{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}class Ls extends Wr{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),s=n[t]||(n[t]=[]);s.includes(e)||s.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,s=this.listeners_&&this.listeners_[n];if(!s)return;const r=e?new Ke(t):t;r.target||(r.target=this.eventTarget_||this);const a=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});n in a||(a[n]=0,o[n]=0),++a[n];let l;for(let h=0,c=s.length;h<c;++h)if("handleEvent"in s[h]?l=s[h].handleEvent(r):l=s[h].call(this,r),l===!1||r.propagationStopped){l=!1;break}if(--a[n]===0){let h=o[n];for(delete o[n];h--;)this.removeEventListener(n,Rr);delete a[n]}return l}disposeInternal(){this.listeners_&&Ps(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;const n=this.listeners_[t];if(!n)return;const s=n.indexOf(e);s!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[s]=Rr,++this.pendingRemovals_[t]):(n.splice(s,1),n.length===0&&delete this.listeners_[t]))}}function ct(i,t,e,n,s){if(s){const a=e;e=function(o){return i.removeEventListener(t,e),a.call(n??this,o)}}else n&&n!==i&&(e=e.bind(n));const r={target:i,type:t,listener:e};return i.addEventListener(t,e),r}function no(i,t,e,n){return ct(i,t,e,n,!0)}function vt(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),Ps(i))}class qr extends Ls{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(Y.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=ct(this,t[r],e);return s}return ct(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const s=t.length;n=new Array(s);for(let r=0;r<s;++r)n[r]=no(this,t[r],e)}else n=no(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)ep(n);else if(Array.isArray(t))for(let s=0,r=t.length;s<r;++s)this.removeEventListener(t[s],e);else this.removeEventListener(t,e)}}qr.prototype.on;qr.prototype.once;qr.prototype.un;function ep(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)vt(i[t]);else vt(i)}function tt(){throw new Error("Unimplemented abstract method.")}let ip=0;function Z(i){return i.ol_uid||(i.ol_uid=String(++ip))}class Hu extends Ke{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}class He extends qr{constructor(t){super(),this.on,this.once,this.un,Z(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let n;n=`change:${t}`,this.hasListener(n)&&this.dispatchEvent(new Hu(n,t,e)),n=xs.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new Hu(n,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,n){const s=this.values_||(this.values_={});if(n)s[t]=e;else{const r=s[t];s[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const n in t)this.set(n,t[n],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const n=this.values_[t];delete this.values_[t],qi(this.values_)&&(this.values_=null),e||this.notify(t,n)}}}const Yu={LENGTH:"length"};class Ea extends Ke{constructor(t,e,n){super(t),this.element=e,this.index=n}}let ei=class extends He{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let n=0,s=this.array_.length;n<s;++n)this.assertUnique_(this.array_[n],n);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,n=t.length;e<n;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let n=0,s=e.length;n<s;++n)t(e[n],n,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Yu.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Ea(ge.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let n=0,s=e.length;n<s;++n)if(e[n]===t)return this.removeAt(n)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Ea(ge.REMOVE,e,t)),e}setAt(t,e){const n=this.getLength();if(t>=n){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const s=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Ea(ge.REMOVE,s,t)),this.dispatchEvent(new Ea(ge.ADD,e,t))}updateLength_(){this.set(Yu.LENGTH,this.array_.length)}assertUnique_(t,e){for(let n=0,s=this.array_.length;n<s;++n)if(this.array_[n]===t&&n!==e)throw new Error("Duplicate item added to a unique collection")}};class Wn extends Ke{constructor(t,e,n){super(t),this.map=e,this.frameState=n!==void 0?n:null}}class Di extends Wn{constructor(t,e,n,s,r,a){super(t,e,r),this.originalEvent=n,this.pixel_=null,this.coordinate_=null,this.dragging=s!==void 0?s:!1,this.activePointers=a}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Nt={SINGLECLICK:"singleclick",CLICK:Y.CLICK,DBLCLICK:Y.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},pn=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",np=pn.includes("safari")&&!pn.includes("chrom"),sp=np&&(pn.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(pn)),rp=pn.includes("webkit")&&!pn.includes("edge"),dg=pn.includes("macintosh"),ap=typeof devicePixelRatio<"u"?devicePixelRatio:1,No=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,tc=typeof Image<"u"&&Image.prototype.decode,gg=typeof createImageBitmap=="function",_g=function(){let i=!1;try{const t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}(),ah={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown"};class op extends Ls{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const n=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=n,this.pointerdownListenerKey_=ct(n,ah.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=ct(n,ah.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(Y.TOUCHMOVE,this.boundHandleTouchMove_,_g?{passive:!1}:!1)}emulateClick_(t){let e=new Di(Nt.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Di(Nt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const n=new Di(Nt.SINGLECLICK,this.map_,t);this.dispatchEvent(n)},250)}updateActivePointers_(t){const e=t,n=e.pointerId;if(e.type==Nt.POINTERUP||e.type==Nt.POINTERCANCEL){delete this.trackedTouches_[n];for(const s in this.trackedTouches_)if(this.trackedTouches_[s].target!==e.target){delete this.trackedTouches_[s];break}}else(e.type==Nt.POINTERDOWN||e.type==Nt.POINTERMOVE)&&(this.trackedTouches_[n]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Di(Nt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(vt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new Di(Nt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);if(this.dispatchEvent(e),this.down_=new PointerEvent(t.type,t),Object.defineProperty(this.down_,"target",{writable:!1,value:t.target}),this.dragListenerKeys_.length===0){const n=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ct(n,Nt.POINTERMOVE,this.handlePointerMove_,this),ct(n,Nt.POINTERUP,this.handlePointerUp_,this),ct(this.element_,Nt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==n&&this.dragListenerKeys_.push(ct(this.element_.getRootNode(),Nt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Di(Nt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Di(Nt.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(vt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(Y.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(vt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(vt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const yi={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ee={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},z={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ft(i,t){if(!i)throw new Error(t)}const so=1/0;class lp{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Ps(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,n=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const s=this.keyFunction_(n);return delete this.queuedElements_[s],n}enqueue(t){ft(!(this.keyFunction_(t)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const e=this.priorityFunction_(t);return e!=so?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,n=this.priorities_,s=e.length,r=e[t],a=n[t],o=t;for(;t<s>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),c=h<s&&n[h]<n[l]?h:l;e[t]=e[c],n[t]=n[c],t=c}e[t]=r,n[t]=a,this.siftDown_(o,t)}siftDown_(t,e){const n=this.elements_,s=this.priorities_,r=n[e],a=s[e];for(;e>t;){const o=this.getParentIndex_(e);if(s[o]>a)n[e]=n[o],s[e]=s[o],e=o;else break}n[e]=r,s[e]=a}reprioritize(){const t=this.priorityFunction_,e=this.elements_,n=this.priorities_;let s=0;const r=e.length;let a,o,l;for(o=0;o<r;++o)a=e[o],l=t(a),l==so?delete this.queuedElements_[this.keyFunction_(a)]:(n[s]=l,e[s++]=a);e.length=s,n.length=s,this.heapify_()}}class hp extends lp{constructor(t,e){super(n=>t.apply(null,n),n=>n[0].getKey()),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(Y.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,n=e.getState();if(n===z.LOADED||n===z.ERROR||n===z.EMPTY){n!==z.ERROR&&e.removeEventListener(Y.CHANGE,this.boundHandleTileChange_);const s=e.getKey();s in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[s],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let n=0;for(;this.tilesLoading_<t&&n<e&&this.getCount()>0;){const s=this.dequeue()[0],r=s.getKey();s.getState()===z.IDLE&&!(r in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[r]=!0,++this.tilesLoading_,++n,s.load())}}}function cp(i,t,e,n,s){if(!i||!(e in i.wantedTiles)||!i.wantedTiles[e][t.getKey()])return so;const r=i.viewState.center,a=n[0]-r[0],o=n[1]-r[1];return 65536*Math.log(s)+Math.sqrt(a*a+o*o)/s}const bt={ANIMATING:0,INTERACTING:1},ke={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function wt(i,t,e){return Math.min(Math.max(i,t),e)}function up(i,t,e,n,s,r){const a=s-e,o=r-n;if(a!==0||o!==0){const l=((i-e)*a+(t-n)*o)/(a*a+o*o);l>1?(e=s,n=r):l>0&&(e+=a*l,n+=o*l)}return _n(i,t,e,n)}function _n(i,t,e,n){const s=e-i,r=n-t;return s*s+r*r}function fp(i){const t=i.length;for(let n=0;n<t;n++){let s=n,r=Math.abs(i[n][n]);for(let o=n+1;o<t;o++){const l=Math.abs(i[o][n]);l>r&&(r=l,s=o)}if(r===0)return null;const a=i[s];i[s]=i[n],i[n]=a;for(let o=n+1;o<t;o++){const l=-i[o][n]/i[n][n];for(let h=n;h<t+1;h++)n==h?i[o][h]=0:i[o][h]+=l*i[n][h]}}const e=new Array(t);for(let n=t-1;n>=0;n--){e[n]=i[n][t]/i[n][n];for(let s=n-1;s>=0;s--)i[s][t]-=i[s][n]*e[n]}return e}function Zu(i){return i*180/Math.PI}function ji(i){return i*Math.PI/180}function mn(i,t){const e=i%t;return e*t<0?e+t:e}function Te(i,t,e){return i+e*(t-i)}function Kr(i,t){const e=Math.pow(10,t);return Math.round(i*e)/e}function Qu(i,t){return Math.round(Kr(i,t))}function va(i,t){return Math.floor(Kr(i,t))}function Ni(i,t){return Math.ceil(Kr(i,t))}function oh(i,t,e){if(i>=t&&i<e)return i;const n=e-t;return((i-t)%n+n)%n+t}function Ju(i,t,e){return function(n,s,r,a,o){if(!n)return;if(!s&&!t)return n;const l=t?0:r[0]*s,h=t?0:r[1]*s,c=o?o[0]:0,u=o?o[1]:0;let f=i[0]+l/2+c,_=i[2]-l/2+c,g=i[1]+h/2+u,x=i[3]-h/2+u;f>_&&(f=(_+f)/2,_=f),g>x&&(g=(x+g)/2,x=g);let y=wt(n[0],f,_),w=wt(n[1],g,x);if(a&&e&&s){const d=30*s;y+=-d*Math.log(1+Math.max(0,f-n[0])/d)+d*Math.log(1+Math.max(0,n[0]-_)/d),w+=-d*Math.log(1+Math.max(0,g-n[1])/d)+d*Math.log(1+Math.max(0,n[1]-x)/d)}return[y,w]}}function dp(i){return i}const $t={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function Es(i){const t=xe();for(let e=0,n=i.length;e<n;++e)fr(t,i[e]);return t}function gp(i,t,e){const n=Math.min.apply(null,i),s=Math.min.apply(null,t),r=Math.max.apply(null,i),a=Math.max.apply(null,t);return Ti(n,s,r,a,e)}function ai(i,t,e){return e?(e[0]=i[0]-t,e[1]=i[1]-t,e[2]=i[2]+t,e[3]=i[3]+t,e):[i[0]-t,i[1]-t,i[2]+t,i[3]+t]}function mg(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i.slice()}function Sn(i,t,e){let n,s;return t<i[0]?n=i[0]-t:i[2]<t?n=t-i[2]:n=0,e<i[1]?s=i[1]-e:i[3]<e?s=e-i[3]:s=0,n*n+s*s}function wi(i,t){return ec(i,t[0],t[1])}function Xe(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function ec(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function lh(i,t){const e=i[0],n=i[1],s=i[2],r=i[3],a=t[0],o=t[1];let l=$t.UNKNOWN;return a<e?l=l|$t.LEFT:a>s&&(l=l|$t.RIGHT),o<n?l=l|$t.BELOW:o>r&&(l=l|$t.ABOVE),l===$t.UNKNOWN&&(l=$t.INTERSECTING),l}function xe(){return[1/0,1/0,-1/0,-1/0]}function Ti(i,t,e,n,s){return s?(s[0]=i,s[1]=t,s[2]=e,s[3]=n,s):[i,t,e,n]}function Os(i){return Ti(1/0,1/0,-1/0,-1/0,i)}function pg(i,t){const e=i[0],n=i[1];return Ti(e,n,e,n,t)}function ic(i,t,e,n,s){const r=Os(s);return yg(r,i,t,e,n)}function yn(i,t){return i[0]==t[0]&&i[2]==t[2]&&i[1]==t[1]&&i[3]==t[3]}function nc(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function fr(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function yg(i,t,e,n,s){for(;e<n;e+=s)_p(i,t[e],t[e+1]);return i}function _p(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function xg(i,t){let e;return e=t(ko(i)),e||(e=t(Uo(i)),e)||(e=t(Bo(i)),e)||(e=t(li(i)),e)?e:!1}function Mr(i){let t=0;return Ri(i)||(t=ot(i)*It(i)),t}function ko(i){return[i[0],i[1]]}function Uo(i){return[i[2],i[1]]}function We(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function mp(i,t){let e;if(t==="bottom-left")e=ko(i);else if(t==="bottom-right")e=Uo(i);else if(t==="top-left")e=li(i);else if(t==="top-right")e=Bo(i);else throw new Error("Invalid corner");return e}function ro(i,t,e,n,s){const[r,a,o,l,h,c,u,f]=sc(i,t,e,n);return Ti(Math.min(r,o,h,u),Math.min(a,l,c,f),Math.max(r,o,h,u),Math.max(a,l,c,f),s)}function sc(i,t,e,n){const s=t*n[0]/2,r=t*n[1]/2,a=Math.cos(e),o=Math.sin(e),l=s*a,h=s*o,c=r*a,u=r*o,f=i[0],_=i[1];return[f-l+u,_-h-c,f-l-u,_-h+c,f+l-u,_+h+c,f+l+u,_+h-c,f-l+u,_-h-c]}function It(i){return i[3]-i[1]}function Xt(i,t,e){const n=e||xe();return Pt(i,t)?(i[0]>t[0]?n[0]=i[0]:n[0]=t[0],i[1]>t[1]?n[1]=i[1]:n[1]=t[1],i[2]<t[2]?n[2]=i[2]:n[2]=t[2],i[3]<t[3]?n[3]=i[3]:n[3]=t[3]):Os(n),n}function li(i){return[i[0],i[3]]}function Bo(i){return[i[2],i[3]]}function ot(i){return i[2]-i[0]}function Pt(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function Ri(i){return i[2]<i[0]||i[3]<i[1]}function pp(i,t){return t?(t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t):i}function yp(i,t,e){let n=!1;const s=lh(i,t),r=lh(i,e);if(s===$t.INTERSECTING||r===$t.INTERSECTING)n=!0;else{const a=i[0],o=i[1],l=i[2],h=i[3],c=t[0],u=t[1],f=e[0],_=e[1],g=(_-u)/(f-c);let x,y;r&$t.ABOVE&&!(s&$t.ABOVE)&&(x=f-(_-h)/g,n=x>=a&&x<=l),!n&&r&$t.RIGHT&&!(s&$t.RIGHT)&&(y=_-(f-l)*g,n=y>=o&&y<=h),!n&&r&$t.BELOW&&!(s&$t.BELOW)&&(x=f-(_-o)/g,n=x>=a&&x<=l),!n&&r&$t.LEFT&&!(s&$t.LEFT)&&(y=_-(f-a)*g,n=y>=o&&y<=h)}return n}function rc(i,t,e,n){if(Ri(i))return Os(e);let s=[];s=[i[0],i[1],i[2],i[1],i[2],i[3],i[0],i[3]],t(s,s,2);const r=[],a=[];for(let o=0,l=s.length;o<l;o+=2)r.push(s[o]),a.push(s[o+1]);return gp(r,a,e)}function Eg(i,t){const e=t.getExtent(),n=We(i);if(t.canWrapX()&&(n[0]<e[0]||n[0]>=e[2])){const s=ot(e),a=Math.floor((n[0]-e[0])/s)*s;i[0]-=a,i[2]-=a}return i}function ac(i,t,e){if(t.canWrapX()){const n=t.getExtent();if(!isFinite(i[0])||!isFinite(i[2]))return[[n[0],i[1],n[2],i[3]]];Eg(i,t);const s=ot(n);if(ot(i)>s&&!e)return[[n[0],i[1],n[2],i[3]]];if(i[0]<n[0])return[[i[0]+s,i[1],n[2],i[3]],[n[0],i[1],i[2],i[3]]];if(i[2]>n[2])return[[i[0],i[1],n[2],i[3]],[n[0],i[1],i[2]-s,i[3]]]}return[i]}function vg(i,t){const e=(""+i).split("."),n=(""+t).split(".");for(let s=0;s<Math.max(e.length,n.length);s++){const r=parseInt(e[s]||"0",10),a=parseInt(n[s]||"0",10);if(r>a)return 1;if(a>r)return-1}return 0}function xp(i,t){return i[0]+=+t[0],i[1]+=+t[1],i}function ao(i,t){let e=!0;for(let n=i.length-1;n>=0;--n)if(i[n]!=t[n]){e=!1;break}return e}function oc(i,t){const e=Math.cos(t),n=Math.sin(t),s=i[0]*e-i[1]*n,r=i[1]*e+i[0]*n;return i[0]=s,i[1]=r,i}function Ep(i,t){return i[0]*=t,i[1]*=t,i}function lc(i,t){if(t.canWrapX()){const e=ot(t.getExtent()),n=wg(i,t,e);n&&(i[0]-=n*e)}return i}function wg(i,t,e){const n=t.getExtent();let s=0;return t.canWrapX()&&(i[0]<n[0]||i[0]>n[2])&&(e=e||ot(n),s=Math.floor((i[0]-n[0])/e)),s}function Tg(i){return Math.pow(i,3)}function Fs(i){return 1-Tg(1-i)}function vp(i){return 3*i*i-2*i*i*i}function wp(i){return i}const Tp=63710088e-1;function tf(i,t,e){e=e||Tp;const n=ji(i[1]),s=ji(t[1]),r=(s-n)/2,a=ji(t[0]-i[0])/2,o=Math.sin(r)*Math.sin(r)+Math.sin(a)*Math.sin(a)*Math.cos(n)*Math.cos(s);return 2*e*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}function Sg(...i){console.warn(...i)}function ef(...i){console.error(...i)}const Sp={9001:"m",9002:"ft",9003:"us-ft",9101:"radians",9102:"degrees"};function nf(i){return Sp[i]}const hc={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let xn=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||hc[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const Hr=6378137,es=Math.PI*Hr,Rp=[-es,-es,es,es],Mp=[-180,-85,180,85],wa=Hr*Math.log(Math.tan(Math.PI/2));class Dn extends xn{constructor(t){super({code:t,units:"m",extent:Rp,global:!0,worldExtent:Mp,getPointResolution:function(e,n){return e/Math.cosh(n[1]/Hr)}})}}const sf=[new Dn("EPSG:3857"),new Dn("EPSG:102100"),new Dn("EPSG:102113"),new Dn("EPSG:900913"),new Dn("http://www.opengis.net/def/crs/EPSG/0/3857"),new Dn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Cp(i,t,e,n){const s=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(s));for(let r=0;r<s;r+=n){t[r]=es*i[r]/180;let a=Hr*Math.log(Math.tan(Math.PI*(+i[r+1]+90)/360));a>wa?a=wa:a<-wa&&(a=-wa),t[r+1]=a}return t}function bp(i,t,e,n){const s=i.length;e=e>1?e:2,n=n??e,t===void 0&&(e>2?t=i.slice():t=new Array(s));for(let r=0;r<s;r+=n)t[r]=180*i[r]/es,t[r+1]=360*Math.atan(Math.exp(i[r+1]/Hr))/Math.PI-90;return t}const Ip=6378137,rf=[-180,-90,180,90],Ap=Math.PI*Ip/180;class an extends xn{constructor(t,e){super({code:t,units:"degrees",extent:rf,axisOrientation:e,global:!0,metersPerUnit:Ap,worldExtent:rf})}}const af=[new an("CRS:84"),new an("EPSG:4326","neu"),new an("urn:ogc:def:crs:OGC:1.3:CRS84"),new an("urn:ogc:def:crs:OGC:2:84"),new an("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new an("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new an("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let hh={};function us(i){return hh[i]||hh[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Pp(i,t){hh[i]=t}let fs={};function En(i,t,e){const n=i.getCode(),s=t.getCode();n in fs||(fs[n]={}),fs[n][s]=e}function Wa(i,t){return i in fs&&t in fs[i]?fs[i][t]:null}const oo=.9996,De=.00669438,zo=De*De,Xo=zo*De,un=De/(1-De),of=Math.sqrt(1-De),vs=(1-of)/(1+of),Rg=vs*vs,cc=Rg*vs,uc=cc*vs,Mg=uc*vs,Cg=1-De/4-3*zo/64-5*Xo/256,Lp=3*De/8+3*zo/32+45*Xo/1024,Op=15*zo/256+45*Xo/1024,Fp=35*Xo/3072,Dp=3/2*vs-27/32*cc+269/512*Mg,Gp=21/16*Rg-55/32*uc,Np=151/96*cc-417/128*Mg,kp=1097/512*uc,lo=6378137;function Up(i,t,e){const n=i-5e5,a=(e.north?t:t-1e7)/oo/(lo*Cg),o=a+Dp*Math.sin(2*a)+Gp*Math.sin(4*a)+Np*Math.sin(6*a)+kp*Math.sin(8*a),l=Math.sin(o),h=l*l,c=Math.cos(o),u=l/c,f=u*u,_=f*f,g=1-De*h,x=Math.sqrt(1-De*h),y=lo/x,w=(1-De)/g,d=un*c**2,p=d*d,v=n/(y*oo),T=v*v,R=T*v,C=R*v,b=C*v,I=b*v,P=o-u/w*(T/2-C/24*(5+3*f+10*d-4*p-9*un))+I/720*(61+90*f+298*d+45*_-252*un-3*p);let G=(v-R/6*(1+2*f+d)+b/120*(5-2*d+28*f-3*p+8*un+24*_))/c;return G=oh(G+ji(bg(e.number)),-Math.PI,Math.PI),[Zu(G),Zu(P)]}const lf=-80,hf=84,Bp=-180,zp=180;function Xp(i,t,e){i=oh(i,Bp,zp),t<lf?t=lf:t>hf&&(t=hf);const n=ji(t),s=Math.sin(n),r=Math.cos(n),a=s/r,o=a*a,l=o*o,h=ji(i),c=bg(e.number),u=ji(c),f=lo/Math.sqrt(1-De*s**2),_=un*r**2,g=r*oh(h-u,-Math.PI,Math.PI),x=g*g,y=x*g,w=y*g,d=w*g,p=d*g,v=lo*(Cg*n-Lp*Math.sin(2*n)+Op*Math.sin(4*n)-Fp*Math.sin(6*n)),T=oo*f*(g+y/6*(1-o+_)+d/120*(5-18*o+l+72*_-58*un))+5e5;let R=oo*(v+f*a*(x/2+w/24*(5-o+9*_+4*_**2)+p/720*(61-58*o+l+600*_-330*un)));return e.north||(R+=1e7),[T,R]}function bg(i){return(i-1)*6-180+3}const jp=[/^EPSG:(\d+)$/,/^urn:ogc:def:crs:EPSG::(\d+)$/,/^http:\/\/www\.opengis\.net\/def\/crs\/EPSG\/0\/(\d+)$/];function Ig(i){let t=0;for(const s of jp){const r=i.match(s);if(r){t=parseInt(r[1]);break}}if(!t)return null;let e=0,n=!1;return t>32700&&t<32761?e=t-32700:t>32600&&t<32661&&(n=!0,e=t-32600),e?{number:e,north:n}:null}function cf(i,t){return function(e,n,s,r){const a=e.length;s=s>1?s:2,r=r??s,n||(s>2?n=e.slice():n=new Array(a));for(let o=0;o<a;o+=r){const l=e[o],h=e[o+1],c=i(l,h,t);n[o]=c[0],n[o+1]=c[1]}return n}}function Vp(i){return Ig(i)?new xn({code:i,units:"m"}):null}function $p(i){const t=Ig(i.getCode());return t?{forward:cf(Xp,t),inverse:cf(Up,t)}:null}const Wp=[$p],qp=[Vp];let ch=!0;function Kp(i){ch=!1}function fc(i,t){if(t!==void 0){for(let e=0,n=i.length;e<n;++e)t[e]=i[e];t=t}else t=i.slice();return t}function ho(i){Pp(i.getCode(),i),En(i,i,fc)}function Hp(i){i.forEach(ho)}function lt(i){if(typeof i!="string")return i;const t=us(i);if(t)return t;for(const e of qp){const n=e(i);if(n)return n}return null}function uf(i,t,e,n){i=lt(i);let s;const r=i.getPointResolutionFunc();if(r)s=r(t,e);else{const a=i.getUnits();if(a=="degrees"&&!n||n=="degrees")s=t;else{const o=Yr(i,lt("EPSG:4326"));if(!o&&a!=="degrees")s=t*i.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=o(h,h,2);const c=tf(h.slice(0,2),h.slice(2,4)),u=tf(h.slice(4,6),h.slice(6,8));s=(c+u)/2}const l=i.getMetersPerUnit();l!==void 0&&(s/=l)}}return s}function uh(i){Hp(i),i.forEach(function(t){i.forEach(function(e){t!==e&&En(t,e,fc)})})}function Yp(i,t,e,n){i.forEach(function(s){t.forEach(function(r){En(s,r,e),En(r,s,n)})})}function dc(i,t){return i?typeof i=="string"?lt(i):i:lt(t)}function co(i){return function(t,e,n,s){const r=t.length;n=n!==void 0?n:2,s=s??n,e=e!==void 0?e:new Array(r);for(let a=0;a<r;a+=s){const o=i(t.slice(a,a+n)),l=o.length;for(let h=0,c=s;h<c;++h)e[a+h]=h>=l?t[a+h]:o[h]}return e}}function Zp(i,t,e,n){const s=lt(i),r=lt(t);En(s,r,co(e)),En(r,s,co(n))}function Ge(i,t){if(i===t)return!0;const e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||Yr(i,t)===fc)&&e}function Yr(i,t){const e=i.getCode(),n=t.getCode();let s=Wa(e,n);if(s)return s;let r=null,a=null;for(const l of Wp)r||(r=l(i)),a||(a=l(t));if(!r&&!a)return null;const o="EPSG:4326";if(a)if(r)s=pl(r.inverse,a.forward);else{const l=Wa(e,o);l&&(s=pl(l,a.forward))}else{const l=Wa(o,n);l&&(s=pl(r.inverse,l))}return s&&(ho(i),ho(t),En(i,t,s)),s}function pl(i,t){return function(e,n,s,r){return n=i(e,n,s,r),t(n,n,s,r)}}function ws(i,t){const e=lt(i),n=lt(t);return Yr(e,n)}function gc(i,t,e){const n=ws(t,e);if(!n){const s=lt(t).getCode(),r=lt(e).getCode();throw new Error(`No transform available between ${s} and ${r}`)}return n(i,void 0,i.length)}function fh(i,t,e,n){const s=ws(t,e);return rc(i,s,void 0)}let Qp=null;function Jp(){return Qp}function uo(i,t){return i}function pi(i,t){return ch&&!ao(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(ch=!1,Sg("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i}function jo(i,t){return i}function Oe(i,t){return i}function ff(i,t,e){return function(n){let s,r;if(i.canWrapX()){const a=i.getExtent(),o=ot(a);n=n.slice(0),r=wg(n,i,o),r&&(n[0]=n[0]-r*o),n[0]=wt(n[0],a[0],a[2]),n[1]=wt(n[1],a[1],a[3]),s=e(n)}else s=e(n);return r&&t.canWrapX()&&(s[0]+=r*ot(t.getExtent())),s}}function t1(){uh(sf),uh(af),Yp(af,sf,Cp,bp)}t1();const _c=new Array(6);function Zt(){return[1,0,0,1,0,0]}function dh(i){return Vo(i,1,0,0,1,0,0)}function Ts(i,t){const e=i[0],n=i[1],s=i[2],r=i[3],a=i[4],o=i[5],l=t[0],h=t[1],c=t[2],u=t[3],f=t[4],_=t[5];return i[0]=e*l+s*h,i[1]=n*l+r*h,i[2]=e*c+s*u,i[3]=n*c+r*u,i[4]=e*f+s*_+a,i[5]=n*f+r*_+o,i}function Vo(i,t,e,n,s,r,a){return i[0]=t,i[1]=e,i[2]=n,i[3]=s,i[4]=r,i[5]=a,i}function e1(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i}function kt(i,t){const e=t[0],n=t[1];return t[0]=i[0]*e+i[2]*n+i[4],t[1]=i[1]*e+i[3]*n+i[5],t}function i1(i,t){const e=Math.cos(t),n=Math.sin(t);return Ts(i,Vo(_c,e,n,-n,e,0,0))}function dr(i,t,e){return Ts(i,Vo(_c,t,0,0,e,0,0))}function Ag(i,t,e){return Ts(i,Vo(_c,1,0,0,1,t,e))}function Ne(i,t,e,n,s,r,a,o){const l=Math.sin(r),h=Math.cos(r);return i[0]=n*h,i[1]=s*l,i[2]=-n*l,i[3]=s*h,i[4]=a*n*h-o*n*l+t,i[5]=a*s*l+o*s*h+e,i}function mc(i,t){const e=n1(t);ft(e!==0,"Transformation matrix cannot be inverted");const n=t[0],s=t[1],r=t[2],a=t[3],o=t[4],l=t[5];return i[0]=a/e,i[1]=-s/e,i[2]=-r/e,i[3]=n/e,i[4]=(r*l-a*o)/e,i[5]=-(n*l-s*o)/e,i}function n1(i){return i[0]*i[3]-i[1]*i[2]}const s1=[1e5,1e5,1e5,1e5,2,2];function r1(i){return"matrix("+i.join(", ")+")"}function df(i){return i.substring(7,i.length-1).split(",").map(parseFloat)}function a1(i,t){const e=df(i),n=df(t);for(let s=0;s<6;++s)if(Math.round((e[s]-n[s])*s1[s])!==0)return!1;return!0}function Vi(i,t,e,n,s,r,a){r=r||[],a=a||2;let o=0;for(let l=t;l<e;l+=n){const h=i[l],c=i[l+1];r[o++]=s[0]*h+s[2]*c+s[4],r[o++]=s[1]*h+s[3]*c+s[5];for(let u=2;u<a;u++)r[o++]=i[l+u]}return r&&r.length!=o&&(r.length=o),r}function Pg(i,t,e,n,s,r,a){a=a||[];const o=Math.cos(s),l=Math.sin(s),h=r[0],c=r[1];let u=0;for(let f=t;f<e;f+=n){const _=i[f]-h,g=i[f+1]-c;a[u++]=h+_*o-g*l,a[u++]=c+_*l+g*o;for(let x=f+2;x<f+n;++x)a[u++]=i[x]}return a&&a.length!=u&&(a.length=u),a}function o1(i,t,e,n,s,r,a,o){o=o||[];const l=a[0],h=a[1];let c=0;for(let u=t;u<e;u+=n){const f=i[u]-l,_=i[u+1]-h;o[c++]=l+s*f,o[c++]=h+r*_;for(let g=u+2;g<u+n;++g)o[c++]=i[g]}return o&&o.length!=c&&(o.length=c),o}function l1(i,t,e,n,s,r,a){a=a||[];let o=0;for(let l=t;l<e;l+=n){a[o++]=i[l]+s,a[o++]=i[l+1]+r;for(let h=l+2;h<l+n;++h)a[o++]=i[h]}return a&&a.length!=o&&(a.length=o),a}const gf=Zt(),h1=[NaN,NaN];class Lg extends He{constructor(){super(),this.extent_=xe(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=fg((t,e,n)=>{if(!n)return this.getSimplifiedGeometry(e);const s=this.clone();return s.applyTransform(n),s.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return tt()}closestPointXY(t,e,n,s){return tt()}containsXY(t,e){return this.closestPointXY(t,e,h1,Number.MIN_VALUE)===0}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return tt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Os(e),this.extentRevision_=this.getRevision()}return pp(this.extent_,t)}rotate(t,e){tt()}scale(t,e,n){tt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return tt()}getType(){return tt()}applyTransform(t){tt()}intersectsExtent(t){return tt()}translate(t,e){tt()}transform(t,e){const n=lt(t),s=n.getUnits()=="tile-pixels"?function(r,a,o){const l=n.getExtent(),h=n.getWorldExtent(),c=It(h)/It(l);Ne(gf,h[0],h[3],c,-c,0,0,0);const u=Vi(r,0,r.length,o,gf,a),f=ws(n,e);return f?f(u,u,o):u}:ws(n,e);return this.applyTransform(s),this}}class Rn extends Lg{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(t){return ic(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return tt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=_f(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){tt()}setLayout(t,e,n){let s;if(t)s=_f(t);else{for(let r=0;r<n;++r){if(e.length===0){this.layout="XY",this.stride=2;return}e=e[0]}s=e.length,t=Mn(s)}this.layout=t,this.stride=s}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.layout.startsWith("XYZ")?3:2,this.stride),this.changed())}rotate(t,e){const n=this.getFlatCoordinates();if(n){const s=this.getStride();Pg(n,0,n.length,s,t,e,n),this.changed()}}scale(t,e,n){e===void 0&&(e=t),n||(n=We(this.getExtent()));const s=this.getFlatCoordinates();if(s){const r=this.getStride();o1(s,0,s.length,r,t,e,n,s),this.changed()}}translate(t,e){const n=this.getFlatCoordinates();if(n){const s=this.getStride();l1(n,0,n.length,s,t,e,n),this.changed()}}}function Mn(i){let t;return i==2?t="XY":i==3?t="XYZ":i==4&&(t="XYZM"),t}function _f(i){let t;return i=="XY"?t=2:i=="XYZ"||i=="XYM"?t=3:i=="XYZM"&&(t=4),t}function c1(i,t,e){const n=i.getFlatCoordinates();if(!n)return null;const s=i.getStride();return Vi(n,0,n.length,s,t,e)}function Og(i,t,e,n){let s=0;const r=i[e-n],a=i[e-n+1];let o=0,l=0;for(;t<e;t+=n){const h=i[t]-r,c=i[t+1]-a;s+=l*h-o*c,o=h,l=c}return s/2}function Fg(i,t,e,n){let s=0;for(let r=0,a=e.length;r<a;++r){const o=e[r];s+=Og(i,t,o,n),t=o}return s}function u1(i,t,e,n){let s=0;for(let r=0,a=e.length;r<a;++r){const o=e[r];s+=Fg(i,t,o,n),t=o[o.length-1]}return s}function mf(i,t,e,n,s,r,a){const o=i[t],l=i[t+1],h=i[e]-o,c=i[e+1]-l;let u;if(h===0&&c===0)u=t;else{const f=((s-o)*h+(r-l)*c)/(h*h+c*c);if(f>1)u=e;else if(f>0){for(let _=0;_<n;++_)a[_]=Te(i[t+_],i[e+_],f);a.length=n;return}else u=t}for(let f=0;f<n;++f)a[f]=i[u+f];a.length=n}function pc(i,t,e,n,s){let r=i[t],a=i[t+1];for(t+=n;t<e;t+=n){const o=i[t],l=i[t+1],h=_n(r,a,o,l);h>s&&(s=h),r=o,a=l}return s}function yc(i,t,e,n,s){for(let r=0,a=e.length;r<a;++r){const o=e[r];s=pc(i,t,o,n,s),t=o}return s}function f1(i,t,e,n,s){for(let r=0,a=e.length;r<a;++r){const o=e[r];s=yc(i,t,o,n,s),t=o[o.length-1]}return s}function xc(i,t,e,n,s,r,a,o,l,h,c){if(t==e)return h;let u,f;if(s===0){if(f=_n(a,o,i[t],i[t+1]),f<h){for(u=0;u<n;++u)l[u]=i[t+u];return l.length=n,f}return h}c=c||[NaN,NaN];let _=t+n;for(;_<e;)if(mf(i,_-n,_,n,a,o,c),f=_n(a,o,c[0],c[1]),f<h){for(h=f,u=0;u<n;++u)l[u]=c[u];l.length=n,_+=n}else _+=n*Math.max((Math.sqrt(f)-Math.sqrt(h))/s|0,1);if(r&&(mf(i,e-n,t,n,a,o,c),f=_n(a,o,c[0],c[1]),f<h)){for(h=f,u=0;u<n;++u)l[u]=c[u];l.length=n}return h}function Ec(i,t,e,n,s,r,a,o,l,h,c){c=c||[NaN,NaN];for(let u=0,f=e.length;u<f;++u){const _=e[u];h=xc(i,t,_,n,s,r,a,o,l,h,c),t=_}return h}function d1(i,t,e,n,s,r,a,o,l,h,c){c=c||[NaN,NaN];for(let u=0,f=e.length;u<f;++u){const _=e[u];h=Ec(i,t,_,n,s,r,a,o,l,h,c),t=_[_.length-1]}return h}function g1(i,t,e,n){for(let s=0,r=e.length;s<r;++s)i[t++]=e[s];return t}function $o(i,t,e,n){for(let s=0,r=e.length;s<r;++s){const a=e[s];for(let o=0;o<n;++o)i[t++]=a[o]}return t}function Zr(i,t,e,n,s){s=s||[];let r=0;for(let a=0,o=e.length;a<o;++a){const l=$o(i,t,e[a],n);s[r++]=l,t=l}return s.length=r,s}function Dg(i,t,e,n,s){s=s||[];let r=0;for(let a=0,o=e.length;a<o;++a){const l=Zr(i,t,e[a],n,s[r]);l.length===0&&(l[0]=t),s[r++]=l,t=l[l.length-1]}return s.length=r,s}function ki(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let a=t;a<e;a+=n)s[r++]=i.slice(a,a+n);return s.length=r,s}function Cr(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let a=0,o=e.length;a<o;++a){const l=e[a];s[r++]=ki(i,t,l,n,s[r]),t=l}return s.length=r,s}function gh(i,t,e,n,s){s=s!==void 0?s:[];let r=0;for(let a=0,o=e.length;a<o;++a){const l=e[a];s[r++]=l.length===1&&l[0]===t?[]:Cr(i,t,l,n,s[r]),t=l[l.length-1]}return s.length=r,s}function Wo(i,t,e,n,s,r,a){const o=(e-t)/n;if(o<3){for(;t<e;t+=n)r[a++]=i[t],r[a++]=i[t+1];return a}const l=new Array(o);l[0]=1,l[o-1]=1;const h=[t,e-n];let c=0;for(;h.length>0;){const u=h.pop(),f=h.pop();let _=0;const g=i[f],x=i[f+1],y=i[u],w=i[u+1];for(let d=f+n;d<u;d+=n){const p=i[d],v=i[d+1],T=up(p,v,g,x,y,w);T>_&&(c=d,_=T)}_>s&&(l[(c-t)/n]=1,f+n<c&&h.push(f,c),c+n<u&&h.push(c,u))}for(let u=0;u<o;++u)l[u]&&(r[a++]=i[t+u*n],r[a++]=i[t+u*n+1]);return a}function Gg(i,t,e,n,s,r,a,o){for(let l=0,h=e.length;l<h;++l){const c=e[l];a=Wo(i,t,c,n,s,r,a),o.push(a),t=c}return a}function ln(i,t){return t*Math.round(i/t)}function _1(i,t,e,n,s,r,a){if(t==e)return a;let o=ln(i[t],s),l=ln(i[t+1],s);t+=n,r[a++]=o,r[a++]=l;let h,c;do if(h=ln(i[t],s),c=ln(i[t+1],s),t+=n,t==e)return r[a++]=h,r[a++]=c,a;while(h==o&&c==l);for(;t<e;){const u=ln(i[t],s),f=ln(i[t+1],s);if(t+=n,u==h&&f==c)continue;const _=h-o,g=c-l,x=u-o,y=f-l;if(_*y==g*x&&(_<0&&x<_||_==x||_>0&&x>_)&&(g<0&&y<g||g==y||g>0&&y>g)){h=u,c=f;continue}r[a++]=h,r[a++]=c,o=h,l=c,h=u,c=f}return r[a++]=h,r[a++]=c,a}function vc(i,t,e,n,s,r,a,o){for(let l=0,h=e.length;l<h;++l){const c=e[l];a=_1(i,t,c,n,s,r,a),o.push(a),t=c}return a}function m1(i,t,e,n,s,r,a,o){for(let l=0,h=e.length;l<h;++l){const c=e[l],u=[];a=vc(i,t,c,n,s,r,a,u),o.push(u),t=c[c.length-1]}return a}class br extends Rn{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new br(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,n,s){return s<Sn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),xc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,s))}getArea(){return Og(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return ki(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new br(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=$o(this.flatCoordinates,0,t,this.stride),this.changed()}}let Ir=class Ng extends Rn{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Ng(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){const r=this.flatCoordinates,a=_n(t,e,r[0],r[1]);if(a<s){const o=this.stride;for(let l=0;l<o;++l)n[l]=r[l];return n.length=o,a}return s}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(t){return pg(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return ec(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=g1(this.flatCoordinates,0,t,this.stride),this.changed()}};function p1(i,t,e,n,s){return!xg(s,function(a){return!fn(i,t,e,n,a[0],a[1])})}function fn(i,t,e,n,s,r){let a=0,o=i[e-n],l=i[e-n+1];for(;t<e;t+=n){const h=i[t],c=i[t+1];l<=r?c>r&&(h-o)*(r-l)-(s-o)*(c-l)>0&&a++:c<=r&&(h-o)*(r-l)-(s-o)*(c-l)<0&&a--,o=h,l=c}return a!==0}function wc(i,t,e,n,s,r){if(e.length===0||!fn(i,t,e[0],n,s,r))return!1;for(let a=1,o=e.length;a<o;++a)if(fn(i,e[a-1],e[a],n,s,r))return!1;return!0}function y1(i,t,e,n,s,r){if(e.length===0)return!1;for(let a=0,o=e.length;a<o;++a){const l=e[a];if(wc(i,t,l,n,s,r))return!0;t=l[l.length-1]}return!1}function Tc(i,t,e,n,s,r,a){let o,l,h,c,u,f,_;const g=s[r+1],x=[];for(let d=0,p=e.length;d<p;++d){const v=e[d];for(c=i[v-n],f=i[v-n+1],o=t;o<v;o+=n)u=i[o],_=i[o+1],(g<=f&&_<=g||f<=g&&g<=_)&&(h=(g-f)/(_-f)*(u-c)+c,x.push(h)),c=u,f=_}let y=NaN,w=-1/0;for(x.sort(si),c=x[0],o=1,l=x.length;o<l;++o){u=x[o];const d=Math.abs(u-c);d>w&&(h=(c+u)/2,wc(i,t,e,n,h,g)&&(y=h,w=d)),c=u}return isNaN(y)&&(y=s[r]),a?(a.push(y,g,w),a):[y,g,w]}function kg(i,t,e,n,s){let r=[];for(let a=0,o=e.length;a<o;++a){const l=e[a];r=Tc(i,t,l,n,s,2*a,r),t=l[l.length-1]}return r}function Ug(i,t,e,n,s){let r;for(t+=n;t<e;t+=n)if(r=s(i.slice(t-n,t),i.slice(t,t+n)),r)return r;return!1}function qo(i,t,e,n,s,r){return r=r??yg(xe(),i,t,e,n),Pt(s,r)?r[0]>=s[0]&&r[2]<=s[2]||r[1]>=s[1]&&r[3]<=s[3]?!0:Ug(i,t,e,n,function(a,o){return yp(s,a,o)}):!1}function x1(i,t,e,n,s){for(let r=0,a=e.length;r<a;++r){if(qo(i,t,e[r],n,s))return!0;t=e[r]}return!1}function Bg(i,t,e,n,s){return!!(qo(i,t,e,n,s)||fn(i,t,e,n,s[0],s[1])||fn(i,t,e,n,s[0],s[3])||fn(i,t,e,n,s[2],s[1])||fn(i,t,e,n,s[2],s[3]))}function zg(i,t,e,n,s){if(!Bg(i,t,e[0],n,s))return!1;if(e.length===1)return!0;for(let r=1,a=e.length;r<a;++r)if(p1(i,e[r-1],e[r],n,s)&&!qo(i,e[r-1],e[r],n,s))return!1;return!0}function E1(i,t,e,n,s){for(let r=0,a=e.length;r<a;++r){const o=e[r];if(zg(i,t,o,n,s))return!0;t=o[o.length-1]}return!1}function v1(i,t,e,n){for(;t<e-n;){for(let s=0;s<n;++s){const r=i[t+s];i[t+s]=i[e-n+s],i[e-n+s]=r}t+=n,e-=n}}function Sc(i,t,e,n){let s=0,r=i[e-n],a=i[e-n+1];for(;t<e;t+=n){const o=i[t],l=i[t+1];s+=(o-r)*(l+a),r=o,a=l}return s===0?void 0:s>0}function Rc(i,t,e,n,s){s=s!==void 0?s:!1;for(let r=0,a=e.length;r<a;++r){const o=e[r],l=Sc(i,t,o,n);if(r===0){if(s&&l||!s&&!l)return!1}else if(s&&!l||!s&&l)return!1;t=o}return!0}function Xg(i,t,e,n,s){for(let r=0,a=e.length;r<a;++r){const o=e[r];if(!Rc(i,t,o,n,s))return!1;o.length&&(t=o[o.length-1])}return!0}function fo(i,t,e,n,s){s=s!==void 0?s:!1;for(let r=0,a=e.length;r<a;++r){const o=e[r],l=Sc(i,t,o,n);(r===0?s&&l||!s&&!l:s&&!l||!s&&l)&&v1(i,t,o,n),t=o}return t}function _h(i,t,e,n,s){for(let r=0,a=e.length;r<a;++r)t=fo(i,t,e[r],n,s);return t}function jg(i,t){const e=[];let n=0,s=0,r;for(let a=0,o=t.length;a<o;++a){const l=t[a],h=Sc(i,n,l,2);if(r===void 0&&(r=h),h===r)e.push(t.slice(s,a+1));else{if(e.length===0)continue;e[e.length-1].push(t[s])}s=a+1,n=l}return e}class Si extends Rn{constructor(t,e,n){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&n?(this.setFlatCoordinates(e,t),this.ends_=n):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?ri(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Si(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<Sn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(yc(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ec(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,s))}containsXY(t,e){return wc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Fg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),fo(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,Cr(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=We(this.getExtent());this.flatInteriorPoint_=Tc(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ir(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new br(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,n=this.ends_,s=[];let r=0;for(let a=0,o=n.length;a<o;++a){const l=n[a],h=new br(e.slice(r,l),t);s.push(h),r=l}return s}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Rc(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=fo(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=vc(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new Si(e,"XY",n)}getType(){return"Polygon"}intersectsExtent(t){return zg(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Zr(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}function pf(i){if(Ri(i))throw new Error("Cannot create polygon from empty extent");const t=i[0],e=i[1],n=i[2],s=i[3],r=[t,e,t,s,n,s,n,e,t,e];return new Si(r,"XY",[r.length])}function Mc(i,t,e,n){const s=ot(t)/e[0],r=It(t)/e[1];return n?Math.min(i,Math.max(s,r)):Math.min(i,Math.min(s,r))}function Cc(i,t,e){let n=Math.min(i,t);const s=50;return n*=Math.log(1+s*Math.max(0,i/t-1))/s+1,e&&(n=Math.max(n,e),n/=Math.log(1+s*Math.max(0,e/i-1))/s+1),wt(n,e/2,t*2)}function w1(i,t,e,n){return t=t!==void 0?t:!0,function(s,r,a,o){if(s!==void 0){const l=i[0],h=i[i.length-1],c=e?Mc(l,e,a,n):l;if(o)return t?Cc(s,c,h):wt(s,h,c);const u=Math.min(c,s),f=Math.floor(Do(i,u,r));return i[f]>c&&f<i.length-1?i[f+1]:i[f]}}}function T1(i,t,e,n,s,r){return n=n!==void 0?n:!0,e=e!==void 0?e:0,function(a,o,l,h){if(a!==void 0){const c=s?Mc(t,s,l,r):t;if(h)return n?Cc(a,c,e):wt(a,e,c);const u=1e-9,f=Math.ceil(Math.log(t/c)/Math.log(i)-u),_=-o*(.5-u)+.5,g=Math.min(c,a),x=Math.floor(Math.log(t/g)/Math.log(i)+_),y=Math.max(f,x),w=t/Math.pow(i,y);return wt(w,e,c)}}}function yf(i,t,e,n,s){return e=e!==void 0?e:!0,function(r,a,o,l){if(r!==void 0){const h=n?Mc(i,n,o,s):i;return!e||!l?wt(r,t,h):Cc(r,h,t)}}}function bc(i){if(i!==void 0)return 0}function xf(i){if(i!==void 0)return i}function S1(i){const t=2*Math.PI/i;return function(e,n){if(n)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function R1(i){const t=ji(5);return function(e,n){return n||e===void 0?e:Math.abs(e)<=t?0:e}}const Vg=42,Ic=256,yl=0;class ti extends He{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=dc(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Kp(),t.center&&(t.center=pi(t.center,this.projection_)),t.extent&&(t.extent=Oe(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const o in ke)delete e[o];this.setProperties(e,!0);const n=C1(t);this.maxResolution_=n.maxResolution,this.minResolution_=n.minResolution,this.zoomFactor_=n.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=n.minZoom;const s=M1(t),r=n.constraint,a=b1(t);this.constraints_={center:s,resolution:r,rotation:a},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const n=this.getCenterInternal();if(n){const s=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution(),a=r/2*(s[3]-e[3]+e[1]-s[1]),o=r/2*(s[0]-e[0]+e[2]-s[2]);this.setCenterInternal([n[0]+a,n[1]-o])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let n=0;n<e.length;++n){let s=arguments[n];s.center&&(s=Object.assign({},s),s.center=pi(s.center,this.getProjection())),s.anchor&&(s=Object.assign({},s),s.anchor=pi(s.anchor,this.getProjection())),e[n]=s}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);let s=0;for(;s<e&&!this.isDef();++s){const c=arguments[s];c.center&&this.setCenterInternal(c.center),c.zoom!==void 0?this.setZoom(c.zoom):c.resolution&&this.setResolution(c.resolution),c.rotation!==void 0&&this.setRotation(c.rotation)}if(s===e){n&&Ta(n,!0);return}let r=Date.now(),a=this.targetCenter_.slice(),o=this.targetResolution_,l=this.targetRotation_;const h=[];for(;s<e;++s){const c=arguments[s],u={start:r,complete:!1,anchor:c.anchor,duration:c.duration!==void 0?c.duration:1e3,easing:c.easing||vp,callback:n};if(c.center&&(u.sourceCenter=a,u.targetCenter=c.center.slice(),a=u.targetCenter),c.zoom!==void 0?(u.sourceResolution=o,u.targetResolution=this.getResolutionForZoom(c.zoom),o=u.targetResolution):c.resolution&&(u.sourceResolution=o,u.targetResolution=c.resolution,o=u.targetResolution),c.rotation!==void 0){u.sourceRotation=l;const f=mn(c.rotation-l+Math.PI,2*Math.PI)-Math.PI;u.targetRotation=l+f,l=u.targetRotation}I1(u)?u.complete=!0:r+=u.duration,h.push(u)}this.animations_.push(h),this.setHint(bt.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[bt.ANIMATING]>0}getInteracting(){return this.hints_[bt.INTERACTING]>0}cancelAnimations(){this.setHint(bt.ANIMATING,-this.hints_[bt.ANIMATING]);let t;for(let e=0,n=this.animations_.length;e<n;++e){const s=this.animations_[e];if(s[0].callback&&Ta(s[0].callback,!1),!t)for(let r=0,a=s.length;r<a;++r){const o=s[r];if(!o.complete){t=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let n=this.animations_.length-1;n>=0;--n){const s=this.animations_[n];let r=!0;for(let a=0,o=s.length;a<o;++a){const l=s[a];if(l.complete)continue;const h=t-l.start;let c=l.duration>0?h/l.duration:1;c>=1?(l.complete=!0,c=1):r=!1;const u=l.easing(c);if(l.sourceCenter){const f=l.sourceCenter[0],_=l.sourceCenter[1],g=l.targetCenter[0],x=l.targetCenter[1];this.nextCenter_=l.targetCenter;const y=f+u*(g-f),w=_+u*(x-_);this.targetCenter_=[y,w]}if(l.sourceResolution&&l.targetResolution){const f=u===1?l.targetResolution:l.sourceResolution+u*(l.targetResolution-l.sourceResolution);if(l.anchor){const _=this.getViewportSize_(this.getRotation()),g=this.constraints_.resolution(f,0,_,!0);this.targetCenter_=this.calculateCenterZoom(g,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=f,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const f=u===1?mn(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+u*(l.targetRotation-l.sourceRotation);if(l.anchor){const _=this.constraints_.rotation(f,!0);this.targetCenter_=this.calculateCenterRotate(_,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=f}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(r){this.animations_[n]=null,this.setHint(bt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const a=s[0].callback;a&&Ta(a,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let n;const s=this.getCenterInternal();return s!==void 0&&(n=[s[0]-e[0],s[1]-e[1]],oc(n,t-this.getRotation()),xp(n,e)),n}calculateCenterZoom(t,e){let n;const s=this.getCenterInternal(),r=this.getResolution();if(s!==void 0&&r!==void 0){const a=e[0]-t*(e[0]-s[0])/r,o=e[1]-t*(e[1]-s[1])/r;n=[a,o]}return n}getViewportSize_(t){const e=this.viewportSize_;if(t){const n=e[0],s=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(s*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(s*Math.cos(t))]}return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&uo(t,this.getProjection())}getCenterInternal(){return this.get(ke.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return jo(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();ft(e,"The view center is not defined");const n=this.getResolution();ft(n!==void 0,"The view resolution is not defined");const s=this.getRotation();return ft(s!==void 0,"The view rotation is not defined"),ro(e,n,s,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(ke.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(Oe(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const n=ot(t)/e[0],s=It(t)/e[1];return Math.max(n,s)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(e/n)/Math.log(t);return function(r){return e/Math.pow(t,r*s)}}getRotation(){return this.get(ke.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),s=this.minResolution_,r=Math.log(n/s)/e;return function(a){return Math.log(n/a)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),n=this.getRotation();let s=this.getCenterInternal();const r=this.padding_;if(r){const a=this.getViewportSizeMinusPadding_();s=xl(s,this.getViewportSize_(),[a[0]/2+r[3],a[1]/2+r[0]],e,n)}return{center:s.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,n,s;if(this.resolutions_){const r=Do(this.resolutions_,t,1);e=r,n=this.resolutions_[r],r==this.resolutions_.length-1?s=2:s=n/this.resolutions_[r+1]}else n=this.maxResolution_,s=this.zoomFactor_;return e+Math.log(n/t)/Math.log(s)}getResolutionForZoom(t){if(this.resolutions_?.length){if(this.resolutions_.length===1)return this.resolutions_[0];const e=wt(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,wt(t-e,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let n;if(ft(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(t)){ft(!Ri(t),"Cannot fit empty extent provided as `geometry`");const s=Oe(t,this.getProjection());n=pf(s)}else if(t.getType()==="Circle"){const s=Oe(t.getExtent(),this.getProjection());n=pf(s),n.rotate(this.getRotation(),We(s))}else n=t;this.fitInternal(n,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),n=Math.cos(e),s=Math.sin(-e),r=t.getFlatCoordinates(),a=t.getStride();let o=1/0,l=1/0,h=-1/0,c=-1/0;for(let u=0,f=r.length;u<f;u+=a){const _=r[u]*n-r[u+1]*s,g=r[u]*s+r[u+1]*n;o=Math.min(o,_),l=Math.min(l,g),h=Math.max(h,_),c=Math.max(c,g)}return[o,l,h,c]}fitInternal(t,e){e=e||{};let n=e.size;n||(n=this.getViewportSizeMinusPadding_());const s=e.padding!==void 0?e.padding:[0,0,0,0],r=e.nearest!==void 0?e.nearest:!1;let a;e.minResolution!==void 0?a=e.minResolution:e.maxZoom!==void 0?a=this.getResolutionForZoom(e.maxZoom):a=0;const o=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(o,[n[0]-s[1]-s[3],n[1]-s[0]-s[2]]);l=isNaN(l)?a:Math.max(l,a),l=this.getConstrainedResolution(l,r?0:1);const h=this.getRotation(),c=Math.sin(h),u=Math.cos(h),f=We(o);f[0]+=(s[1]-s[3])/2*l,f[1]+=(s[0]-s[2])/2*l;const _=f[0]*u-f[1]*c,g=f[1]*u+f[0]*c,x=this.getConstrainedCenter([_,g],l),y=e.callback?e.callback:Rr;e.duration!==void 0?this.animateInternal({resolution:l,center:x,duration:e.duration,easing:e.easing},y):(this.targetResolution_=l,this.targetCenter_=x,this.applyTargetState_(!1,!0),Ta(y,!0))}centerOn(t,e,n){this.centerOnInternal(pi(t,this.getProjection()),e,n)}centerOnInternal(t,e,n){this.setCenterInternal(xl(t,e,n,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,n,s){let r;const a=this.padding_;if(a&&t){const o=this.getViewportSizeMinusPadding_(-n),l=xl(t,s,[o[0]/2+a[3],o[1]/2+a[0]],e,n);r=[t[0]-l[0],t[1]-l[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=uo(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&pi(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const n=this.getAnimating()||this.getInteracting(),s=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,s,n);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=pi(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const n=this.getAnimating()||this.getInteracting(),s=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(s,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&pi(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const n=this.getAnimating()||this.getInteracting()||e,s=this.constraints_.rotation(this.targetRotation_,n),r=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,0,r,n),o=this.constraints_.center(this.targetCenter_,a,r,n,this.calculateCenterShift(this.targetCenter_,a,s,r));this.get(ke.ROTATION)!==s&&this.set(ke.ROTATION,s),this.get(ke.RESOLUTION)!==a&&(this.set(ke.RESOLUTION,a),this.set("zoom",this.getZoom(),!0)),(!o||!this.get(ke.CENTER)||!ao(this.get(ke.CENTER),o))&&this.set(ke.CENTER,o),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,n){t=t!==void 0?t:200;const s=e||0,r=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(r),o=this.constraints_.resolution(this.targetResolution_,s,a),l=this.constraints_.center(this.targetCenter_,o,a,!1,this.calculateCenterShift(this.targetCenter_,o,r,a));if(t===0&&!this.cancelAnchor_){this.targetResolution_=o,this.targetRotation_=r,this.targetCenter_=l,this.applyTargetState_();return}n=n||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==o||this.getRotation()!==r||!this.getCenterInternal()||!ao(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:l,resolution:o,duration:t,easing:Fs,anchor:n}))}beginInteraction(){this.resolveConstraints(0),this.setHint(bt.INTERACTING,1)}endInteraction(t,e,n){n=n&&pi(n,this.getProjection()),this.endInteractionInternal(t,e,n)}endInteractionInternal(t,e,n){this.getInteracting()&&(this.setHint(bt.INTERACTING,-1),this.resolveConstraints(t,e,n))}getConstrainedCenter(t,e){const n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)}getConstrainedZoom(t,e){const n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))}getConstrainedResolution(t,e){e=e||0;const n=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,n)}}function Ta(i,t){setTimeout(function(){i(t)},0)}function M1(i){if(i.extent!==void 0){const e=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return Ju(i.extent,i.constrainOnlyCenter,e)}const t=dc(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Ju(e,!1,!1)}return dp}function C1(i){let t,e,n,a=i.minZoom!==void 0?i.minZoom:yl,o=i.maxZoom!==void 0?i.maxZoom:28;const l=i.zoomFactor!==void 0?i.zoomFactor:2,h=i.multiWorld!==void 0?i.multiWorld:!1,c=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,u=i.showFullExtent!==void 0?i.showFullExtent:!1,f=dc(i.projection,"EPSG:3857"),_=f.getExtent();let g=i.constrainOnlyCenter,x=i.extent;if(!h&&!x&&f.isGlobal()&&(g=!1,x=_),i.resolutions!==void 0){const y=i.resolutions;e=y[a],n=y[o]!==void 0?y[o]:y[y.length-1],i.constrainResolution?t=w1(y,c,!g&&x,u):t=yf(e,n,c,!g&&x,u)}else{const w=(_?Math.max(ot(_),It(_)):360*hc.degrees/f.getMetersPerUnit())/Ic/Math.pow(2,yl),d=w/Math.pow(2,28-yl);e=i.maxResolution,e!==void 0?a=0:e=w/Math.pow(l,a),n=i.minResolution,n===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?n=e/Math.pow(l,o):n=w/Math.pow(l,o):n=d),o=a+Math.floor(Math.log(e/n)/Math.log(l)),n=e/Math.pow(l,o-a),i.constrainResolution?t=T1(l,e,n,c,!g&&x,u):t=yf(e,n,c,!g&&x,u)}return{constraint:t,maxResolution:e,minResolution:n,minZoom:a,zoomFactor:l}}function b1(i){if(i.enableRotation!==void 0?i.enableRotation:!0){const e=i.constrainRotation;return e===void 0||e===!0?R1():e===!1?xf:typeof e=="number"?S1(e):xf}return bc}function I1(i){return!(i.sourceCenter&&i.targetCenter&&!ao(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function xl(i,t,e,n,s){const r=Math.cos(-s);let a=Math.sin(-s),o=i[0]*r-i[1]*a,l=i[1]*r+i[0]*a;o+=(t[0]/2-e[0])*n,l+=(e[1]-t[1]/2)*n,a=-a;const h=o*r-l*a,c=l*r+o*a;return[h,c]}const Sa="ol-hidden",A1="ol-selectable",Ko="ol-unselectable",Ac="ol-control",Ef="ol-collapsed",P1=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z0-9]+?)\\s*$`].join(""),"i"),vf=["style","variant","weight","size","lineHeight","family"],mh={normal:400,bold:700},ph=function(i){const t=i.match(P1);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"400",variant:"normal"};for(let n=0,s=vf.length;n<s;++n){const r=t[n+1];r!==void 0&&(e[vf[n]]=typeof r=="string"?r.trim():r)}return isNaN(Number(e.weight))&&e.weight in mh&&(e.weight=mh[e.weight]),e.families=e.family.split(/,\s?/).map(n=>n.trim().replace(/^['"]|['"]$/g,"")),e};function Ot(i,t,e,n){let s;return e&&e.length?s=e.shift():No?s=new OffscreenCanvas(i||300,t||300):s=document.createElement("canvas"),i&&(s.width=i),t&&(s.height=t),s.getContext("2d",n)}let El;function go(){return El||(El=Ot(1,1)),El}function Qr(i){const t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function L1(i){let t=i.offsetWidth;const e=getComputedStyle(i);return t+=parseInt(e.marginLeft,10)+parseInt(e.marginRight,10),t}function O1(i){let t=i.offsetHeight;const e=getComputedStyle(i);return t+=parseInt(e.marginTop,10)+parseInt(e.marginBottom,10),t}function wf(i,t){const e=t.parentNode;e&&e.replaceChild(i,t)}function $g(i){for(;i.lastChild;)i.lastChild.remove()}function F1(i,t){const e=i.childNodes;for(let n=0;;++n){const s=e[n],r=t[n];if(!s&&!r)break;if(s!==r){if(!s){i.appendChild(r);continue}if(!r){i.removeChild(s),--n;continue}i.insertBefore(r,s)}}}class Pc extends He{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){this.element?.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&this.element?.remove();for(let e=0,n=this.listenerKeys.length;e<n;++e)vt(this.listenerKeys[e]);if(this.listenerKeys.length=0,this.map_=t,t){const e=this.target_??t.getOverlayContainerStopEvent();this.element&&e.appendChild(this.element),this.render!==Rr&&this.listenerKeys.push(ct(t,yi.POSTRENDER,this.render,this)),t.render()}}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class D1 extends Pc{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=t.attributions;const e=t.className!==void 0?t.className:"ol-attribution",n=t.tipLabel!==void 0?t.tipLabel:"Attributions",s=t.expandClassName!==void 0?t.expandClassName:e+"-expand",r=t.collapseLabel!==void 0?t.collapseLabel:"›",a=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=a):this.collapseLabel_=r;const o=t.label!==void 0?t.label:"i";typeof o=="string"?(this.label_=document.createElement("span"),this.label_.textContent=o,this.label_.className=s):this.label_=o;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=n,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(Y.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+Ko+" "+Ac+(this.collapsed_&&this.collapsible_?" "+Ef:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=h,c.appendChild(this.toggleButton_),c.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e=this.getMap().getAllLayers(),n=new Set(e.flatMap(s=>s.getAttributions(t)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(s=>n.add(s)):n.add(this.attributions_)),!this.overrideCollapsible_){const s=!e.some(r=>r.getSource()?.getAttributionsCollapsible()===!1);this.setCollapsible(s)}return Array.from(n)}async updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=await Promise.all(this.collectSourceAttributions_(t).map(s=>Jh(()=>s))),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!Ji(e,this.renderedAttributions_)){$g(this.ulElement_);for(let s=0,r=e.length;s<r;++s){const a=document.createElement("li");a.innerHTML=e[s],this.ulElement_.appendChild(a)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Ef),this.collapsed_?wf(this.collapseLabel_,this.label_):wf(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class G1 extends Pc{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",n=t.label!==void 0?t.label:"⇧",s=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof n=="string"?(this.label_=document.createElement("span"),this.label_.className=s,this.label_.textContent=n):(this.label_=n,this.label_.classList.add(s));const r=t.tipLabel?t.tipLabel:"Reset rotation",a=document.createElement("button");a.className=e+"-reset",a.setAttribute("type","button"),a.title=r,a.appendChild(this.label_),a.addEventListener(Y.CLICK,this.handleClick_.bind(this),!1);const o=e+" "+Ko+" "+Ac,l=this.element;l.className=o,l.appendChild(a),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Sa)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const n=e.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Fs}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const n=e.viewState.rotation;if(n!=this.rotation_){const s="rotate("+n+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Sa);!r&&n===0?this.element.classList.add(Sa):r&&n!==0&&this.element.classList.remove(Sa)}this.label_.style.transform=s}this.rotation_=n}}class N1 extends Pc{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",n=t.delta!==void 0?t.delta:1,s=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",r=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",a=t.zoomInLabel!==void 0?t.zoomInLabel:"+",o=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",c=document.createElement("button");c.className=s,c.setAttribute("type","button"),c.title=l,c.appendChild(typeof a=="string"?document.createTextNode(a):a),c.addEventListener(Y.CLICK,this.handleClick_.bind(this,n),!1);const u=document.createElement("button");u.className=r,u.setAttribute("type","button"),u.title=h,u.appendChild(typeof o=="string"?document.createTextNode(o):o),u.addEventListener(Y.CLICK,this.handleClick_.bind(this,-n),!1);const f=e+" "+Ko+" "+Ac,_=this.element;_.className=f,_.appendChild(c),_.appendChild(u),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const n=this.getMap().getView();if(!n)return;const s=n.getZoom();if(s!==void 0){const r=n.getConstrainedZoom(s+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:r,duration:this.duration_,easing:Fs})):n.setZoom(r)}}}function k1(i){i=i||{};const t=new ei;return(i.zoom!==void 0?i.zoom:!0)&&t.push(new N1(i.zoomOptions)),(i.rotate!==void 0?i.rotate:!0)&&t.push(new G1(i.rotateOptions)),(i.attribution!==void 0?i.attribution:!0)&&t.push(new D1(i.attributionOptions)),t}class U1{constructor(t,e,n){this.decay_=t,this.minVelocity_=e,this.delay_=n,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let n=e-3;for(;n>0&&this.points_[n+2]>t;)n-=3;const s=this.points_[e+2]-this.points_[n+2];if(s<1e3/60)return!1;const r=this.points_[e]-this.points_[n],a=this.points_[e+1]-this.points_[n+1];return this.angle_=Math.atan2(a,r),this.initialVelocity_=Math.sqrt(r*r+a*a)/s,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const Tf={ACTIVE:"active"};class Jr extends He{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Tf.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Tf.ACTIVE,t)}setMap(t){this.map_=t}}function B1(i,t,e){const n=i.getCenterInternal();if(n){const s=[n[0]+t[0],n[1]+t[1]];i.animateInternal({duration:e!==void 0?e:250,easing:wp,center:i.getConstrainedCenter(s)})}}function Lc(i,t,e,n){const s=i.getZoom();if(s===void 0)return;const r=i.getConstrainedZoom(s+t),a=i.getResolutionForZoom(r);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:a,anchor:e,duration:n!==void 0?n:250,easing:Fs})}class z1 extends Jr{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==Nt.DBLCLICK){const n=t.originalEvent,s=t.map,r=t.coordinate,a=n.shiftKey?-this.delta_:this.delta_,o=s.getView();Lc(o,a,r,this.duration_),n.preventDefault(),e=!0}return!e}}function yh(i){const t=arguments;return function(e){let n=!0;for(let s=0,r=t.length;s<r&&(n=n&&t[s](e),!!n);++s);return n}}const X1=function(i){const t=i.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},j1=function(i){const t=i.map.getTargetElement(),e=t.getRootNode(),n=i.map.getOwnerDocument().activeElement;return e instanceof ShadowRoot?e.host.contains(n):t.contains(n)},Wg=function(i){const t=i.map.getTargetElement(),e=t.getRootNode();return(e instanceof ShadowRoot?e.host:t).hasAttribute("tabindex")?j1(i):!0},V1=Sr,qg=function(i){const t=i.originalEvent;return"pointerId"in t&&t.button==0&&!(rp&&dg&&t.ctrlKey)},Kg=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},$1=function(i){const t=i.originalEvent;return dg?t.metaKey:t.ctrlKey},W1=function(i){const t=i.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Hg=function(i){const t=i.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},vl=function(i){const t=i.originalEvent;return"pointerId"in t&&t.pointerType=="mouse"},q1=function(i){const t=i.originalEvent;return"pointerId"in t&&t.isPrimary&&t.button===0};class ta extends Jr{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Nt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Nt.POINTERUP){const n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==Nt.POINTERDOWN){const n=this.handleDownEvent(t);this.handlingDownUpSequence=n,e=this.stopDown(n)}else t.type==Nt.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function Oc(i){const t=i.length;let e=0,n=0;for(let s=0;s<t;s++)e+=i[s].clientX,n+=i[s].clientY;return{clientX:e/t,clientY:n/t}}class K1 extends ta{constructor(t){super({stopDown:Go}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:yh(Kg,q1);this.condition_=t.onFocusOnly?yh(Wg,e):e,this.noKinetic_=!1}handleDragEvent(t){const e=t.map;this.panning_||(this.panning_=!0,e.getView().beginInteraction());const n=this.targetPointers,s=e.getEventPixel(Oc(n));if(n.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(s[0],s[1]),this.lastCentroid){const r=[this.lastCentroid[0]-s[0],s[1]-this.lastCentroid[1]],o=t.map.getView();Ep(r,o.getResolution()),oc(r,o.getRotation()),o.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=s,this.lastPointersCount_=n.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const s=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),a=n.getCenterInternal(),o=e.getPixelFromCoordinateInternal(a),l=e.getCoordinateFromPixelInternal([o[0]-s*Math.cos(r),o[1]-s*Math.sin(r)]);n.animateInternal({center:n.getConstrainedCenter(l),duration:500,easing:Fs})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const n=t.map.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class H1 extends ta{constructor(t){t=t||{},super({stopDown:Go}),this.condition_=t.condition?t.condition:X1,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!vl(t))return;const e=t.map,n=e.getView();if(n.getConstraints().rotation===bc)return;const s=e.getSize(),r=t.pixel,a=Math.atan2(s[1]/2-r[1],r[0]-s[0]/2);if(this.lastAngle_!==void 0){const o=a-this.lastAngle_;n.adjustRotationInternal(-o)}this.lastAngle_=a}handleUpEvent(t){return vl(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return vl(t)&&qg(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class Y1 extends Wr{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,n="px",s=this.element_.style;s.left=Math.min(t[0],e[0])+n,s.top=Math.min(t[1],e[1])+n,s.width=Math.abs(e[0]-t[0])+n,s.height=Math.abs(e[1]-t[1])+n}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const t=this.startPixel_,e=this.endPixel_,s=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);s[4]=s[0].slice(),this.geometry_?this.geometry_.setCoordinates([s]):this.geometry_=new Si([s])}getGeometry(){return this.geometry_}}const Gn={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class qs extends Ke{constructor(t,e,n){super(t),this.coordinate=e,this.mapBrowserEvent=n}}class Z1 extends ta{constructor(t){super(),this.on,this.once,this.un,t=t??{},this.box_=new Y1(t.className||"ol-dragbox"),this.minArea_=t.minArea??64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition??qg,this.boxEndCondition_=t.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,n){const s=n[0]-e[0],r=n[1]-e[1];return s*s+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.startPixel_&&(this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new qs(Gn.BOXDRAG,t.coordinate,t)))}handleUpEvent(t){if(!this.startPixel_)return!1;const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new qs(e?Gn.BOXEND:Gn.BOXCANCEL,t.coordinate,t)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new qs(Gn.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}setActive(t){t||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new qs(Gn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(t)}setMap(t){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new qs(Gn.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(t)}}class Q1 extends Z1{constructor(t){t=t||{};const e=t.condition?t.condition:W1;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const n=this.getMap().getView();let s=this.getGeometry();if(this.out_){const r=n.rotatedExtentForGeometry(s),a=n.getResolutionForExtentInternal(r),o=n.getResolution()/a;s=s.clone(),s.scale(o*o)}n.fitInternal(s,{duration:this.duration_,easing:Fs})}}const on={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class J1 extends Jr{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return Kg(e)&&Hg(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==Y.KEYDOWN){const n=t.originalEvent,s=n.key;if(this.condition_(t)&&(s==on.DOWN||s==on.LEFT||s==on.RIGHT||s==on.UP)){const a=t.map.getView(),o=a.getResolution()*this.pixelDelta_;let l=0,h=0;s==on.DOWN?h=-o:s==on.LEFT?l=-o:s==on.RIGHT?l=o:h=o;const c=[l,h];oc(c,a.getRotation()),B1(a,c,this.duration_),n.preventDefault(),e=!0}}return!e}}class ty extends Jr{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:function(e){return!$1(e)&&Hg(e)},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==Y.KEYDOWN||t.type==Y.KEYPRESS){const n=t.originalEvent,s=n.key;if(this.condition_(t)&&(s==="+"||s==="-")){const r=t.map,a=s==="+"?this.delta_:-this.delta_,o=r.getView();Lc(o,a,void 0,this.duration_),n.preventDefault(),e=!0}}return!e}}const ey=40,iy=300;class ny extends Jr{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:V1;this.condition_=t.onFocusOnly?yh(Wg,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(t){if(!this.condition_(t)||t.type!==Y.WHEEL)return!0;const n=t.map,s=t.originalEvent;s.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.pixel);let r=s.deltaY;switch(s.deltaMode){case WheelEvent.DOM_DELTA_LINE:r*=ey;break;case WheelEvent.DOM_DELTA_PAGE:r*=iy;break}if(r===0)return!1;this.lastDelta_=r;const a=Date.now();this.startTime_===void 0&&(this.startTime_=a),(!this.mode_||a-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const o=n.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?n.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=a,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(a-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let n=-wt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),Lc(e,n,this.lastAnchor_?t.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class sy extends ta{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Go),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const n=this.targetPointers[0],s=this.targetPointers[1],r=Math.atan2(s.clientY-n.clientY,s.clientX-n.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=r;const a=t.map,o=a.getView();o.getConstraints().rotation!==bc&&(this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(Oc(this.targetPointers))),this.rotating_&&(a.render(),o.adjustRotationInternal(e,this.anchor_)))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}class ry extends ta{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=Go),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const n=this.targetPointers[0],s=this.targetPointers[1],r=n.clientX-s.clientX,a=n.clientY-s.clientY,o=Math.sqrt(r*r+a*a);this.lastDistance_!==void 0&&(e=this.lastDistance_/o),this.lastDistance_=o;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Oc(this.targetPointers))),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const n=t.map.getView(),s=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,s),!1}return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}return!1}}function ay(i){i=i||{};const t=new ei,e=new U1(-.005,.05,100);return(i.altShiftDragRotate!==void 0?i.altShiftDragRotate:!0)&&t.push(new H1),(i.doubleClickZoom!==void 0?i.doubleClickZoom:!0)&&t.push(new z1({delta:i.zoomDelta,duration:i.zoomDuration})),(i.dragPan!==void 0?i.dragPan:!0)&&t.push(new K1({onFocusOnly:i.onFocusOnly,kinetic:e})),(i.pinchRotate!==void 0?i.pinchRotate:!0)&&t.push(new sy),(i.pinchZoom!==void 0?i.pinchZoom:!0)&&t.push(new ry({duration:i.zoomDuration})),(i.keyboard!==void 0?i.keyboard:!0)&&(t.push(new J1),t.push(new ty({delta:i.zoomDelta,duration:i.zoomDuration}))),(i.mouseWheelZoom!==void 0?i.mouseWheelZoom:!0)&&t.push(new ny({onFocusOnly:i.onFocusOnly,duration:i.zoomDuration})),(i.shiftDragZoom!==void 0?i.shiftDragZoom:!0)&&t.push(new Q1({duration:i.zoomDuration})),t}const _t={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Yg extends He{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[_t.OPACITY]=t.opacity!==void 0?t.opacity:1,ft(typeof e[_t.OPACITY]=="number","Layer opacity must be a number"),e[_t.VISIBLE]=t.visible!==void 0?t.visible:!0,e[_t.Z_INDEX]=t.zIndex,e[_t.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[_t.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[_t.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[_t.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=wt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return tt()}getLayerStatesArray(t){return tt()}getExtent(){return this.get(_t.EXTENT)}getMaxResolution(){return this.get(_t.MAX_RESOLUTION)}getMinResolution(){return this.get(_t.MIN_RESOLUTION)}getMinZoom(){return this.get(_t.MIN_ZOOM)}getMaxZoom(){return this.get(_t.MAX_ZOOM)}getOpacity(){return this.get(_t.OPACITY)}getSourceState(){return tt()}getVisible(){return this.get(_t.VISIBLE)}getZIndex(){return this.get(_t.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(_t.EXTENT,t)}setMaxResolution(t){this.set(_t.MAX_RESOLUTION,t)}setMinResolution(t){this.set(_t.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(_t.MAX_ZOOM,t)}setMinZoom(t){this.set(_t.MIN_ZOOM,t)}setOpacity(t){ft(typeof t=="number","Layer opacity must be a number"),this.set(_t.OPACITY,t)}setVisible(t){this.set(_t.VISIBLE,t)}setZIndex(t){this.set(_t.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class Gi extends Ke{constructor(t,e){super(t),this.layer=e}}const wl={LAYERS:"layers"};class Cn extends Yg{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let n=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(wl.LAYERS,this.handleLayersChanged_),n?Array.isArray(n)?n=new ei(n.slice(),{unique:!0}):ft(typeof n.getArray=="function","Expected `layers` to be an array or a `Collection`"):n=new ei(void 0,{unique:!0}),this.setLayers(n)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(vt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(ct(t,ge.ADD,this.handleLayersAdd_,this),ct(t,ge.REMOVE,this.handleLayersRemove_,this));for(const n in this.listenerKeys_)this.listenerKeys_[n].forEach(vt);Ps(this.listenerKeys_);const e=t.getArray();for(let n=0,s=e.length;n<s;n++){const r=e[n];this.registerLayerListeners_(r),this.dispatchEvent(new Gi("addlayer",r))}this.changed()}registerLayerListeners_(t){const e=[ct(t,xs.PROPERTYCHANGE,this.handleLayerChange_,this),ct(t,Y.CHANGE,this.handleLayerChange_,this)];t instanceof Cn&&e.push(ct(t,"addlayer",this.handleLayerGroupAdd_,this),ct(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Z(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Gi("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Gi("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Gi("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,n=Z(e);this.listenerKeys_[n].forEach(vt),delete this.listenerKeys_[n],this.dispatchEvent(new Gi("removelayer",e)),this.changed()}getLayers(){return this.get(wl.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const n=e.getArray();for(let s=0,r=n.length;s<r;++s)this.dispatchEvent(new Gi("removelayer",n[s]))}this.set(wl.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(a){a.getLayerStatesArray(e)});const s=this.getLayerState();let r=s.zIndex;!t&&s.zIndex===void 0&&(r=0);for(let a=n,o=e.length;a<o;a++){const l=e[a];l.opacity*=s.opacity,l.visible=l.visible&&s.visible,l.maxResolution=Math.min(l.maxResolution,s.maxResolution),l.minResolution=Math.max(l.minResolution,s.minResolution),l.minZoom=Math.max(l.minZoom,s.minZoom),l.maxZoom=Math.min(l.maxZoom,s.maxZoom),s.extent!==void 0&&(l.extent!==void 0?l.extent=Xt(l.extent,s.extent):l.extent=s.extent),l.zIndex===void 0&&(l.zIndex=r)}return e}getSourceState(){return"ready"}}const Wt={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class ea extends Yg{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(_t.SOURCE,this.handleSourcePropertyChange_);const n=t.source?t.source:null;this.setSource(n)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(_t.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(vt(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const t=this.getSource();t&&(this.sourceChangeKey_=ct(t,Y.CHANGE,this.handleSourceChange_,this),t.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):Promise.resolve([])}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}isVisible(t){let e;const n=this.getMapInternal();!t&&n&&(t=n.getView()),t instanceof ti?e={viewState:t.getState(),extent:t.calculateExtent()}:e=t,!e.layerStatesArray&&n&&(e.layerStatesArray=n.getLayerGroup().getLayerStatesArray());let s;if(e.layerStatesArray){if(s=e.layerStatesArray.find(a=>a.layer===this),!s)return!1}else s=this.getLayerState();const r=this.getExtent();return Fc(s,e.viewState)&&(!r||Pt(r,e.extent))}getAttributions(t){if(!this.isVisible(t))return[];const e=this.getSource()?.getAttributions();if(!e)return[];const n=t instanceof ti?t.getViewStateAndExtent():t;let s=e(n);return Array.isArray(s)||(s=[s]),s}render(t,e){const n=this.getRenderer();return n.prepareFrame(t)?(this.rendered=!0,n.renderFrame(t,e)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(t,e){}renderDeferred(t){const e=this.getRenderer();e&&e.renderDeferred(t)}setMapInternal(t){t||this.unrender(),this.set(_t.MAP,t)}getMapInternal(){return this.get(_t.MAP)}setMap(t){this.mapPrecomposeKey_&&(vt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(vt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=ct(t,Wt.PRECOMPOSE,this.handlePrecompose_,this),this.mapRenderKey_=ct(this,Y.CHANGE,t.render,t),this.changed())}handlePrecompose_(t){const e=t.frameState.layerStatesArray,n=this.getLayerState(!1);ft(!e.some(s=>s.layer===n.layer),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),e.push(n)}setSource(t){this.set(_t.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}clearRenderer(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_)}disposeInternal(){this.clearRenderer(),this.setSource(null),super.disposeInternal()}}function Fc(i,t){if(!i.visible)return!1;const e=t.resolution;if(e<i.minResolution||e>=i.maxResolution)return!1;const n=t.zoom;return n>i.minZoom&&n<=i.maxZoom}function Zg(i,t,e=0,n=i.length-1,s=oy){for(;n>e;){if(n-e>600){const l=n-e+1,h=t-e+1,c=Math.log(l),u=.5*Math.exp(2*c/3),f=.5*Math.sqrt(c*u*(l-u)/l)*(h-l/2<0?-1:1),_=Math.max(e,Math.floor(t-h*u/l+f)),g=Math.min(n,Math.floor(t+(l-h)*u/l+f));Zg(i,t,_,g,s)}const r=i[t];let a=e,o=n;for(Ks(i,e,t),s(i[n],r)>0&&Ks(i,e,n);a<o;){for(Ks(i,a,o),a++,o--;s(i[a],r)<0;)a++;for(;s(i[o],r)>0;)o--}s(i[e],r)===0?Ks(i,e,o):(o++,Ks(i,o,n)),o<=t&&(e=o+1),t<=o&&(n=o-1)}}function Ks(i,t,e){const n=i[t];i[t]=i[e],i[e]=n}function oy(i,t){return i<t?-1:i>t?1:0}let Qg=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!Ma(t,e))return n;const s=this.toBBox,r=[];for(;e;){for(let a=0;a<e.children.length;a++){const o=e.children[a],l=e.leaf?s(o):o;Ma(t,l)&&(e.leaf?n.push(o):Sl(t,l)?this._all(o,n):r.push(o))}e=r.pop()}return n}collides(t){let e=this.data;if(!Ma(t,e))return!1;const n=[];for(;e;){for(let s=0;s<e.children.length;s++){const r=e.children[s],a=e.leaf?this.toBBox(r):r;if(Ma(t,a)){if(e.leaf||Sl(t,a))return!0;n.push(r)}}e=n.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const n=this.data;this.data=e,e=n}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=qn([]),this}remove(t,e){if(!t)return this;let n=this.data;const s=this.toBBox(t),r=[],a=[];let o,l,h;for(;n||r.length;){if(n||(n=r.pop(),l=r[r.length-1],o=a.pop(),h=!0),n.leaf){const c=ly(t,n.children,e);if(c!==-1)return n.children.splice(c,1),r.push(n),this._condense(r),this}!h&&!n.leaf&&Sl(n,s)?(r.push(n),a.push(o),o=0,l=n,n=n.children[0]):l?(o++,n=l.children[o],h=!1):n=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,s){const r=n-e+1;let a=this._maxEntries,o;if(r<=a)return o=qn(t.slice(e,n+1)),Nn(o,this.toBBox),o;s||(s=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,s-1))),o=qn([]),o.leaf=!1,o.height=s;const l=Math.ceil(r/a),h=l*Math.ceil(Math.sqrt(a));Sf(t,e,n,h,this.compareMinX);for(let c=e;c<=n;c+=h){const u=Math.min(c+h-1,n);Sf(t,c,u,l,this.compareMinY);for(let f=c;f<=u;f+=l){const _=Math.min(f+l-1,u);o.children.push(this._build(t,f,_,s-1))}}return Nn(o,this.toBBox),o}_chooseSubtree(t,e,n,s){for(;s.push(e),!(e.leaf||s.length-1===n);){let r=1/0,a=1/0,o;for(let l=0;l<e.children.length;l++){const h=e.children[l],c=Tl(h),u=uy(t,h)-c;u<a?(a=u,r=c<r?c:r,o=h):u===a&&c<r&&(r=c,o=h)}e=o||e.children[0]}return e}_insert(t,e,n){const s=n?t:this.toBBox(t),r=[],a=this._chooseSubtree(s,this.data,e,r);for(a.children.push(t),ir(a,s);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(s,r,e)}_split(t,e){const n=t[e],s=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,s);const a=this._chooseSplitIndex(n,r,s),o=qn(n.children.splice(a,n.children.length-a));o.height=n.height,o.leaf=n.leaf,Nn(n,this.toBBox),Nn(o,this.toBBox),e?t[e-1].children.push(o):this._splitRoot(n,o)}_splitRoot(t,e){this.data=qn([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Nn(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let s,r=1/0,a=1/0;for(let o=e;o<=n-e;o++){const l=er(t,0,o,this.toBBox),h=er(t,o,n,this.toBBox),c=fy(l,h),u=Tl(l)+Tl(h);c<r?(r=c,s=o,a=u<a?u:a):c===r&&u<a&&(a=u,s=o)}return s||n-e}_chooseSplitAxis(t,e,n){const s=t.leaf?this.compareMinX:hy,r=t.leaf?this.compareMinY:cy,a=this._allDistMargin(t,e,n,s),o=this._allDistMargin(t,e,n,r);a<o&&t.children.sort(s)}_allDistMargin(t,e,n,s){t.children.sort(s);const r=this.toBBox,a=er(t,0,e,r),o=er(t,n-e,n,r);let l=Ra(a)+Ra(o);for(let h=e;h<n-e;h++){const c=t.children[h];ir(a,t.leaf?r(c):c),l+=Ra(a)}for(let h=n-e-1;h>=e;h--){const c=t.children[h];ir(o,t.leaf?r(c):c),l+=Ra(o)}return l}_adjustParentBBoxes(t,e,n){for(let s=n;s>=0;s--)ir(e[s],t)}_condense(t){for(let e=t.length-1,n;e>=0;e--)t[e].children.length===0?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():Nn(t[e],this.toBBox)}};function ly(i,t,e){if(!e)return t.indexOf(i);for(let n=0;n<t.length;n++)if(e(i,t[n]))return n;return-1}function Nn(i,t){er(i,0,i.children.length,t,i)}function er(i,t,e,n,s){s||(s=qn(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let r=t;r<e;r++){const a=i.children[r];ir(s,i.leaf?n(a):a)}return s}function ir(i,t){return i.minX=Math.min(i.minX,t.minX),i.minY=Math.min(i.minY,t.minY),i.maxX=Math.max(i.maxX,t.maxX),i.maxY=Math.max(i.maxY,t.maxY),i}function hy(i,t){return i.minX-t.minX}function cy(i,t){return i.minY-t.minY}function Tl(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function Ra(i){return i.maxX-i.minX+(i.maxY-i.minY)}function uy(i,t){return(Math.max(t.maxX,i.maxX)-Math.min(t.minX,i.minX))*(Math.max(t.maxY,i.maxY)-Math.min(t.minY,i.minY))}function fy(i,t){const e=Math.max(i.minX,t.minX),n=Math.max(i.minY,t.minY),s=Math.min(i.maxX,t.maxX),r=Math.min(i.maxY,t.maxY);return Math.max(0,s-e)*Math.max(0,r-n)}function Sl(i,t){return i.minX<=t.minX&&i.minY<=t.minY&&t.maxX<=i.maxX&&t.maxY<=i.maxY}function Ma(i,t){return t.minX<=i.maxX&&t.minY<=i.maxY&&t.maxX>=i.minX&&t.maxY>=i.minY}function qn(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Sf(i,t,e,n,s){const r=[t,e];for(;r.length;){if(e=r.pop(),t=r.pop(),e-t<=n)continue;const a=t+Math.ceil((e-t)/n/2)*n;Zg(i,a,t,e,s),r.push(t,a,a,e)}}const Dc=[NaN,NaN,NaN,0];let Rl;function dy(){return Rl||(Rl=Ot(1,1,void 0,{willReadFrequently:!0,desynchronized:!0})),Rl}const gy=/^rgba?\(\s*(\d+%?)\s+(\d+%?)\s+(\d+%?)(?:\s*\/\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,_y=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,my=/^rgba?\(\s*(\d+%)\s*,\s*(\d+%)\s*,\s*(\d+%)(?:\s*,\s*(\d+%|\d*\.\d+|[01]))?\s*\)$/i,py=/^#([\da-f]{3,4}|[\da-f]{6}|[\da-f]{8})$/i;function Ca(i,t){return i.endsWith("%")?Number(i.substring(0,i.length-1))/t:Number(i)}function gr(i){throw new Error('failed to parse "'+i+'" as color')}function Jg(i){if(i.toLowerCase().startsWith("rgb")){const r=i.match(_y)||i.match(gy)||i.match(my);if(r){const a=r[4],o=100/255;return[wt(Ca(r[1],o)+.5|0,0,255),wt(Ca(r[2],o)+.5|0,0,255),wt(Ca(r[3],o)+.5|0,0,255),a!==void 0?wt(Ca(a,100),0,1):1]}gr(i)}if(i.startsWith("#")){if(py.test(i)){const r=i.substring(1),a=r.length<=4?1:2,o=[0,0,0,255];for(let l=0,h=r.length;l<h;l+=a){let c=parseInt(r.substring(l,l+a),16);a===1&&(c+=c<<4),o[l/a]=c}return o[3]=o[3]/255,o}gr(i)}const t=dy();t.fillStyle="#abcdef";let e=t.fillStyle;t.fillStyle=i,t.fillStyle===e&&(t.fillStyle="#fedcba",e=t.fillStyle,t.fillStyle=i,t.fillStyle===e&&gr(i));const n=t.fillStyle;if(n.startsWith("#")||n.startsWith("rgba"))return Jg(n);t.clearRect(0,0,1,1),t.fillRect(0,0,1,1);const s=Array.from(t.getImageData(0,0,1,1).data);return s[3]=Kr(s[3]/255,3),s}function yy(i){return typeof i=="string"?i:Nc(i)}const xy=1024,Hs={};let Ml=0;function Ey(i){if(i.length===4)return i;const t=i.slice();return t[3]=1,t}function Cl(i){return i>.0031308?Math.pow(i,1/2.4)*269.025-14.025:i*3294.6}function bl(i){return i>.2068965?Math.pow(i,3):(i-4/29)*(108/841)}function Il(i){return i>10.314724?Math.pow((i+14.025)/269.025,2.4):i/3294.6}function Al(i){return i>.0088564?Math.pow(i,1/3):i/(108/841)+4/29}function Rf(i){const t=Il(i[0]),e=Il(i[1]),n=Il(i[2]),s=Al(t*.222488403+e*.716873169+n*.06060791),r=500*(Al(t*.452247074+e*.399439023+n*.148375274)-s),a=200*(s-Al(t*.016863605+e*.117638439+n*.865350722)),o=Math.atan2(a,r)*(180/Math.PI);return[116*s-16,Math.sqrt(r*r+a*a),o<0?o+360:o,i[3]]}function vy(i){const t=(i[0]+16)/116,e=i[1],n=i[2]*Math.PI/180,s=bl(t),r=bl(t+e/500*Math.cos(n)),a=bl(t-e/200*Math.sin(n)),o=Cl(r*3.021973625-s*1.617392459-a*.404875592),l=Cl(r*-.943766287+s*1.916279586+a*.027607165),h=Cl(r*.069407491-s*.22898585+a*1.159737864);return[wt(o+.5|0,0,255),wt(l+.5|0,0,255),wt(h+.5|0,0,255),i[3]]}function Gc(i){if(i==="none")return Dc;if(Hs.hasOwnProperty(i))return Hs[i];if(Ml>=xy){let e=0;for(const n in Hs)(e++&3)===0&&(delete Hs[n],--Ml)}const t=Jg(i);t.length!==4&&gr(i);for(const e of t)isNaN(e)&&gr(i);return Hs[i]=t,++Ml,t}function Ki(i){return Array.isArray(i)?i:Gc(i)}function Nc(i){let t=i[0];t!=(t|0)&&(t=t+.5|0);let e=i[1];e!=(e|0)&&(e=e+.5|0);let n=i[2];n!=(n|0)&&(n=n+.5|0);const s=i[3]===void 0?1:Math.round(i[3]*1e3)/1e3;return"rgba("+t+","+e+","+n+","+s+")"}function Mf(i){return i[0]>0&&i[1]>0}function wy(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function Lt(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}let bn=0;const ne=1<<bn++,st=1<<bn++,oe=1<<bn++,Se=1<<bn++,Hi=1<<bn++,is=1<<bn++,ba=Math.pow(2,bn)-1,kc={[ne]:"boolean",[st]:"number",[oe]:"string",[Se]:"color",[Hi]:"number[]",[is]:"size"},Ty=Object.keys(kc).map(Number).sort(si);function Sy(i){return i in kc}function ns(i){const t=[];for(const e of Ty)nr(i,e)&&t.push(kc[e]);return t.length===0?"untyped":t.length<3?t.join(" or "):t.slice(0,-1).join(", ")+", or "+t[t.length-1]}function nr(i,t){return(i&t)===t}function bi(i,t){return i===t}class zt{constructor(t,e){if(!Sy(t))throw new Error(`literal expressions must have a specific type, got ${ns(t)}`);this.type=t,this.value=e}}class t0{constructor(t,e,...n){this.type=t,this.operator=e,this.args=n}}function Uc(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,mapState:!1}}function Kt(i,t,e){switch(typeof i){case"boolean":{if(bi(t,oe))return new zt(oe,i?"true":"false");if(!nr(t,ne))throw new Error(`got a boolean, but expected ${ns(t)}`);return new zt(ne,i)}case"number":{if(bi(t,is))return new zt(is,Lt(i));if(bi(t,ne))return new zt(ne,!!i);if(bi(t,oe))return new zt(oe,i.toString());if(!nr(t,st))throw new Error(`got a number, but expected ${ns(t)}`);return new zt(st,i)}case"string":{if(bi(t,Se))return new zt(Se,Gc(i));if(bi(t,ne))return new zt(ne,!!i);if(!nr(t,oe))throw new Error(`got a string, but expected ${ns(t)}`);return new zt(oe,i)}}if(!Array.isArray(i))throw new Error("expression must be an array or a primitive value");if(i.length===0)throw new Error("empty expression");if(typeof i[0]=="string")return Dy(i,t,e);for(const n of i)if(typeof n!="number")throw new Error("expected an array of numbers");if(bi(t,is)){if(i.length!==2)throw new Error(`expected an array of two values for a size, got ${i.length}`);return new zt(is,i)}if(bi(t,Se)){if(i.length===3)return new zt(Se,[...i,1]);if(i.length===4)return new zt(Se,i);throw new Error(`expected an array of 3 or 4 values for a color, got ${i.length}`)}if(!nr(t,Hi))throw new Error(`got an array of numbers, but expected ${ns(t)}`);return new zt(Hi,i)}const N={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",LineMetric:"line-metric",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string",Has:"has"},Ry={[N.Get]:it(rt(1,1/0),Cf),[N.Var]:it(rt(1,1),My),[N.Has]:it(rt(1,1/0),Cf),[N.Id]:it(Cy,kn),[N.Concat]:it(rt(2,1/0),pt(oe)),[N.GeometryType]:it(by,kn),[N.LineMetric]:it(kn),[N.Resolution]:it(Pl,kn),[N.Zoom]:it(Pl,kn),[N.Time]:it(Pl,kn),[N.Any]:it(rt(2,1/0),pt(ne)),[N.All]:it(rt(2,1/0),pt(ne)),[N.Not]:it(rt(1,1),pt(ne)),[N.Equal]:it(rt(2,2),pt(ba)),[N.NotEqual]:it(rt(2,2),pt(ba)),[N.GreaterThan]:it(rt(2,2),pt(st)),[N.GreaterThanOrEqualTo]:it(rt(2,2),pt(st)),[N.LessThan]:it(rt(2,2),pt(st)),[N.LessThanOrEqualTo]:it(rt(2,2),pt(st)),[N.Multiply]:it(rt(2,1/0),bf),[N.Coalesce]:it(rt(2,1/0),bf),[N.Divide]:it(rt(2,2),pt(st)),[N.Add]:it(rt(2,1/0),pt(st)),[N.Subtract]:it(rt(2,2),pt(st)),[N.Clamp]:it(rt(3,3),pt(st)),[N.Mod]:it(rt(2,2),pt(st)),[N.Pow]:it(rt(2,2),pt(st)),[N.Abs]:it(rt(1,1),pt(st)),[N.Floor]:it(rt(1,1),pt(st)),[N.Ceil]:it(rt(1,1),pt(st)),[N.Round]:it(rt(1,1),pt(st)),[N.Sin]:it(rt(1,1),pt(st)),[N.Cos]:it(rt(1,1),pt(st)),[N.Atan]:it(rt(1,2),pt(st)),[N.Sqrt]:it(rt(1,1),pt(st)),[N.Match]:it(rt(4,1/0),If,Ay),[N.Between]:it(rt(3,3),pt(st)),[N.Interpolate]:it(rt(6,1/0),If,Py),[N.Case]:it(rt(3,1/0),Iy,Ly),[N.In]:it(rt(2,2),Oy),[N.Number]:it(rt(1,1/0),pt(ba)),[N.String]:it(rt(1,1/0),pt(ba)),[N.Array]:it(rt(1,1/0),pt(st)),[N.Color]:it(rt(1,4),pt(st)),[N.Band]:it(rt(1,3),pt(st)),[N.Palette]:it(rt(2,2),Fy),[N.ToString]:it(rt(1,1),pt(ne|st|oe|Se))};function Cf(i,t,e){const n=i.length-1,s=new Array(n);for(let r=0;r<n;++r){const a=i[r+1];switch(typeof a){case"number":{s[r]=new zt(st,a);break}case"string":{s[r]=new zt(oe,a);break}default:throw new Error(`expected a string key or numeric array index for a get operation, got ${a}`)}r===0&&e.properties.add(String(a))}return s}function My(i,t,e){const n=i[1];if(typeof n!="string")throw new Error("expected a string argument for var operation");return e.variables.add(n),[new zt(oe,n)]}function Cy(i,t,e){e.featureId=!0}function by(i,t,e){e.geometryType=!0}function Pl(i,t,e){e.mapState=!0}function kn(i,t,e){const n=i[0];if(i.length!==1)throw new Error(`expected no arguments for ${n} operation`);return[]}function rt(i,t){return function(e,n,s){const r=e[0],a=e.length-1;if(i===t){if(a!==i){const o=i===1?"":"s";throw new Error(`expected ${i} argument${o} for ${r}, got ${a}`)}}else if(a<i||a>t){const o=t===1/0?`${i} or more`:`${i} to ${t}`;throw new Error(`expected ${o} arguments for ${r}, got ${a}`)}}}function bf(i,t,e){const n=i.length-1,s=new Array(n);for(let r=0;r<n;++r){const a=Kt(i[r+1],t,e);s[r]=a}return s}function pt(i){return function(t,e,n){const s=t.length-1,r=new Array(s);for(let a=0;a<s;++a){const o=Kt(t[a+1],i,n);r[a]=o}return r}}function Iy(i,t,e){const n=i[0],s=i.length-1;if(s%2===0)throw new Error(`expected an odd number of arguments for ${n}, got ${s} instead`)}function If(i,t,e){const n=i[0],s=i.length-1;if(s%2===1)throw new Error(`expected an even number of arguments for operation ${n}, got ${s} instead`)}function Ay(i,t,e){const n=i.length-1,s=oe|st|ne,r=Kt(i[1],s,e),a=Kt(i[i.length-1],t,e),o=new Array(n-2);for(let l=0;l<n-2;l+=2){try{const h=Kt(i[l+2],r.type,e);o[l]=h}catch(h){throw new Error(`failed to parse argument ${l+1} of match expression: ${h.message}`)}try{const h=Kt(i[l+3],a.type,e);o[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+2} of match expression: ${h.message}`)}}return[r,...o,a]}function Py(i,t,e){const n=i[1];let s;switch(n[0]){case"linear":s=1;break;case"exponential":const l=n[1];if(typeof l!="number"||l<=0)throw new Error(`expected a number base for exponential interpolation, got ${JSON.stringify(l)} instead`);s=l;break;default:throw new Error(`invalid interpolation type: ${JSON.stringify(n)}`)}const r=new zt(st,s);let a;try{a=Kt(i[2],st,e)}catch(l){throw new Error(`failed to parse argument 1 in interpolate expression: ${l.message}`)}const o=new Array(i.length-3);for(let l=0;l<o.length;l+=2){try{const h=Kt(i[l+3],st,e);o[l]=h}catch(h){throw new Error(`failed to parse argument ${l+2} for interpolate expression: ${h.message}`)}try{const h=Kt(i[l+4],t,e);o[l+1]=h}catch(h){throw new Error(`failed to parse argument ${l+3} for interpolate expression: ${h.message}`)}}return[r,a,...o]}function Ly(i,t,e){const n=Kt(i[i.length-1],t,e),s=new Array(i.length-1);for(let r=0;r<s.length-1;r+=2){try{const a=Kt(i[r+1],ne,e);s[r]=a}catch(a){throw new Error(`failed to parse argument ${r} of case expression: ${a.message}`)}try{const a=Kt(i[r+2],n.type,e);s[r+1]=a}catch(a){throw new Error(`failed to parse argument ${r+1} of case expression: ${a.message}`)}}return s[s.length-1]=n,s}function Oy(i,t,e){let n=i[2];if(!Array.isArray(n))throw new Error('the second argument for the "in" operator must be an array');let s;if(typeof n[0]=="string"){if(n[0]!=="literal")throw new Error('for the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions');if(!Array.isArray(n[1]))throw new Error('failed to parse "in" expression: the literal operator must be followed by an array');n=n[1],s=oe}else s=st;const r=new Array(n.length);for(let o=0;o<r.length;o++)try{const l=Kt(n[o],s,e);r[o]=l}catch(l){throw new Error(`failed to parse haystack item ${o} for "in" expression: ${l.message}`)}return[Kt(i[1],s,e),...r]}function Fy(i,t,e){let n;try{n=Kt(i[1],st,e)}catch(a){throw new Error(`failed to parse first argument in palette expression: ${a.message}`)}const s=i[2];if(!Array.isArray(s))throw new Error("the second argument of palette must be an array");const r=new Array(s.length);for(let a=0;a<r.length;a++){let o;try{o=Kt(s[a],Se,e)}catch(l){throw new Error(`failed to parse color at index ${a} in palette expression: ${l.message}`)}if(!(o instanceof zt))throw new Error(`the palette color at index ${a} must be a literal value`);r[a]=o}return[n,...r]}function it(...i){return function(t,e,n){const s=t[0];let r;for(let a=0;a<i.length;a++){const o=i[a](t,e,n);if(a==i.length-1){if(!o)throw new Error("expected last argument validator to return the parsed args");r=o}}return new t0(e,s,...r)}}function Dy(i,t,e){const n=i[0],s=Ry[n];if(!s)throw new Error(`unknown operator: ${n}`);return s(i,t,e)}function e0(i){if(!i)return"";const t=i.getType();switch(t){case"Point":case"LineString":case"Polygon":return t;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return t.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return e0(i.getGeometries()[0]);default:return""}}function i0(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Mi(i,t,e){const n=Kt(i,t,e);return qe(n)}function qe(i,t){if(i instanceof zt){if(i.type===Se&&typeof i.value=="string"){const n=Gc(i.value);return function(){return n}}return function(){return i.value}}const e=i.operator;switch(e){case N.Number:case N.String:case N.Coalesce:return Gy(i);case N.Get:case N.Var:case N.Has:return Ny(i);case N.Id:return n=>n.featureId;case N.GeometryType:return n=>n.geometryType;case N.Concat:{const n=i.args.map(s=>qe(s));return s=>"".concat(...n.map(r=>r(s).toString()))}case N.Resolution:return n=>n.resolution;case N.Any:case N.All:case N.Between:case N.In:case N.Not:return Uy(i);case N.Equal:case N.NotEqual:case N.LessThan:case N.LessThanOrEqualTo:case N.GreaterThan:case N.GreaterThanOrEqualTo:return ky(i);case N.Multiply:case N.Divide:case N.Add:case N.Subtract:case N.Clamp:case N.Mod:case N.Pow:case N.Abs:case N.Floor:case N.Ceil:case N.Round:case N.Sin:case N.Cos:case N.Atan:case N.Sqrt:return By(i);case N.Case:return zy(i);case N.Match:return Xy(i);case N.Interpolate:return jy(i);case N.ToString:return Vy(i);default:throw new Error(`Unsupported operator ${e}`)}}function Gy(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=qe(i.args[r]);switch(e){case N.Coalesce:return r=>{for(let a=0;a<n;++a){const o=s[a](r);if(typeof o<"u"&&o!==null)return o}throw new Error("Expected one of the values to be non-null")};case N.Number:case N.String:return r=>{for(let a=0;a<n;++a){const o=s[a](r);if(typeof o===e)return o}throw new Error(`Expected one of the values to be a ${e}`)};default:throw new Error(`Unsupported assertion operator ${e}`)}}function Ny(i,t){const n=i.args[0].value;switch(i.operator){case N.Get:return s=>{const r=i.args;let a=s.properties[n];for(let o=1,l=r.length;o<l;++o){const c=r[o].value;a=a[c]}return a};case N.Var:return s=>s.variables[n];case N.Has:return s=>{const r=i.args;if(!(n in s.properties))return!1;let a=s.properties[n];for(let o=1,l=r.length;o<l;++o){const c=r[o].value;if(!a||!Object.hasOwn(a,c))return!1;a=a[c]}return!0};default:throw new Error(`Unsupported accessor operator ${i.operator}`)}}function ky(i,t){const e=i.operator,n=qe(i.args[0]),s=qe(i.args[1]);switch(e){case N.Equal:return r=>n(r)===s(r);case N.NotEqual:return r=>n(r)!==s(r);case N.LessThan:return r=>n(r)<s(r);case N.LessThanOrEqualTo:return r=>n(r)<=s(r);case N.GreaterThan:return r=>n(r)>s(r);case N.GreaterThanOrEqualTo:return r=>n(r)>=s(r);default:throw new Error(`Unsupported comparison operator ${e}`)}}function Uy(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=qe(i.args[r]);switch(e){case N.Any:return r=>{for(let a=0;a<n;++a)if(s[a](r))return!0;return!1};case N.All:return r=>{for(let a=0;a<n;++a)if(!s[a](r))return!1;return!0};case N.Between:return r=>{const a=s[0](r),o=s[1](r),l=s[2](r);return a>=o&&a<=l};case N.In:return r=>{const a=s[0](r);for(let o=1;o<n;++o)if(a===s[o](r))return!0;return!1};case N.Not:return r=>!s[0](r);default:throw new Error(`Unsupported logical operator ${e}`)}}function By(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=qe(i.args[r]);switch(e){case N.Multiply:return r=>{let a=1;for(let o=0;o<n;++o)a*=s[o](r);return a};case N.Divide:return r=>s[0](r)/s[1](r);case N.Add:return r=>{let a=0;for(let o=0;o<n;++o)a+=s[o](r);return a};case N.Subtract:return r=>s[0](r)-s[1](r);case N.Clamp:return r=>{const a=s[0](r),o=s[1](r);if(a<o)return o;const l=s[2](r);return a>l?l:a};case N.Mod:return r=>s[0](r)%s[1](r);case N.Pow:return r=>Math.pow(s[0](r),s[1](r));case N.Abs:return r=>Math.abs(s[0](r));case N.Floor:return r=>Math.floor(s[0](r));case N.Ceil:return r=>Math.ceil(s[0](r));case N.Round:return r=>Math.round(s[0](r));case N.Sin:return r=>Math.sin(s[0](r));case N.Cos:return r=>Math.cos(s[0](r));case N.Atan:return n===2?r=>Math.atan2(s[0](r),s[1](r)):r=>Math.atan(s[0](r));case N.Sqrt:return r=>Math.sqrt(s[0](r));default:throw new Error(`Unsupported numeric operator ${e}`)}}function zy(i,t){const e=i.args.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=qe(i.args[s]);return s=>{for(let r=0;r<e-1;r+=2)if(n[r](s))return n[r+1](s);return n[e-1](s)}}function Xy(i,t){const e=i.args.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=qe(i.args[s]);return s=>{const r=n[0](s);for(let a=1;a<e-1;a+=2)if(r===n[a](s))return n[a+1](s);return n[e-1](s)}}function jy(i,t){const e=i.args.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=qe(i.args[s]);return s=>{const r=n[0](s),a=n[1](s);let o,l;for(let h=2;h<e;h+=2){const c=n[h](s);let u=n[h+1](s);const f=Array.isArray(u);if(f&&(u=Ey(u)),c>=a)return h===2?u:f?$y(r,a,o,l,c,u):sr(r,a,o,l,c,u);o=c,l=u}return l}}function Vy(i,t){const e=i.operator,n=i.args.length,s=new Array(n);for(let r=0;r<n;++r)s[r]=qe(i.args[r]);switch(e){case N.ToString:return r=>{const a=s[0](r);return i.args[0].type===Se?Nc(a):a.toString()};default:throw new Error(`Unsupported convert operator ${e}`)}}function sr(i,t,e,n,s,r){const a=s-e;if(a===0)return n;const o=t-e,l=i===1?o/a:(Math.pow(i,o)-1)/(Math.pow(i,a)-1);return n+l*(r-n)}function $y(i,t,e,n,s,r){if(s-e===0)return n;const o=Rf(n),l=Rf(r);let h=l[2]-o[2];h>180?h-=360:h<-180&&(h+=360);const c=[sr(i,t,e,o[0],s,l[0]),sr(i,t,e,o[1],s,l[1]),o[2]+sr(i,t,e,0,s,h),sr(i,t,e,n[3],s,r[3])];return vy(c)}const K={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class Bc extends Ls{constructor(t,e,n,s){super(),this.extent=t,this.pixelRatio_=n,this.resolution=e,this.state=typeof s=="function"?K.IDLE:s,this.image_=null,this.loader=typeof s=="function"?s:null}changed(){this.dispatchEvent(Y.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==K.IDLE&&this.loader){this.state=K.LOADING,this.changed();const t=this.getResolution(),e=Array.isArray(t)?t[0]:t;Jh(()=>this.loader(this.getExtent(),e,this.getPixelRatio())).then(n=>{"image"in n&&(this.image_=n.image),"extent"in n&&(this.extent=n.extent),"resolution"in n&&(this.resolution=n.resolution),"pixelRatio"in n&&(this.pixelRatio_=n.pixelRatio),(n instanceof HTMLImageElement||gg&&n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement)&&(this.image_=n),this.state=K.LOADED}).catch(n=>{this.state=K.ERROR,console.error(n)}).finally(()=>this.changed())}}setImage(t){this.image_=t}setResolution(t){this.resolution=t}}function Wy(i,t,e){const n=i;let s=!0,r=!1,a=!1;const o=[no(n,Y.LOAD,function(){a=!0,r||t()})];return n.src&&tc?(r=!0,n.decode().then(function(){s&&t()}).catch(function(l){s&&(a?t():e())})):o.push(no(n,Y.ERROR,e)),function(){s=!1,o.forEach(vt)}}function qy(i,t){return new Promise((e,n)=>{function s(){a(),e(i)}function r(){a(),n(new Error("Image load error"))}function a(){i.removeEventListener("load",s),i.removeEventListener("error",r)}i.addEventListener("load",s),i.addEventListener("error",r)})}function n0(i,t){return t&&(i.src=t),i.src&&tc?new Promise((e,n)=>i.decode().then(()=>e(i)).catch(s=>i.complete&&i.width?e(i):n(s))):qy(i)}function s0(i,t){return t&&(i.src=t),i.src&&tc&&gg?i.decode().then(()=>createImageBitmap(i)).catch(e=>{if(i.complete&&i.width)return i;throw e}):n0(i)}class Ky{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=1024}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const n=this.cache_[e];(t++&3)===0&&!n.hasListener()&&(delete this.cache_[e],delete this.patternCache_[e],--this.cacheSize_)}}}get(t,e,n){const s=Ll(t,e,n);return s in this.cache_?this.cache_[s]:null}getPattern(t,e,n){const s=Ll(t,e,n);return s in this.patternCache_?this.patternCache_[s]:null}set(t,e,n,s,r){const a=Ll(t,e,n),o=a in this.cache_;this.cache_[a]=s,r&&(s.getImageState()===K.IDLE&&s.load(),s.getImageState()===K.LOADING?s.ready().then(()=>{this.patternCache_[a]=go().createPattern(s.getImage(1),"repeat")}):this.patternCache_[a]=go().createPattern(s.getImage(1),"repeat")),o||++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Ll(i,t,e){const n=e?Ki(e):"null";return t+":"+i+":"+n}const Fe=new Ky;let Ys=null;class r0 extends Ls{constructor(t,e,n,s,r){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=r,this.imageState_=s===void 0?K.IDLE:s,this.size_=t&&t.width&&t.height?[t.width,t.height]:null,this.src_=e,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===K.LOADED){Ys||(Ys=Ot(1,1,void 0,{willReadFrequently:!0})),Ys.drawImage(this.image_,0,0);try{Ys.getImageData(0,0,1,1),this.tainted_=!1}catch{Ys=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(Y.CHANGE)}handleImageError_(){this.imageState_=K.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=K.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],n=Ot(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===K.IDLE){this.image_||this.initializeImage_(),this.imageState_=K.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&n0(this.image_,this.src_).then(t=>{this.image_=t,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==K.LOADED)return;const e=this.image_,n=Ot(Math.ceil(e.width*t),Math.ceil(e.height*t)),s=n.canvas;n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=yy(this.color_),n.fillRect(0,0,s.width/t,s.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=s}ready(){return this.ready_||(this.ready_=new Promise(t=>{if(this.imageState_===K.LOADED||this.imageState_===K.ERROR)t();else{const e=()=>{(this.imageState_===K.LOADED||this.imageState_===K.ERROR)&&(this.removeEventListener(Y.CHANGE,e),t())};this.addEventListener(Y.CHANGE,e)}})),this.ready_}}function zc(i,t,e,n,s,r){let a=t===void 0?void 0:Fe.get(t,e,s);return a||(a=new r0(i,i&&"src"in i?i.src||void 0:t,e,n,s),Fe.set(t,e,s,a,r)),r&&a&&!Fe.getPattern(t,e,s)&&Fe.set(t,e,s,a,r),a}function ii(i){return i?Array.isArray(i)?Nc(i):typeof i=="object"&&"src"in i?Hy(i):i:null}function Hy(i){if(!i.offset||!i.size)return Fe.getPattern(i.src,"anonymous",i.color);const t=i.src+":"+i.offset,e=Fe.getPattern(t,void 0,i.color);if(e)return e;const n=Fe.get(i.src,"anonymous",null);if(n.getImageState()!==K.LOADED)return null;const s=Ot(i.size[0],i.size[1]);return s.drawImage(n.getImage(1),i.offset[0],i.offset[1],i.size[0],i.size[1],0,0,i.size[0],i.size[1]),zc(s.canvas,t,void 0,K.LOADED,i.color,!0),Fe.getPattern(t,void 0,i.color)}const a0="10px sans-serif",_e="#000",Ss="round",Ei=[],vi=0,Rs="round",Ar=10,Pr="#000",Lr="center",_o="middle",dn=[0,0,0,0],Or=1,Kn=new He;let Zs=null,Af;const xh={},Yy=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","emoji","math","fangsong"]);function Zy(i,t,e){return`${i} ${t} 16px "${e}"`}const Qy=function(){let t,e;async function n(r){await e.ready;const a=await e.load(r);if(a.length===0)return!1;const o=ph(r),l=o.families[0].toLowerCase(),h=o.weight;return a.some(c=>{const u=c.family.replace(/^['"]|['"]$/g,"").toLowerCase(),f=mh[c.weight]||c.weight;return u===l&&c.style===o.style&&f==h})}async function s(){await e.ready;let r=!0;const a=Kn.getProperties(),o=Object.keys(a).filter(l=>a[l]<100);for(let l=o.length-1;l>=0;--l){const h=o[l];let c=a[h];c<100&&(await n(h)?(Ps(xh),Kn.set(h,100)):(c+=10,Kn.set(h,c,!0),c<100&&(r=!1)))}t=void 0,r||(t=setTimeout(s,100))}return async function(r){e||(e=No?self.fonts:document.fonts);const a=ph(r);if(!a)return;const o=a.families;let l=!1;for(const h of o){if(Yy.has(h))continue;const c=Zy(a.style,a.weight,h);Kn.get(c)===void 0&&(Kn.set(c,0,!0),l=!0)}l&&(clearTimeout(t),t=setTimeout(s,100))}}(),Jy=function(){let i;return function(t){let e=xh[t];if(e==null){if(No){const n=ph(t),s=o0(t,"Žg");e=(isNaN(Number(n.lineHeight))?1.2:Number(n.lineHeight))*(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=t,document.body.appendChild(i),e=i.offsetHeight,document.body.removeChild(i);xh[t]=e}return e}}();function o0(i,t){return Zs||(Zs=Ot(1,1)),i!=Af&&(Zs.font=i,Af=Zs.font),Zs.measureText(t)}function l0(i,t){return o0(i,t).width}function Pf(i,t,e){if(t in e)return e[t];const n=t.split(`
`).reduce((s,r)=>Math.max(s,l0(i,r)),0);return e[t]=n,n}function tx(i,t){const e=[],n=[],s=[];let r=0,a=0,o=0,l=0;for(let h=0,c=t.length;h<=c;h+=2){const u=t[h];if(u===`
`||h===c){r=Math.max(r,a),s.push(a),a=0,o+=l,l=0;continue}const f=t[h+1]||i.font,_=l0(f,u);e.push(_),a+=_;const g=Jy(f);n.push(g),l=Math.max(l,g)}return{width:r,height:o,widths:e,heights:n,lineWidths:s}}function ex(i,t,e,n,s,r,a,o,l,h,c){i.save(),e!==1&&(i.globalAlpha===void 0?i.globalAlpha=u=>u.globalAlpha*=e:i.globalAlpha*=e),t&&i.transform.apply(i,t),n.contextInstructions?(i.translate(l,h),i.scale(c[0],c[1]),ix(n,i)):c[0]<0||c[1]<0?(i.translate(l,h),i.scale(c[0],c[1]),i.drawImage(n,s,r,a,o,0,0,a,o)):i.drawImage(n,s,r,a,o,l,h,a*c[0],o*c[1]),i.restore()}function ix(i,t){const e=i.contextInstructions;for(let n=0,s=e.length;n<s;n+=2)Array.isArray(e[n+1])?t[e[n]].apply(t,e[n+1]):t[e[n]]=e[n+1]}class Ho{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=Lt(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Ho({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return tt()}getImage(t){return tt()}getHitDetectionImage(){return tt()}getPixelRatio(t){return 1}getImageState(){return tt()}getImageSize(){return tt()}getOrigin(){return tt()}getSize(){return tt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Lt(t)}listenImageChange(t){tt()}load(){tt()}unlistenImageChange(t){tt()}ready(){return Promise.resolve()}}class Yo extends Ho{constructor(t){super({opacity:1,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius=t.radius,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?K.LOADING:K.LOADED,this.imageState_===K.LOADING&&this.ready().then(()=>this.imageState_=K.LOADED),this.render()}clone(){const t=this.getScale(),e=new Yo({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_,e=this.getDisplacement(),n=this.getScaleArray();return[t[0]/2-e[0]/n[0],t[1]/2+e[1]/n[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(t){const e=this.fill_?.getKey(),n=`${t},${this.angle_},${this.radius},${this.radius2_},${this.points_},${e}`+Object.values(this.renderOptions_).join(",");let s=Fe.get(n,null,null)?.getImage(1);if(!s){const r=this.renderOptions_,a=Math.ceil(r.size*t),o=Ot(a,a);this.draw_(r,o,t),s=o.canvas,Fe.set(n,null,null,new r0(s,void 0,null,K.LOADED,null))}return s}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let s=this.radius,r=this.radius2_===void 0?s:this.radius2_;if(s<r){const R=s;s=r,r=R}const a=this.radius2_===void 0?this.points_:this.points_*2,o=2*Math.PI/a,l=r*Math.sin(o),h=Math.sqrt(r*r-l*l),c=s-h,u=Math.sqrt(l*l+c*c),f=u/l;if(t==="miter"&&f<=n)return f*e;const _=e/2/f,g=e/2*(c/u),y=Math.sqrt((s+_)*(s+_)+g*g)-s;if(this.radius2_===void 0||t==="bevel")return y*2;const w=s*Math.sin(o),d=Math.sqrt(s*s-w*w),p=r-d,T=Math.sqrt(w*w+p*p)/w;if(T<=n){const R=T*e/2-r-s;return 2*Math.max(y,R)}return y*2}createRenderOptions(){let t=Ss,e=Rs,n=0,s=null,r=0,a,o=0;this.stroke_&&(a=ii(this.stroke_.getColor()??Pr),o=this.stroke_.getWidth()??Or,s=this.stroke_.getLineDash(),r=this.stroke_.getLineDashOffset()??0,e=this.stroke_.getLineJoin()??Rs,t=this.stroke_.getLineCap()??Ss,n=this.stroke_.getMiterLimit()??Ar);const l=this.calculateLineJoinSize_(e,o,n),h=Math.max(this.radius,this.radius2_||0),c=Math.ceil(2*h+l);return{strokeStyle:a,strokeWidth:o,size:c,lineCap:t,lineDash:s,lineDashOffset:r,lineJoin:e,miterLimit:n}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.hitDetectionCanvas_=null,this.size_=[t,t]}draw_(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let s=this.fill_.getColor();s===null&&(s=_e),e.fillStyle=ii(s),e.fill()}t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineCap=t.lineCap,e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){let e;if(this.fill_){let n=this.fill_.getColor(),s=0;typeof n=="string"&&(n=Ki(n)),n===null?s=1:Array.isArray(n)&&(s=n.length===4?n[3]:1),s===0&&(e=Ot(t.size,t.size),this.drawHitDetectionCanvas_(t,e))}return e?e.canvas:this.getImage(1)}createPath_(t){let e=this.points_;const n=this.radius;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{const s=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);const r=this.angle_-Math.PI/2,a=2*Math.PI/e;for(let o=0;o<e;o++){const l=r+o*a,h=o%2===0?n:s;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=_e,e.fill(),t.strokeStyle&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class ia extends Yo{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new ia({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius=t,this.render()}}class In{constructor(t){t=t||{},this.patternImage_=null,this.color_=null,t.color!==void 0&&this.setColor(t.color)}clone(){const t=this.getColor();return new In({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){if(t!==null&&typeof t=="object"&&"src"in t){const e=zc(null,t.src,"anonymous",void 0,t.offset?null:t.color?t.color:null,!(t.offset&&t.size));e.ready().then(()=>{this.patternImage_=null}),e.getImageState()===K.IDLE&&e.load(),e.getImageState()===K.LOADING&&(this.patternImage_=e)}this.color_=t}getKey(){const t=this.getColor();return t?t instanceof CanvasPattern||t instanceof CanvasGradient?Z(t):typeof t=="object"&&"src"in t?t.src+":"+t.offset:Ki(t).toString():""}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}function Lf(i,t,e,n){return e!==void 0&&n!==void 0?[e/i,n/t]:e!==void 0?e/i:n!==void 0?n/t:1}class Zo extends Ho{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,n=t.rotation!==void 0?t.rotation:0,s=t.scale!==void 0?t.scale:1,r=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:n,scale:s,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const a=t.img!==void 0?t.img:null;let o=t.src;ft(!(o!==void 0&&a),"`image` and `src` cannot be provided at the same time"),(o===void 0||o.length===0)&&a&&(o=a.src||Z(a)),ft(o!==void 0&&o.length>0,"A defined and non-empty `src` or `image` must be provided"),ft(!((t.width!==void 0||t.height!==void 0)&&t.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let l;if(t.src!==void 0?l=K.IDLE:a!==void 0&&("complete"in a?a.complete?l=a.src?K.LOADED:K.IDLE:l=K.LOADING:l=K.LOADED),this.color_=t.color!==void 0?Ki(t.color):null,this.iconImage_=zc(a,o,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null,this.initialOptions_,t.width!==void 0||t.height!==void 0){let h,c;if(t.size)[h,c]=t.size;else{const u=this.getImage(1);if(u.width&&u.height)h=u.width,c=u.height;else if(u instanceof HTMLImageElement){this.initialOptions_=t;const f=()=>{if(this.unlistenImageChange(f),!this.initialOptions_)return;const _=this.iconImage_.getSize();this.setScale(Lf(_[0],_[1],t.width,t.height))};this.listenImageChange(f);return}}h!==void 0&&this.setScale(Lf(h,c,t.width,t.height))}}clone(){let t,e,n;return this.initialOptions_?(e=this.initialOptions_.width,n=this.initialOptions_.height):(t=this.getScale(),t=Array.isArray(t)?t.slice():t),new Zo({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:t,width:e,height:n,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const s=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!s)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=s[0]),this.anchorYUnits_=="fraction"&&(t[1]*=s[1])}if(this.anchorOrigin_!="top-left"){if(!s)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+s[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+s[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),n=this.getScaleArray();return[t[0]-e[0]/n[0],t[1]+e[1]/n[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const t=this.getScaleArray();if(this.size_)return this.size_[0]*t[0];if(this.iconImage_.getImageState()==K.LOADED)return this.iconImage_.getSize()[0]*t[0]}getHeight(){const t=this.getScaleArray();if(this.size_)return this.size_[1]*t[1];if(this.iconImage_.getImageState()==K.LOADED)return this.iconImage_.getSize()[1]*t[1]}setScale(t){delete this.initialOptions_,super.setScale(t)}listenImageChange(t){this.iconImage_.addEventListener(Y.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(Y.CHANGE,t)}ready(){return this.iconImage_.ready()}}class na{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new na({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class $i{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Of,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new $i({geometry:t??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Of,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function nx(i){let t;if(typeof i=="function")t=i;else{let e;Array.isArray(i)?e=i:(ft(typeof i.getZIndex=="function","Expected an `Style` or an array of `Style`"),e=[i]),t=function(){return e}}return t}let Ol=null;function h0(i,t){if(!Ol){const e=new In({color:"rgba(255,255,255,0.4)"}),n=new na({color:"#3399CC",width:1.25});Ol=[new $i({image:new ia({fill:e,stroke:n,radius:5}),fill:e,stroke:n})]}return Ol}function Of(i){return i.getGeometry()}const sx="#333";class Xc{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.keepUpright_=t.keepUpright,this.scale_=t.scale,this.scaleArray_=Lt(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.repeat_=t.repeat,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new In({color:sx}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new Xc({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),keepUpright:this.getKeepUpright(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getKeepUpright(){return this.keepUpright_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRepeat(t){this.repeat_=t}setRotateWithView(t){this.rotateWithView_=t}setKeepUpright(t){this.keepUpright_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=Lt(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}function rx(i){return!0}function ax(i){const t=Uc(),e=ox(i,t),n=i0();return function(s,r){if(n.properties=s.getPropertiesInternal(),n.resolution=r,t.featureId){const a=s.getId();a!==void 0?n.featureId=a:n.featureId=null}return t.geometryType&&(n.geometryType=e0(s.getGeometry())),e(n)}}function Ff(i){const t=Uc(),e=i.length,n=new Array(e);for(let a=0;a<e;++a)n[a]=Eh(i[a],t);const s=i0(),r=new Array(e);return function(a,o){if(s.properties=a.getPropertiesInternal(),s.resolution=o,t.featureId){const h=a.getId();h!==void 0?s.featureId=h:s.featureId=null}let l=0;for(let h=0;h<e;++h){const c=n[h](s);c&&(r[l]=c,l+=1)}return r.length=l,r}}function ox(i,t){const e=i.length,n=new Array(e);for(let s=0;s<e;++s){const r=i[s],a="filter"in r?Mi(r.filter,ne,t):rx;let o;if(Array.isArray(r.style)){const l=r.style.length;o=new Array(l);for(let h=0;h<l;++h)o[h]=Eh(r.style[h],t)}else o=[Eh(r.style,t)];n[s]={filter:a,styles:o}}return function(s){const r=[];let a=!1;for(let o=0;o<e;++o){const l=n[o].filter;if(l(s)&&!(i[o].else&&a)){a=!0;for(const h of n[o].styles){const c=h(s);c&&r.push(c)}}}return r}}function Eh(i,t){const e=Fr(i,"",t),n=Dr(i,"",t),s=lx(i,t),r=hx(i,t),a=pe(i,"z-index",t);if(!e&&!n&&!s&&!r&&!qi(i))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(i));const o=new $i;return function(l){let h=!0;if(e){const c=e(l);c&&(h=!1),o.setFill(c)}if(n){const c=n(l);c&&(h=!1),o.setStroke(c)}if(s){const c=s(l);c&&(h=!1),o.setText(c)}if(r){const c=r(l);c&&(h=!1),o.setImage(c)}return a&&o.setZIndex(a(l)),h?null:o}}function Fr(i,t,e){let n;if(t+"fill-pattern-src"in i)n=dx(i,t+"fill-",e);else{if(i[t+"fill-color"]==="none")return r=>null;n=jc(i,t+"fill-color",e)}if(!n)return null;const s=new In;return function(r){const a=n(r);return a===Dc?null:(s.setColor(a),s)}}function Dr(i,t,e){const n=pe(i,t+"stroke-width",e),s=jc(i,t+"stroke-color",e);if(!n&&!s)return null;const r=xi(i,t+"stroke-line-cap",e),a=xi(i,t+"stroke-line-join",e),o=c0(i,t+"stroke-line-dash",e),l=pe(i,t+"stroke-line-dash-offset",e),h=pe(i,t+"stroke-miter-limit",e),c=new na;return function(u){if(s){const f=s(u);if(f===Dc)return null;c.setColor(f)}if(n&&c.setWidth(n(u)),r){const f=r(u);if(f!=="butt"&&f!=="round"&&f!=="square")throw new Error("Expected butt, round, or square line cap");c.setLineCap(f)}if(a){const f=a(u);if(f!=="bevel"&&f!=="round"&&f!=="miter")throw new Error("Expected bevel, round, or miter line join");c.setLineJoin(f)}return o&&c.setLineDash(o(u)),l&&c.setLineDashOffset(l(u)),h&&c.setMiterLimit(h(u)),c}}function lx(i,t){const e="text-",n=xi(i,e+"value",t);if(!n)return null;const s=Fr(i,e,t),r=Fr(i,e+"background-",t),a=Dr(i,e,t),o=Dr(i,e+"background-",t),l=xi(i,e+"font",t),h=pe(i,e+"max-angle",t),c=pe(i,e+"offset-x",t),u=pe(i,e+"offset-y",t),f=ds(i,e+"overflow",t),_=xi(i,e+"placement",t),g=pe(i,e+"repeat",t),x=Qo(i,e+"scale",t),y=ds(i,e+"rotate-with-view",t),w=pe(i,e+"rotation",t),d=xi(i,e+"align",t),p=xi(i,e+"justify",t),v=xi(i,e+"baseline",t),T=ds(i,e+"keep-upright",t),R=c0(i,e+"padding",t),C=Jo(i,e+"declutter-mode"),b=new Xc({declutterMode:C});return function(I){if(b.setText(n(I)),s&&b.setFill(s(I)),r&&b.setBackgroundFill(r(I)),a&&b.setStroke(a(I)),o&&b.setBackgroundStroke(o(I)),l&&b.setFont(l(I)),h&&b.setMaxAngle(h(I)),c&&b.setOffsetX(c(I)),u&&b.setOffsetY(u(I)),f&&b.setOverflow(f(I)),_){const P=_(I);if(P!=="point"&&P!=="line")throw new Error("Expected point or line for text-placement");b.setPlacement(P)}if(g&&b.setRepeat(g(I)),x&&b.setScale(x(I)),y&&b.setRotateWithView(y(I)),w&&b.setRotation(w(I)),d){const P=d(I);if(P!=="left"&&P!=="center"&&P!=="right"&&P!=="end"&&P!=="start")throw new Error("Expected left, right, center, start, or end for text-align");b.setTextAlign(P)}if(p){const P=p(I);if(P!=="left"&&P!=="right"&&P!=="center")throw new Error("Expected left, right, or center for text-justify");b.setJustify(P)}if(v){const P=v(I);if(P!=="bottom"&&P!=="top"&&P!=="middle"&&P!=="alphabetic"&&P!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");b.setTextBaseline(P)}return R&&b.setPadding(R(I)),T&&b.setKeepUpright(T(I)),b}}function hx(i,t){return"icon-src"in i?cx(i,t):"shape-points"in i?ux(i,t):"circle-radius"in i?fx(i,t):null}function cx(i,t){const e="icon-",n=e+"src",s=u0(i[n],n),r=mo(i,e+"anchor",t),a=Qo(i,e+"scale",t),o=pe(i,e+"opacity",t),l=mo(i,e+"displacement",t),h=pe(i,e+"rotation",t),c=ds(i,e+"rotate-with-view",t),u=Gf(i,e+"anchor-origin"),f=Nf(i,e+"anchor-x-units"),_=Nf(i,e+"anchor-y-units"),g=px(i,e+"color"),x=_x(i,e+"cross-origin"),y=mx(i,e+"offset"),w=Gf(i,e+"offset-origin"),d=po(i,e+"width"),p=po(i,e+"height"),v=gx(i,e+"size"),T=Jo(i,e+"declutter-mode"),R=new Zo({src:s,anchorOrigin:u,anchorXUnits:f,anchorYUnits:_,color:g,crossOrigin:x,offset:y,offsetOrigin:w,height:p,width:d,size:v,declutterMode:T});return function(C){return o&&R.setOpacity(o(C)),l&&R.setDisplacement(l(C)),h&&R.setRotation(h(C)),c&&R.setRotateWithView(c(C)),a&&R.setScale(a(C)),r&&R.setAnchor(r(C)),R}}function ux(i,t){const e="shape-",n=e+"points",s=e+"radius",r=vh(i[n],n),a=vh(i[s],s),o=Fr(i,e,t),l=Dr(i,e,t),h=Qo(i,e+"scale",t),c=mo(i,e+"displacement",t),u=pe(i,e+"rotation",t),f=ds(i,e+"rotate-with-view",t),_=po(i,e+"radius2"),g=po(i,e+"angle"),x=Jo(i,e+"declutter-mode"),y=new Yo({points:r,radius:a,radius2:_,angle:g,declutterMode:x});return function(w){return o&&y.setFill(o(w)),l&&y.setStroke(l(w)),c&&y.setDisplacement(c(w)),u&&y.setRotation(u(w)),f&&y.setRotateWithView(f(w)),h&&y.setScale(h(w)),y}}function fx(i,t){const e="circle-",n=Fr(i,e,t),s=Dr(i,e,t),r=pe(i,e+"radius",t),a=Qo(i,e+"scale",t),o=mo(i,e+"displacement",t),l=pe(i,e+"rotation",t),h=ds(i,e+"rotate-with-view",t),c=Jo(i,e+"declutter-mode"),u=new ia({radius:5,declutterMode:c});return function(f){return r&&u.setRadius(r(f)),n&&u.setFill(n(f)),s&&u.setStroke(s(f)),o&&u.setDisplacement(o(f)),l&&u.setRotation(l(f)),h&&u.setRotateWithView(h(f)),a&&u.setScale(a(f)),u}}function pe(i,t,e){if(!(t in i))return;const n=Mi(i[t],st,e);return function(s){return vh(n(s),t)}}function xi(i,t,e){if(!(t in i))return null;const n=Mi(i[t],oe,e);return function(s){return u0(n(s),t)}}function dx(i,t,e){const n=xi(i,t+"pattern-src",e),s=Df(i,t+"pattern-offset",e),r=Df(i,t+"pattern-size",e),a=jc(i,t+"color",e);return function(o){return{src:n(o),offset:s&&s(o),size:r&&r(o),color:a&&a(o)}}}function ds(i,t,e){if(!(t in i))return null;const n=Mi(i[t],ne,e);return function(s){const r=n(s);if(typeof r!="boolean")throw new Error(`Expected a boolean for ${t}`);return r}}function jc(i,t,e){if(!(t in i))return null;const n=Mi(i[t],Se,e);return function(s){return f0(n(s),t)}}function c0(i,t,e){if(!(t in i))return null;const n=Mi(i[t],Hi,e);return function(s){return sa(n(s),t)}}function mo(i,t,e){if(!(t in i))return null;const n=Mi(i[t],Hi,e);return function(s){const r=sa(n(s),t);if(r.length!==2)throw new Error(`Expected two numbers for ${t}`);return r}}function Df(i,t,e){if(!(t in i))return null;const n=Mi(i[t],Hi,e);return function(s){return d0(n(s),t)}}function Qo(i,t,e){if(!(t in i))return null;const n=Mi(i[t],Hi|st,e);return function(s){return yx(n(s),t)}}function po(i,t){const e=i[t];if(e!==void 0){if(typeof e!="number")throw new Error(`Expected a number for ${t}`);return e}}function gx(i,t){const e=i[t];if(e!==void 0){if(typeof e=="number")return Lt(e);if(!Array.isArray(e))throw new Error(`Expected a number or size array for ${t}`);if(e.length!==2||typeof e[0]!="number"||typeof e[1]!="number")throw new Error(`Expected a number or size array for ${t}`);return e}}function _x(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);return e}}function Gf(i,t){const e=i[t];if(e!==void 0){if(e!=="bottom-left"&&e!=="bottom-right"&&e!=="top-left"&&e!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${t}`);return e}}function Nf(i,t){const e=i[t];if(e!==void 0){if(e!=="pixels"&&e!=="fraction")throw new Error(`Expected pixels or fraction for ${t}`);return e}}function mx(i,t){const e=i[t];if(e!==void 0)return sa(e,t)}function Jo(i,t){const e=i[t];if(e!==void 0){if(typeof e!="string")throw new Error(`Expected a string for ${t}`);if(e!=="declutter"&&e!=="obstacle"&&e!=="none")throw new Error(`Expected declutter, obstacle, or none for ${t}`);return e}}function px(i,t){const e=i[t];if(e!==void 0)return f0(e,t)}function sa(i,t){if(!Array.isArray(i))throw new Error(`Expected an array for ${t}`);const e=i.length;for(let n=0;n<e;++n)if(typeof i[n]!="number")throw new Error(`Expected an array of numbers for ${t}`);return i}function u0(i,t){if(typeof i!="string")throw new Error(`Expected a string for ${t}`);return i}function vh(i,t){if(typeof i!="number")throw new Error(`Expected a number for ${t}`);return i}function f0(i,t){if(typeof i=="string")return i;const e=sa(i,t),n=e.length;if(n<3||n>4)throw new Error(`Expected a color with 3 or 4 values for ${t}`);return e}function d0(i,t){const e=sa(i,t);if(e.length!==2)throw new Error(`Expected an array of two numbers for ${t}`);return e}function yx(i,t){return typeof i=="number"?i:d0(i,t)}const kf={RENDER_ORDER:"renderOrder"};class Vc extends ea{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter?String(t.declutter):void 0,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(kf.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t,e){const n=this.getDeclutter();n in t.declutter||(t.declutter[n]=new Qg(9)),this.getRenderer().renderDeclutter(t,e)}setRenderOrder(t){this.set(kf.RENDER_ORDER,t)}setStyle(t){this.style_=t===void 0?h0:t;const e=xx(t);this.styleFunction_=t===null?void 0:nx(e),this.changed()}setDeclutter(t){this.declutter_=t?String(t):void 0,this.changed()}}function xx(i){if(i===void 0)return h0;if(!i)return null;if(typeof i=="function"||i instanceof $i)return i;if(!Array.isArray(i))return Ff([i]);if(i.length===0)return[];const t=i.length,e=i[0];if(e instanceof $i){const s=new Array(t);for(let r=0;r<t;++r){const a=i[r];if(!(a instanceof $i))throw new Error("Expected a list of style instances");s[r]=a}return s}if("style"in e){const s=new Array(t);for(let r=0;r<t;++r){const a=i[r];if(!("style"in a))throw new Error("Expected a list of rules with a style property");s[r]=a}return ax(s)}return Ff(i)}class _r extends Ke{constructor(t,e,n,s){super(t),this.inversePixelTransform=e,this.frameState=n,this.context=s}}class Ex extends Wr{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){tt()}calculateMatrices2D(t){const e=t.viewState,n=t.coordinateToPixelTransform,s=t.pixelToCoordinateTransform;Ne(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),mc(s,n)}forEachFeatureAtCoordinate(t,e,n,s,r,a,o,l){let h;const c=e.viewState;function u(v,T,R,C){return r.call(a,T,v?R:null,C)}const f=c.projection,_=lc(t.slice(),f),g=[[0,0]];if(f.canWrapX()&&s){const v=f.getExtent(),T=ot(v);g.push([-T,0],[T,0])}const x=e.layerStatesArray,y=x.length,w=[],d=[];for(let v=0;v<g.length;v++)for(let T=y-1;T>=0;--T){const R=x[T],C=R.layer;if(C.hasRenderer()&&Fc(R,c)&&o.call(l,C)){const b=C.getRenderer(),I=C.getSource();if(b&&I){const P=I.getWrapX()?_:t,G=u.bind(null,R.managed);d[0]=P[0]+g[v][0],d[1]=P[1]+g[v][1],h=b.forEachFeatureAtCoordinate(d,e,n,G,w)}if(h)return h}}if(w.length===0)return;const p=1/w.length;return w.forEach((v,T)=>v.distanceSq+=T*p),w.sort((v,T)=>v.distanceSq-T.distanceSq),w.some(v=>h=v.callback(v.feature,v.layer,v.geometry)),h}hasFeatureAtCoordinate(t,e,n,s,r,a){return this.forEachFeatureAtCoordinate(t,e,n,s,Sr,this,r,a)!==void 0}getMap(){return this.map_}renderFrame(t){tt()}scheduleExpireIconCache(t){Fe.canExpireCache()&&t.postRenderFunctions.push(vx)}}function vx(i,t){Fe.expire()}class wx extends Ex{constructor(t){super(t),this.fontChangeListenerKey_=ct(Kn,xs.PROPERTYCHANGE,t.redrawText,t),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=Ko+" ol-layers";const n=t.getViewport();n.insertBefore(this.element_,n.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const n=this.getMap();if(n.hasListener(t)){const s=new _r(t,void 0,e);n.dispatchEvent(s)}}disposeInternal(){vt(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Wt.PRECOMPOSE,t);const e=t.layerStatesArray.sort((o,l)=>o.zIndex-l.zIndex);e.some(o=>o.layer instanceof Vc&&o.layer.getDeclutter())&&(t.declutter={});const s=t.viewState;this.children_.length=0;const r=[];let a=null;for(let o=0,l=e.length;o<l;++o){const h=e[o];t.layerIndex=o;const c=h.layer,u=c.getSourceState();if(!Fc(h,s)||u!="ready"&&u!="undefined"){c.unrender();continue}const f=c.render(t,a);f&&(f!==a&&(this.children_.push(f),a=f),r.push(h))}this.declutter(t,r),F1(this.element_,this.children_),this.dispatchRenderEvent(Wt.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}declutter(t,e){if(t.declutter){for(let n=e.length-1;n>=0;--n){const s=e[n],r=s.layer;r.getDeclutter()&&r.renderDeclutter(t,s)}e.forEach(n=>n.layer.renderDeferred(t))}}}function g0(i){if(i instanceof ea){i.setMapInternal(null);return}i instanceof Cn&&i.getLayers().forEach(g0)}function _0(i,t){if(i instanceof ea){i.setMapInternal(t);return}if(i instanceof Cn){const e=i.getLayers().getArray();for(let n=0,s=e.length;n<s;++n)_0(e[n],t)}}let Tx=class extends He{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=Sx(t);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:ap,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Zt(),this.pixelToCoordinateTransform_=Zt(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=e.controls||k1(),this.interactions=e.interactions||ay({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new hp(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(ee.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(ee.VIEW,this.handleViewChanged_),this.addChangeListener(ee.SIZE,this.handleSizeChanged_),this.addChangeListener(ee.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const n=this;t.view&&!(t.view instanceof ti)&&t.view.then(function(s){n.setView(new ti(s))}),this.controls.addEventListener(ge.ADD,s=>{s.element.setMap(this)}),this.controls.addEventListener(ge.REMOVE,s=>{s.element.setMap(null)}),this.interactions.addEventListener(ge.ADD,s=>{s.element.setMap(this)}),this.interactions.addEventListener(ge.REMOVE,s=>{s.element.setMap(null)}),this.overlays_.addEventListener(ge.ADD,s=>{this.addOverlayInternal_(s.element)}),this.overlays_.addEventListener(ge.REMOVE,s=>{const r=s.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],s.element.setMap(null)}),this.controls.forEach(s=>{s.setMap(this)}),this.interactions.forEach(s=>{s.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){_0(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,n){if(!this.frameState_||!this.renderer_)return;const s=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};const r=n.hitTolerance!==void 0?n.hitTolerance:0,a=n.layerFilter!==void 0?n.layerFilter:Sr,o=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(s,this.frameState_,r,o,e,null,a,null)}getFeaturesAtPixel(t,e){const n=[];return this.forEachFeatureAtPixel(t,function(s){n.push(s)},e),n}getAllLayers(){const t=[];function e(n){n.forEach(function(s){s instanceof Cn?e(s.getLayers()):t.push(s)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const n=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const s=e.layerFilter!==void 0?e.layerFilter:Sr,r=e.hitTolerance!==void 0?e.hitTolerance:0,a=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,r,a,s,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const n=this.viewport_.getBoundingClientRect(),s=this.getSize(),r=n.width/s[0],a=n.height/s[1],o="changedTouches"in t?t.changedTouches[0]:t;return[(o.clientX-n.left)/r,(o.clientY-n.top)/a]}getTarget(){return this.get(ee.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(t){return uo(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?kt(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(ee.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof ei){e.setLayers(t);return}const n=e.getLayers();n.clear(),n.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,n=t.length;e<n;++e){const s=t[e];if(!s.visible)continue;const r=s.layer.getRenderer();if(r&&!r.ready)return!0;const a=s.layer.getSource();if(a&&a.loading)return!0}return!1}getPixelFromCoordinate(t){const e=pi(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?kt(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(ee.SIZE)}getView(){return this.get(ee.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,n,s){return cp(this.frameState_,t,e,n,s)}handleBrowserEvent(t,e){e=e||t.type;const n=new Di(e,this,t);this.handleMapBrowserEvent(n)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,n=e.type;if(n===ah.POINTERDOWN||n===Y.WHEEL||n===Y.KEYDOWN){const s=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():s,a=e.target,o=r instanceof ShadowRoot?r.host===a?r.host.ownerDocument:r:r===s?s.documentElement:r;if(this.overlayContainerStopEvent_.contains(a)||!o.contains(a))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const s=this.getInteractions().getArray().slice();for(let r=s.length-1;r>=0;r--){const a=s[r];if(a.getMap()!==this||!a.getActive()||!this.getTargetElement())continue;if(!a.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let s=this.maxTilesLoading_,r=s;if(t){const a=t.viewHints;if(a[bt.ANIMATING]||a[bt.INTERACTING]){const o=Date.now()-t.time>8;s=o?0:8,r=o?0:2}}e.getTilesLoading()<s&&(e.reprioritize(),e.loadMoreTiles(s,r))}t&&this.renderer_&&!t.animate&&(this.renderComplete_?(this.hasListener(Wt.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Wt.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Wn(yi.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Wn(yi.LOADSTART,this,t))));const n=this.postRenderFunctions_;if(t)for(let s=0,r=n.length;s<r;++s)n[s](this,t);n.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let n=0,s=this.targetChangeHandlerKeys_.length;n<s;++n)vt(this.targetChangeHandlerKeys_[n]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(Y.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(Y.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const n=this.targetElement_.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.unobserve(n.host),this.setSize(void 0)}const t=this.getTarget(),e=typeof t=="string"?document.getElementById(t):t;if(this.targetElement_=e,!e)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{e.appendChild(this.viewport_),this.renderer_||(this.renderer_=new wx(this)),this.mapBrowserEventHandler_=new op(this,this.moveTolerance_);for(const r in Nt)this.mapBrowserEventHandler_.addEventListener(Nt[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(Y.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(Y.WHEEL,this.boundHandleBrowserEvent_,_g?{passive:!1}:!1);let n;if(this.keyboardEventTarget_)n=this.keyboardEventTarget_;else{const r=e.getRootNode();n=r instanceof ShadowRoot?r.host:e}this.targetChangeHandlerKeys_=[ct(n,Y.KEYDOWN,this.handleBrowserEvent,this),ct(n,Y.KEYPRESS,this.handleBrowserEvent,this)];const s=e.getRootNode();s instanceof ShadowRoot&&this.resizeObserver_.observe(s.host),this.resizeObserver_.observe(e)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(vt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(vt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=ct(t,xs.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ct(t,Y.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(vt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Gi("addlayer",t)),this.layerGroupPropertyListenerKeys_=[ct(t,xs.PROPERTYCHANGE,this.render,this),ct(t,Y.CHANGE,this.render,this),ct(t,"addlayer",this.handleLayerAdd_,this),ct(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){if(!this.frameState_)return;const t=this.frameState_.layerStatesArray;for(let e=0,n=t.length;e<n;++e){const s=t[e].layer;s.hasRenderer()&&s.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){g0(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),n=this.getView(),s=this.frameState_;let r=null;if(e!==void 0&&Mf(e)&&n&&n.isDef()){const a=n.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=n.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:ro(o.center,o.resolution,o.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:o,viewHints:a,wantedTiles:{},mapId:Z(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const l=isNaN(o.nextRotation)?o.rotation:o.nextRotation;r.nextExtent=ro(o.nextCenter,o.nextResolution,l,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),s&&(!this.previousExtent_||!Ri(this.previousExtent_)&&!yn(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Wn(yi.MOVESTART,this,s)),this.previousExtent_=Os(this.previousExtent_)),this.previousExtent_&&!r.viewHints[bt.ANIMATING]&&!r.viewHints[bt.INTERACTING]&&!yn(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Wn(yi.MOVEEND,this,r)),mg(r.extent,this.previousExtent_))),this.dispatchEvent(new Wn(yi.POSTRENDER,this,r)),this.renderComplete_=(this.hasListener(yi.LOADSTART)||this.hasListener(yi.LOADEND)||this.hasListener(Wt.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Gi("removelayer",e)),this.set(ee.LAYERGROUP,t)}setSize(t){this.set(ee.SIZE,t)}setTarget(t){this.set(ee.TARGET,t)}setView(t){if(!t||t instanceof ti){this.set(ee.VIEW,t);return}this.set(ee.VIEW,new ti);const e=this;t.then(function(n){e.setView(new ti(n))})}updateSize(){const t=this.getTargetElement();let e;if(t){const s=getComputedStyle(t),r=t.offsetWidth-parseFloat(s.borderLeftWidth)-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight)-parseFloat(s.borderRightWidth),a=t.offsetHeight-parseFloat(s.borderTopWidth)-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)-parseFloat(s.borderBottomWidth);!isNaN(r)&&!isNaN(a)&&(e=[Math.max(0,r),Math.max(0,a)],!Mf(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&Sg("No map visible because the map container's width or height are 0."))}const n=this.getSize();e&&(!n||!Ji(e,n))&&(this.setSize(e),this.updateViewportSize_(e))}updateViewportSize_(t){const e=this.getView();e&&e.setViewportSize(t)}};function Sx(i){let t=null;i.keyboardEventTarget!==void 0&&(t=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);const e={},n=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new Cn({layers:i.layers});e[ee.LAYERGROUP]=n,e[ee.TARGET]=i.target,e[ee.VIEW]=i.view instanceof ti?i.view:new ti;let s;i.controls!==void 0&&(Array.isArray(i.controls)?s=new ei(i.controls.slice()):(ft(typeof i.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),s=i.controls));let r;i.interactions!==void 0&&(Array.isArray(i.interactions)?r=new ei(i.interactions.slice()):(ft(typeof i.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=i.interactions));let a;return i.overlays!==void 0?Array.isArray(i.overlays)?a=new ei(i.overlays.slice()):(ft(typeof i.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),a=i.overlays):a=new ei,{controls:s,interactions:r,keyboardEventTarget:t,overlays:a,values:e}}function Ds(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function m0(i,t){return i[0]=t[0],i[1]=t[1],i[4]=t[2],i[5]=t[3],i[12]=t[4],i[13]=t[5],i}function wh(i,t,e,n,s,r,a){a=a??Ds();const o=1/(i-t),l=1/(e-n),h=1/(s-r);return a[0]=-2*o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*l,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*h,a[11]=0,a[12]=(i+t)*o,a[13]=(n+e)*l,a[14]=(r+s)*h,a[15]=1,a}function Uf(i,t,e,n,s){return s=s??Ds(),s[0]=i[0]*t,s[1]=i[1]*t,s[2]=i[2]*t,s[3]=i[3]*t,s[4]=i[4]*e,s[5]=i[5]*e,s[6]=i[6]*e,s[7]=i[7]*e,s[8]=i[8]*n,s[9]=i[9]*n,s[10]=i[10]*n,s[11]=i[11]*n,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s}function Rx(i,t,e,n,s){s=s??Ds();let r,a,o,l,h,c,u,f,_,g,x,y;return i===s?(s[12]=i[0]*t+i[4]*e+i[8]*n+i[12],s[13]=i[1]*t+i[5]*e+i[9]*n+i[13],s[14]=i[2]*t+i[6]*e+i[10]*n+i[14],s[15]=i[3]*t+i[7]*e+i[11]*n+i[15]):(r=i[0],a=i[1],o=i[2],l=i[3],h=i[4],c=i[5],u=i[6],f=i[7],_=i[8],g=i[9],x=i[10],y=i[11],s[0]=r,s[1]=a,s[2]=o,s[3]=l,s[4]=h,s[5]=c,s[6]=u,s[7]=f,s[8]=_,s[9]=g,s[10]=x,s[11]=y,s[12]=r*t+h*e+_*n+i[12],s[13]=a*t+c*e+g*n+i[13],s[14]=o*t+u*e+x*n+i[14],s[15]=l*t+f*e+y*n+i[15]),s}function Mx(i,t,e,n){return n=n??Ds(),n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=i,n[13]=t,n[14]=e,n[15]=1,n}const $c=34962,Wc=34963,qc=35044,Cx=5121,bx=5123,Ix=5125,p0=5126,Bf=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Ax(i,t){t=Object.assign({preserveDrawingBuffer:!0,antialias:!sp},t);const e=Bf.length;for(let n=0;n<e;++n)try{const s=i.getContext(Bf[n],t);if(s)return s}catch{}return null}const Px={STATIC_DRAW:qc};class y0{constructor(t,e){this.array_=null,this.type_=t,ft(t===$c||t===Wc,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=e!==void 0?e:Px.STATIC_DRAW}ofSize(t){return this.array_=new(Ia(this.type_))(t),this}fromArray(t){return this.array_=Ia(this.type_).from(t),this}fromArrayBuffer(t){return this.array_=new(Ia(this.type_))(t),this}getType(){return this.type_}getArray(){return this.array_}setArray(t){const e=Ia(this.type_);if(!(t instanceof e))throw new Error(`Expected ${e}`);this.array_=t}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Ia(i){switch(i){case $c:return Float32Array;case Wc:return Uint32Array;default:return Float32Array}}const Aa={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Lx=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Ox=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class zf{constructor(t){this.gl_=t.webGlContext;const e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer(),this.depthBuffer_=e.createRenderbuffer();const n=e.createShader(e.VERTEX_SHADER);e.shaderSource(n,t.vertexShader||Lx),e.compileShader(n);const s=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(s,t.fragmentShader||Ox),e.compileShader(s),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,n),e.attachShader(this.renderTargetProgram_,s),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();const r=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array(r),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(a=>{this.uniforms_.push({value:t.uniforms[a],location:e.getUniformLocation(this.renderTargetProgram_,a)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(t){const e=this.getGL(),n=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.bindRenderbuffer(e.RENDERBUFFER,this.getDepthBuffer()),e.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const s=0,r=e.RGBA,a=0,o=e.RGBA,l=e.UNSIGNED_BYTE,h=null;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,s,r,n[0],n[1],a,o,l,h),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n[0],n[1]),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.depthBuffer_)}}apply(t,e,n,s){const r=this.getGL(),a=t.size;if(r.bindFramebuffer(r.FRAMEBUFFER,e?e.getFrameBuffer():null),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this.renderTargetTexture_),!e){const l=Z(r.canvas);if(!t.renderTargets[l]){const h=r.getContextAttributes();h&&h.preserveDrawingBuffer&&(r.clearColor(0,0,0,0),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)),t.renderTargets[l]=!0}}r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE_MINUS_SRC_ALPHA),r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.bindBuffer(r.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),r.useProgram(this.renderTargetProgram_),r.enableVertexAttribArray(this.renderTargetAttribLocation_),r.vertexAttribPointer(this.renderTargetAttribLocation_,2,r.FLOAT,!1,0,0),r.uniform2f(this.renderTargetUniformLocation_,a[0],a[1]),r.uniform1i(this.renderTargetTextureLocation_,0);const o=t.layerStatesArray[t.layerIndex].opacity;r.uniform1f(this.renderTargetOpacityLocation_,o),this.applyUniforms(t),n&&n(r,t),r.drawArrays(r.TRIANGLES,0,6),s&&s(r,t)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(t){const e=this.getGL();let n,s=1;this.uniforms_.forEach(function(r){if(n=typeof r.value=="function"?r.value(t):r.value,n instanceof HTMLCanvasElement||n instanceof ImageData)r.texture||(r.texture=e.createTexture()),e.activeTexture(e[`TEXTURE${s}`]),e.bindTexture(e.TEXTURE_2D,r.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),n instanceof ImageData?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,n.width,n.height,0,e.UNSIGNED_BYTE,new Uint8Array(n.data)):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.uniform1i(r.location,s++);else if(Array.isArray(n))switch(n.length){case 2:e.uniform2f(r.location,n[0],n[1]);return;case 3:e.uniform3f(r.location,n[0],n[1],n[2]);return;case 4:e.uniform4f(r.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(r.location,n)})}}const Ii={TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},rr={UNSIGNED_BYTE:Cx,UNSIGNED_SHORT:bx,UNSIGNED_INT:Ix,FLOAT:p0},yo={};function Xf(i){return"shared/"+i}let jf=0;function Fx(){const i="unique/"+jf;return jf+=1,i}function Dx(i){let t=yo[i];if(!t){const e=document.createElement("canvas");e.width=1,e.height=1,e.style.position="absolute",e.style.left="0",t={users:0,context:Ax(e)},yo[i]=t}return t.users+=1,t.context}function Gx(i){const t=yo[i];if(!t||(t.users-=1,t.users>0))return;const e=t.context,n=e.getExtension("WEBGL_lose_context");n&&n.loseContext();const s=e.canvas;s.width=1,s.height=1,delete yo[i]}class Nx extends Wr{constructor(t){super(),t=t||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=t.canvasCacheKey?Xf(t.canvasCacheKey):Fx(),this.gl_=Dx(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const e=this.gl_.canvas;e.addEventListener(Aa.LOST,this.boundHandleWebGLContextLost_),e.addEventListener(Aa.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Zt(),this.offsetScaleMatrix_=Zt(),this.tmpMat4_=Ds(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],t.uniforms&&this.setUniforms(t.uniforms),this.postProcessPasses_=t.postProcesses?t.postProcesses.map(n=>new zf({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new zf({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(t){this.uniforms_=[],this.addUniforms(t)}addUniforms(t){for(const e in t)this.uniforms_.push({name:e,value:t[e]})}canvasCacheKeyMatches(t){return this.canvasCacheKey_===Xf(t)}getExtension(t){if(t in this.extensionCache_)return this.extensionCache_[t];const e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e}bindBuffer(t){const e=this.gl_,n=Z(t);let s=this.bufferCache_[n];if(!s){const r=e.createBuffer();s={buffer:t,webGlBuffer:r},this.bufferCache_[n]=s}e.bindBuffer(t.getType(),s.webGlBuffer)}flushBufferData(t){const e=this.gl_;this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())}deleteBuffer(t){const e=Z(t);delete this.bufferCache_[e]}disposeInternal(){const t=this.gl_.canvas;t.removeEventListener(Aa.LOST,this.boundHandleWebGLContextLost_),t.removeEventListener(Aa.RESTORED,this.boundHandleWebGLContextRestored_),Gx(this.canvasCacheKey_),delete this.gl_}prepareDraw(t,e,n){const s=this.gl_,r=this.getCanvas(),a=t.size,o=t.pixelRatio;(r.width!==a[0]*o||r.height!==a[1]*o)&&(r.width=a[0]*o,r.height=a[1]*o,r.style.width=a[0]+"px",r.style.height=a[1]+"px");for(let l=this.postProcessPasses_.length-1;l>=0;l--)this.postProcessPasses_[l].init(t);s.bindTexture(s.TEXTURE_2D,null),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,e?s.ZERO:s.ONE_MINUS_SRC_ALPHA),n?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}bindFrameBuffer(t,e){const n=this.getGL();n.bindFramebuffer(n.FRAMEBUFFER,t),e&&n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)}bindInitialFrameBuffer(){const t=this.getGL(),e=this.postProcessPasses_[0].getFrameBuffer();t.bindFramebuffer(t.FRAMEBUFFER,e);const n=this.postProcessPasses_[0].getRenderTargetTexture();t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}bindTexture(t,e,n){const s=this.gl_;s.activeTexture(s.TEXTURE0+e),s.bindTexture(s.TEXTURE_2D,t),s.uniform1i(this.getUniformLocation(n),e)}bindAttribute(t,e,n){const s=this.getGL();this.bindBuffer(t);const r=this.getAttributeLocation(e);s.enableVertexAttribArray(r),s.vertexAttribPointer(r,n,s.FLOAT,!1,0,0)}prepareDrawToRenderTarget(t,e,n,s){const r=this.gl_,a=e.getSize();r.bindFramebuffer(r.FRAMEBUFFER,e.getFramebuffer()),r.bindRenderbuffer(r.RENDERBUFFER,e.getDepthbuffer()),r.viewport(0,0,a[0],a[1]),r.bindTexture(r.TEXTURE_2D,e.getTexture()),r.clearColor(0,0,0,0),r.depthRange(0,1),r.clearDepth(1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,n?r.ZERO:r.ONE_MINUS_SRC_ALPHA),s?(r.enable(r.DEPTH_TEST),r.depthFunc(r.LEQUAL)):r.disable(r.DEPTH_TEST)}drawElements(t,e){const n=this.gl_;this.getExtension("OES_element_index_uint");const s=n.UNSIGNED_INT,r=4,a=e-t,o=t*r;n.drawElements(n.TRIANGLES,a,s,o)}finalizeDraw(t,e,n){for(let s=0,r=this.postProcessPasses_.length;s<r;s++)s===r-1?this.postProcessPasses_[s].apply(t,null,e,n):this.postProcessPasses_[s].apply(t,this.postProcessPasses_[s+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(t){const e=t.size,n=t.viewState.rotation,s=t.pixelRatio;this.setUniformFloatValue(Ii.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(Ii.ZOOM,t.viewState.zoom),this.setUniformFloatValue(Ii.RESOLUTION,t.viewState.resolution),this.setUniformFloatValue(Ii.PIXEL_RATIO,s),this.setUniformFloatVec2(Ii.VIEWPORT_SIZE_PX,[e[0],e[1]]),this.setUniformFloatValue(Ii.ROTATION,n)}applyHitDetectionUniform(t){const e=this.getUniformLocation(Ii.HIT_DETECTION);this.getGL().uniform1i(e,t?1:0),t&&this.setUniformFloatValue(Ii.PIXEL_RATIO,.5)}applyUniforms(t){const e=this.gl_;let n,s=0;this.uniforms_.forEach(r=>{if(n=typeof r.value=="function"?r.value(t):r.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!r.texture?(r.prevValue=void 0,r.texture=n):r.texture||(r.prevValue=void 0,r.texture=e.createTexture()),this.bindTexture(r.texture,s,r.name),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);const a=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&a&&r.prevValue!==n&&(r.prevValue=n,e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)),s++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(r.name,m0(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:e.uniform2f(this.getUniformLocation(r.name),n[0],n[1]);return;case 3:e.uniform3f(this.getUniformLocation(r.name),n[0],n[1],n[2]);return;case 4:e.uniform4f(this.getUniformLocation(r.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&e.uniform1f(this.getUniformLocation(r.name),n)})}useProgram(t,e){this.disableAllAttributes_(),this.gl_.useProgram(t),this.currentProgram_=t,e&&(this.applyFrameState(e),this.applyUniforms(e))}compileShader(t,e){const n=this.gl_,s=n.createShader(e);return n.shaderSource(s,t),n.compileShader(s),s}getProgram(t,e){const n=this.gl_,s=this.compileShader(t,n.FRAGMENT_SHADER),r=this.compileShader(e,n.VERTEX_SHADER),a=n.createProgram();if(n.attachShader(a,s),n.attachShader(a,r),n.linkProgram(a),!n.getShaderParameter(s,n.COMPILE_STATUS)){const o=`Fragment shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(o)}if(n.deleteShader(s),!n.getShaderParameter(r,n.COMPILE_STATUS)){const o=`Vertex shader compilation failed: ${n.getShaderInfoLog(r)}`;throw new Error(o)}if(n.deleteShader(r),!n.getProgramParameter(a,n.LINK_STATUS)){const o=`GL program linking failed: ${n.getProgramInfoLog(a)}`;throw new Error(o)}return a}getUniformLocation(t){const e=Z(this.currentProgram_);return this.uniformLocationsByProgram_[e]===void 0&&(this.uniformLocationsByProgram_[e]={}),this.uniformLocationsByProgram_[e][t]===void 0&&(this.uniformLocationsByProgram_[e][t]=this.gl_.getUniformLocation(this.currentProgram_,t)),this.uniformLocationsByProgram_[e][t]}getAttributeLocation(t){const e=Z(this.currentProgram_);return this.attribLocationsByProgram_[e]===void 0&&(this.attribLocationsByProgram_[e]={}),this.attribLocationsByProgram_[e][t]===void 0&&(this.attribLocationsByProgram_[e][t]=this.gl_.getAttribLocation(this.currentProgram_,t)),this.attribLocationsByProgram_[e][t]}makeProjectionTransform(t,e){const n=t.size,s=t.viewState.rotation,r=t.viewState.resolution,a=t.viewState.center;return Ne(e,0,0,2/(r*n[0]),2/(r*n[1]),-s,-a[0],-a[1]),e}setUniformFloatValue(t,e){this.gl_.uniform1f(this.getUniformLocation(t),e)}setUniformFloatVec2(t,e){this.gl_.uniform2fv(this.getUniformLocation(t),e)}setUniformFloatVec4(t,e){this.gl_.uniform4fv(this.getUniformLocation(t),e)}setUniformMatrixValue(t,e){this.gl_.uniformMatrix4fv(this.getUniformLocation(t),!1,e)}disableAllAttributes_(){for(let t=0;t<this.maxAttributeCount_;t++)this.gl_.disableVertexAttribArray(t)}enableAttributeArray_(t,e,n,s,r){const a=this.getAttributeLocation(t);a<0||(this.gl_.enableVertexAttribArray(a),this.gl_.vertexAttribPointer(a,e,n,!1,s,r))}enableAttributes(t){const e=kx(t);let n=0;for(let s=0;s<t.length;s++){const r=t[s];this.enableAttributeArray_(r.name,r.size,r.type||p0,e,n),n+=r.size*x0(r.type)}}handleWebGLContextLost(t){Ps(this.bufferCache_),this.currentProgram_=null,t.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(t,e,n,s){const r=this.gl_;n=n||r.createTexture();const a=s?r.NEAREST:r.LINEAR;r.bindTexture(r.TEXTURE_2D,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);const o=0,l=r.RGBA,h=0,c=r.RGBA,u=r.UNSIGNED_BYTE;return e instanceof Uint8Array?r.texImage2D(r.TEXTURE_2D,o,l,t[0],t[1],h,c,u,e):e?r.texImage2D(r.TEXTURE_2D,o,l,c,u,e):r.texImage2D(r.TEXTURE_2D,o,l,t[0],t[1],h,c,u,null),n}}function kx(i){let t=0;for(let e=0;e<i.length;e++){const n=i[e];t+=n.size*x0(n.type)}return t}function x0(i){switch(i){case rr.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case rr.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case rr.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case rr.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}class ra extends Ls{constructor(t,e,n){super(),n=n||{},this.tileCoord=t,this.state=e,this.key="",this.transition_=n.transition===void 0?250:n.transition,this.transitionStarts_={},this.interpolate=!!n.interpolate}changed(){this.dispatchEvent(Y.CHANGE)}release(){this.setState(z.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==z.EMPTY){if(this.state!==z.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}}load(){tt()}getAlpha(t,e){if(!this.transition_)return 1;let n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;const s=e-n+1e3/60;return s>=this.transition_?1:Tg(s/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}disposeInternal(){this.release(),super.disposeInternal()}}function Ms(i){return i instanceof Image||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageBitmap?i:null}function Th(i){return i instanceof Uint8Array||i instanceof Uint8ClampedArray||i instanceof Float32Array||i instanceof DataView?i:null}const Ux=new Error("disposed");let Un=null;function Bx(i){Un||(Un=Ot(i.width,i.height,void 0,{willReadFrequently:!0}));const t=Un.canvas,e=i.width;t.width!==e&&(t.width=e);const n=i.height;return t.height!==n&&(t.height=n),Un.clearRect(0,0,e,n),Un.drawImage(i,0,0),Un.getImageData(0,0,e,n).data}const zx=[256,256];class Gr extends ra{constructor(t){const e=z.IDLE;super(t.tileCoord,e,{transition:t.transition,interpolate:t.interpolate}),this.loader_=t.loader,this.data_=null,this.error_=null,this.size_=t.size||null,this.controller_=t.controller||null}getSize(){if(this.size_)return this.size_;const t=Ms(this.data_);return t?[t.width,t.height]:zx}getData(){return this.data_}getError(){return this.error_}load(){if(this.state!==z.IDLE&&this.state!==z.ERROR)return;this.state=z.LOADING,this.changed();const t=this;this.loader_().then(function(e){t.data_=e,t.state=z.LOADED,t.changed()}).catch(function(e){t.error_=e,t.state=z.ERROR,t.changed()})}disposeInternal(){this.controller_&&(this.controller_.abort(Ux),this.controller_=null),super.disposeInternal()}}class tl extends ra{constructor(t,e,n,s,r,a){super(t,e,a),this.crossOrigin_=s,this.src_=n,this.key=n,this.image_=new Image,s!==null&&(this.image_.crossOrigin=s),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=z.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=z.ERROR,this.unlistenImage_(),this.image_=Xx(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=z.LOADED:this.state=z.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==z.ERROR&&(this.state=z.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==z.IDLE&&(this.state=z.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Wy(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}disposeInternal(){this.unlistenImage_(),this.image_=null,super.disposeInternal()}}function Xx(){const i=Ot(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}let Fl;const gs=[];function Vf(i,t,e,n,s){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(n,s),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,n)+1,Math.max(e,s)),i.restore()}function Dl(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function jx(){if(Fl===void 0){const i=Ot(6,6,gs);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",Vf(i,4,5,4,0),Vf(i,4,5,0,5);const t=i.getImageData(0,0,3,3).data;Fl=Dl(t,0)||Dl(t,4)||Dl(t,8),Qr(i),gs.push(i.canvas)}return Fl}function xo(i,t,e,n){const s=gc(e,t,i);let r=uf(t,n,e);const a=t.getMetersPerUnit();a!==void 0&&(r*=a);const o=i.getMetersPerUnit();o!==void 0&&(r/=o);const l=i.getExtent();if(!l||wi(l,s)){const h=uf(i,r,s)/r;isFinite(h)&&h>0&&(r/=h)}return r}function E0(i,t,e,n){const s=We(e);let r=xo(i,t,s,n);return(!isFinite(r)||r<=0)&&xg(e,function(a){return r=xo(i,t,a,n),isFinite(r)&&r>0}),r}function v0(i,t,e,n,s,r,a,o,l,h,c,u,f,_){const g=Ot(Math.round(e*i),Math.round(e*t),gs);if(u||(g.imageSmoothingEnabled=!1),l.length===0)return g.canvas;g.scale(e,e);function x(T){return Math.round(T*e)/e}g.globalCompositeOperation="lighter";const y=xe();l.forEach(function(T,R,C){nc(y,T.extent)});let w;const d=e/n,p=(u?1:1+Math.pow(2,-24))/d;if(!f||l.length!==1||h!==0){if(w=Ot(Math.round(ot(y)*d),Math.round(It(y)*d),gs),u||(w.imageSmoothingEnabled=!1),s&&_){const T=(s[0]-y[0])*d,R=-(s[3]-y[3])*d,C=ot(s)*d,b=It(s)*d;w.rect(T,R,C,b),w.clip()}l.forEach(function(T,R,C){if(T.image.width>0&&T.image.height>0){if(T.clipExtent){w.save();const O=(T.clipExtent[0]-y[0])*d,m=-(T.clipExtent[3]-y[3])*d,E=ot(T.clipExtent)*d,S=It(T.clipExtent)*d;w.rect(u?O:Math.round(O),u?m:Math.round(m),u?E:Math.round(O+E)-Math.round(O),u?S:Math.round(m+S)-Math.round(m)),w.clip()}const b=(T.extent[0]-y[0])*d,I=-(T.extent[3]-y[3])*d,P=ot(T.extent)*d,G=It(T.extent)*d;w.drawImage(T.image,h,h,T.image.width-2*h,T.image.height-2*h,u?b:Math.round(b),u?I:Math.round(I),u?P:Math.round(b+P)-Math.round(b),u?G:Math.round(I+G)-Math.round(I)),T.clipExtent&&w.restore()}})}const v=li(a);return o.getTriangles().forEach(function(T,R,C){const b=T.source,I=T.target;let P=b[0][0],G=b[0][1],O=b[1][0],m=b[1][1],E=b[2][0],S=b[2][1];const M=x((I[0][0]-v[0])/r),A=x(-(I[0][1]-v[1])/r),F=x((I[1][0]-v[0])/r),D=x(-(I[1][1]-v[1])/r),k=x((I[2][0]-v[0])/r),B=x(-(I[2][1]-v[1])/r),U=P,V=G;P=0,G=0,O-=U,m-=V,E-=U,S-=V;const q=[[O,m,0,0,F-M],[E,S,0,0,k-M],[0,0,O,m,D-A],[0,0,E,S,B-A]],W=fp(q);if(!W)return;if(g.save(),g.beginPath(),jx()||!u){g.moveTo(F,D);const et=4,mt=M-F,ht=A-D;for(let dt=0;dt<et;dt++)g.lineTo(F+x((dt+1)*mt/et),D+x(dt*ht/(et-1))),dt!=et-1&&g.lineTo(F+x((dt+1)*mt/et),D+x((dt+1)*ht/(et-1)));g.lineTo(k,B)}else g.moveTo(F,D),g.lineTo(M,A),g.lineTo(k,B);g.clip(),g.transform(W[0],W[2],W[1],W[3],M,A),g.translate(y[0]-U,y[3]-V);let H;if(w)H=w.canvas,g.scale(p,-p);else{const et=l[0],mt=et.extent;H=et.image,g.scale(ot(mt)/H.width,-It(mt)/H.height)}g.drawImage(H,0,0),g.restore()}),w&&(Qr(w),gs.push(w.canvas)),c&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,o.getTriangles().forEach(function(T,R,C){const b=T.target,I=(b[0][0]-v[0])/r,P=-(b[0][1]-v[1])/r,G=(b[1][0]-v[0])/r,O=-(b[1][1]-v[1])/r,m=(b[2][0]-v[0])/r,E=-(b[2][1]-v[1])/r;g.beginPath(),g.moveTo(G,O),g.lineTo(I,P),g.lineTo(m,E),g.closePath(),g.stroke()}),g.restore()),g.canvas}const Vx=10,$f=.25;class Kc{constructor(t,e,n,s,r,a,o){this.sourceProj_=t,this.targetProj_=e;let l={};const h=o?co(p=>kt(o,gc(p,this.targetProj_,this.sourceProj_))):ws(this.targetProj_,this.sourceProj_);this.transformInv_=function(p){const v=p[0]+"/"+p[1];return l[v]||(l[v]=h(p)),l[v]},this.maxSourceExtent_=s,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!s&&!!this.sourceProj_.getExtent()&&ot(s)>=ot(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?ot(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?ot(this.targetProj_.getExtent()):null;const c=li(n),u=Bo(n),f=Uo(n),_=ko(n),g=this.transformInv_(c),x=this.transformInv_(u),y=this.transformInv_(f),w=this.transformInv_(_),d=Vx+(a?Math.max(0,Math.ceil(Math.log2(Mr(n)/(a*a*256*256)))):0);if(this.addQuad_(c,u,f,_,g,x,y,w,d),this.wrapsXInSource_){let p=1/0;this.triangles_.forEach(function(v,T,R){p=Math.min(p,v.source[0][0],v.source[1][0],v.source[2][0])}),this.triangles_.forEach(v=>{if(Math.max(v.source[0][0],v.source[1][0],v.source[2][0])-p>this.sourceWorldWidth_/2){const T=[[v.source[0][0],v.source[0][1]],[v.source[1][0],v.source[1][1]],[v.source[2][0],v.source[2][1]]];T[0][0]-p>this.sourceWorldWidth_/2&&(T[0][0]-=this.sourceWorldWidth_),T[1][0]-p>this.sourceWorldWidth_/2&&(T[1][0]-=this.sourceWorldWidth_),T[2][0]-p>this.sourceWorldWidth_/2&&(T[2][0]-=this.sourceWorldWidth_);const R=Math.min(T[0][0],T[1][0],T[2][0]);Math.max(T[0][0],T[1][0],T[2][0])-R<this.sourceWorldWidth_/2&&(v.source=T)}})}l={}}addTriangle_(t,e,n,s,r,a){this.triangles_.push({source:[s,r,a],target:[t,e,n]})}addQuad_(t,e,n,s,r,a,o,l,h){const c=Es([r,a,o,l]),u=this.sourceWorldWidth_?ot(c)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,_=this.sourceProj_.canWrapX()&&u>.5&&u<1;let g=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const y=Es([t,e,n,s]);g=ot(y)/this.targetWorldWidth_>$f||g}!_&&this.sourceProj_.isGlobal()&&u&&(g=u>$f||g)}if(!g&&this.maxSourceExtent_&&isFinite(c[0])&&isFinite(c[1])&&isFinite(c[2])&&isFinite(c[3])&&!Pt(c,this.maxSourceExtent_))return;let x=0;if(!g&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)g=!0;else if(x=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(a[0])||!isFinite(a[1])?4:0)+(!isFinite(o[0])||!isFinite(o[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),x!=1&&x!=2&&x!=4&&x!=8)return}if(h>0){if(!g){const y=[(t[0]+n[0])/2,(t[1]+n[1])/2],w=this.transformInv_(y);let d;_?d=(mn(r[0],f)+mn(o[0],f))/2-mn(w[0],f):d=(r[0]+o[0])/2-w[0];const p=(r[1]+o[1])/2-w[1];g=d*d+p*p>this.errorThresholdSquared_}if(g){if(Math.abs(t[0]-n[0])<=Math.abs(t[1]-n[1])){const y=[(e[0]+n[0])/2,(e[1]+n[1])/2],w=this.transformInv_(y),d=[(s[0]+t[0])/2,(s[1]+t[1])/2],p=this.transformInv_(d);this.addQuad_(t,e,y,d,r,a,w,p,h-1),this.addQuad_(d,y,n,s,p,w,o,l,h-1)}else{const y=[(t[0]+e[0])/2,(t[1]+e[1])/2],w=this.transformInv_(y),d=[(n[0]+s[0])/2,(n[1]+s[1])/2],p=this.transformInv_(d);this.addQuad_(t,y,d,s,r,w,p,l,h-1),this.addQuad_(y,e,n,d,w,a,o,p,h-1)}return}}if(_){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(x&11)==0&&this.addTriangle_(t,n,s,r,o,l),(x&14)==0&&this.addTriangle_(t,n,e,r,o,a),x&&((x&13)==0&&this.addTriangle_(e,s,t,a,l,r),(x&7)==0&&this.addTriangle_(e,s,n,a,l,o))}calculateSourceExtent(){const t=xe();return this.triangles_.forEach(function(e,n,s){const r=e.source;fr(t,r[0]),fr(t,r[1]),fr(t,r[2])}),t}getTriangles(){return this.triangles_}}const Hc=.5;class Yc extends ra{constructor(t,e,n,s,r,a,o,l,h,c,u,f){super(r,z.IDLE,f),this.renderEdges_=u!==void 0?u:!1,this.pixelRatio_=o,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=s,this.wrappedTileCoord_=a||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=t.canWrapX()?t.getExtent():void 0;const _=s.getTileCoordExtent(this.wrappedTileCoord_),g=this.targetTileGrid_.getExtent();let x=this.sourceTileGrid_.getExtent();const y=g?Xt(_,g):_;if(Mr(y)===0){this.state=z.EMPTY;return}const w=t.getExtent();w&&(x?x=Xt(x,w):x=w);const d=s.getResolution(this.wrappedTileCoord_[0]),p=E0(t,n,y,d);if(!isFinite(p)||p<=0){this.state=z.EMPTY;return}const v=c!==void 0?c:Hc;if(this.triangulation_=new Kc(t,n,y,x,p*v,d),this.triangulation_.getTriangles().length===0){this.state=z.EMPTY;return}this.sourceZ_=e.getZForResolution(p);let T=this.triangulation_.calculateSourceExtent();if(x&&(t.canWrapX()?(T[1]=wt(T[1],x[1],x[3]),T[3]=wt(T[3],x[1],x[3])):T=Xt(T,x)),!Mr(T))this.state=z.EMPTY;else{let R=0,C=0;t.canWrapX()&&(R=ot(w),C=Math.floor((T[0]-w[0])/R)),ac(T.slice(),t,!0).forEach(I=>{const P=e.getTileRangeForExtentAndZ(I,this.sourceZ_);for(let G=P.minX;G<=P.maxX;G++)for(let O=P.minY;O<=P.maxY;O++){const m=h(this.sourceZ_,G,O,o);if(m){const E=C*R;this.sourceTiles_.push({tile:m,offset:E})}}++C}),this.sourceTiles_.length===0&&(this.state=z.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach(e=>{const n=e.tile;if(n&&n.getState()==z.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(n.tileCoord);s[0]+=e.offset,s[2]+=e.offset;const r=this.clipExtent_?.slice();r&&(r[0]+=e.offset,r[2]+=e.offset),t.push({extent:s,clipExtent:r,image:n.getImage()})}}),this.sourceTiles_.length=0,t.length===0)this.state=z.ERROR;else{const e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),s=typeof n=="number"?n:n[0],r=typeof n=="number"?n:n[1],a=this.targetTileGrid_.getResolution(e),o=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=v0(s,r,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=z.LOADED}this.changed()}load(){if(this.state==z.IDLE){this.state=z.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const n=e.getState();if(n==z.IDLE||n==z.LOADING){t++;const s=ct(e,Y.CHANGE,r=>{const a=e.getState();(a==z.LOADED||a==z.ERROR||a==z.EMPTY)&&(vt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e},n,s){e.getState()==z.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(vt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Qr(this.canvas_.getContext("2d")),gs.push(this.canvas_),this.canvas_=null),super.release()}}class $x extends Ls{constructor(t){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=t.gutter||0,this.helper=t.helper,this.loaded=!1,this.ready=!1}setTile(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(Y.CHANGE,this.handleTileChange_),this.tile=t,this.loaded=t.getState()===z.LOADED,this.loaded)this.uploadTile();else{if(t instanceof tl){const e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(Y.CHANGE,this.handleTileChange_)}}uploadTile(){tt()}setReady(){this.ready=!0,this.dispatchEvent(Y.CHANGE)}handleTileChange_(){this.tile.getState()===z.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(t){this.helper=t,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(Y.CHANGE,this.handleTileChange_)}}function w0(i,t,e){const n=e?i.LINEAR:i.NEAREST;i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,n)}function Wx(i,t,e,n){w0(i,t,n),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e)}function Wf(i,t,e,n,s,r){const a=i.getGL();let o,l;e instanceof Float32Array?(o=a.FLOAT,i.getExtension("OES_texture_float"),l=i.getExtension("OES_texture_float_linear")!==null):(o=a.UNSIGNED_BYTE,l=!0),w0(a,t,r&&l);const h=e.byteLength/n[1];let c=1;h%8===0?c=8:h%4===0?c=4:h%2===0&&(c=2);let u;switch(s){case 1:{u=a.LUMINANCE;break}case 2:{u=a.LUMINANCE_ALPHA;break}case 3:{u=a.RGB;break}case 4:{u=a.RGBA;break}default:throw new Error(`Unsupported number of bands: ${s}`)}const f=a.getParameter(a.UNPACK_ALIGNMENT);a.pixelStorei(a.UNPACK_ALIGNMENT,c),a.texImage2D(a.TEXTURE_2D,0,u,n[0],n[1],0,u,o,e),a.pixelStorei(a.UNPACK_ALIGNMENT,f)}let Hn=null;function qx(){Hn=Ot(1,1,void 0,{willReadFrequently:!0})}class Kx extends $x{constructor(t){super(t),this.textures=[],this.renderSize_=Lt(t.grid.getTileSize(t.tile.tileCoord[0])),this.bandCount=NaN;const e=new y0($c,qc);e.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(e),this.coords=e,this.setTile(t.tile)}setHelper(t){const e=this.helper?.getGL();if(e){this.helper.deleteBuffer(this.coords);for(let n=0;n<this.textures.length;++n)e.deleteTexture(this.textures[n])}super.setHelper(t),t&&t.flushBufferData(this.coords)}uploadTile(){const t=this.helper,e=t.getGL(),n=this.tile;this.textures.length=0;let s;n instanceof tl||n instanceof Yc?s=n.getImage():s=n.getData();const r=Ms(s);if(r){const d=e.createTexture();this.textures.push(d),this.bandCount=4,Wx(e,d,r,n.interpolate),this.setReady();return}s=Th(s);const a=n.getSize(),o=[a[0]+2*this.gutter,a[1]+2*this.gutter],l=s instanceof Float32Array,h=o[0]*o[1],c=l?Float32Array:Uint8Array,u=c.BYTES_PER_ELEMENT,f=s.byteLength/o[1];this.bandCount=Math.floor(f/u/o[0]);const _=Math.ceil(this.bandCount/4);if(_===1){const d=e.createTexture();this.textures.push(d),Wf(t,d,s,o,this.bandCount,n.interpolate),this.setReady();return}const g=new Array(_);for(let d=0;d<_;++d){const p=e.createTexture();this.textures.push(p);const v=d<_-1?4:(this.bandCount-1)%4+1;g[d]=new c(h*v)}let x=0,y=0;const w=o[0]*this.bandCount;for(let d=0;d<o[1];++d){for(let p=0;p<w;++p){const v=s[y+p],T=Math.floor(x/this.bandCount),R=p%this.bandCount,C=Math.floor(R/4),b=g[C],I=b.length/h,P=R%4;b[T*I+P]=v,++x}y+=f/u}for(let d=0;d<_;++d){const p=this.textures[d],v=g[d],T=v.length/h;Wf(t,p,v,o,T,n.interpolate)}this.setReady()}getImagePixelData_(t,e,n){const s=this.gutter,r=this.renderSize_[0],a=this.renderSize_[1];Hn||qx(),Hn.clearRect(0,0,1,1);const o=t.width,l=t.height,h=o-2*s,c=l-2*s,u=s+Math.floor(h*(e/r)),f=s+Math.floor(c*(n/a));let _;try{Hn.drawImage(t,u,f,1,1,0,0,1,1),_=Hn.getImageData(0,0,1,1).data}catch{return Hn=null,null}return _}getArrayPixelData_(t,e,n,s){const r=this.gutter,a=this.renderSize_[0],o=this.renderSize_[1],l=e[0],h=e[1],c=l+2*r,u=h+2*r,f=r+Math.floor(l*(n/a)),_=r+Math.floor(h*(s/o));if(t instanceof DataView){const x=t.byteLength/(c*u),y=x*(_*c+f),w=t.buffer.slice(y,y+x);return new DataView(w)}const g=this.bandCount*(_*c+f);return t.slice(g,g+this.bandCount)}getPixelData(t,e){if(!this.loaded)return null;if(this.tile instanceof Gr){const n=this.tile.getData(),s=Th(n);if(s){const r=this.tile.getSize();return this.getArrayPixelData_(s,r,t,e)}return this.getImagePixelData_(Ms(n),t,e)}return this.getImagePixelData_(this.tile.getImage(),t,e)}}class el{constructor(t,e,n,s){this.minX=t,this.maxX=e,this.minY=n,this.maxY=s}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Bn(i,t,e,n,s){return s!==void 0?(s.minX=i,s.maxX=t,s.minY=e,s.maxY=n,s):new el(i,t,e,n)}class T0{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}deleteOldest(){const t=this.pop();t instanceof Wr&&t.dispose()}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.deleteOldest()}clear(){for(;this.oldest_;)this.deleteOldest()}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const n=this.entries_[t];return ft(n!==void 0,"Tried to get a value for a key that does not exist in the cache"),n===this.newest_||(n===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(n.newer.older=n.older,n.older.newer=n.newer),n.newer=null,n.older=this.newest_,this.newest_.newer=n,this.newest_=n),n.value_}remove(t){const e=this.entries_[t];return ft(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.key_;return t}getValues(){const t=new Array(this.count_);let e=0,n;for(n=this.newest_;n;n=n.older)t[e++]=n.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){ft(!(t in this.entries_),"Tried to set a value for a key that is used already");const n={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=n:this.oldest_=n,this.newest_=n,this.entries_[t]=n,++this.count_}setSize(t){this.highWaterMark=t}}function Cs(i,t,e,n){return n!==void 0?(n[0]=i,n[1]=t,n[2]=e,n):[i,t,e]}function S0(i,t,e){return i+"/"+t+"/"+e}function Yn(i){return S0(i[0],i[1],i[2])}function R0(i){return Hx(i[0],i[1],i[2])}function Hx(i,t,e){return(t<<i)+e}function Yx(i,t){const e=i[0],n=i[1],s=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const r=t.getFullTileRange(e);return r?r.containsXY(n,s):!0}const Zx=5;class M0 extends qr{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.staleKeys_=new Array,this.maxStaleKeys=Zx}getStaleKeys(){return this.staleKeys_}prependStaleKey(t){this.staleKeys_.unshift(t),this.staleKeys_.length>this.maxStaleKeys&&(this.staleKeys_.length=this.maxStaleKeys)}getFeatures(t){return tt()}getData(t){return null}prepareFrame(t){return tt()}renderFrame(t,e){return tt()}forEachFeatureAtCoordinate(t,e,n,s,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){const e=t.target;(e.getState()===K.LOADED||e.getState()===K.ERROR)&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=K.LOADED&&e!=K.ERROR&&t.addEventListener(Y.CHANGE,this.boundHandleImageChange_),e==K.IDLE&&(t.load(),e=t.getState()),e==K.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}renderDeferred(t){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class Zc extends M0{constructor(t,e){super(t),e=e||{},this.inversePixelTransform_=Zt(),this.postProcesses_=e.postProcesses,this.uniforms_=e.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},t.addChangeListener(_t.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(Wt.PRECOMPOSE)){const s=new _r(Wt.PRECOMPOSE,void 0,e,t);n.dispatchEvent(s)}}dispatchPostComposeEvent(t,e){const n=this.getLayer();if(n.hasListener(Wt.POSTCOMPOSE)){const s=new _r(Wt.POSTCOMPOSE,void 0,e,t);n.dispatchEvent(s)}}reset(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(t){if(this.getLayer().getRenderSource()){let e=!0,n=-1,s;for(let a=0,o=t.layerStatesArray.length;a<o;a++){const l=t.layerStatesArray[a].layer,h=l.getRenderer();if(!(h instanceof Zc)){e=!0;continue}const c=l.getClassName();if((e||c!==s)&&(n+=1,e=!1),s=c,h===this)break}const r="map/"+t.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(r)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new Nx({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:r}),s&&(this.helper.getCanvas().className=s),this.afterHelperCreated())}return this.prepareFrameInternal(t)}afterHelperCreated(){}prepareFrameInternal(t){return!0}clearCache(){}disposeInternal(){this.clearCache(),this.removeHelper(),this.getLayer()?.removeChangeListener(_t.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(t,e,n){const s=this.getLayer();if(s.hasListener(t)){Ne(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const r=new _r(t,this.inversePixelTransform_,n,e);s.dispatchEvent(r)}}preRender(t,e){this.dispatchRenderEvent_(Wt.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(Wt.POSTRENDER,t,e)}}const Qx={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function qf(i){return 1/(i+2)}function Jx(){return{tileIds:new Set,representationsByZ:{}}}function Kf(i,t){return i.tileIds.has(Z(t))}function Hf(i,t,e){const n=i.representationsByZ;e in n||(n[e]=new Set),n[e].add(t),i.tileIds.add(Z(t.tile))}function Gl(i,t){const e=i.layerStatesArray[i.layerIndex];e.extent&&(t=Xt(t,Oe(e.extent,i.viewState.projection)));const n=e.layer.getRenderSource();if(!n.getWrapX()){const s=n.getTileGridForProjection(i.viewState.projection).getExtent();s&&(t=Xt(t,s))}return t}function Sh(i,t){return`${Z(i)},${i.getKey()},${i.getRevision()},${Yn(t)}`}class tE extends Zc{constructor(t,e){super(t,{uniforms:e.uniforms,postProcesses:e.postProcesses}),this.renderComplete=!1,this.tileTransform_=Zt(),this.tempMat4=Ds(),this.tempTileRange_=new el(0,0,0,0),this.tempTileCoord_=Cs(0,0,0),this.tempSize_=[0,0];const n=e.cacheSize!==void 0?e.cacheSize:512;this.tileRepresentationCache=new T0(n),this.frameState=null,this.renderedProjection_=void 0}reset(t){super.reset({uniforms:t.uniforms})}prepareFrameInternal(t){this.renderedProjection_?t.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=t.viewState.projection):this.renderedProjection_=t.viewState.projection;const n=this.getLayer().getRenderSource();return!n||Ri(Gl(t,t.extent))?!1:n.getState()==="ready"}createTileRepresentation(t){return tt()}enqueueTiles(t,e,n,s,r){const a=t.viewState,o=this.getLayer(),l=o.getRenderSource(),h=l.getTileGridForProjection(a.projection),c=l.getGutterForProjection(a.projection),u=Z(l);u in t.wantedTiles||(t.wantedTiles[u]={});const f=t.wantedTiles[u],_=this.tileRepresentationCache,g=o.getMapInternal(),x=Math.max(n-r,h.getMinZoom(),h.getZForResolution(Math.min(o.getMaxResolution(),g?g.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):h.getResolution(0)),l.zDirection)),y=a.rotation,w=y?sc(a.center,a.resolution,y,t.size):void 0;for(let d=n;d>=x;--d){const p=h.getTileRangeForExtentAndZ(e,d,this.tempTileRange_),v=h.getResolution(d);for(let T=p.minX;T<=p.maxX;++T)for(let R=p.minY;R<=p.maxY;++R){if(y&&!h.tileCoordIntersectsViewport([d,T,R],w))continue;const C=Cs(d,T,R,this.tempTileCoord_),b=Sh(l,C);let I,P;if(_.containsKey(b)&&(I=_.get(b),P=I.tile),(!I||I.tile.key!==l.getKey())&&(P=l.getTile(d,T,R,t.pixelRatio,a.projection),!P)||Kf(s,P))continue;I?I.setTile(P):(I=this.createTileRepresentation({tile:P,grid:h,helper:this.helper,gutter:c}),_.set(b,I)),Hf(s,I,d);const G=P.getKey();f[G]=!0,P.getState()===z.IDLE&&(t.tileQueue.isKeyQueued(G)||t.tileQueue.enqueue([P,u,h.getTileCoordCenter(C),v]))}}}beforeTilesRender(t,e){this.helper.prepareDraw(this.frameState,!e,!0)}beforeTilesMaskRender(t){return!1}renderTile(t,e,n,s,r,a,o,l,h,c,u){}renderTileMask(t,e,n,s){}drawTile_(t,e,n,s,r,a,o){if(!e.ready)return;const h=e.tile.tileCoord,c=Yn(h),u=c in a?a[c]:1,f=o.getResolution(n),_=Lt(o.getTileSize(n),this.tempSize_),g=o.getOrigin(n),x=o.getTileCoordExtent(h),y=u<1?-1:qf(n);u<1&&(t.animate=!0);const w=t.viewState,d=w.center[0],p=w.center[1],v=_[0]+2*s,T=_[1]+2*s,R=v/T,C=(d-g[0])/(_[0]*f),b=(g[1]-p)/(_[1]*f),I=w.resolution/f,P=h[1],G=h[2];dh(this.tileTransform_),dr(this.tileTransform_,2/(t.size[0]*I/v),-2/(t.size[1]*I/v)),i1(this.tileTransform_,w.rotation),dr(this.tileTransform_,1,1/R),Ag(this.tileTransform_,(_[0]*(P-C)-s)/v,(_[1]*(G-b)-s)/T),this.renderTile(e,this.tileTransform_,t,r,f,_,g,x,y,s,u)}renderFrame(t){this.frameState=t,this.renderComplete=!0;const e=this.helper.getGL();this.preRender(e,t);const n=t.viewState,s=this.getLayer(),r=s.getRenderSource(),a=r.getTileGridForProjection(n.projection),o=r.getGutterForProjection(n.projection),l=Gl(t,t.extent),h=a.getZForResolution(n.resolution,r.zDirection),c=Jx(),u=s.getPreload();if(t.nextExtent){const p=a.getZForResolution(n.nextResolution,r.zDirection),v=Gl(t,t.nextExtent);this.enqueueTiles(t,v,p,c,u)}this.enqueueTiles(t,l,h,c,0),u>0&&setTimeout(()=>{this.enqueueTiles(t,l,h-1,c,u-1)},0);const f={};let _=!1;const g=c.representationsByZ;if(h in g){const p=Z(this),v=t.time;for(const T of g[h]){const R=T.tile;if(R.getState()===z.EMPTY)continue;const C=R.tileCoord;if(T.ready){const P=R.getAlpha(p,v);if(P===1){R.endTransition(p);continue}_=!0;const G=Yn(C);f[G]=P}if(this.renderComplete=!1,this.findAltTiles_(a,C,h+1,c))continue;const I=a.getMinZoom();for(let P=h-1;P>=I&&!this.findAltTiles_(a,C,P,c);--P);}}const x=Object.keys(g).map(Number).sort(ug);if(this.beforeTilesMaskRender(t))for(let p=0,v=x.length;p<v;++p){const T=x[p];for(const R of g[T]){const C=R.tile.tileCoord;if(Yn(C)in f)continue;const I=a.getTileCoordExtent(C);this.renderTileMask(R,T,I,qf(T))}}this.beforeTilesRender(t,_);for(let p=0,v=x.length;p<v;++p){const T=x[p];for(const R of g[T]){const C=R.tile.tileCoord;Yn(C)in f||this.drawTile_(t,R,T,o,l,f,a)}}if(h in g)for(const p of g[h]){const v=p.tile.tileCoord;Yn(v)in f&&this.drawTile_(t,p,h,o,l,f,a)}this.beforeFinalize(t),this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const w=this.helper.getCanvas(),d=this.tileRepresentationCache;for(;d.canExpireCache();)d.pop().dispose();return this.postRender(e,t),w}beforeFinalize(t){}findAltTiles_(t,e,n,s){const r=t.getTileRangeForTileCoordAndZ(e,n,this.tempTileRange_);if(!r)return!1;let a=!0;const o=this.tileRepresentationCache,l=this.getLayer().getRenderSource();for(let h=r.minX;h<=r.maxX;++h)for(let c=r.minY;c<=r.maxY;++c){const u=Sh(l,[n,h,c]);let f=!1;if(o.containsKey(u)){const _=o.get(u);_.ready&&!Kf(s,_.tile)&&(Hf(s,_,n),f=!0)}f||(a=!1)}return a}clearCache(){super.clearCache();const t=this.tileRepresentationCache;t.forEach(e=>e.dispose()),t.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(t=>t.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}const nt={...Qx,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},qa={TEXTURE_COORD:"a_textureCoord"},eE=[{name:qa.TEXTURE_COORD,size:2,type:rr.FLOAT}];class iE extends tE{constructor(t,e){super(t,e),this.program_,this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.indices_=new y0(Wc,qc),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=e.paletteTextures||[]}reset(t){if(super.reset(t),this.helper){const e=this.helper.getGL();for(const n of this.paletteTextures_)n.delete(e)}if(this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const e=this.helper.getGL();for(const n of this.paletteTextures_)n.getTexture(e)}}afterHelperCreated(){super.afterHelperCreated();const t=this.helper.getGL();for(const e of this.paletteTextures_)e.getTexture(t);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const t=this.helper.getGL();for(const e of this.paletteTextures_)e.delete(t)}super.removeHelper()}createTileRepresentation(t){return new Kx(t)}beforeTilesRender(t,e){super.beforeTilesRender(t,e),this.helper.useProgram(this.program_,t)}renderTile(t,e,n,s,r,a,o,l,h,c,u){const f=this.helper.getGL();this.helper.bindBuffer(t.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(eE);let _=0;for(;_<t.textures.length;){const R=`${nt.TILE_TEXTURE_ARRAY}[${_}]`;this.helper.bindTexture(t.textures[_],_,R),++_}for(let R=0;R<this.paletteTextures_.length;++R){const C=this.paletteTextures_[R],b=C.getTexture(f);this.helper.bindTexture(b,_,C.name),++_}const g=n.viewState,x=a[0]+2*c,y=a[1]+2*c,d=t.tile.tileCoord,p=d[1],v=d[2];this.helper.setUniformMatrixValue(nt.TILE_TRANSFORM,m0(this.tempMat4,e)),this.helper.setUniformFloatValue(nt.TRANSITION_ALPHA,u),this.helper.setUniformFloatValue(nt.DEPTH,h);let T=s;c>0&&(T=l,Xt(T,s,T)),this.helper.setUniformFloatVec4(nt.RENDER_EXTENT,T),this.helper.setUniformFloatValue(nt.RESOLUTION,g.resolution),this.helper.setUniformFloatValue(nt.ZOOM,g.zoom),this.helper.setUniformFloatValue(nt.TEXTURE_PIXEL_WIDTH,x),this.helper.setUniformFloatValue(nt.TEXTURE_PIXEL_HEIGHT,y),this.helper.setUniformFloatValue(nt.TEXTURE_RESOLUTION,r),this.helper.setUniformFloatValue(nt.TEXTURE_ORIGIN_X,o[0]+p*a[0]*r-c*r),this.helper.setUniformFloatValue(nt.TEXTURE_ORIGIN_Y,o[1]-v*a[1]*r+c*r),this.helper.drawElements(0,this.indices_.getSize())}getData(t){if(!this.helper.getGL())return null;const n=this.frameState;if(!n)return null;const s=this.getLayer(),r=kt(n.pixelToCoordinateTransform,t.slice()),a=n.viewState,o=s.getExtent();if(o&&!wi(Oe(o,a.projection),r))return null;const l=s.getSources(Es([r]),a.resolution);let h,c,u;for(h=l.length-1;h>=0;--h)if(c=l[h],c.getState()==="ready"){if(u=c.getTileGridForProjection(a.projection),c.getWrapX())break;const _=u.getExtent();if(!_||wi(_,r))break}if(h<0)return null;const f=this.tileRepresentationCache;for(let _=u.getZForResolution(a.resolution);_>=u.getMinZoom();--_){const g=u.getTileCoordForCoordAndZ(r,_),x=Sh(c,g);if(!f.containsKey(x))continue;const y=f.get(x);if(y.tile.getState()===z.EMPTY)return null;if(!y.loaded)continue;const d=u.getOrigin(_),p=Lt(u.getTileSize(_)),v=u.getResolution(_),T=(r[0]-d[0])/v-g[1]*p[0],R=(d[1]-r[1])/v-g[2]*p[1];return y.getPixelData(T,R)}return null}disposeInternal(){const t=this.helper;if(t){const e=t.getGL();for(const n of this.paletteTextures_)n.delete(e);this.paletteTextures_.length=0,e.deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}class nE{constructor(t,e){this.name=t,this.data=e,this.texture_=null}getTexture(t){if(!this.texture_){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_}delete(t){this.texture_&&t.deleteTexture(this.texture_),this.texture_=null}}function sE(i,t){return`operator_${i}_${Object.keys(t.functions).length}`}function Nr(i){const t=i.toString();return t.includes(".")?t:t+".0"}function Qc(i){if(i.length<2||i.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${i.length}(${i.map(Nr).join(", ")})`}function rE(i){const t=Ki(i),e=t.length>3?t[3]:1;return Qc([t[0]/255,t[1]/255,t[2]/255,e])}function aE(i){const t=Lt(i);return Qc(t)}const Nl={};let oE=0;function C0(i){return i in Nl||(Nl[i]=oE++),Nl[i]}function lE(i){return Nr(C0(i))}function b0(i){return"u_var_"+i}function hE(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const kl="getBandValue",I0="u_paletteTextures",cE="featureId",uE="geometryType",fE=-9999999;function dE(i,t,e,n){const s=Kt(i,t,e);return Jc(s,t,n)}function gt(i){return(t,e,n)=>{const s=e.args.length,r=new Array(s);for(let a=0;a<s;++a)r[a]=Jc(e.args[a],n,t);return i(r,t)}}const gE={[N.Get]:(i,t)=>{const n=t.args[0].value;return n in i.properties||(i.properties[n]={name:n,type:t.type}),"a_prop_"+n},[N.Id]:i=>(i.featureId=!0,"a_"+cE),[N.GeometryType]:i=>(i.geometryType=!0,"a_"+uE),[N.LineMetric]:()=>"currentLineMetric",[N.Var]:(i,t)=>{const n=t.args[0].value;return n in i.variables||(i.variables[n]={name:n,type:t.type}),b0(n)},[N.Has]:(i,t)=>{const n=t.args[0].value;return n in i.properties||(i.properties[n]={name:n,type:t.type}),`(a_prop_${n} != ${Nr(fE)})`},[N.Resolution]:()=>"u_resolution",[N.Zoom]:()=>"u_zoom",[N.Time]:()=>"u_time",[N.Any]:gt(i=>`(${i.join(" || ")})`),[N.All]:gt(i=>`(${i.join(" && ")})`),[N.Not]:gt(([i])=>`(!${i})`),[N.Equal]:gt(([i,t])=>`(${i} == ${t})`),[N.NotEqual]:gt(([i,t])=>`(${i} != ${t})`),[N.GreaterThan]:gt(([i,t])=>`(${i} > ${t})`),[N.GreaterThanOrEqualTo]:gt(([i,t])=>`(${i} >= ${t})`),[N.LessThan]:gt(([i,t])=>`(${i} < ${t})`),[N.LessThanOrEqualTo]:gt(([i,t])=>`(${i} <= ${t})`),[N.Multiply]:gt(i=>`(${i.join(" * ")})`),[N.Divide]:gt(([i,t])=>`(${i} / ${t})`),[N.Add]:gt(i=>`(${i.join(" + ")})`),[N.Subtract]:gt(([i,t])=>`(${i} - ${t})`),[N.Clamp]:gt(([i,t,e])=>`clamp(${i}, ${t}, ${e})`),[N.Mod]:gt(([i,t])=>`mod(${i}, ${t})`),[N.Pow]:gt(([i,t])=>`pow(${i}, ${t})`),[N.Abs]:gt(([i])=>`abs(${i})`),[N.Floor]:gt(([i])=>`floor(${i})`),[N.Ceil]:gt(([i])=>`ceil(${i})`),[N.Round]:gt(([i])=>`floor(${i} + 0.5)`),[N.Sin]:gt(([i])=>`sin(${i})`),[N.Cos]:gt(([i])=>`cos(${i})`),[N.Atan]:gt(([i,t])=>t!==void 0?`atan(${i}, ${t})`:`atan(${i})`),[N.Sqrt]:gt(([i])=>`sqrt(${i})`),[N.Match]:gt(i=>{const t=i[0],e=i[i.length-1];let n=null;for(let s=i.length-3;s>=1;s-=2){const r=i[s],a=i[s+1];n=`(${t} == ${r} ? ${a} : ${n||e})`}return n}),[N.Between]:gt(([i,t,e])=>`(${i} >= ${t} && ${i} <= ${e})`),[N.Interpolate]:gt(([i,t,...e])=>{let n="";for(let s=0;s<e.length-2;s+=2){const r=e[s],a=n||e[s+1],o=e[s+2],l=e[s+3];let h;i===Nr(1)?h=`(${t} - ${r}) / (${o} - ${r})`:h=`(pow(${i}, (${t} - ${r})) - 1.0) / (pow(${i}, (${o} - ${r})) - 1.0)`,n=`mix(${a}, ${l}, clamp(${h}, 0.0, 1.0))`}return n}),[N.Case]:gt(i=>{const t=i[i.length-1];let e=null;for(let n=i.length-3;n>=0;n-=2){const s=i[n],r=i[n+1];e=`(${s} ? ${r} : ${e||t})`}return e}),[N.In]:gt(([i,...t],e)=>{const n=sE("in",e),s=[];for(let r=0;r<t.length;r+=1)s.push(`  if (inputValue == ${t[r]}) { return true; }`);return e.functions[n]=`bool ${n}(float inputValue) {
${s.join(`
`)}
  return false;
}`,`${n}(${i})`}),[N.Array]:gt(i=>`vec${i.length}(${i.join(", ")})`),[N.Color]:gt(i=>{if(i.length===1)return`vec4(vec3(${i[0]} / 255.0), 1.0)`;if(i.length===2)return`vec4(vec3(${i[0]} / 255.0), ${i[1]})`;const t=i.slice(0,3).map(n=>`${n} / 255.0`);if(i.length===3)return`vec4(${t.join(", ")}, 1.0)`;const e=i[3];return`vec4(${t.join(", ")}, ${e})`}),[N.Band]:gt(([i,t,e],n)=>{if(!(kl in n.functions)){let s="";const r=n.bandCount||1;for(let a=0;a<r;a++){const o=Math.floor(a/4);let l=a%4;a===r-1&&l===1&&(l=3);const h=`${nt.TILE_TEXTURE_ARRAY}[${o}]`;s+=`  if (band == ${a+1}.0) {
    return texture2D(${h}, v_textureCoord + vec2(dx, dy))[${l}];
  }
`}n.functions[kl]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${nt.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${nt.TEXTURE_PIXEL_HEIGHT};
${s}
}`}return`${kl}(${i}, ${t??"0.0"}, ${e??"0.0"})`}),[N.Palette]:(i,t)=>{const[e,...n]=t.args,s=n.length,r=new Uint8Array(s*4);for(let h=0;h<n.length;h++){const c=n[h].value,u=Ki(c),f=h*4;r[f]=u[0],r[f+1]=u[1],r[f+2]=u[2],r[f+3]=u[3]*255}i.paletteTextures||(i.paletteTextures=[]);const a=`${I0}[${i.paletteTextures.length}]`,o=new nE(a,r);i.paletteTextures.push(o);const l=Jc(e,st,i);return`texture2D(${a}, vec2((${l} + 0.5) / ${s}.0, 0.5))`}};function Jc(i,t,e){if(i instanceof t0){const n=gE[i.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(i.operator)}`);return n(e,i,t)}if((i.type&st)>0)return Nr(i.value);if((i.type&ne)>0)return i.value.toString();if((i.type&oe)>0)return lE(i.value.toString());if((i.type&Se)>0)return rE(i.value);if((i.type&Hi)>0)return Qc(i.value);if((i.type&is)>0)return aE(i.value);throw new Error(`Unexpected expression ${i.value} (expected type ${ns(t)})`)}function zn(i,t,e){const n=Uc();return dE(t,e,n,i)}const Ui={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class A0 extends ea{constructor(t){t=t||{};const e=Object.assign({},t),n=t.cacheSize;delete t.cacheSize,delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=n,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getCacheSize(){return this.cacheSize_}getPreload(){return this.get(Ui.PRELOAD)}setPreload(t){this.set(Ui.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(Ui.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(Ui.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}function Yf(i,t){const e=`
    attribute vec2 ${qa.TEXTURE_COORD};
    uniform mat4 ${nt.TILE_TRANSFORM};
    uniform float ${nt.TEXTURE_PIXEL_WIDTH};
    uniform float ${nt.TEXTURE_PIXEL_HEIGHT};
    uniform float ${nt.TEXTURE_RESOLUTION};
    uniform float ${nt.TEXTURE_ORIGIN_X};
    uniform float ${nt.TEXTURE_ORIGIN_Y};
    uniform float ${nt.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${qa.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${nt.TEXTURE_ORIGIN_X} + ${nt.TEXTURE_RESOLUTION} * ${nt.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${nt.TEXTURE_ORIGIN_Y} - ${nt.TEXTURE_RESOLUTION} * ${nt.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${nt.TILE_TRANSFORM} * vec4(${qa.TEXTURE_COORD}, ${nt.DEPTH}, 1.0);
    }
  `,n={...hE(),bandCount:t},s=[];if(i.color!==void 0){const u=zn(n,i.color,Se);s.push(`color = ${u};`)}if(i.contrast!==void 0){const u=zn(n,i.contrast,st);s.push(`color.rgb = clamp((${u} + 1.0) * color.rgb - (${u} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.exposure!==void 0){const u=zn(n,i.exposure,st);s.push(`color.rgb = clamp((${u} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(i.saturation!==void 0){const u=zn(n,i.saturation,st);s.push(`
      float saturation = ${u} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(i.gamma!==void 0){const u=zn(n,i.gamma,st);s.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${u}));`)}if(i.brightness!==void 0){const u=zn(n,i.brightness,st);s.push(`color.rgb = clamp(color.rgb + ${u}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const r={},a=Object.keys(n.variables).length;if(a>1&&!i.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let u=0;u<a;++u){const f=n.variables[Object.keys(n.variables)[u]];if(!(f.name in i.variables))throw new Error(`Missing '${f.name}' in style variables`);const _=b0(f.name);r[_]=function(){let g=i.variables[f.name];return typeof g=="string"&&(g=C0(g)),g!==void 0?g:-9999999}}const o=Object.keys(r).map(function(u){return`uniform float ${u};`}),l=Math.ceil(t/4);o.push(`uniform sampler2D ${nt.TILE_TEXTURE_ARRAY}[${l}];`),n.paletteTextures&&o.push(`uniform sampler2D ${I0}[${n.paletteTextures.length}];`);const h=Object.keys(n.functions).map(function(u){return n.functions[u]}),c=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${nt.RENDER_EXTENT};
    uniform float ${nt.TRANSITION_ALPHA};
    uniform float ${nt.TEXTURE_PIXEL_WIDTH};
    uniform float ${nt.TEXTURE_PIXEL_HEIGHT};
    uniform float ${nt.RESOLUTION};
    uniform float ${nt.ZOOM};

    ${o.join(`
`)}

    ${h.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${nt.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${nt.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${nt.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${nt.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${nt.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${s.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${nt.TRANSITION_ALPHA};
    }`;return{vertexShader:e,fragmentShader:c,uniforms:r,paletteTextures:n.paletteTextures}}class Eo extends A0{constructor(t){t=t?Object.assign({},t):{};const e=t.style||{};delete t.style,super(t),this.sources_=t.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=e,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(_t.SOURCE,this.handleSourceUpdate_)}getSources(t,e){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(t,e):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const t=this.getRenderSource();return t?t.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const t=this.getSource();if(t)if(t.getState()==="loading"){const e=()=>{t.getState()==="ready"&&(t.removeEventListener("change",e),this.setStyle(this.style_))};t.addEventListener("change",e)}else this.setStyle(this.style_)}getSourceBandCount_(){const t=Number.MAX_SAFE_INTEGER,e=this.getSources([-t,-t,t,t],t);return e&&e.length&&"bandCount"in e[0]?e[0].bandCount:4}createRenderer(){const t=Yf(this.style_,this.getSourceBandCount_());return new iE(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.getCacheSize(),paletteTextures:t.paletteTextures})}renderSources(t,e){const n=this.getRenderer();let s;for(let r=0,a=e.length;r<a;++r)this.renderedSource_=e[r],n.prepareFrame(t)&&(s=n.renderFrame(t));return s}render(t,e){this.rendered=!0;const n=t.viewState,s=this.getSources(t.extent,n.resolution);let r=!0;for(let o=0,l=s.length;o<l;++o){const h=s[o],c=h.getState();if(c=="loading"){const u=()=>{h.getState()=="ready"&&(h.removeEventListener("change",u),this.changed())};h.addEventListener("change",u)}r=r&&c=="ready"}const a=this.renderSources(t,s);if(this.getRenderer().renderComplete&&r)return this.renderedResolution_=n.resolution,a;if(this.renderedResolution_>.5*n.resolution){const o=this.getSources(t.extent,this.renderedResolution_).filter(l=>!s.includes(l));if(o.length>0)return this.renderSources(t,o)}return a}setStyle(t){if(this.styleVariables_=t.variables||{},this.style_=t,this.hasRenderer()){const e=Yf(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()}}updateStyleVariables(t){Object.assign(this.styleVariables_,t),this.changed()}}Eo.prototype.dispose;const Xn=[0,0,0],Ai=5;class aa{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,ft(tp(this.resolutions_,(s,r)=>r-s),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let s=0,r=this.resolutions_.length-1;s<r;++s)if(!e)e=this.resolutions_[s]/this.resolutions_[s+1];else if(this.resolutions_[s]/this.resolutions_[s+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,ft(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const n=t.extent;n!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=li(n)),ft(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,ft(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Ic,ft(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=n!==void 0?n:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((s,r)=>{const a=new el(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(n){const o=this.getTileRangeForExtentAndZ(n,r);a.minX=Math.max(o.minX,a.minX),a.maxX=Math.min(o.maxX,a.maxX),a.minY=Math.max(o.minY,a.minY),a.maxY=Math.min(o.maxY,a.maxY)}return a}):n&&this.calculateTileRanges_(n)}forEachTileCoord(t,e,n){const s=this.getTileRangeForExtentAndZ(t,e);for(let r=s.minX,a=s.maxX;r<=a;++r)for(let o=s.minY,l=s.maxY;o<=l;++o)n([e,r,o])}forEachTileCoordParentTileRange(t,e,n,s){let r,a,o,l=null,h=t[0]-1;for(this.zoomFactor_===2?(a=t[1],o=t[2]):l=this.getTileCoordExtent(t,s);h>=this.minZoom;){if(a!==void 0&&o!==void 0?(a=Math.floor(a/2),o=Math.floor(o/2),r=Bn(a,a,o,o,n)):r=this.getTileRangeForExtentAndZ(l,h,n),e(h,r))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,n){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const r=t[1]*2,a=t[2]*2;return Bn(r,r+1,a,a+1,e)}const s=this.getTileCoordExtent(t,n||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,n){if(e>this.maxZoom||e<this.minZoom)return null;const s=t[0],r=t[1],a=t[2];if(e===s)return Bn(r,a,r,a,n);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-s),h=Math.floor(r*l),c=Math.floor(a*l);if(e<s)return Bn(h,h,c,c,n);const u=Math.floor(l*(r+1))-1,f=Math.floor(l*(a+1))-1;return Bn(h,u,c,f,n)}const o=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,e,n)}getTileRangeForExtentAndZ(t,e,n){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,Xn);const s=Xn[1],r=Xn[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,Xn);const a=Xn[1],o=Xn[2];return Bn(s,a,r,o,n)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=Lt(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*s[0]*n,e[1]-(t[2]+.5)*s[1]*n]}getTileCoordExtent(t,e){const n=this.getOrigin(t[0]),s=this.getResolution(t[0]),r=Lt(this.getTileSize(t[0]),this.tmpSize_),a=n[0]+t[1]*r[0]*s,o=n[1]-(t[2]+1)*r[1]*s,l=a+r[0]*s,h=o+r[1]*s;return Ti(a,o,l,h,e)}getTileCoordForCoordAndResolution(t,e,n){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,n)}getTileCoordForXYAndResolution_(t,e,n,s,r){const a=this.getZForResolution(n),o=n/this.getResolution(a),l=this.getOrigin(a),h=Lt(this.getTileSize(a),this.tmpSize_);let c=o*(t-l[0])/n/h[0],u=o*(l[1]-e)/n/h[1];return s?(c=Ni(c,Ai)-1,u=Ni(u,Ai)-1):(c=va(c,Ai),u=va(u,Ai)),Cs(a,c,u,r)}getTileCoordForXYAndZ_(t,e,n,s,r){const a=this.getOrigin(n),o=this.getResolution(n),l=Lt(this.getTileSize(n),this.tmpSize_);let h=(t-a[0])/o/l[0],c=(a[1]-e)/o/l[1];return s?(h=Ni(h,Ai)-1,c=Ni(c,Ai)-1):(h=va(h,Ai),c=va(c,Ai)),Cs(n,h,c,r)}getTileCoordForCoordAndZ(t,e,n){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,n)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const n=Do(this.resolutions_,t,e||0);return wt(n,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Bg(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,n=new Array(e);for(let s=this.minZoom;s<e;++s)n[s]=this.getTileRangeForExtentAndZ(t,s);this.fullTileRanges_=n}}class _E extends aa{constructor(t){super({extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes}),this.matrixIds_=t.matrixIds}getMatrixId(t){return this.matrixIds_[t]}getMatrixIds(){return this.matrixIds_}}function mE(i,t,e){const n=[],s=[],r=[],a=[],o=[];e=e!==void 0?e:[];const l="SupportedCRS",h="TileMatrix",c="Identifier",u="ScaleDenominator",f="TopLeftCorner",_="TileWidth",g="TileHeight",x=i[l],y=lt(x),w=y.getMetersPerUnit(),d=y.getAxisOrientation().startsWith("ne");return i[h].sort(function(p,v){return v[u]-p[u]}),i[h].forEach(function(p){let v;if(e.length>0?v=e.find(function(T){return p[c]==T[h]?!0:p[c].includes(":")?!1:i[c]+":"+p[c]===T[h]}):v=!0,v){s.push(p[c]);const T=p[u]*28e-5/w,R=p[_],C=p[g];d?r.push([p[f][1],p[f][0]]):r.push(p[f]),n.push(T),a.push(R==C?R:[R,C]),o.push([p.MatrixWidth,p.MatrixHeight])}}),new _E({extent:t,origins:r,resolutions:n,matrixIds:s,tileSizes:a,sizes:o})}function tu(i){let t=i.getDefaultTileGrid();return t||(t=xE(i),i.setDefaultTileGrid(t)),t}function pE(i,t,e){const n=t[0],s=i.getTileCoordCenter(t),r=tn(e);if(!wi(r,s)){const a=ot(r),o=Math.ceil((r[0]-s[0])/a);return s[0]+=a*o,i.getTileCoordForCoordAndZ(s,n)}return t}function yE(i,t,e,n){n=n!==void 0?n:"top-left";const s=P0(i,t,e);return new aa({extent:i,origin:mp(i,n),resolutions:s,tileSize:e})}function Gs(i){const t=i||{},e=t.extent||lt("EPSG:3857").getExtent(),n={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:P0(e,t.maxZoom,t.tileSize,t.maxResolution)};return new aa(n)}function P0(i,t,e,n){t=t!==void 0?t:Vg,e=Lt(e!==void 0?e:Ic);const s=It(i),r=ot(i);n=n>0?n:Math.max(r/e[0],s/e[1]);const a=t+1,o=new Array(a);for(let l=0;l<a;++l)o[l]=n/Math.pow(2,l);return o}function xE(i,t,e,n){const s=tn(i);return yE(s,t,e,n)}function tn(i){i=lt(i);let t=i.getExtent();if(!t){const e=180*hc.degrees/i.getMetersPerUnit();t=Ti(-e,-e,e,e)}return t}function vo(i,t){const e=[];Object.keys(t).forEach(function(s){t[s]!==null&&t[s]!==void 0&&e.push(s+"="+encodeURIComponent(t[s]))});const n=e.join("&");return i=i.replace(/[?&]$/,""),i+=i.includes("?")?"&":"?",i+n}const EE=/\{z\}/g,vE=/\{x\}/g,wE=/\{y\}/g,TE=/\{-y\}/g;function SE(i,t,e,n,s){return i.replace(EE,t.toString()).replace(vE,e.toString()).replace(wE,n.toString()).replace(TE,function(){if(s===void 0)throw new Error("If the URL template has a {-y} placeholder, the grid extent must be known");return(s-n).toString()})}function L0(i){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(i);if(e){const n=e[1].charCodeAt(0),s=e[2].charCodeAt(0);let r;for(r=n;r<=s;++r)t.push(i.replace(e[0],String.fromCharCode(r)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){const n=parseInt(e[2],10);for(let s=parseInt(e[1],10);s<=n;s++)t.push(i.replace(e[0],s.toString()));return t}return t.push(i),t}function RE(i,t){return function(e,n,s){if(!e)return;let r;const a=e[0];if(t){const o=t.getFullTileRange(a);o&&(r=o.getHeight()-1)}return SE(i,a,e[1],e[2],r)}}function O0(i,t){const e=i.length,n=new Array(e);for(let s=0;s<e;++s)n[s]=RE(i[s],t);return Rh(n)}function Rh(i){return i.length===1?i[0]:function(t,e,n){if(!t)return;const s=R0(t),r=mn(s,i.length);return i[r](t,e,n)}}class eu extends He{constructor(t){super(),this.projection=lt(t.projection),this.attributions_=Zf(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible??!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(n,s){e.viewResolver=n,e.viewRejector=s})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Zf(t),this.changed()}setState(t){this.state_=t,this.changed()}}function Zf(i){return i?typeof i=="function"?i:(Array.isArray(i)||(i=[i]),t=>i):null}class F0 extends eu{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&Lt(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tmpSize=[0,0],this.key_=t.key||Z(this),this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getResolutions(t){const e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,n,s,r){return tt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:tu(t)}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,n){const s=this.getTileGridForProjection(n),r=this.getTilePixelRatio(e),a=Lt(s.getTileSize(t),this.tmpSize);return r==1?a:wy(a,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){const n=e!==void 0?e:this.getProjection(),s=e!==void 0?this.getTileGridForProjection(n):this.tileGrid||this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=pE(s,t,n)),Yx(t,s)?t:null}clear(){}refresh(){this.clear(),super.refresh()}}class D0 extends Ke{constructor(t,e){super(t),this.tile=e}}const _s={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class il extends F0{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===il.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,n=Z(e),s=e.getState();let r;s==z.LOADING?(this.tileLoadingKeys_[n]=!0,r=_s.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==z.ERROR?_s.TILELOADERROR:s==z.LOADED?_s.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new D0(r,e))}setTileLoadFunction(t){this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=L0(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(O0(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,n){}}class nl extends il{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:ME,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:tl,this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(t){return this.getProjection()&&t&&!Ge(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Ge(e,t)))return this.tileGrid;const n=Z(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=tu(t)),this.tileGridForProjection[n]}createTile_(t,e,n,s,r,a){const o=[t,e,n],l=this.getTileCoordForTileUrlFunction(o,r),h=l?this.tileUrlFunction(l,s,r):void 0,c=new this.tileClass(o,h!==void 0?z.IDLE:z.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return c.key=a,c.addEventListener(Y.CHANGE,this.handleTileChange.bind(this)),c}getTile(t,e,n,s,r){const a=this.getProjection();if(!a||!r||Ge(a,r))return this.getTileInternal(t,e,n,s,a||r);const o=[t,e,n],l=this.getKey(),h=this.getTileGridForProjection(a),c=this.getTileGridForProjection(r),u=this.getTileCoordForTileUrlFunction(o,r),f=new Yc(a,h,r,c,o,u,this.getTilePixelRatio(s),this.getGutter(),(_,g,x,y)=>this.getTileInternal(_,g,x,y,a),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return f.key=l,f}getTileInternal(t,e,n,s,r){const a=this.getKey();return this.createTile_(t,e,n,s,r,a)}setRenderReprojectionEdges(t){this.renderReprojectionEdges_!=t&&(this.renderReprojectionEdges_=t,this.changed())}setTileGridForProjection(t,e){const n=lt(t);if(n){const s=Z(n);s in this.tileGridForProjection||(this.tileGridForProjection[s]=e)}}}function ME(i,t){i.getImage().src=t}class Mh extends nl{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",n=t.tileGrid!==void 0?t.tileGrid:Gs({extent:tn(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const te={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class CE extends He{constructor(t){super(),this.on,this.once,this.un,this.options=t,this.id=t.id,this.insertFirst=t.insertFirst!==void 0?t.insertFirst:!0,this.stopEvent=t.stopEvent!==void 0?t.stopEvent:!0,this.element=document.createElement("div"),this.element.className=t.className!==void 0?t.className:"ol-overlay-container "+A1,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=t.autoPan===!0?{}:t.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(te.ELEMENT,this.handleElementChanged),this.addChangeListener(te.MAP,this.handleMapChanged),this.addChangeListener(te.OFFSET,this.handleOffsetChanged),this.addChangeListener(te.POSITION,this.handlePositionChanged),this.addChangeListener(te.POSITIONING,this.handlePositioningChanged),t.element!==void 0&&this.setElement(t.element),this.setOffset(t.offset!==void 0?t.offset:[0,0]),this.setPositioning(t.positioning||"top-left"),t.position!==void 0&&this.setPosition(t.position)}getElement(){return this.get(te.ELEMENT)}getId(){return this.id}getMap(){return this.get(te.MAP)||null}getOffset(){return this.get(te.OFFSET)}getPosition(){return this.get(te.POSITION)}getPositioning(){return this.get(te.POSITIONING)}handleElementChanged(){$g(this.element);const t=this.getElement();t&&this.element.appendChild(t)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),vt(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const t=this.getMap();if(t){this.mapPostrenderListenerKey=ct(t,yi.POSTRENDER,this.render,this),this.updatePixelPosition();const e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(t){this.set(te.ELEMENT,t)}setMap(t){this.set(te.MAP,t)}setOffset(t){this.set(te.OFFSET,t)}setPosition(t){this.set(te.POSITION,t)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(t){const e=this.getMap();if(!e||!e.getTargetElement()||!this.get(te.POSITION))return;const n=this.getRect(e.getTargetElement(),e.getSize()),s=this.getElement(),r=this.getRect(s,[L1(s),O1(s)]);t=t||{};const a=t.margin===void 0?20:t.margin;if(!Xe(n,r)){const o=r[0]-n[0],l=n[2]-r[2],h=r[1]-n[1],c=n[3]-r[3],u=[0,0];if(o<0?u[0]=o-a:l<0&&(u[0]=Math.abs(l)+a),h<0?u[1]=h-a:c<0&&(u[1]=Math.abs(c)+a),u[0]!==0||u[1]!==0){const f=e.getView().getCenterInternal(),_=e.getPixelFromCoordinateInternal(f);if(!_)return;const g=[_[0]+u[0],_[1]+u[1]],x=t.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(g),duration:x.duration,easing:x.easing})}}}getRect(t,e){const n=t.getBoundingClientRect(),s=n.left+window.pageXOffset,r=n.top+window.pageYOffset;return[s,r,s+e[0],r+e[1]]}setPositioning(t){this.set(te.POSITIONING,t)}setVisible(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)}updatePixelPosition(){const t=this.getMap(),e=this.getPosition();if(!t||!t.isRendered()||!e){this.setVisible(!1);return}const n=t.getPixelFromCoordinate(e),s=t.getSize();this.updateRenderedPosition(n,s)}updateRenderedPosition(t,e){const n=this.element.style,s=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const a=`${t[0]+s[0]}px`,o=`${t[1]+s[1]}px`;let l="0%",h="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?h="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(h="-50%");const c=`translate(${l}, ${h}) translate(${a}, ${o})`;this.rendered.transform_!=c&&(this.rendered.transform_=c,n.transform=c)}getOptions(){return this.options}}var Re=Uint8Array,ss=Uint16Array,bE=Int32Array,G0=new Re([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),N0=new Re([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),IE=new Re([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k0=function(i,t){for(var e=new ss(31),n=0;n<31;++n)e[n]=t+=1<<i[n-1];for(var s=new bE(e[30]),n=1;n<30;++n)for(var r=e[n];r<e[n+1];++r)s[r]=r-e[n]<<5|n;return{b:e,r:s}},U0=k0(G0,2),B0=U0.b,AE=U0.r;B0[28]=258,AE[258]=28;var PE=k0(N0,0),LE=PE.b,Ch=new ss(32768);for(var Ct=0;Ct<32768;++Ct){var Pi=(Ct&43690)>>1|(Ct&21845)<<1;Pi=(Pi&52428)>>2|(Pi&13107)<<2,Pi=(Pi&61680)>>4|(Pi&3855)<<4,Ch[Ct]=((Pi&65280)>>8|(Pi&255)<<8)>>1}var mr=function(i,t,e){for(var n=i.length,s=0,r=new ss(t);s<n;++s)i[s]&&++r[i[s]-1];var a=new ss(t);for(s=1;s<t;++s)a[s]=a[s-1]+r[s-1]<<1;var o;if(e){o=new ss(1<<t);var l=15-t;for(s=0;s<n;++s)if(i[s])for(var h=s<<4|i[s],c=t-i[s],u=a[i[s]-1]++<<c,f=u|(1<<c)-1;u<=f;++u)o[Ch[u]>>l]=h}else for(o=new ss(n),s=0;s<n;++s)i[s]&&(o[s]=Ch[a[i[s]-1]++]>>15-i[s]);return o},oa=new Re(288);for(var Ct=0;Ct<144;++Ct)oa[Ct]=8;for(var Ct=144;Ct<256;++Ct)oa[Ct]=9;for(var Ct=256;Ct<280;++Ct)oa[Ct]=7;for(var Ct=280;Ct<288;++Ct)oa[Ct]=8;var z0=new Re(32);for(var Ct=0;Ct<32;++Ct)z0[Ct]=5;var OE=mr(oa,9,1),FE=mr(z0,5,1),Ul=function(i){for(var t=i[0],e=1;e<i.length;++e)i[e]>t&&(t=i[e]);return t},Ue=function(i,t,e){var n=t/8|0;return(i[n]|i[n+1]<<8)>>(t&7)&e},Bl=function(i,t){var e=t/8|0;return(i[e]|i[e+1]<<8|i[e+2]<<16)>>(t&7)},DE=function(i){return(i+7)/8|0},GE=function(i,t,e){return(e==null||e>i.length)&&(e=i.length),new Re(i.subarray(t,e))},NE=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],we=function(i,t,e){var n=new Error(t||NE[i]);if(n.code=i,Error.captureStackTrace&&Error.captureStackTrace(n,we),!e)throw n;return n},iu=function(i,t,e,n){var s=i.length,r=0;if(!s||t.f&&!t.l)return e||new Re(0);var a=!e,o=a||t.i!=2,l=t.i;a&&(e=new Re(s*3));var h=function(St){var Ut=e.length;if(St>Ut){var Ft=new Re(Math.max(Ut*2,St));Ft.set(e),e=Ft}},c=t.f||0,u=t.p||0,f=t.b||0,_=t.l,g=t.d,x=t.m,y=t.n,w=s*8;do{if(!_){c=Ue(i,u,1);var d=Ue(i,u+1,3);if(u+=3,d)if(d==1)_=OE,g=FE,x=9,y=5;else if(d==2){var R=Ue(i,u,31)+257,C=Ue(i,u+10,15)+4,b=R+Ue(i,u+5,31)+1;u+=14;for(var I=new Re(b),P=new Re(19),G=0;G<C;++G)P[IE[G]]=Ue(i,u+G*3,7);u+=C*3;for(var O=Ul(P),m=(1<<O)-1,E=mr(P,O,1),G=0;G<b;){var S=E[Ue(i,u,m)];u+=S&15;var p=S>>4;if(p<16)I[G++]=p;else{var M=0,A=0;for(p==16?(A=3+Ue(i,u,3),u+=2,M=I[G-1]):p==17?(A=3+Ue(i,u,7),u+=3):p==18&&(A=11+Ue(i,u,127),u+=7);A--;)I[G++]=M}}var F=I.subarray(0,R),D=I.subarray(R);x=Ul(F),y=Ul(D),_=mr(F,x,1),g=mr(D,y,1)}else we(1);else{var p=DE(u)+4,v=i[p-4]|i[p-3]<<8,T=p+v;if(T>s){l&&we(0);break}o&&h(f+v),e.set(i.subarray(p,T),f),t.b=f+=v,t.p=u=T*8,t.f=c;continue}if(u>w){l&&we(0);break}}o&&h(f+131072);for(var k=(1<<x)-1,B=(1<<y)-1,U=u;;U=u){var M=_[Bl(i,u)&k],V=M>>4;if(u+=M&15,u>w){l&&we(0);break}if(M||we(2),V<256)e[f++]=V;else if(V==256){U=u,_=null;break}else{var q=V-254;if(V>264){var G=V-257,W=G0[G];q=Ue(i,u,(1<<W)-1)+B0[G],u+=W}var H=g[Bl(i,u)&B],et=H>>4;H||we(3),u+=H&15;var D=LE[et];if(et>3){var W=N0[et];D+=Bl(i,u)&(1<<W)-1,u+=W}if(u>w){l&&we(0);break}o&&h(f+131072);var mt=f+q;if(f<D){var ht=r-D,dt=Math.min(D,mt);for(ht+f<0&&we(3);f<dt;++f)e[f]=n[ht+f]}for(;f<mt;++f)e[f]=e[f-D]}}t.l=_,t.p=U,t.b=f,t.f=c,_&&(c=1,t.m=x,t.d=g,t.n=y)}while(!c);return f!=e.length&&a?GE(e,0,f):e.subarray(0,f)},kE=new Re(0),UE=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&we(6,"invalid gzip data");var t=i[3],e=10;t&4&&(e+=(i[10]|i[11]<<8)+2);for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!i[e++]);return e+(t&2)},BE=function(i){var t=i.length;return(i[t-4]|i[t-3]<<8|i[t-2]<<16|i[t-1]<<24)>>>0},zE=function(i,t){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&we(6,"invalid zlib data"),(i[1]>>5&1)==1&&we(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function XE(i,t){return iu(i,{i:2},t,t)}function jE(i,t){var e=UE(i);return e+8>i.length&&we(6,"invalid gzip data"),iu(i.subarray(e,-8),{i:2},new Re(BE(i)),t)}function VE(i,t){return iu(i.subarray(zE(i),-4),{i:2},t,t)}function $E(i,t){return i[0]==31&&i[1]==139&&i[2]==8?jE(i,t):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?XE(i,t):VE(i,t)}var WE=typeof TextDecoder<"u"&&new TextDecoder,qE=0;try{WE.decode(kE,{stream:!0}),qE=1}catch{}var KE=Object.defineProperty,pr=Math.pow,Tt=(i,t)=>KE(i,"name",{value:t,configurable:!0}),qt=(i,t,e)=>new Promise((n,s)=>{var r=l=>{try{o(e.next(l))}catch(h){s(h)}},a=l=>{try{o(e.throw(l))}catch(h){s(h)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(r,a);o((e=e.apply(i,t)).next())});Tt((i,t)=>{let e=!1,n="",s=L.GridLayer.extend({createTile:Tt((r,a)=>{let o=document.createElement("img"),l=new AbortController,h=l.signal;return o.cancel=()=>{l.abort()},e||(i.getHeader().then(c=>{c.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):c.tileType===2?n="image/png":c.tileType===3?n="image/jpeg":c.tileType===4?n="image/webp":c.tileType===5&&(n="image/avif")}),e=!0),i.getZxy(r.z,r.x,r.y,h).then(c=>{if(c){let u=new Blob([c.data],{type:n}),f=window.URL.createObjectURL(u);o.src=f,o.cancel=void 0,a(void 0,o)}}).catch(c=>{if(c.name!=="AbortError")throw c}),o},"createTile"),_removeTile:Tt(function(r){let a=this._tiles[r];a&&(a.el.cancel&&a.el.cancel(),a.el.width=0,a.el.height=0,a.el.deleted=!0,L.DomUtil.remove(a.el),delete this._tiles[r],this.fire("tileunload",{tile:a.el,coords:this._keyToTileCoords(r)}))},"_removeTile")});return new s(t)},"leafletRasterLayer");var HE=Tt(i=>(t,e)=>{if(e instanceof AbortController)return i(t,e);let n=new AbortController;return i(t,n).then(s=>e(void 0,s.data,s.cacheControl||"",s.expires||""),s=>e(s)).catch(s=>e(s)),{cancel:Tt(()=>n.abort(),"cancel")}},"v3compat"),YE=class{constructor(t){this.tilev4=Tt((e,n)=>qt(this,null,function*(){if(e.type==="json"){let _=e.url.substr(10),g=this.tiles.get(_);if(g||(g=new kr(_),this.tiles.set(_,g)),this.metadata)return{data:yield g.getTileJson(e.url)};let x=yield g.getHeader();return(x.minLon>=x.maxLon||x.minLat>=x.maxLat)&&console.error(`Bounds of PMTiles archive ${x.minLon},${x.minLat},${x.maxLon},${x.maxLat} are not valid.`),{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:x.minZoom,maxzoom:x.maxZoom,bounds:[x.minLon,x.minLat,x.maxLon,x.maxLat]}}}let s=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),r=e.url.match(s);if(!r)throw new Error("Invalid PMTiles protocol URL");let a=r[1],o=this.tiles.get(a);o||(o=new kr(a),this.tiles.set(a,o));let l=r[2],h=r[3],c=r[4],u=yield o.getHeader(),f=yield o?.getZxy(+l,+h,+c,n.signal);if(f)return{data:new Uint8Array(f.data),cacheControl:f.cacheControl,expires:f.expires};if(u.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=HE(this.tilev4),this.tiles=new Map,this.metadata=t?.metadata||!1,this.errorOnMissingTile=t?.errorOnMissingTile||!1}add(t){this.tiles.set(t.source.getKey(),t)}get(t){return this.tiles.get(t)}};Tt(YE,"Protocol");function X0(i,t){return(t>>>0)*4294967296+(i>>>0)}Tt(X0,"toNum");function j0(i,t){let e=t.buf,n=e[t.pos++],s=(n&112)>>4;if(n<128||(n=e[t.pos++],s|=(n&127)<<3,n<128)||(n=e[t.pos++],s|=(n&127)<<10,n<128)||(n=e[t.pos++],s|=(n&127)<<17,n<128)||(n=e[t.pos++],s|=(n&127)<<24,n<128)||(n=e[t.pos++],s|=(n&1)<<31,n<128))return X0(i,s);throw new Error("Expected varint not more than 10 bytes")}Tt(j0,"readVarintRemainder");function Zn(i){let t=i.buf,e=t[i.pos++],n=e&127;return e<128||(e=t[i.pos++],n|=(e&127)<<7,e<128)||(e=t[i.pos++],n|=(e&127)<<14,e<128)||(e=t[i.pos++],n|=(e&127)<<21,e<128)?n:(e=t[i.pos],n|=(e&15)<<28,j0(n,i))}Tt(Zn,"readVarint");function nu(i,t,e,n){if(n===0){e===1&&(t[0]=i-1-t[0],t[1]=i-1-t[1]);let s=t[0];t[0]=t[1],t[1]=s}}Tt(nu,"rotate");function V0(i,t){let e=pr(2,i),n=t,s=t,r=t,a=[0,0],o=1;for(;o<e;)n=1&r/2,s=1&(r^n),nu(o,a,n,s),a[0]+=o*n,a[1]+=o*s,r=r/4,o*=2;return[i,a[0],a[1]]}Tt(V0,"idOnLevel");var ZE=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function $0(i,t,e){if(i>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(t>pr(2,i)-1||e>pr(2,i)-1)throw new Error("tile x/y outside zoom level bounds");let n=ZE[i],s=pr(2,i),r=0,a=0,o=0,l=[t,e],h=s/2;for(;h>0;)r=(l[0]&h)>0?1:0,a=(l[1]&h)>0?1:0,o+=h*h*(3*r^a),nu(h,l,r,a),h=h/2;return n+o}Tt($0,"zxyToTileId");function QE(i){let t=0;for(let e=0;e<27;e++){let n=(1<<e)*(1<<e);if(t+n>i)return V0(e,i-t);t+=n}throw new Error("Tile zoom level exceeds max safe number limit (26)")}Tt(QE,"tileIdToZxy");var JE=(i=>(i[i.Unknown=0]="Unknown",i[i.None=1]="None",i[i.Gzip=2]="Gzip",i[i.Brotli=3]="Brotli",i[i.Zstd=4]="Zstd",i))(JE||{});function sl(i,t){return qt(this,null,function*(){if(t===1||t===0)return i;if(t===2){if(typeof globalThis.DecompressionStream>"u")return $E(new Uint8Array(i));let e=new Response(i).body;if(!e)throw new Error("Failed to read response stream");let n=e.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw new Error("Compression method not supported")})}Tt(sl,"defaultDecompress");var Qn=(i=>(i[i.Unknown=0]="Unknown",i[i.Mvt=1]="Mvt",i[i.Png=2]="Png",i[i.Jpeg=3]="Jpeg",i[i.Webp=4]="Webp",i[i.Avif=5]="Avif",i))(Qn||{});function W0(i){return i===1?".mvt":i===2?".png":i===3?".jpg":i===4?".webp":i===5?".avif":""}Tt(W0,"tileTypeExt");var tv=127;function q0(i,t){let e=0,n=i.length-1;for(;e<=n;){let s=n+e>>1,r=t-i[s].tileId;if(r>0)e=s+1;else if(r<0)n=s-1;else return i[s]}return n>=0&&(i[n].runLength===0||t-i[n].tileId<i[n].runLength)?i[n]:null}Tt(q0,"findTile");var ev=class{constructor(t){this.file=t}getKey(){return this.file.name}getBytes(t,e){return qt(this,null,function*(){return{data:yield this.file.slice(t,t+e).arrayBuffer()}})}};Tt(ev,"FileSource");var K0=class{constructor(t,e=new Headers){this.url=t,this.customHeaders=e,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");let s=n.indexOf("Windows")>-1,r=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,s&&r&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(t){this.customHeaders=t}getBytes(t,e,n,s){return qt(this,null,function*(){let r,a;n?a=n:(r=new AbortController,a=r.signal);let o=new Headers(this.customHeaders);o.set("range",`bytes=${t}-${t+e-1}`);let l;this.mustReload?l="reload":this.chromeWindowsNoCache&&(l="no-store");let h=yield fetch(this.url,{signal:a,cache:l,headers:o});if(t===0&&h.status===416){let f=h.headers.get("Content-Range");if(!f||!f.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let _=+f.substr(8);h=yield fetch(this.url,{signal:a,cache:"reload",headers:{range:`bytes=0-${_-1}`}})}let c=h.headers.get("Etag");if(c!=null&&c.startsWith("W/")&&(c=null),h.status===416||s&&c&&c!==s)throw this.mustReload=!0,new bh(`Server returned non-matching ETag ${s} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(h.status>=300)throw new Error(`Bad response code: ${h.status}`);let u=h.headers.get("Content-Length");if(h.status===200&&(!u||+u>e))throw r&&r.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield h.arrayBuffer(),etag:c||void 0,cacheControl:h.headers.get("Cache-Control")||void 0,expires:h.headers.get("Expires")||void 0}})}};Tt(K0,"FetchSource");var iv=K0;function Pe(i,t){let e=i.getUint32(t+4,!0),n=i.getUint32(t+0,!0);return e*pr(2,32)+n}Tt(Pe,"getUint64");function H0(i,t){let e=new DataView(i),n=e.getUint8(7);if(n>3)throw new Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:Pe(e,8),rootDirectoryLength:Pe(e,16),jsonMetadataOffset:Pe(e,24),jsonMetadataLength:Pe(e,32),leafDirectoryOffset:Pe(e,40),leafDirectoryLength:Pe(e,48),tileDataOffset:Pe(e,56),tileDataLength:Pe(e,64),numAddressedTiles:Pe(e,72),numTileEntries:Pe(e,80),numTileContents:Pe(e,88),clustered:e.getUint8(96)===1,internalCompression:e.getUint8(97),tileCompression:e.getUint8(98),tileType:e.getUint8(99),minZoom:e.getUint8(100),maxZoom:e.getUint8(101),minLon:e.getInt32(102,!0)/1e7,minLat:e.getInt32(106,!0)/1e7,maxLon:e.getInt32(110,!0)/1e7,maxLat:e.getInt32(114,!0)/1e7,centerZoom:e.getUint8(118),centerLon:e.getInt32(119,!0)/1e7,centerLat:e.getInt32(123,!0)/1e7,etag:t}}Tt(H0,"bytesToHeader");function su(i){let t={buf:new Uint8Array(i),pos:0},e=Zn(t),n=[],s=0;for(let r=0;r<e;r++){let a=Zn(t);n.push({tileId:s+a,offset:0,length:0,runLength:1}),s+=a}for(let r=0;r<e;r++)n[r].runLength=Zn(t);for(let r=0;r<e;r++)n[r].length=Zn(t);for(let r=0;r<e;r++){let a=Zn(t);a===0&&r>0?n[r].offset=n[r-1].offset+n[r-1].length:n[r].offset=a-1}return n}Tt(su,"deserializeIndex");var Y0=class extends Error{};Tt(Y0,"EtagMismatch");var bh=Y0;function ru(i,t){return qt(this,null,function*(){let e=yield i.getBytes(0,16384);if(new DataView(e.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let n=e.data.slice(0,tv),s=H0(n,e.etag),r=e.data.slice(s.rootDirectoryOffset,s.rootDirectoryOffset+s.rootDirectoryLength),a=`${i.getKey()}|${s.etag||""}|${s.rootDirectoryOffset}|${s.rootDirectoryLength}`,o=su(yield t(r,s.internalCompression));return[s,[a,o.length,o]]})}Tt(ru,"getHeaderAndRoot");function au(i,t,e,n,s){return qt(this,null,function*(){let r=yield i.getBytes(e,n,void 0,s.etag),a=yield t(r.data,s.internalCompression),o=su(a);if(o.length===0)throw new Error("Empty directory is invalid");return o})}Tt(au,"getDirectory");var nv=class{constructor(t=100,e=!0,n=sl){this.cache=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=n}getHeader(t){return qt(this,null,function*(){let e=t.getKey(),n=this.cache.get(e);if(n)return n.lastUsed=this.counter++,n.data;let s=yield ru(t,this.decompress);return s[1]&&this.cache.set(s[1][0],{lastUsed:this.counter++,data:s[1][2]}),this.cache.set(e,{lastUsed:this.counter++,data:s[0]}),this.prune(),s[0]})}getDirectory(t,e,n,s){return qt(this,null,function*(){let r=`${t.getKey()}|${s.etag||""}|${e}|${n}`,a=this.cache.get(r);if(a)return a.lastUsed=this.counter++,a.data;let o=yield au(t,this.decompress,e,n,s);return this.cache.set(r,{lastUsed:this.counter++,data:o}),this.prune(),o})}prune(){if(this.cache.size>this.maxCacheEntries){let t=1/0,e;this.cache.forEach((n,s)=>{n.lastUsed<t&&(t=n.lastUsed,e=s)}),e&&this.cache.delete(e)}}invalidate(t){return qt(this,null,function*(){this.cache.delete(t.getKey())})}};Tt(nv,"ResolvedValueCache");var Z0=class{constructor(t=100,e=!0,n=sl){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=t,this.counter=1,this.decompress=n}getHeader(t){return qt(this,null,function*(){let e=t.getKey(),n=this.cache.get(e);if(n)return n.lastUsed=this.counter++,yield n.data;let s=new Promise((r,a)=>{ru(t,this.decompress).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),r(o[0]),this.prune()}).catch(o=>{a(o)})});return this.cache.set(e,{lastUsed:this.counter++,data:s}),s})}getDirectory(t,e,n,s){return qt(this,null,function*(){let r=`${t.getKey()}|${s.etag||""}|${e}|${n}`,a=this.cache.get(r);if(a)return a.lastUsed=this.counter++,yield a.data;let o=new Promise((l,h)=>{au(t,this.decompress,e,n,s).then(c=>{l(c),this.prune()}).catch(c=>{h(c)})});return this.cache.set(r,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let t=1/0,e;this.cache.forEach((n,s)=>{n.lastUsed<t&&(t=n.lastUsed,e=s)}),e&&this.cache.delete(e)}}invalidate(t){return qt(this,null,function*(){let e=t.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(t.getKey());let n=new Promise((s,r)=>{this.getHeader(t).then(a=>{s(),this.invalidations.delete(e)}).catch(a=>{r(a)})});this.invalidations.set(e,n)})}};Tt(Z0,"SharedPromiseCache");var sv=Z0,Q0=class{constructor(t,e,n){typeof t=="string"?this.source=new iv(t):this.source=t,n?this.decompress=n:this.decompress=sl,e?this.cache=e:this.cache=new sv}getHeader(){return qt(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(t,e,n,s){return qt(this,null,function*(){let r=$0(t,e,n),a=yield this.cache.getHeader(this.source);if(t<a.minZoom||t>a.maxZoom)return;let o=a.rootDirectoryOffset,l=a.rootDirectoryLength;for(let h=0;h<=3;h++){let c=yield this.cache.getDirectory(this.source,o,l,a),u=q0(c,r);if(u){if(u.runLength>0){let f=yield this.source.getBytes(a.tileDataOffset+u.offset,u.length,s,a.etag);return{data:yield this.decompress(f.data,a.tileCompression),cacheControl:f.cacheControl,expires:f.expires}}o=a.leafDirectoryOffset+u.offset,l=u.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(t,e,n,s){return qt(this,null,function*(){try{return yield this.getZxyAttempt(t,e,n,s)}catch(r){if(r instanceof bh)return this.cache.invalidate(this.source),yield this.getZxyAttempt(t,e,n,s);throw r}})}getMetadataAttempt(){return qt(this,null,function*(){let t=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(t.jsonMetadataOffset,t.jsonMetadataLength,void 0,t.etag),n=yield this.decompress(e.data,t.internalCompression),s=new TextDecoder("utf-8");return JSON.parse(s.decode(n))})}getMetadata(){return qt(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(t){if(t instanceof bh)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw t}})}getTileJson(t){return qt(this,null,function*(){let e=yield this.getHeader(),n=yield this.getMetadata(),s=W0(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${t}/{z}/{x}/{y}${s}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};Tt(Q0,"PMTiles");var kr=Q0;class rv extends Ke{constructor(t){super(Y.ERROR),this.error=t}}class rl extends He{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new rl(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const n=this.getStyle();return n&&t.setStyle(n),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(vt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=ct(t,Y.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?av(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function av(i){if(typeof i=="function")return i;let t;return Array.isArray(i)?t=i:(ft(typeof i.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[i]),function(){return t}}function J0(i,t,e,n){const s=[];let r=xe();for(let a=0,o=e.length;a<o;++a){const l=e[a];r=ic(i,t,l[0],n),s.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=l[l.length-1]}return s}function wo(i,t,e,n,s,r,a){let o,l;const h=(e-t)/n;if(h===1)o=t;else if(h===2)o=t,l=s;else if(h!==0){let c=i[t],u=i[t+1],f=0;const _=[0];for(let y=t+n;y<e;y+=n){const w=i[y],d=i[y+1];f+=Math.sqrt((w-c)*(w-c)+(d-u)*(d-u)),_.push(f),c=w,u=d}const g=s*f,x=Qm(_,g);x<0?(l=(g-_[-x-2])/(_[-x-1]-_[-x-2]),o=t+(-x-2)*n):o=t+x*n}a=a>1?a:2,r=r||new Array(a);for(let c=0;c<a;++c)r[c]=o===void 0?NaN:l===void 0?i[o+c]:Te(i[o+c],i[o+n+c],l);return r}function Ih(i,t,e,n,s,r){if(e==t)return null;let a;if(s<i[t+n-1])return r?(a=i.slice(t,t+n),a[n-1]=s,a):null;if(i[e-1]<s)return r?(a=i.slice(e-n,e),a[n-1]=s,a):null;if(s==i[t+n-1])return i.slice(t,t+n);let o=t/n,l=e/n;for(;o<l;){const f=o+l>>1;s<i[(f+1)*n-1]?l=f:o=f+1}const h=i[o*n-1];if(s==h)return i.slice((o-1)*n,(o-1)*n+n);const c=i[(o+1)*n-1],u=(s-h)/(c-h);a=[];for(let f=0;f<n-1;++f)a.push(Te(i[(o-1)*n+f],i[o*n+f],u));return a.push(s),a}function ov(i,t,e,n,s,r,a){if(a)return Ih(i,t,e[e.length-1],n,s,r);let o;if(s<i[n-1])return r?(o=i.slice(0,n),o[n-1]=s,o):null;if(i[i.length-1]<s)return r?(o=i.slice(i.length-n),o[n-1]=s,o):null;for(let l=0,h=e.length;l<h;++l){const c=e[l];if(t!=c){if(s<i[t+n-1])return null;if(s<=i[c-1])return Ih(i,t,c,n,s,!1);t=c}}return null}class To extends Lg{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(vt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const t=this.geometries_;for(let e=0,n=t.length;e<n;++e)this.changeEventsKeys_.push(ct(t[e],Y.CHANGE,this.changed,this))}clone(){const t=new To(zl(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,n,s){if(s<Sn(this.getExtent(),t,e))return s;const r=this.geometries_;for(let a=0,o=r.length;a<o;++a)s=r[a].closestPointXY(t,e,n,s);return s}containsXY(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)if(n[s].containsXY(t,e))return!0;return!1}computeExtent(t){Os(t);const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)nc(t,e[n].getExtent());return t}getGeometries(){return zl(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],n=this.geometries_;let s=!1;for(let r=0,a=n.length;r<a;++r){const o=n[r],l=o.getSimplifiedGeometry(t);e.push(l),l!==o&&(s=!0)}return s?new To(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)if(e[n].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].rotate(t,e);this.changed()}scale(t,e,n){n||(n=We(this.getExtent()));const s=this.geometries_;for(let r=0,a=s.length;r<a;++r)s[r].scale(t,e,n);this.changed()}setGeometries(t){this.setGeometriesArray(zl(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let n=0,s=e.length;n<s;++n)e[n].applyTransform(t);this.changed()}translate(t,e){const n=this.geometries_;for(let s=0,r=n.length;s<r;++s)n[s].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function zl(i){return i.map(t=>t.clone())}function ou(i,t,e,n){let s=i[t],r=i[t+1],a=0;for(let o=t+n;o<e;o+=n){const l=i[o],h=i[o+1];a+=Math.sqrt((l-s)*(l-s)+(h-r)*(h-r)),s=l,r=h}return a}class vn extends Rn{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){ri(this.flatCoordinates,t),this.changed()}clone(){const t=new vn(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<Sn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),xc(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,s))}forEachSegment(t){return Ug(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Ih(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return ki(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return ou(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Wo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new vn(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return qo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=$o(this.flatCoordinates,0,t,this.stride),this.changed()}}class Ur extends Rn{constructor(t,e,n){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&n)this.setFlatCoordinates(e,t),this.ends_=n;else{const s=t,r=[],a=[];for(let l=0,h=s.length;l<h;++l){const c=s[l];ri(r,c.getFlatCoordinates()),a.push(r.length)}const o=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(o,r),this.ends_=a}}appendLineString(t){ri(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Ur(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,n,s){return s<Sn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(yc(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ec(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,s))}getCoordinateAtM(t,e,n){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,n=n!==void 0?n:!1,ov(this.flatCoordinates,0,this.ends_,this.stride,t,e,n))}getCoordinates(){return Cr(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new vn(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,n=this.layout,s=[];let r=0;for(let a=0,o=e.length;a<o;++a){const l=e[a],h=new vn(t.slice(r,l),n);s.push(h),r=l}return s}getLength(){const t=this.ends_;let e=0,n=0;for(let s=0,r=t.length;s<r;++s)n+=ou(this.flatCoordinates,e,t[s],this.stride),e=t[s];return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let n=0;const s=this.ends_,r=this.stride;for(let a=0,o=s.length;a<o;++a){const l=s[a],h=wo(e,n,l,r,.5);ri(t,h),n=l}return t}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=Gg(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new Ur(e,"XY",n)}getType(){return"MultiLineString"}intersectsExtent(t){return x1(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const n=Zr(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()}}class la extends Rn{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){ri(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new la(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,n,s){if(s<Sn(this.getExtent(),t,e))return s;const r=this.flatCoordinates,a=this.stride;for(let o=0,l=r.length;o<l;o+=a){const h=_n(t,e,r[o],r[o+1]);if(h<s){s=h;for(let c=0;c<a;++c)n[c]=r[o+c];n.length=a}}return s}getCoordinates(){return ki(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new Ir(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,n=this.stride,s=[];for(let r=0,a=t.length;r<a;r+=n){const o=new Ir(t.slice(r,r+n),e);s.push(o)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,n=this.stride;for(let s=0,r=e.length;s<r;s+=n){const a=e[s],o=e[s+1];if(ec(t,a,o))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=$o(this.flatCoordinates,0,t,this.stride),this.changed()}}class Br extends Rn{constructor(t,e,n){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){const s=t,r=[],a=[];for(let o=0,l=s.length;o<l;++o){const h=s[o],c=r.length,u=h.getEnds();for(let f=0,_=u.length;f<_;++f)u[f]+=c;ri(r,h.getFlatCoordinates()),a.push(u)}e=s.length===0?this.getLayout():s[0].getLayout(),t=r,n=a}e!==void 0&&n?(this.setFlatCoordinates(e,t),this.endss_=n):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const n=this.flatCoordinates.length;ri(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,r=e.length;s<r;++s)e[s]+=n}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const n=new Br(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}closestPointXY(t,e,n,s){return s<Sn(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(f1(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),d1(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,s))}containsXY(t,e){return y1(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return u1(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),_h(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,gh(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=J0(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=kg(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new la(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Xg(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=_h(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],n=[];return e.length=m1(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new Br(e,"XY",n)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const r=this.endss_[t-1];e=r[r.length-1]}const n=this.endss_[t].slice(),s=n[n.length-1];if(e!==0)for(let r=0,a=n.length;r<a;++r)n[r]-=e;return new Si(this.flatCoordinates.slice(e,s),this.layout,n)}getPolygons(){const t=this.layout,e=this.flatCoordinates,n=this.endss_,s=[];let r=0;for(let a=0,o=n.length;a<o;++a){const l=n[a].slice(),h=l[l.length-1];if(r!==0)for(let u=0,f=l.length;u<f;++u)l[u]-=r;const c=new Si(e.slice(r,h),t,l);s.push(c),r=h}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return E1(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const n=Dg(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{const s=n[n.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}const Qf=Zt();class le{constructor(t,e,n,s,r,a){this.styleFunction,this.extent_,this.id_=a,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n||null,this.properties_=r,this.squaredTolerance_,this.stride_=s,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?pg(this.flatCoordinates_):ic(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const t=We(this.getExtent());this.flatInteriorPoints_=Tc(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const t=jg(this.flatCoordinates_,this.ends_),e=J0(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=kg(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=wo(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const t=this.flatCoordinates_;let e=0;const n=this.ends_;for(let s=0,r=n.length;s<r;++s){const a=n[s],o=wo(t,e,a,2,.5);ri(this.flatMidpoints_,o),e=a}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=lt(t);const e=t.getExtent(),n=t.getWorldExtent();if(e&&n){const s=It(n)/It(e);Ne(Qf,n[0],n[3],s,-s,0,0,0),Vi(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Qf,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new le(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=fg((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);const n=this.simplifiedGeometry_.getFlatCoordinates();let s;switch(this.type_){case"LineString":n.length=Wo(n,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,n,0),s=[n.length];break;case"MultiLineString":s=[],n.length=Gg(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,n,0,s);break;case"Polygon":s=[],n.length=vc(n,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),n,0,s);break}return s&&(this.simplifiedGeometry_=new le(this.type_,n,s,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}}le.prototype.getFlatCoordinates=le.prototype.getOrientedFlatCoordinates;class t_{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=rl,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let n=e.dataProjection?lt(e.dataProjection):this.readProjection(t);e.extent&&n&&n.getUnits()==="tile-pixels"&&(n=lt(n),n.setWorldExtent(e.extent)),e={dataProjection:n,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return tt()}readFeature(t,e){return tt()}readFeatures(t,e){return tt()}readGeometry(t,e){return tt()}readProjection(t){return tt()}writeFeature(t,e){return tt()}writeFeatures(t,e){return tt()}writeGeometry(t,e){return tt()}}function al(i,t,e){const n=e?lt(e.featureProjection):null,s=e?lt(e.dataProjection):null;let r=i;if(n&&s&&!Ge(n,s)){t&&(r=i.clone());const a=t?n:s,o=t?s:n;a.getUnits()==="tile-pixels"?r.transform(a,o):r.applyTransform(ws(a,o))}if(t&&e&&e.decimals!==void 0){const a=Math.pow(10,e.decimals),o=function(l){for(let h=0,c=l.length;h<c;++h)l[h]=Math.round(l[h]*a)/a;return l};r===i&&(r=i.clone()),r.applyTransform(o)}return r}const lv={Point:Ir,LineString:vn,Polygon:Si,MultiPoint:la,MultiLineString:Ur,MultiPolygon:Br};function hv(i,t,e){return Array.isArray(t[0])?(Xg(i,0,t,e)||(i=i.slice(),_h(i,0,t,e)),i):(Rc(i,0,t,e)||(i=i.slice(),fo(i,0,t,e)),i)}function e_(i,t){const e=i.geometry;if(!e)return[];if(Array.isArray(e))return e.map(r=>e_({...i,geometry:r})).flat();const n=e.type==="MultiPolygon"?"Polygon":e.type;if(n==="GeometryCollection"||n==="Circle")throw new Error("Unsupported geometry type: "+n);const s=e.layout.length;return al(new le(n,n==="Polygon"?hv(e.flatCoordinates,e.ends,s):e.flatCoordinates,e.ends?.flat(),s,i.properties||{},i.id).enableSimplifyTransformed(),!1,t)}function lu(i,t){if(!i)return null;if(Array.isArray(i)){const n=i.map(s=>lu(s,t));return new To(n)}const e=lv[i.type];return al(new e(i.flatCoordinates,i.layout||"XY",i.ends),!1,t)}class cv extends t_{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Pa(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Pa(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return tt()}readFeaturesFromObject(t,e){return tt()}readGeometry(t,e){return this.readGeometryFromObject(Pa(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return tt()}readProjection(t){return this.readProjectionFromObject(Pa(t))}readProjectionFromObject(t){return tt()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return tt()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return tt()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return tt()}}function Pa(i){if(typeof i=="string"){const t=JSON.parse(i);return t||null}return i!==null?i:null}class uv extends cv{constructor(t){t=t||{},super(),this.dataProjection=lt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=lt(t.featureProjection)),t.featureClass&&(this.featureClass=t.featureClass),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};const s=hu(n.geometry);if(this.featureClass===le)return e_({geometry:s,id:n.id,properties:n.properties},e);const r=new rl;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&n.geometry_name&&r.setGeometryName(n.geometry_name),r.setGeometry(lu(s,e)),"id"in n&&r.setId(n.id),n.properties&&r.setProperties(n.properties,!0),r}readFeaturesFromObject(t,e){const n=t;let s=null;if(n.type==="FeatureCollection"){const r=t;s=[];const a=r.features;for(let o=0,l=a.length;o<l;++o){const h=this.readFeatureFromObject(a[o],e);h&&s.push(h)}}else s=[this.readFeatureFromObject(t,e)];return s.flat()}readGeometryFromObject(t,e){return fv(t,e)}readProjectionFromObject(t){const e=t.crs;let n;if(e)if(e.type=="name")n=lt(e.properties.name);else if(e.type==="EPSG")n=lt("EPSG:"+e.properties.code);else throw new Error("Unknown SRS type");else n=this.dataProjection;return n}writeFeatureObject(t,e){e=this.adaptOptions(e);const n={type:"Feature",geometry:null,properties:null},s=t.getId();if(s!==void 0&&(n.id=s),!t.hasProperties())return n;const r=t.getProperties(),a=t.getGeometry();return a&&(n.geometry=Ah(a,e),delete r[t.getGeometryName()]),qi(r)||(n.properties=r),n}writeFeaturesObject(t,e){e=this.adaptOptions(e);const n=[];for(let s=0,r=t.length;s<r;++s)n.push(this.writeFeatureObject(t[s],e));return{type:"FeatureCollection",features:n}}writeGeometryObject(t,e){return Ah(t,this.adaptOptions(e))}}function hu(i,t){if(!i)return null;let e;switch(i.type){case"Point":{e=gv(i);break}case"LineString":{e=_v(i);break}case"Polygon":{e=xv(i);break}case"MultiPoint":{e=pv(i);break}case"MultiLineString":{e=mv(i);break}case"MultiPolygon":{e=yv(i);break}case"GeometryCollection":{e=dv(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return e}function fv(i,t){const e=hu(i);return lu(e,t)}function dv(i,t){return i.geometries.map(function(n){return hu(n)})}function gv(i){const t=i.coordinates;return{type:"Point",flatCoordinates:t,layout:Mn(t.length)}}function _v(i){const t=i.coordinates,e=t.flat();return{type:"LineString",flatCoordinates:e,ends:[e.length],layout:Mn(t[0]?.length||2)}}function mv(i){const t=i.coordinates,e=t[0]?.[0]?.length||2,n=[],s=Zr(n,0,t,e);return{type:"MultiLineString",flatCoordinates:n,ends:s,layout:Mn(e)}}function pv(i){const t=i.coordinates;return{type:"MultiPoint",flatCoordinates:t.flat(),layout:Mn(t[0]?.length||2)}}function yv(i){const t=i.coordinates,e=[],n=t[0]?.[0]?.[0].length||2,s=Dg(e,0,t,n);return{type:"MultiPolygon",flatCoordinates:e,ends:s,layout:Mn(n)}}function xv(i){const t=i.coordinates,e=[],n=t[0]?.[0]?.length,s=Zr(e,0,t,n);return{type:"Polygon",flatCoordinates:e,ends:s,layout:Mn(n)}}function Ah(i,t){i=al(i,!0,t);const e=i.getType();let n;switch(e){case"Point":{n=Rv(i);break}case"LineString":{n=vv(i);break}case"Polygon":{n=Mv(i,t);break}case"MultiPoint":{n=Tv(i);break}case"MultiLineString":{n=wv(i);break}case"MultiPolygon":{n=Sv(i,t);break}case"GeometryCollection":{n=Ev(i,t);break}case"Circle":{n={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return n}function Ev(i,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:i.getGeometriesArray().map(function(n){return Ah(n,t)})}}function vv(i,t){return{type:"LineString",coordinates:i.getCoordinates()}}function wv(i,t){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function Tv(i,t){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function Sv(i,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(e)}}function Rv(i,t){return{type:"Point",coordinates:i.getCoordinates()}}function Mv(i,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(e)}}function Qt(i){return(t,...e)=>Cv(i,t,e)}function Ns(i,t){return Qt(i_(i,t).get)}const{apply:Cv,getOwnPropertyDescriptor:i_,getPrototypeOf:cu,ownKeys:bv}=Reflect,{iterator:ha,toStringTag:Iv}=Symbol,Av=Object,{create:uu,defineProperty:Pv}=Av,Lv=Array,Ov=Lv.prototype,n_=Ov[ha],Fv=Qt(n_),s_=ArrayBuffer,Dv=s_.prototype;Ns(Dv,"byteLength");const Jf=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;Jf&&Ns(Jf.prototype,"byteLength");const r_=cu(Uint8Array);r_.from;const ue=r_.prototype;ue[ha];Qt(ue.keys);Qt(ue.values);Qt(ue.entries);Qt(ue.set);Qt(ue.reverse);Qt(ue.fill);Qt(ue.copyWithin);Qt(ue.sort);Qt(ue.slice);Qt(ue.subarray);Ns(ue,"buffer");Ns(ue,"byteOffset");Ns(ue,"length");Ns(ue,Iv);const Gv=Uint8Array,a_=Uint16Array,fu=Uint32Array,Nv=Float32Array,zr=cu([][ha]()),o_=Qt(zr.next),kv=Qt(function*(){}().next),Uv=cu(zr),Bv=DataView.prototype,zv=Qt(Bv.getUint16),du=WeakMap,l_=du.prototype,h_=Qt(l_.get),Xv=Qt(l_.set),c_=new du,jv=uu(null,{next:{value:function(){const t=h_(c_,this);return o_(t)}},[ha]:{value:function(){return this}}});function Vv(i){if(i[ha]===n_&&zr.next===o_)return i;const t=uu(jv);return Xv(c_,t,Fv(i)),t}const $v=new du,Wv=uu(Uv,{next:{value:function(){const t=h_($v,this);return kv(t)},writable:!0,configurable:!0}});for(const i of bv(zr))i!=="next"&&Pv(Wv,i,i_(zr,i));const u_=new s_(4),qv=new Nv(u_),Kv=new fu(u_),Ze=new a_(512),Qe=new Gv(512);for(let i=0;i<256;++i){const t=i-127;t<-24?(Ze[i]=0,Ze[i|256]=32768,Qe[i]=24,Qe[i|256]=24):t<-14?(Ze[i]=1024>>-t-14,Ze[i|256]=1024>>-t-14|32768,Qe[i]=-t-1,Qe[i|256]=-t-1):t<=15?(Ze[i]=t+15<<10,Ze[i|256]=t+15<<10|32768,Qe[i]=13,Qe[i|256]=13):t<128?(Ze[i]=31744,Ze[i|256]=64512,Qe[i]=24,Qe[i|256]=24):(Ze[i]=31744,Ze[i|256]=64512,Qe[i]=13,Qe[i|256]=13)}const gu=new fu(2048);for(let i=1;i<1024;++i){let t=i<<13,e=0;for(;(t&8388608)===0;)t<<=1,e-=8388608;t&=-8388609,e+=947912704,gu[i]=t|e}for(let i=1024;i<2048;++i)gu[i]=939524096+(i-1024<<13);const ks=new fu(64);for(let i=1;i<31;++i)ks[i]=i<<23;ks[31]=1199570944;ks[32]=2147483648;for(let i=33;i<63;++i)ks[i]=2147483648+(i-32<<23);ks[63]=3347054592;const f_=new a_(64);for(let i=1;i<64;++i)i!==32&&(f_[i]=1024);function Hv(i){const t=i>>10;return Kv[0]=gu[f_[t]+(i&1023)]+ks[t],qv[0]}function d_(i,t,...e){return Hv(zv(i,t,...Vv(e)))}var td=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ol(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var La={exports:{}},ed;function Yv(){if(ed)return La.exports;ed=1;function i(t,e,n){const s=n&&n.debug||!1;s&&console.log("[xml-utils] getting "+e+" in "+t);const r=typeof t=="object"?t.outer:t,a=r.slice(0,r.indexOf(">")+1),o=['"',"'"];for(let l=0;l<o.length;l++){const h=o[l],c=e+"\\="+h+"([^"+h+"]*)"+h;s&&console.log("[xml-utils] pattern:",c);const f=new RegExp(c).exec(a);if(s&&console.log("[xml-utils] match:",f),f)return f[1]}}return La.exports=i,La.exports.default=i,La.exports}var Zv=Yv();const Xl=ol(Zv);var Oa={exports:{}},Fa={exports:{}},Da={exports:{}},id;function Qv(){if(id)return Da.exports;id=1;function i(t,e,n){const r=new RegExp(e).exec(t.slice(n));return r?n+r.index:-1}return Da.exports=i,Da.exports.default=i,Da.exports}var Ga={exports:{}},nd;function Jv(){if(nd)return Ga.exports;nd=1;function i(t,e,n){const r=new RegExp(e).exec(t.slice(n));return r?n+r.index+r[0].length-1:-1}return Ga.exports=i,Ga.exports.default=i,Ga.exports}var Na={exports:{}},sd;function t2(){if(sd)return Na.exports;sd=1;function i(t,e){const n=new RegExp(e,"g"),s=t.match(n);return s?s.length:0}return Na.exports=i,Na.exports.default=i,Na.exports}var rd;function e2(){if(rd)return Fa.exports;rd=1;const i=Qv(),t=Jv(),e=t2();function n(s,r,a){const o=a&&a.debug||!1,l=!(a&&typeof a.nested===!1),h=a&&a.startIndex||0;o&&console.log("[xml-utils] starting findTagByName with",r," and ",a);const c=i(s,`<${r}[ 
>/]`,h);if(o&&console.log("[xml-utils] start:",c),c===-1)return;const u=s.slice(c+r.length);let f=t(u,"^[^<]*[ /]>",0);const _=f!==-1&&u[f-1]==="/";if(o&&console.log("[xml-utils] selfClosing:",_),_===!1)if(l){let w=0,d=1,p=0;for(;(f=t(u,"[ /]"+r+">",w))!==-1;){const v=u.substring(w,f+1);if(d+=e(v,"<"+r+`[ 
	>]`),p+=e(v,"</"+r+">"),p>=d)break;w=f}}else f=t(u,"[ /]"+r+">",0);const g=c+r.length+f+1;if(o&&console.log("[xml-utils] end:",g),g===-1)return;const x=s.slice(c,g);let y;return _?y=null:y=x.slice(x.indexOf(">")+1,x.lastIndexOf("<")),{inner:y,outer:x,start:c,end:g}}return Fa.exports=n,Fa.exports.default=n,Fa.exports}var ad;function i2(){if(ad)return Oa.exports;ad=1;const i=e2();function t(e,n,s){const r=[],a=s&&s.debug||!1,o=s&&typeof s.nested=="boolean"?s.nested:!0;let l=s&&s.startIndex||0,h;for(;h=i(e,n,{debug:a,startIndex:l});)o?l=h.start+1+n.length:l=h.end,r.push(h);return a&&console.log("findTagsByName found",r.length,"tags"),r}return Oa.exports=t,Oa.exports.default=t,Oa.exports}var n2=i2();const s2=ol(n2),yr={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Je={};for(const i in yr)yr.hasOwnProperty(i)&&(Je[yr[i]]=parseInt(i,10));const r2=[Je.BitsPerSample,Je.ExtraSamples,Je.SampleFormat,Je.StripByteCounts,Je.StripOffsets,Je.StripRowCounts,Je.TileByteCounts,Je.TileOffsets,Je.SubIFDs],jl={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},at={};for(const i in jl)jl.hasOwnProperty(i)&&(at[jl[i]]=parseInt(i,10));const fe={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},a2={Unspecified:0},ZA={AddCompression:1},QA={None:0,Deflate:1,Zstandard:2},o2={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function l2(i,t){const{width:e,height:n}=i,s=new Uint8Array(e*n*3);let r;for(let a=0,o=0;a<i.length;++a,o+=3)r=256-i[a]/t*256,s[o]=r,s[o+1]=r,s[o+2]=r;return s}function h2(i,t){const{width:e,height:n}=i,s=new Uint8Array(e*n*3);let r;for(let a=0,o=0;a<i.length;++a,o+=3)r=i[a]/t*256,s[o]=r,s[o+1]=r,s[o+2]=r;return s}function c2(i,t){const{width:e,height:n}=i,s=new Uint8Array(e*n*3),r=t.length/3,a=t.length/3*2;for(let o=0,l=0;o<i.length;++o,l+=3){const h=i[o];s[l]=t[h]/65536*256,s[l+1]=t[h+r]/65536*256,s[l+2]=t[h+a]/65536*256}return s}function u2(i){const{width:t,height:e}=i,n=new Uint8Array(t*e*3);for(let s=0,r=0;s<i.length;s+=4,r+=3){const a=i[s],o=i[s+1],l=i[s+2],h=i[s+3];n[r]=255*((255-a)/256)*((255-h)/256),n[r+1]=255*((255-o)/256)*((255-h)/256),n[r+2]=255*((255-l)/256)*((255-h)/256)}return n}function f2(i){const{width:t,height:e}=i,n=new Uint8ClampedArray(t*e*3);for(let s=0,r=0;s<i.length;s+=3,r+=3){const a=i[s],o=i[s+1],l=i[s+2];n[r]=a+1.402*(l-128),n[r+1]=a-.34414*(o-128)-.71414*(l-128),n[r+2]=a+1.772*(o-128)}return n}const d2=.95047,g2=1,_2=1.08883;function m2(i){const{width:t,height:e}=i,n=new Uint8Array(t*e*3);for(let s=0,r=0;s<i.length;s+=3,r+=3){const a=i[s+0],o=i[s+1]<<24>>24,l=i[s+2]<<24>>24;let h=(a+16)/116,c=o/500+h,u=h-l/200,f,_,g;c=d2*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),h=g2*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),u=_2*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),f=c*3.2406+h*-1.5372+u*-.4986,_=c*-.9689+h*1.8758+u*.0415,g=c*.0557+h*-.204+u*1.057,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,_=_>.0031308?1.055*_**(1/2.4)-.055:12.92*_,g=g>.0031308?1.055*g**(1/2.4)-.055:12.92*g,n[r]=Math.max(0,Math.min(1,f))*255,n[r+1]=Math.max(0,Math.min(1,_))*255,n[r+2]=Math.max(0,Math.min(1,g))*255}return n}const g_=new Map;function en(i,t){Array.isArray(i)||(i=[i]),i.forEach(e=>g_.set(e,t))}async function __(i){const t=g_.get(i.Compression);if(!t)throw new Error(`Unknown compression method identifier: ${i.Compression}`);const e=await t();return new e(i)}en([void 0,1],()=>Qi(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1]),import.meta.url).then(i=>i.default));en(5,()=>Qi(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1]),import.meta.url).then(i=>i.default));en(6,()=>{throw new Error("old style JPEG compression is not supported.")});en(7,()=>Qi(()=>import("./jpeg-CKYXsxFN.js"),__vite__mapDeps([3,1]),import.meta.url).then(i=>i.default));en([8,32946],()=>Qi(()=>import("./deflate-B9JhHpvg.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(i=>i.default));en(32773,()=>Qi(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1]),import.meta.url).then(i=>i.default));en(34887,()=>Qi(()=>import("./lerc-BiJm_dO3.js"),__vite__mapDeps([7,5,1,8,9,10,11]),import.meta.url).then(async i=>(await i.zstd.init(),i)).then(i=>i.default));en(50001,()=>Qi(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([12,1]),import.meta.url).then(i=>i.default));function ll(i,t,e,n=1){return new(Object.getPrototypeOf(i)).constructor(t*e*n)}function p2(i,t,e,n,s){const r=t/n,a=e/s;return i.map(o=>{const l=ll(o,n,s);for(let h=0;h<s;++h){const c=Math.min(Math.round(a*h),e-1);for(let u=0;u<n;++u){const f=Math.min(Math.round(r*u),t-1),_=o[c*t+f];l[h*n+u]=_}}return l})}function ms(i,t,e){return(1-e)*i+e*t}function y2(i,t,e,n,s){const r=t/n,a=e/s;return i.map(o=>{const l=ll(o,n,s);for(let h=0;h<s;++h){const c=a*h,u=Math.floor(c),f=Math.min(Math.ceil(c),e-1);for(let _=0;_<n;++_){const g=r*_,x=g%1,y=Math.floor(g),w=Math.min(Math.ceil(g),t-1),d=o[u*t+y],p=o[u*t+w],v=o[f*t+y],T=o[f*t+w],R=ms(ms(d,p,x),ms(v,T,x),c%1);l[h*n+_]=R}}return l})}function x2(i,t,e,n,s,r="nearest"){switch(r.toLowerCase()){case"nearest":return p2(i,t,e,n,s);case"bilinear":case"linear":return y2(i,t,e,n,s);default:throw new Error(`Unsupported resampling method: '${r}'`)}}function E2(i,t,e,n,s,r){const a=t/n,o=e/s,l=ll(i,n,s,r);for(let h=0;h<s;++h){const c=Math.min(Math.round(o*h),e-1);for(let u=0;u<n;++u){const f=Math.min(Math.round(a*u),t-1);for(let _=0;_<r;++_){const g=i[c*t*r+f*r+_];l[h*n*r+u*r+_]=g}}}return l}function v2(i,t,e,n,s,r){const a=t/n,o=e/s,l=ll(i,n,s,r);for(let h=0;h<s;++h){const c=o*h,u=Math.floor(c),f=Math.min(Math.ceil(c),e-1);for(let _=0;_<n;++_){const g=a*_,x=g%1,y=Math.floor(g),w=Math.min(Math.ceil(g),t-1);for(let d=0;d<r;++d){const p=i[u*t*r+y*r+d],v=i[u*t*r+w*r+d],T=i[f*t*r+y*r+d],R=i[f*t*r+w*r+d],C=ms(ms(p,v,x),ms(T,R,x),c%1);l[h*n*r+_*r+d]=C}}}return l}function w2(i,t,e,n,s,r,a="nearest"){switch(a.toLowerCase()){case"nearest":return E2(i,t,e,n,s,r);case"bilinear":case"linear":return v2(i,t,e,n,s,r);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function T2(i,t,e){let n=0;for(let s=t;s<e;++s)n+=i[s];return n}function Ph(i,t,e){switch(i){case 1:if(t<=8)return new Uint8Array(e);if(t<=16)return new Uint16Array(e);if(t<=32)return new Uint32Array(e);break;case 2:if(t===8)return new Int8Array(e);if(t===16)return new Int16Array(e);if(t===32)return new Int32Array(e);break;case 3:switch(t){case 16:case 32:return new Float32Array(e);case 64:return new Float64Array(e)}break}throw Error("Unsupported data format/bitsPerSample")}function S2(i,t){return(i===1||i===2)&&t<=32&&t%8===0?!1:!(i===3&&(t===16||t===32||t===64))}function R2(i,t,e,n,s,r,a){const o=new DataView(i),l=e===2?a*r:a*r*n,h=e===2?1:n,c=Ph(t,s,l),u=parseInt("1".repeat(s),2);if(t===1){let f;e===1?f=n*s:f=s;let _=r*f;(_&7)!==0&&(_=_+7&-8);for(let g=0;g<a;++g){const x=g*_;for(let y=0;y<r;++y){const w=x+y*h*s;for(let d=0;d<h;++d){const p=w+d*s,v=(g*r+y)*h+d,T=Math.floor(p/8),R=p%8;if(R+s<=8)c[v]=o.getUint8(T)>>8-s-R&u;else if(R+s<=16)c[v]=o.getUint16(T)>>16-s-R&u;else if(R+s<=24){const C=o.getUint16(T)<<8|o.getUint8(T+2);c[v]=C>>24-s-R&u}else c[v]=o.getUint32(T)>>32-s-R&u}}}}return c.buffer}class m_{constructor(t,e,n,s,r,a){this.fileDirectory=t,this.geoKeys=e,this.dataView=n,this.littleEndian=s,this.tiles=r?{}:null,this.isTiled=!t.StripOffsets;const o=t.PlanarConfiguration;if(this.planarConfiguration=typeof o>"u"?1:o,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(t){return this.isTiled||(t+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-t*this.getTileHeight()}getBytesPerPixel(){let t=0;for(let e=0;e<this.fileDirectory.BitsPerSample.length;++e)t+=this.getSampleByteSize(e);return t}getSampleByteSize(t){if(t>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${t} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[t]/8)}getReaderForSample(t){const e=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1,n=this.fileDirectory.BitsPerSample[t];switch(e){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(s,r){return d_(this,s,r)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(t=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[t]:1}getBitsPerSample(t=0){return this.fileDirectory.BitsPerSample[t]}getArrayForSample(t,e){const n=this.getSampleFormat(t),s=this.getBitsPerSample(t);return Ph(n,s,e)}async getTileOrStrip(t,e,n,s,r){const a=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:h}=this;this.planarConfiguration===1?l=e*a+t:this.planarConfiguration===2&&(l=n*a*o+e*a+t);let c,u;this.isTiled?(c=this.fileDirectory.TileOffsets[l],u=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],u=this.fileDirectory.StripByteCounts[l]);const f=(await this.source.fetch([{offset:c,length:u}],r))[0];let _;return h===null||!h[l]?(_=(async()=>{let g=await s.decode(this.fileDirectory,f);const x=this.getSampleFormat(),y=this.getBitsPerSample();return S2(x,y)&&(g=R2(g,x,this.planarConfiguration,this.getSamplesPerPixel(),y,this.getTileWidth(),this.getBlockHeight(e))),g})(),h!==null&&(h[l]=_)):_=h[l],{x:t,y:e,sample:n,data:await _}}async _readRaster(t,e,n,s,r,a,o,l,h){const c=this.getTileWidth(),u=this.getTileHeight(),f=this.getWidth(),_=this.getHeight(),g=Math.max(Math.floor(t[0]/c),0),x=Math.min(Math.ceil(t[2]/c),Math.ceil(f/c)),y=Math.max(Math.floor(t[1]/u),0),w=Math.min(Math.ceil(t[3]/u),Math.ceil(_/u)),d=t[2]-t[0];let p=this.getBytesPerPixel();const v=[],T=[];for(let b=0;b<e.length;++b)this.planarConfiguration===1?v.push(T2(this.fileDirectory.BitsPerSample,0,e[b])/8):v.push(0),T.push(this.getReaderForSample(e[b]));const R=[],{littleEndian:C}=this;for(let b=y;b<w;++b)for(let I=g;I<x;++I){let P;this.planarConfiguration===1&&(P=this.getTileOrStrip(I,b,0,r,h));for(let G=0;G<e.length;++G){const O=G,m=e[G];this.planarConfiguration===2&&(p=this.getSampleByteSize(m),P=this.getTileOrStrip(I,b,m,r,h));const E=P.then(S=>{const M=S.data,A=new DataView(M),F=this.getBlockHeight(S.y),D=S.y*u,k=S.x*c,B=D+F,U=(S.x+1)*c,V=T[O],q=Math.min(F,F-(B-t[3]),_-D),W=Math.min(c,c-(U-t[2]),f-k);for(let H=Math.max(0,t[1]-D);H<q;++H)for(let et=Math.max(0,t[0]-k);et<W;++et){const mt=(H*c+et)*p,ht=V.call(A,mt+v[O],C);let dt;s?(dt=(H+D-t[1])*d*e.length+(et+k-t[0])*e.length+O,n[dt]=ht):(dt=(H+D-t[1])*d+et+k-t[0],n[O][dt]=ht)}});R.push(E)}}if(await Promise.all(R),a&&t[2]-t[0]!==a||o&&t[3]-t[1]!==o){let b;return s?b=w2(n,t[2]-t[0],t[3]-t[1],a,o,e.length,l):b=x2(n,t[2]-t[0],t[3]-t[1],a,o,l),b.width=a,b.height=o,b}return n.width=a||t[2]-t[0],n.height=o||t[3]-t[1],n}async readRasters({window:t,samples:e=[],interleave:n,pool:s=null,width:r,height:a,resampleMethod:o,fillValue:l,signal:h}={}){const c=t||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const u=c[2]-c[0],f=c[3]-c[1],_=u*f,g=this.getSamplesPerPixel();if(!e||!e.length)for(let d=0;d<g;++d)e.push(d);else for(let d=0;d<e.length;++d)if(e[d]>=g)return Promise.reject(new RangeError(`Invalid sample index '${e[d]}'.`));let x;if(n){const d=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,p=Math.max.apply(null,this.fileDirectory.BitsPerSample);x=Ph(d,p,_*e.length),l&&x.fill(l)}else{x=[];for(let d=0;d<e.length;++d){const p=this.getArrayForSample(e[d],_);Array.isArray(l)&&d<l.length?p.fill(l[d]):l&&!Array.isArray(l)&&p.fill(l),x.push(p)}}const y=s||await __(this.fileDirectory);return await this._readRaster(c,e,x,n,y,r,a,o,h)}async readRGB({window:t,interleave:e=!0,pool:n=null,width:s,height:r,resampleMethod:a,enableAlpha:o=!1,signal:l}={}){const h=t||[0,0,this.getWidth(),this.getHeight()];if(h[0]>h[2]||h[1]>h[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===fe.RGB){let w=[0,1,2];if(this.fileDirectory.ExtraSamples!==a2.Unspecified&&o){w=[];for(let d=0;d<this.fileDirectory.BitsPerSample.length;d+=1)w.push(d)}return this.readRasters({window:t,interleave:e,samples:w,pool:n,width:s,height:r,resampleMethod:a,signal:l})}let u;switch(c){case fe.WhiteIsZero:case fe.BlackIsZero:case fe.Palette:u=[0];break;case fe.CMYK:u=[0,1,2,3];break;case fe.YCbCr:case fe.CIELab:u=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const f={window:h,interleave:!0,samples:u,pool:n,width:s,height:r,resampleMethod:a,signal:l},{fileDirectory:_}=this,g=await this.readRasters(f),x=2**this.fileDirectory.BitsPerSample[0];let y;switch(c){case fe.WhiteIsZero:y=l2(g,x);break;case fe.BlackIsZero:y=h2(g,x);break;case fe.Palette:y=c2(g,_.ColorMap);break;case fe.CMYK:y=u2(g);break;case fe.YCbCr:y=f2(g);break;case fe.CIELab:y=m2(g);break;default:throw new Error("Unsupported photometric interpretation.")}if(!e){const w=new Uint8Array(y.length/3),d=new Uint8Array(y.length/3),p=new Uint8Array(y.length/3);for(let v=0,T=0;v<y.length;v+=3,++T)w[T]=y[v],d[T]=y[v+1],p[T]=y[v+2];y=[w,d,p]}return y.width=g.width,y.height=g.height,y}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const t=[];for(let e=0;e<this.fileDirectory.ModelTiepoint.length;e+=6)t.push({i:this.fileDirectory.ModelTiepoint[e],j:this.fileDirectory.ModelTiepoint[e+1],k:this.fileDirectory.ModelTiepoint[e+2],x:this.fileDirectory.ModelTiepoint[e+3],y:this.fileDirectory.ModelTiepoint[e+4],z:this.fileDirectory.ModelTiepoint[e+5]});return t}getGDALMetadata(t=null){const e={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let s=s2(n,"Item");t===null?s=s.filter(r=>Xl(r,"sample")===void 0):s=s.filter(r=>Number(Xl(r,"sample"))===t);for(let r=0;r<s.length;++r){const a=s[r];e[Xl(a,"name")]=a.inner}return e}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const t=this.fileDirectory.GDAL_NODATA;return Number(t.substring(0,t.length-1))}getOrigin(){const t=this.fileDirectory.ModelTiepoint,e=this.fileDirectory.ModelTransformation;if(t&&t.length===6)return[t[3],t[4],t[5]];if(e)return[e[3],e[7],e[11]];throw new Error("The image does not have an affine transformation.")}getResolution(t=null){const e=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(e)return[e[0],-e[1],e[2]];if(n)return n[1]===0&&n[4]===0?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(t){const[s,r,a]=t.getResolution();return[s*t.getWidth()/this.getWidth(),r*t.getHeight()/this.getHeight(),a*t.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(t=!1){const e=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!t){const[s,r,a,o,l,h,c,u]=this.fileDirectory.ModelTransformation,_=[[0,0],[0,e],[n,0],[n,e]].map(([y,w])=>[o+s*y+r*w,u+l*y+h*w]),g=_.map(y=>y[0]),x=_.map(y=>y[1]);return[Math.min(...g),Math.min(...x),Math.max(...g),Math.max(...x)]}else{const s=this.getOrigin(),r=this.getResolution(),a=s[0],o=s[1],l=a+r[0]*n,h=o+r[1]*e;return[Math.min(a,l),Math.min(o,h),Math.max(a,l),Math.max(o,h)]}}}class M2{constructor(t){this._dataView=new DataView(t)}get buffer(){return this._dataView.buffer}getUint64(t,e){const n=this.getUint32(t,e),s=this.getUint32(t+4,e);let r;if(e){if(r=n+2**32*s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}if(r=2**32*n+s,!Number.isSafeInteger(r))throw new Error(`${r} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return r}getInt64(t,e){let n=0;const s=(this._dataView.getUint8(t+(e?7:0))&128)>0;let r=!0;for(let a=0;a<8;a++){let o=this._dataView.getUint8(t+(e?a:7-a));s&&(r?o!==0&&(o=~(o-1)&255,r=!1):o=~o&255),n+=o*256**a}return s&&(n=-n),n}getUint8(t,e){return this._dataView.getUint8(t,e)}getInt8(t,e){return this._dataView.getInt8(t,e)}getUint16(t,e){return this._dataView.getUint16(t,e)}getInt16(t,e){return this._dataView.getInt16(t,e)}getUint32(t,e){return this._dataView.getUint32(t,e)}getInt32(t,e){return this._dataView.getInt32(t,e)}getFloat16(t,e){return d_(this._dataView,t,e)}getFloat32(t,e){return this._dataView.getFloat32(t,e)}getFloat64(t,e){return this._dataView.getFloat64(t,e)}}class C2{constructor(t,e,n,s){this._dataView=new DataView(t),this._sliceOffset=e,this._littleEndian=n,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(t,e){return this.sliceOffset<=t&&this.sliceTop>=t+e}readUint8(t){return this._dataView.getUint8(t-this._sliceOffset,this._littleEndian)}readInt8(t){return this._dataView.getInt8(t-this._sliceOffset,this._littleEndian)}readUint16(t){return this._dataView.getUint16(t-this._sliceOffset,this._littleEndian)}readInt16(t){return this._dataView.getInt16(t-this._sliceOffset,this._littleEndian)}readUint32(t){return this._dataView.getUint32(t-this._sliceOffset,this._littleEndian)}readInt32(t){return this._dataView.getInt32(t-this._sliceOffset,this._littleEndian)}readFloat32(t){return this._dataView.getFloat32(t-this._sliceOffset,this._littleEndian)}readFloat64(t){return this._dataView.getFloat64(t-this._sliceOffset,this._littleEndian)}readUint64(t){const e=this.readUint32(t),n=this.readUint32(t+4);let s;if(this._littleEndian){if(s=e+2**32*n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*e+n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}readInt64(t){let e=0;const n=(this._dataView.getUint8(t+(this._littleEndian?7:0))&128)>0;let s=!0;for(let r=0;r<8;r++){let a=this._dataView.getUint8(t+(this._littleEndian?r:7-r));n&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),e+=a*256**r}return n&&(e=-e),e}readOffset(t){return this._bigTiff?this.readUint64(t):this.readUint32(t)}}const b2=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class I2{constructor(t=b2,e){this.workers=null,this._awaitingDecoder=null,this.size=t,this.messageId=0,t&&(this._awaitingDecoder=e?Promise.resolve(e):new Promise(n=>{Qi(()=>import("./decoder-tqM1uIvc.js"),[],import.meta.url).then(s=>{n(s.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let s=0;s<t;s++)this.workers.push({worker:n(),idle:!0})}))}async decode(t,e){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?__(t).then(n=>n.decode(t,e)):new Promise(n=>{const s=this.workers.find(o=>o.idle)||this.workers[Math.floor(Math.random()*this.size)];s.idle=!1;const r=this.messageId++,a=o=>{o.data.id===r&&(s.idle=!0,n(o.data.decoded),s.worker.removeEventListener("message",a))};s.worker.addEventListener("message",a),s.worker.postMessage({fileDirectory:t,buffer:e,id:r},[e])})}destroy(){this.workers&&(this.workers.forEach(t=>{t.worker.terminate()}),this.workers=null)}}const od=`\r
\r
`;function p_(i){if(typeof Object.fromEntries<"u")return Object.fromEntries(i);const t={};for(const[e,n]of i)t[e.toLowerCase()]=n;return t}function A2(i){const t=i.split(`\r
`).map(e=>{const n=e.split(":").map(s=>s.trim());return n[0]=n[0].toLowerCase(),n});return p_(t)}function P2(i){const[t,...e]=i.split(";").map(s=>s.trim()),n=e.map(s=>s.split("="));return{type:t,params:p_(n)}}function Lh(i){let t,e,n;return i&&([,t,e,n]=i.match(/bytes (\d+)-(\d+)\/(\d+)/),t=parseInt(t,10),e=parseInt(e,10),n=parseInt(n,10)),{start:t,end:e,total:n}}function L2(i,t){let e=null;const n=new TextDecoder("ascii"),s=[],r=`--${t}`,a=`${r}--`;for(let o=0;o<10;++o)n.decode(new Uint8Array(i,o,r.length))===r&&(e=o);if(e===null)throw new Error("Could not find initial boundary");for(;e<i.byteLength;){const o=n.decode(new Uint8Array(i,e,Math.min(r.length+1024,i.byteLength-e)));if(o.length===0||o.startsWith(a))break;if(!o.startsWith(r))throw new Error("Part does not start with boundary");const l=o.substr(r.length+2);if(l.length===0)break;const h=l.indexOf(od),c=A2(l.substr(0,h)),{start:u,end:f,total:_}=Lh(c["content-range"]),g=e+r.length+h+od.length,x=parseInt(f,10)+1-parseInt(u,10);s.push({headers:c,data:i.slice(g,g+x),offset:u,length:x,fileSize:_}),e=g+x+4}return s}class _u{async fetch(t,e=void 0){return Promise.all(t.map(n=>this.fetchSlice(n,e)))}async fetchSlice(t){throw new Error(`fetching of slice ${t} not possible, not implemented`)}get fileSize(){return null}async close(){}}class O2 extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof t.maxAge=="number"&&t.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if(typeof this.onEviction=="function")for(const[e,n]of t)this.onEviction(e,n.value)}_deleteIfExpired(t,e){return typeof e.expiry=="number"&&e.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(t,e.value),this.delete(t)):!1}_getOrDeleteIfExpired(t,e){if(this._deleteIfExpired(t,e)===!1)return e.value}_getItemValue(t,e){return e.expiry?this._getOrDeleteIfExpired(t,e):e.value}_peek(t,e){const n=e.get(t);return this._getItemValue(t,n)}_set(t,e){this.cache.set(t,e),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,e){this.oldCache.delete(t),this._set(t,e)}*_entriesAscending(){for(const t of this.oldCache){const[e,n]=t;this.cache.has(e)||this._deleteIfExpired(e,n)===!1&&(yield t)}for(const t of this.cache){const[e,n]=t;this._deleteIfExpired(e,n)===!1&&(yield t)}}get(t){if(this.cache.has(t)){const e=this.cache.get(t);return this._getItemValue(t,e)}if(this.oldCache.has(t)){const e=this.oldCache.get(t);if(this._deleteIfExpired(t,e)===!1)return this._moveToRecent(t,e),e.value}}set(t,e,{maxAge:n=this.maxAge}={}){const s=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(t)?this.cache.set(t,{value:e,expiry:s}):this._set(t,{value:e,expiry:s}),this}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):this.oldCache.has(t)?!this._deleteIfExpired(t,this.oldCache.get(t)):!1}peek(t){if(this.cache.has(t))return this._peek(t,this.cache);if(this.oldCache.has(t))return this._peek(t,this.oldCache)}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this._entriesAscending()],n=e.length-t;n<0?(this.cache=new Map(e),this.oldCache=new Map,this._size=e.length):(n>0&&this._emitEvictions(e.slice(0,n)),this.oldCache=new Map(e.slice(n)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[e,n]=t;this._deleteIfExpired(e,n)===!1&&(yield[e,n.value])}for(const t of this.oldCache){const[e,n]=t;this.cache.has(e)||this._deleteIfExpired(e,n)===!1&&(yield[e,n.value])}}*entriesDescending(){let t=[...this.cache];for(let e=t.length-1;e>=0;--e){const n=t[e],[s,r]=n;this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}t=[...this.oldCache];for(let e=t.length-1;e>=0;--e){const n=t[e],[s,r]=n;this.cache.has(s)||this._deleteIfExpired(s,r)===!1&&(yield[s,r.value])}}*entriesAscending(){for(const[t,e]of this._entriesAscending())yield[t,e.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const e of this.oldCache.keys())this.cache.has(e)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[n,s]of this.entriesAscending())t.call(e,s,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function F2(i){return new Promise(t=>setTimeout(t,i))}function D2(i,t){const e=Array.isArray(i)?i:Array.from(i),n=Array.isArray(t)?t:Array.from(t);return e.map((s,r)=>[s,n[r]])}class bs extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,bs),this.name="AbortError"}}class G2 extends Error{constructor(t,e){super(e),this.errors=t,this.message=e,this.name="AggregateError"}}const N2=G2;class k2{constructor(t,e,n=null){this.offset=t,this.length=e,this.data=n}get top(){return this.offset+this.length}}class ld{constructor(t,e,n){this.offset=t,this.length=e,this.blockIds=n}}class U2 extends _u{constructor(t,{blockSize:e=65536,cacheSize:n=100}={}){super(),this.source=t,this.blockSize=e,this.blockCache=new O2({maxSize:n,onEviction:(s,r)=>{this.evictedBlocks.set(s,r)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(t,e){const n=[],s=[],r=[];this.evictedBlocks.clear();for(const{offset:f,length:_}of t){let g=f+_;const{fileSize:x}=this;x!==null&&(g=Math.min(g,x));const y=Math.floor(f/this.blockSize)*this.blockSize;for(let w=y;w<g;w+=this.blockSize){const d=Math.floor(w/this.blockSize);!this.blockCache.has(d)&&!this.blockRequests.has(d)&&(this.blockIdsToFetch.add(d),s.push(d)),this.blockRequests.has(d)&&n.push(this.blockRequests.get(d)),r.push(d)}}await F2(),this.fetchBlocks(e);const a=[];for(const f of s)this.blockRequests.has(f)&&a.push(this.blockRequests.get(f));await Promise.allSettled(n),await Promise.allSettled(a);const o=[],l=r.filter(f=>this.abortedBlockIds.has(f)||!this.blockCache.has(f));if(l.forEach(f=>this.blockIdsToFetch.add(f)),l.length>0&&e&&!e.aborted){this.fetchBlocks(null);for(const f of l){const _=this.blockRequests.get(f);if(!_)throw new Error(`Block ${f} is not in the block requests`);o.push(_)}await Promise.allSettled(o)}if(e&&e.aborted)throw new bs("Request was aborted");const h=r.map(f=>this.blockCache.get(f)||this.evictedBlocks.get(f)),c=h.filter(f=>!f);if(c.length)throw new N2(c,"Request failed");const u=new Map(D2(r,h));return this.readSliceData(t,u)}fetchBlocks(t){if(this.blockIdsToFetch.size>0){const e=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(e,t);for(let s=0;s<e.length;++s){const r=e[s];for(const a of r.blockIds)this.blockRequests.set(a,(async()=>{try{const o=(await n)[s],l=a*this.blockSize,h=l-o.offset,c=Math.min(h+this.blockSize,o.data.byteLength),u=o.data.slice(h,c),f=new k2(l,u.byteLength,u,a);this.blockCache.set(a,f),this.abortedBlockIds.delete(a)}catch(o){if(o.name==="AbortError")o.signal=t,this.blockCache.delete(a),this.abortedBlockIds.add(a);else throw o}finally{this.blockRequests.delete(a)}})())}this.blockIdsToFetch.clear()}}groupBlocks(t){const e=Array.from(t).sort((a,o)=>a-o);if(e.length===0)return[];let n=[],s=null;const r=[];for(const a of e)s===null||s+1===a?(n.push(a),s=a):(r.push(new ld(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[a],s=a);return r.push(new ld(n[0]*this.blockSize,n.length*this.blockSize,n)),r}readSliceData(t,e){return t.map(n=>{let s=n.offset+n.length;this.fileSize!==null&&(s=Math.min(this.fileSize,s));const r=Math.floor(n.offset/this.blockSize),a=Math.floor(s/this.blockSize),o=new ArrayBuffer(n.length),l=new Uint8Array(o);for(let h=r;h<=a;++h){const c=e.get(h),u=c.offset-n.offset,f=c.top-s;let _=0,g=0,x;u<0?_=-u:u>0&&(g=u),f<0?x=c.length-_:x=s-c.offset-_;const y=new Uint8Array(c.data,_,x);l.set(y,g)}return o})}}class mu{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(t){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class pu{constructor(t){this.url=t}async request({headers:t,signal:e}={}){throw new Error("request is not implemented")}}class B2 extends mu{constructor(t){super(),this.response=t}get status(){return this.response.status}getHeader(t){return this.response.headers.get(t)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class z2 extends pu{constructor(t,e){super(t),this.credentials=e}async request({headers:t,signal:e}={}){const n=await fetch(this.url,{headers:t,credentials:this.credentials,signal:e});return new B2(n)}}class X2 extends mu{constructor(t,e){super(),this.xhr=t,this.data=e}get status(){return this.xhr.status}getHeader(t){return this.xhr.getResponseHeader(t)}async getData(){return this.data}}class j2 extends pu{constructRequest(t,e){return new Promise((n,s)=>{const r=new XMLHttpRequest;r.open("GET",this.url),r.responseType="arraybuffer";for(const[a,o]of Object.entries(t))r.setRequestHeader(a,o);r.onload=()=>{const a=r.response;n(new X2(r,a))},r.onerror=s,r.onabort=()=>s(new bs("Request aborted")),r.send(),e&&(e.aborted&&r.abort(),e.addEventListener("abort",()=>r.abort()))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}const Vl={};class V2 extends mu{constructor(t,e){super(),this.response=t,this.dataPromise=e}get status(){return this.response.statusCode}getHeader(t){return this.response.headers[t]}async getData(){return await this.dataPromise}}class $2 extends pu{constructor(t){super(t),this.parsedUrl=Vl.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Vl)}constructRequest(t,e){return new Promise((n,s)=>{const r=this.httpApi.get({...this.parsedUrl,headers:t},a=>{const o=new Promise(l=>{const h=[];a.on("data",c=>{h.push(c)}),a.on("end",()=>{const c=Buffer.concat(h).buffer;l(c)}),a.on("error",s)});n(new V2(a,o))});r.on("error",s),e&&(e.aborted&&r.destroy(new bs("Request aborted")),e.addEventListener("abort",()=>r.destroy(new bs("Request aborted"))))})}async request({headers:t,signal:e}={}){return await this.constructRequest(t,e)}}class yu extends _u{constructor(t,e,n,s){super(),this.client=t,this.headers=e,this.maxRanges=n,this.allowFullFile=s,this._fileSize=null}async fetch(t,e){return this.maxRanges>=t.length?this.fetchSlices(t,e):(this.maxRanges>0&&t.length>1,Promise.all(t.map(n=>this.fetchSlice(n,e))))}async fetchSlices(t,e){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${t.map(({offset:s,length:r})=>`${s}-${s+r}`).join(",")}`},signal:e});if(n.ok)if(n.status===206){const{type:s,params:r}=P2(n.getHeader("content-type"));if(s==="multipart/byteranges"){const u=L2(await n.getData(),r.boundary);return this._fileSize=u[0].fileSize||null,u}const a=await n.getData(),{start:o,end:l,total:h}=Lh(n.getHeader("content-range"));this._fileSize=h||null;const c=[{data:a,offset:o,length:l-o}];if(t.length>1){const u=await Promise.all(t.slice(1).map(f=>this.fetchSlice(f,e)));return c.concat(u)}return c}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const s=await n.getData();return this._fileSize=s.byteLength,[{data:s,offset:0,length:s.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(t,e){const{offset:n,length:s}=t,r=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+s}`},signal:e});if(r.ok)if(r.status===206){const a=await r.getData(),{total:o}=Lh(r.getHeader("content-range"));return this._fileSize=o||null,{data:a,offset:n,length:s}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const a=await r.getData();return this._fileSize=a.byteLength,{data:a,offset:0,length:a.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function xu(i,{blockSize:t,cacheSize:e}){return t===null?i:new U2(i,{blockSize:t,cacheSize:e})}function W2(i,{headers:t={},credentials:e,maxRanges:n=0,allowFullFile:s=!1,...r}={}){const a=new z2(i,e),o=new yu(a,t,n,s);return xu(o,r)}function q2(i,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...s}={}){const r=new j2(i),a=new yu(r,t,e,n);return xu(a,s)}function K2(i,{headers:t={},maxRanges:e=0,allowFullFile:n=!1,...s}={}){const r=new $2(i),a=new yu(r,t,e,n);return xu(a,s)}function Oh(i,{forceXHR:t=!1,...e}={}){return typeof fetch=="function"&&!t?W2(i,e):typeof XMLHttpRequest<"u"?q2(i,e):K2(i,e)}class H2 extends _u{constructor(t){super(),this.file=t}async fetchSlice(t,e){return new Promise((n,s)=>{const r=this.file.slice(t.offset,t.offset+t.length),a=new FileReader;a.onload=o=>n(o.target.result),a.onerror=s,a.onabort=s,a.readAsArrayBuffer(r),e&&e.addEventListener("abort",()=>a.abort())})}}function Y2(i){return new H2(i)}function Fh(i){switch(i){case at.BYTE:case at.ASCII:case at.SBYTE:case at.UNDEFINED:return 1;case at.SHORT:case at.SSHORT:return 2;case at.LONG:case at.SLONG:case at.FLOAT:case at.IFD:return 4;case at.RATIONAL:case at.SRATIONAL:case at.DOUBLE:case at.LONG8:case at.SLONG8:case at.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${i}`)}}function Z2(i){const t=i.GeoKeyDirectory;if(!t)return null;const e={};for(let n=4;n<=t[3]*4;n+=4){const s=o2[t[n]],r=t[n+1]?yr[t[n+1]]:null,a=t[n+2],o=t[n+3];let l=null;if(!r)l=o;else{if(l=i[r],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${s}'.`);typeof l=="string"?l=l.substring(o,o+a-1):l.subarray&&(l=l.subarray(o,o+a),a===1&&(l=l[0]))}e[s]=l}return e}function jn(i,t,e,n){let s=null,r=null;const a=Fh(t);switch(t){case at.BYTE:case at.ASCII:case at.UNDEFINED:s=new Uint8Array(e),r=i.readUint8;break;case at.SBYTE:s=new Int8Array(e),r=i.readInt8;break;case at.SHORT:s=new Uint16Array(e),r=i.readUint16;break;case at.SSHORT:s=new Int16Array(e),r=i.readInt16;break;case at.LONG:case at.IFD:s=new Uint32Array(e),r=i.readUint32;break;case at.SLONG:s=new Int32Array(e),r=i.readInt32;break;case at.LONG8:case at.IFD8:s=new Array(e),r=i.readUint64;break;case at.SLONG8:s=new Array(e),r=i.readInt64;break;case at.RATIONAL:s=new Uint32Array(e*2),r=i.readUint32;break;case at.SRATIONAL:s=new Int32Array(e*2),r=i.readInt32;break;case at.FLOAT:s=new Float32Array(e),r=i.readFloat32;break;case at.DOUBLE:s=new Float64Array(e),r=i.readFloat64;break;default:throw new RangeError(`Invalid field type: ${t}`)}if(t===at.RATIONAL||t===at.SRATIONAL)for(let o=0;o<e;o+=2)s[o]=r.call(i,n+o*a),s[o+1]=r.call(i,n+(o*a+4));else for(let o=0;o<e;++o)s[o]=r.call(i,n+o*a);return t===at.ASCII?new TextDecoder("utf-8").decode(s):s}class Q2{constructor(t,e,n){this.fileDirectory=t,this.geoKeyDirectory=e,this.nextIFDByteOffset=n}}class ka extends Error{constructor(t){super(`No image at index ${t}`),this.index=t}}class y_{async readRasters(t={}){const{window:e,width:n,height:s}=t;let{resX:r,resY:a,bbox:o}=t;const l=await this.getImage();let h=l;const c=await this.getImageCount(),u=l.getBoundingBox();if(e&&o)throw new Error('Both "bbox" and "window" passed.');if(n||s){if(e){const[g,x]=l.getOrigin(),[y,w]=l.getResolution();o=[g+e[0]*y,x+e[1]*w,g+e[2]*y,x+e[3]*w]}const _=o||u;if(n){if(r)throw new Error("Both width and resX passed");r=(_[2]-_[0])/n}if(s){if(a)throw new Error("Both width and resY passed");a=(_[3]-_[1])/s}}if(r||a){const _=[];for(let g=0;g<c;++g){const x=await this.getImage(g),{SubfileType:y,NewSubfileType:w}=x.fileDirectory;(g===0||y===2||w&1)&&_.push(x)}_.sort((g,x)=>g.getWidth()-x.getWidth());for(let g=0;g<_.length;++g){const x=_[g],y=(u[2]-u[0])/x.getWidth(),w=(u[3]-u[1])/x.getHeight();if(h=x,r&&r>y||a&&a>w)break}}let f=e;if(o){const[_,g]=l.getOrigin(),[x,y]=h.getResolution(l);f=[Math.round((o[0]-_)/x),Math.round((o[1]-g)/y),Math.round((o[2]-_)/x),Math.round((o[3]-g)/y)],f=[Math.min(f[0],f[2]),Math.min(f[1],f[3]),Math.max(f[0],f[2]),Math.max(f[1],f[3])]}return h.readRasters({...t,window:f})}}class Is extends y_{constructor(t,e,n,s,r={}){super(),this.source=t,this.littleEndian=e,this.bigTiff=n,this.firstIFDOffset=s,this.cache=r.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(t,e){const n=this.bigTiff?4048:1024;return new C2((await this.source.fetch([{offset:t,length:typeof e<"u"?e:n}]))[0],t,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(t){const e=this.bigTiff?20:12,n=this.bigTiff?8:2;let s=await this.getSlice(t);const r=this.bigTiff?s.readUint64(t):s.readUint16(t),a=r*e+(this.bigTiff?16:6);s.covers(t,a)||(s=await this.getSlice(t,a));const o={};let l=t+(this.bigTiff?8:2);for(let u=0;u<r;l+=e,++u){const f=s.readUint16(l),_=s.readUint16(l+2),g=this.bigTiff?s.readUint64(l+4):s.readUint32(l+4);let x,y;const w=Fh(_),d=l+(this.bigTiff?12:8);if(w*g<=(this.bigTiff?8:4))x=jn(s,_,g,d);else{const p=s.readOffset(d),v=Fh(_)*g;if(s.covers(p,v))x=jn(s,_,g,p);else{const T=await this.getSlice(p,v);x=jn(T,_,g,p)}}g===1&&r2.indexOf(f)===-1&&!(_===at.RATIONAL||_===at.SRATIONAL)?y=x[0]:y=x,o[yr[f]]=y}const h=Z2(o),c=s.readOffset(t+n+e*r);return new Q2(o,h,c)}async requestIFD(t){if(this.ifdRequests[t])return this.ifdRequests[t];if(t===0)return this.ifdRequests[t]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[t];if(!this.ifdRequests[t-1])try{this.ifdRequests[t-1]=this.requestIFD(t-1)}catch(e){throw e instanceof ka?new ka(t):e}return this.ifdRequests[t]=(async()=>{const e=await this.ifdRequests[t-1];if(e.nextIFDByteOffset===0)throw new ka(t);return this.parseFileDirectoryAt(e.nextIFDByteOffset)})(),this.ifdRequests[t]}async getImage(t=0){const e=await this.requestIFD(t);return new m_(e.fileDirectory,e.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let t=0,e=!0;for(;e;)try{await this.requestIFD(t),++t}catch(n){if(n instanceof ka)e=!1;else throw n}return t}async getGhostValues(){const t=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const e="GDAL_STRUCTURAL_METADATA_SIZE=",n=e.length+100;let s=await this.getSlice(t,n);if(e===jn(s,at.ASCII,e.length,t)){const a=jn(s,at.ASCII,n,t).split(`
`)[0],o=Number(a.split("=")[1].split(" ")[0])+a.length;o>n&&(s=await this.getSlice(t,o));const l=jn(s,at.ASCII,o,t);this.ghostValues={},l.split(`
`).filter(h=>h.length>0).map(h=>h.split("=")).forEach(([h,c])=>{this.ghostValues[h]=c})}return this.ghostValues}static async fromSource(t,e,n){const s=(await t.fetch([{offset:0,length:1024}],n))[0],r=new M2(s),a=r.getUint16(0,0);let o;if(a===18761)o=!0;else if(a===19789)o=!1;else throw new TypeError("Invalid byte order value.");const l=r.getUint16(2,o);let h;if(l===42)h=!1;else if(l===43){if(h=!0,r.getUint16(4,o)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=h?r.getUint64(8,o):r.getUint32(4,o);return new Is(t,o,h,c,e)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class J2 extends y_{constructor(t,e){super(),this.mainFile=t,this.overviewFiles=e,this.imageFiles=[t].concat(e),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const t=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(e=>e.parseFileDirectoryAt(e.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(t),this.fileDirectoriesPerFile}async getImage(t=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let e=0,n=0;for(let s=0;s<this.imageFiles.length;s++){const r=this.imageFiles[s];for(let a=0;a<this.imageCounts[s];a++){if(t===e){const o=await r.requestIFD(n);return new m_(o.fileDirectory,o.geoKeyDirectory,r.dataView,r.littleEndian,r.cache,r.source)}e++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const t=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(e=>e.getImageCount()));return this.imageCounts=await Promise.all(t),this.imageCount=this.imageCounts.reduce((e,n)=>e+n,0),this.imageCount}}async function tw(i,t={},e){return Is.fromSource(Oh(i,t),e)}async function ew(i,t){return Is.fromSource(Y2(i),t)}async function iw(i,t=[],e={},n){const s=await Is.fromSource(Oh(i,e),n),r=await Promise.all(t.map(a=>Is.fromSource(Oh(a,e))));return new J2(s,r)}const nw=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,sw=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class rw{constructor(t){this.gl_=t,this.program_=Dh(t,sw,nw),this.positionLocation=t.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=t.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=t.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=t.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=t.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.positions),t.STATIC_DRAW),this.texcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.texcoords),t.STATIC_DRAW)}drawImage(t,e,n,s,r,a,o,l,h,c,u,f,_){const g=this.gl_;l===void 0&&(l=s),h===void 0&&(h=r),a===void 0&&(a=e),o===void 0&&(o=n),c===void 0&&(c=a),u===void 0&&(u=o),f===void 0&&(f=g.canvas.width),_===void 0&&(_=g.canvas.height),g.bindTexture(g.TEXTURE_2D,t),g.useProgram(this.program_),g.bindBuffer(g.ARRAY_BUFFER,this.positionBuffer),g.enableVertexAttribArray(this.positionLocation),g.vertexAttribPointer(this.positionLocation,2,g.FLOAT,!1,0,0),g.bindBuffer(g.ARRAY_BUFFER,this.texcoordBuffer),g.enableVertexAttribArray(this.texcoordLocation),g.vertexAttribPointer(this.texcoordLocation,2,g.FLOAT,!1,0,0);let x=wh(0,f,0,_,-1,1);x=Rx(x,l,h,0),x=Uf(x,c,u,1),g.uniformMatrix4fv(this.matrixLocation,!1,x);let y=Mx(s/e,r/n,0);y=Uf(y,a/e,o/n,1),g.uniformMatrix4fv(this.textureMatrixLocation,!1,y),g.uniform1i(this.textureLocation,0),g.drawArrays(g.TRIANGLES,0,this.positions.length/2)}}function hd(i,t,e){const n=i.createShader(t);if(n===null)throw new Error("Shader compilation failed");if(i.shaderSource(n,e),i.compileShader(n),!i.getShaderParameter(n,i.COMPILE_STATUS)){const s=i.getShaderInfoLog(n);throw s===null?new Error("Shader info log creation failed"):new Error(s)}return n}function Dh(i,t,e){const n=i.createProgram(),s=hd(i,i.VERTEX_SHADER,e),r=hd(i,i.FRAGMENT_SHADER,t);if(n===null)throw new Error("Program creation failed");if(i.attachShader(n,s),i.attachShader(n,r),i.linkProgram(n),!i.getProgramParameter(n,i.LINK_STATUS))throw i.getProgramInfoLog(n)===null?new Error("Program info log creation failed"):new Error;return n}const aw=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,ow=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,lw=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,hw=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function cw(i,t,e,n){let s;return e&&e.length?s=e.shift():No?s=new OffscreenCanvas(i||300,t||300):s=document.createElement("canvas"),i&&(s.width=i),t&&(s.height=t),s.getContext("webgl",n)}function uw(i){const t=i.canvas;t.width=1,t.height=1,i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT)}const cd=[];function fw(i,t,e,n,s,r,a,o,l,h,c,u,f,_){const g=Math.round(n*t),x=Math.round(n*e);i.canvas.width=g,i.canvas.height=x;let y,w;if(w=i.createTexture(),i.bindTexture(i.TEXTURE_2D,w),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),f?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,g,x,0,i.RGBA,c,null),y=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,y),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,w,0),y===null)throw new Error("Could not create framebuffer");if(w===null)throw new Error("Could not create texture");if(l.length===0)return{width:g,height:x,framebuffer:y,texture:w};const d=xe();l.forEach(function(P,G,O){nc(d,P.extent)});let p,v,T;const R=1/s;{if(p=i.createTexture(),w===null)throw new Error("Could not create texture");v=Math.round(ot(d)*R),T=Math.round(It(d)*R);const P=i.getParameter(i.MAX_TEXTURE_SIZE),G=Math.max(v,T),O=G>P?P/G:1,m=Math.round(v*O),E=Math.round(T*O);i.bindTexture(i.TEXTURE_2D,p),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),f?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST)),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,m,E,0,i.RGBA,c,null);const S=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,S),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,p,0);const M=new rw(i);l.forEach(function(A,F,D){const k=(A.extent[0]-d[0])*R*O,B=-(A.extent[3]-d[3])*R*O,U=ot(A.extent)*R*O,V=It(A.extent)*R*O;if(i.bindFramebuffer(i.FRAMEBUFFER,S),i.viewport(0,0,m,E),A.clipExtent){const q=(A.clipExtent[0]-d[0])*R*O,W=-(A.clipExtent[3]-d[3])*R*O,H=ot(A.clipExtent)*R*O,et=It(A.clipExtent)*R*O;i.enable(i.SCISSOR_TEST),i.scissor(f?q:Math.round(q),f?W:Math.round(W),f?H:Math.round(q+H)-Math.round(q),f?et:Math.round(W+et)-Math.round(W))}M.drawImage(A.texture,A.width,A.height,h,h,A.width-2*h,A.height-2*h,f?k:Math.round(k),f?B:Math.round(B),f?U:Math.round(k+U)-Math.round(k),f?V:Math.round(B+V)-Math.round(B),m,E),i.disable(i.SCISSOR_TEST)}),i.deleteFramebuffer(S)}const C=li(a),b=li(d),I=P=>{const G=(P[0][0]-C[0])/r*n,O=-(P[0][1]-C[1])/r*n,m=(P[1][0]-C[0])/r*n,E=-(P[1][1]-C[1])/r*n,S=(P[2][0]-C[0])/r*n,M=-(P[2][1]-C[1])/r*n;return{u1:m,v1:E,u0:G,v0:O,u2:S,v2:M}};i.bindFramebuffer(i.FRAMEBUFFER,y),i.viewport(0,0,g,x);{const P=[],G=[],O=Dh(i,hw,lw);i.useProgram(O);const m=i.getUniformLocation(O,"u_texture");i.bindTexture(i.TEXTURE_2D,p),i.uniform1i(m,0),o.getTriangles().forEach(function(k,B,U){const V=k.source,q=k.target,{u1:W,v1:H,u0:et,v0:mt,u2:ht,v2:dt}=I(q),St=(V[0][0]-b[0])/s/v,Ut=-(V[0][1]-b[1])/s/T,Ft=(V[1][0]-b[0])/s/v,jt=-(V[1][1]-b[1])/s/T,Dt=(V[2][0]-b[0])/s/v,Jt=-(V[2][1]-b[1])/s/T;P.push(W,H,et,mt,ht,dt),G.push(Ft,jt,St,Ut,Dt,Jt)});const E=wh(0,g,x,0,-1,1),S=i.getUniformLocation(O,"u_matrix");i.uniformMatrix4fv(S,!1,E);const M=i.getAttribLocation(O,"a_position"),A=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,A),i.bufferData(i.ARRAY_BUFFER,new Float32Array(P),i.STATIC_DRAW),i.vertexAttribPointer(M,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(M);const F=i.getAttribLocation(O,"a_texcoord"),D=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,D),i.bufferData(i.ARRAY_BUFFER,new Float32Array(G),i.STATIC_DRAW),i.vertexAttribPointer(F,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(F),i.drawArrays(i.TRIANGLES,0,P.length/2)}if(u){const P=Dh(i,ow,aw);i.useProgram(P);const G=wh(0,g,x,0,-1,1),O=i.getUniformLocation(P,"u_matrix");i.uniformMatrix4fv(O,!1,G);const m=Array.isArray(u)?u:[0,0,0,255],E=i.getUniformLocation(P,"u_val");i.uniform4fv(E,m);const S=i.getAttribLocation(P,"a_position"),M=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,M),i.vertexAttribPointer(S,2,i.FLOAT,!1,0,0),i.enableVertexAttribArray(S);const A=o.getTriangles().reduce(function(F,D){const k=D.target,{u1:B,v1:U,u0:V,v0:q,u2:W,v2:H}=I(k);return F.concat([B,U,V,q,V,q,W,H,W,H,B,U])},[]);i.bufferData(i.ARRAY_BUFFER,new Float32Array(A),i.STATIC_DRAW),i.drawArrays(i.LINES,0,A.length/2)}return{width:g,height:x,framebuffer:y,texture:w}}class dw extends Gr{constructor(t){super({tileCoord:t.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:t.interpolate,transition:t.transition}),this.renderEdges_=t.renderEdges!==void 0?t.renderEdges:!1,this.pixelRatio_=t.pixelRatio,this.gutter_=t.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=t.sourceTileGrid,this.targetTileGrid_=t.targetTileGrid,this.wrappedTileCoord_=t.wrappedTileCoord||t.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const e=t.sourceProj,n=e.getExtent(),s=t.sourceTileGrid.getExtent();this.clipExtent_=e.canWrapX()?s?Xt(n,s):n:s;const r=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),a=this.targetTileGrid_.getExtent();let o=this.sourceTileGrid_.getExtent();const l=a?Xt(r,a):r;if(Mr(l)===0){this.state=z.EMPTY;return}n&&(o?o=Xt(o,n):o=n);const h=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),c=t.targetProj,u=E0(e,c,l,h);if(!isFinite(u)||u<=0){this.state=z.EMPTY;return}const f=t.errorThreshold!==void 0?t.errorThreshold:Hc;if(this.triangulation_=new Kc(e,c,l,o,u*f,h,t.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=z.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(u);let _=this.triangulation_.calculateSourceExtent();if(o&&(e.canWrapX()?(_[1]=wt(_[1],o[1],o[3]),_[3]=wt(_[3],o[1],o[3])):_=Xt(_,o)),!Mr(_))this.state=z.EMPTY;else{let g=0,x=0;e.canWrapX()&&(g=ot(n),x=Math.floor((_[0]-n[0])/g)),ac(_.slice(),e,!0).forEach(w=>{const d=this.sourceTileGrid_.getTileRangeForExtentAndZ(w,this.sourceZ_),p=t.getTileFunction;for(let v=d.minX;v<=d.maxX;v++)for(let T=d.minY;T<=d.maxY;T++){const R=p(this.sourceZ_,v,T,this.pixelRatio_);if(R){const C=x*g;this.sourceTiles_.push({tile:R,offset:C})}}++x}),this.sourceTiles_.length===0&&(this.state=z.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const t=[];let e=!1;if(this.sourceTiles_.forEach(v=>{const T=v.tile;if(!T||T.getState()!==z.LOADED)return;const R=T.getSize(),C=this.gutter_;let b;const I=Th(T.getData());I?b=I:(e=!0,b=Bx(Ms(T.getData())));const P=[R[0]+2*C,R[1]+2*C],G=b instanceof Float32Array,O=P[0]*P[1],m=G?Float32Array:Uint8ClampedArray,E=new m(b.buffer),S=m.BYTES_PER_ELEMENT,M=S*E.length/O,A=E.byteLength/P[1],F=Math.floor(A/S/P[0]),D=this.sourceTileGrid_.getTileCoordExtent(T.tileCoord);D[0]+=v.offset,D[2]+=v.offset;const k=this.clipExtent_?.slice();k&&(k[0]+=v.offset,k[2]+=v.offset),t.push({extent:D,clipExtent:k,data:E,dataType:m,bytesPerPixel:M,pixelSize:P,bandCount:F})}),this.sourceTiles_.length=0,t.length===0){this.state=z.ERROR,this.changed();return}const n=this.wrappedTileCoord_[0],s=this.targetTileGrid_.getTileSize(n),r=typeof s=="number"?s:s[0],a=typeof s=="number"?s:s[1],o=r*this.pixelRatio_,l=a*this.pixelRatio_,h=this.targetTileGrid_.getResolution(n),c=this.sourceTileGrid_.getResolution(this.sourceZ_),u=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),f=t[0].bandCount,_=new t[0].dataType(f*o*l),g=cw(o,l,cd,{premultipliedAlpha:!1,antialias:!1});let x;const y=g.RGBA;let w;t[0].dataType==Float32Array?(w=g.FLOAT,g.getExtension("WEBGL_color_buffer_float"),g.getExtension("OES_texture_float"),g.getExtension("EXT_float_blend"),x=g.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(w=g.UNSIGNED_BYTE,x=this.interpolate);const d=4,p=Math.ceil(f/d);for(let v=p-1;v>=0;--v){const T=[];for(let m=0,E=t.length;m<E;++m){const S=t[m],M=S.pixelSize,A=M[0],F=M[1],D=new S.dataType(d*A*F),k=S.data;let B=v*d;for(let V=0,q=D.length;V<q;V+=d)D[V]=k[B],D[V+1]=k[B+1],D[V+2]=k[B+2],D[V+3]=k[B+3],B+=f;const U=g.createTexture();g.bindTexture(g.TEXTURE_2D,U),x?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR)):(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.NEAREST),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.NEAREST)),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE),g.texImage2D(g.TEXTURE_2D,0,y,A,F,0,y,w,D),T.push({extent:S.extent,clipExtent:S.clipExtent,texture:U,width:A,height:F})}const{framebuffer:R,width:C,height:b}=fw(g,r,a,this.pixelRatio_,c,h,u,this.triangulation_,T,this.gutter_,w,this.renderEdges_,x),I=C,P=b*d,G=new t[0].dataType(I*P);g.bindFramebuffer(g.FRAMEBUFFER,R),g.readPixels(0,0,C,b,g.RGBA,w,G);let O=v*d;for(let m=0,E=G.length;m<E;m+=d){const S=(I-1-(m/P|0))*P+m%P;_[O]=G[S],_[O+1]=G[S+1],_[O+2]=G[S+2],_[O+3]=G[S+3],O+=f}}if(uw(g),cd.push(g.canvas),e){const v=Ot(r,a),T=new ImageData(_,r);v.putImageData(T,0,0),this.reprojData_=v.canvas}else this.reprojData_=_;this.reprojSize_=[Math.round(o),Math.round(l)],this.state=z.LOADED,this.changed()}load(){if(this.state!==z.IDLE&&this.state!==z.ERROR)return;this.state=z.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:e})=>{const n=e.getState();if(n!==z.IDLE&&n!==z.LOADING)return;t++;const s=ct(e,Y.CHANGE,()=>{const r=e.getState();(r==z.LOADED||r==z.ERROR||r==z.EMPTY)&&(vt(s),t--,t===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(s)}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:e}){e.getState()==z.IDLE&&e.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(vt),this.sourcesListenerKeys_=null}}class x_ extends F0{constructor(t){const e=t.projection===void 0?"EPSG:3857":t.projection;let n=t.tileGrid;n===void 0&&e&&(n=Gs({extent:tn(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize})),super({cacheSize:.1,attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:e,tileGrid:n,state:t.state,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.tileSize_=t.tileSize?Lt(t.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=t.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=t.bandCount===void 0?4:t.bandCount,this.tileGridForProjection_={},this.crossOrigin_=t.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(t){this.tileSizes_=t}getTileSize(t){if(this.tileSizes_)return this.tileSizes_[t];if(this.tileSize_)return this.tileSize_;const e=this.getTileGrid();return e?Lt(e.getTileSize(t)):[256,256]}getGutterForProjection(t){const e=this.getProjection();return(!e||Ge(e,t))&&!this.transformMatrix?this.gutter_:0}setLoader(t){this.loader_=t}getReprojTile_(t,e,n,s,r){const a=this.tileGrid||this.getTileGridForProjection(r||s),o=Math.max.apply(null,a.getResolutions().map((_,g)=>{const x=Lt(a.getTileSize(g)),y=this.getTileSize(g);return Math.max(y[0]/x[0],y[1]/x[1])})),l=this.getTileGridForProjection(s),h=[t,e,n],c=this.getTileCoordForTileUrlFunction(h,s),u=Object.assign({sourceProj:r||s,sourceTileGrid:a,targetProj:s,targetTileGrid:l,tileCoord:h,wrappedTileCoord:c,pixelRatio:o,gutter:this.gutter_,getTileFunction:(_,g,x,y)=>this.getTile(_,g,x,y),transformMatrix:this.transformMatrix},this.tileOptions),f=new dw(u);return f.key=this.getKey(),f}getTile(t,e,n,s,r){const a=this.getProjection();if(r&&(a&&!Ge(a,r)||this.transformMatrix))return this.getReprojTile_(t,e,n,r,a);const o=this.getTileSize(t),l=this.loader_,h=new AbortController,c={signal:h.signal,crossOrigin:this.crossOrigin_},u=this.getTileCoordForTileUrlFunction([t,e,n]);if(!u)return null;const f=u[0],_=u[1],g=u[2],x=this.getTileGrid()?.getFullTileRange(f);x&&(c.maxY=x.getHeight()-1);function y(){return Jh(function(){return l(f,_,g,c)})}const w=Object.assign({tileCoord:[t,e,n],loader:y,size:o,controller:h},this.tileOptions),d=new Gr(w);return d.key=this.getKey(),d.addEventListener(Y.CHANGE,this.handleTileChange_),d}handleTileChange_(t){const e=t.target,n=Z(e),s=e.getState();let r;s==z.LOADING?(this.tileLoadingKeys_[n]=!0,r=_s.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],r=s==z.ERROR?_s.TILELOADERROR:s==z.LOADED?_s.TILELOADEND:void 0),r&&this.dispatchEvent(new D0(r,e))}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||Ge(e,t))&&!this.transformMatrix)return this.tileGrid;const n=Z(t);return n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=tu(t)),this.tileGridForProjection_[n]}setTileGridForProjection(t,e){const n=lt(t);if(n){const s=Z(n);s in this.tileGridForProjection_||(this.tileGridForProjection_[s]=e)}}}function gw(i){return((i.fileDirectory.NewSubfileType||0)&4)===4}function _w(i,t){if(!i)return!1;if(i===!0)return!0;if(t.getSamplesPerPixel()!==3)return!1;const e=t.fileDirectory.PhotometricInterpretation,n=fe;return e===n.CMYK||e===n.YCbCr||e===n.CIELab||e===n.ICCLab}const ud="STATISTICS_MAXIMUM",fd="STATISTICS_MINIMUM",$l=256;let Wl;function mw(){return Wl||(Wl=new I2),Wl}function pw(i){try{return i.getBoundingBox(!0)}catch{return[0,0,i.getWidth(),i.getHeight()]}}function yw(i){try{return i.getOrigin().slice(0,2)}catch{return[0,i.getHeight()]}}function xw(i,t){try{return i.getResolution(t)}catch{return[t.getWidth()/i.getWidth(),t.getHeight()/i.getHeight()]}}function Ew(i){const t=i.geoKeys;if(!t)return null;if(t.ProjectedCSTypeGeoKey&&t.ProjectedCSTypeGeoKey!==32767){const e="EPSG:"+t.ProjectedCSTypeGeoKey;let n=lt(e);if(!n){const s=nf(t.ProjLinearUnitsGeoKey);s&&(n=new xn({code:e,units:s}))}return n}if(t.GeographicTypeGeoKey&&t.GeographicTypeGeoKey!==32767){const e="EPSG:"+t.GeographicTypeGeoKey;let n=lt(e);if(!n){const s=nf(t.GeogAngularUnitsGeoKey);s&&(n=new xn({code:e,units:s}))}return n}return null}function vw(i){return i.getImageCount().then(function(t){const e=new Array(t);for(let n=0;n<t;++n)e[n]=i.getImage(n);return Promise.all(e)})}function ww(i,t){let e;return i.blob?e=ew(i.blob):i.overviews?e=iw(i.url,i.overviews,t):e=tw(i.url,t),e.then(vw)}function ar(i,t,e,n,s){if(Array.isArray(i)){const r=i.length;if(!Array.isArray(t)||r!=t.length){const a=new Error(n);throw s(a),a}for(let a=0;a<r;++a)ar(i[a],t[a],e,n,s);return}if(t=t,Math.abs(i-t)>e*i)throw new Error(n)}function Tw(i){return i instanceof Int8Array?-128:i instanceof Int16Array?-32768:i instanceof Int32Array?-2147483648:i instanceof Float32Array?12e-39:0}function Sw(i){return i instanceof Int8Array?127:i instanceof Uint8Array||i instanceof Uint8ClampedArray?255:i instanceof Int16Array?32767:i instanceof Uint16Array?65535:i instanceof Int32Array?2147483647:i instanceof Uint32Array?4294967295:i instanceof Float32Array?34e37:255}class E_ extends x_{constructor(t){super({state:"loading",tileGrid:null,projection:t.projection||null,transition:t.transition,interpolate:t.interpolate!==!1,wrapX:t.wrapX}),this.sourceInfo_=t.sources;const e=this.sourceInfo_.length;this.sourceOptions_=t.sourceOptions,this.sourceImagery_=new Array(e),this.sourceMasks_=new Array(e),this.resolutionFactors_=new Array(e),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=t.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=t.convertToRGB||!1,this.setKey(this.sourceInfo_.map(r=>r.url).join(","));const n=this,s=new Array(e);for(let r=0;r<e;++r)s[r]=ww(this.sourceInfo_[r],this.sourceOptions_);Promise.all(s).then(function(r){n.configure_(r)}).catch(function(r){ef(r),n.error_=r,n.setState("error")})}getError(){return this.error_}determineProjection(t){const e=t[0];for(let n=e.length-1;n>=0;--n){const s=e[n],r=Ew(s);if(r){this.projection=r;break}}}determineTransformMatrix(t){const e=t[0];for(let n=e.length-1;n>=0;--n){const r=e[n].fileDirectory.ModelTransformation;if(r){const[a,o,l,h,c,u,f,_]=r,g=Ts(Ts([1/Math.sqrt(a*a+c*c),0,0,-1/Math.sqrt(o*o+u*u),h,_],[a,c,o,u,0,0]),[1,0,0,1,-h,-_]);this.transformMatrix=g,this.addAlpha_=!0;break}}}configure_(t){let e,n,s,r,a;const o=new Array(t.length),l=new Array(t.length),h=new Array(t.length);let c=0;const u=t.length;for(let y=0;y<u;++y){const w=[],d=[];t[y].forEach(I=>{gw(I)?d.push(I):w.push(I)});const p=w.length;if(d.length>0&&d.length!==p)throw new Error(`Expected one mask per image found ${d.length} masks and ${p} images`);let v,T;const R=new Array(p),C=new Array(p),b=new Array(p);l[y]=new Array(p),h[y]=new Array(p);for(let I=0;I<p;++I){const P=w[I],G=P.getGDALNoData();h[y][I]=P.getGDALMetadata(0),l[y][I]=G;const O=this.sourceInfo_[y].bands;o[y]=O?O.length:P.getSamplesPerPixel();const m=p-(I+1);v||(v=pw(P)),T||(T=yw(P));const E=xw(P,w[0]);b[m]=E[0];const S=[P.getTileWidth(),P.getTileHeight()];S[0]!==S[1]&&S[1]<$l&&(S[0]=$l,S[1]=$l),R[m]=S;const M=E[0]/Math.abs(E[1]);C[m]=[S[0],S[1]/M]}if(e?Xt(e,v,e):e=v,!n)n=T;else{const I=`Origin mismatch for source ${y}, got [${T}] but expected [${n}]`;ar(n,T,0,I,this.viewRejector)}if(!a)a=b,this.resolutionFactors_[y]=1;else{a.length-c>b.length&&(c=a.length-b.length);const I=a[a.length-1]/b[b.length-1];this.resolutionFactors_[y]=I;const P=b.map(O=>O*=I),G=`Resolution mismatch for source ${y}, got [${P}] but expected [${a}]`;ar(a.slice(c,a.length),P,.02,G,this.viewRejector)}s?ar(s.slice(c,s.length),C,.01,`Tile size mismatch for source ${y}`,this.viewRejector):s=C,r?ar(r.slice(c,r.length),R,0,`Tile size mismatch for source ${y}`,this.viewRejector):r=R,this.sourceImagery_[y]=w.reverse(),this.sourceMasks_[y]=d.reverse()}for(let y=0,w=this.sourceImagery_.length;y<w;++y){const d=this.sourceImagery_[y];for(;d.length<a.length;)d.unshift(void 0)}this.getProjection()||this.determineProjection(t),this.determineTransformMatrix(t),this.samplesPerPixel_=o,this.nodataValues_=l,this.metadata_=h;t:for(let y=0;y<u;++y){if(this.sourceInfo_[y].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[y].length){this.addAlpha_=!0;break}const w=l[y],d=this.sourceInfo_[y].bands;if(d){for(let p=0;p<d.length;++p)if(w[d[p]-1]!==null){this.addAlpha_=!0;break t}continue}for(let p=0;p<w.length;++p)if(w[p]!==null){this.addAlpha_=!0;break t}}let f=this.addAlpha_?1:0;for(let y=0;y<u;++y)f+=o[y];this.bandCount=f;const _=new aa({extent:e,minZoom:c,origin:n,resolutions:a,tileSizes:s});this.tileGrid=_,this.setTileSizes(r),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const g=1;a.length===2?a=[a[0],a[1],a[1]/2]:a.length===1&&(a=[a[0]*2,a[0],a[0]/2]);let x=e;if(this.transformMatrix){const y=mc(Zt(),this.transformMatrix.slice()),w=co(d=>kt(y,d));x=rc(e,w)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:a,center:uo(We(x),this.projection),extent:jo(x,this.projection),zoom:g})}loadTile_(t,e,n,s){const r=this.getTileSize(t),a=this.sourceImagery_.length,o=new Array(a*2),l=this.nodataValues_,h=this.sourceInfo_,c=mw();for(let u=0;u<a;++u){const f=h[u],_=this.resolutionFactors_[u],g=[Math.round(e*(r[0]*_)),Math.round(n*(r[1]*_)),Math.round((e+1)*(r[0]*_)),Math.round((n+1)*(r[1]*_))],x=this.sourceImagery_[u][t];let y;f.bands&&(y=f.bands.map(function(T){return T-1}));let w;"nodata"in f&&f.nodata!==null?w=f.nodata:y?w=y.map(function(T){return l[u][T]}):w=l[u];const d={window:g,width:r[0],height:r[1],samples:y,fillValue:w,pool:c,interleave:!1,signal:s.signal};_w(this.convertToRGB_,x)?o[u]=x.readRGB(d):o[u]=x.readRasters(d);const p=a+u,v=this.sourceMasks_[u][t];if(!v){o[p]=Promise.resolve(null);continue}o[p]=v.readRasters({window:g,width:r[0],height:r[1],samples:[0],pool:c,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,r)).catch(function(u){throw ef(u),u})}composeTile_(t,e){const n=this.metadata_,s=this.sourceInfo_,r=this.sourceImagery_.length,a=this.bandCount,o=this.samplesPerPixel_,l=this.nodataValues_,h=this.normalize_,c=this.addAlpha_,u=t[0]*t[1],f=u*a;let _;h?_=new Uint8Array(f):_=new Float32Array(f);let g=0;for(let x=0;x<u;++x){let y=c;for(let w=0;w<r;++w){const d=s[w];let p=d.min,v=d.max,T,R;if(h){const C=n[w][0];p===void 0&&(C&&fd in C?p=parseFloat(C[fd]):p=Tw(e[w][0])),v===void 0&&(C&&ud in C?v=parseFloat(C[ud]):v=Sw(e[w][0])),T=255/(v-p),R=-p*T}for(let C=0;C<o[w];++C){const b=e[w][C][x];let I;if(h?I=wt(T*b+R,0,255):I=b,!c)_[g]=I;else{let P=d.nodata;if(P===void 0){let O;d.bands?O=d.bands[C]-1:O=C,P=l[w][O]}const G=isNaN(P);(!G&&b!==P||G&&!isNaN(b))&&(y=!1,_[g]=I)}g++}if(!y){const C=r+w,b=e[C];b&&!b[0][x]&&(y=!0)}}c&&(y||(_[g]=255),g++)}return _}}E_.prototype.getView;class Eu{constructor(){this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(go(),{get:(t,e)=>{if(typeof go()[e]=="function")return this.push_(e),this.pushMethodArgs_},set:(t,e,n)=>(this.push_(e,n),!0)})}push_(...t){const e=this.instructions_,n=this.zIndex+this.offset_;e[n]||(e[n]=[]),e[n].push(...t)}pushMethodArgs_=(...t)=>(this.push_(t),this);pushFunction(t){this.push_(t)}getContext(){return this.context_}draw(t){this.instructions_.forEach(e=>{for(let n=0,s=e.length;n<s;++n){const r=e[n];if(typeof r=="function"){r(t);continue}const a=e[++n];if(typeof t[r]=="function")t[r](...a);else{if(typeof a=="function"){t[r]=a(t);continue}t[r]=a}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const dd=[];let Jn=null;function Rw(){Jn=Ot(1,1,void 0,{willReadFrequently:!0})}class vu extends M0{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Zt(),this.pixelTransform=Zt(),this.inversePixelTransform=Zt(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.frameState=null}getImageData(t,e,n){Jn||Rw(),Jn.clearRect(0,0,1,1);let s;try{Jn.drawImage(t,e,n,1,1,0,0,1,1),s=Jn.getImageData(0,0,1,1).data}catch{return Jn=null,null}return s}getBackground(t){let n=this.getLayer().getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0}useContainer(t,e,n){const s=this.getLayer().getClassName();let r,a;if(t&&t.className===s&&(!n||t&&t.style.backgroundColor&&Ji(Ki(t.style.backgroundColor),Ki(n)))){const o=t.firstElementChild;o instanceof HTMLCanvasElement&&(a=o.getContext("2d"))}if(a&&a1(a.canvas.style.transform,e)?(this.container=t,this.context=a,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){r=document.createElement("div"),r.className=s;let o=r.style;o.position="absolute",o.width="100%",o.height="100%",a=Ot();const l=a.canvas;r.appendChild(l),o=l.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=r,this.context=a}!this.containerReused&&n&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=n)}clipUnrotated(t,e,n){const s=li(n),r=Bo(n),a=Uo(n),o=ko(n);kt(e.coordinateToPixelTransform,s),kt(e.coordinateToPixelTransform,r),kt(e.coordinateToPixelTransform,a),kt(e.coordinateToPixelTransform,o);const l=this.inversePixelTransform;kt(l,s),kt(l,r),kt(l,a),kt(l,o),t.save(),t.beginPath(),t.moveTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.clip()}prepareContainer(t,e){const n=t.extent,s=t.viewState.resolution,r=t.viewState.rotation,a=t.pixelRatio,o=Math.round(ot(n)/s*a),l=Math.round(It(n)/s*a);Ne(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/a,1/a,r,-o/2,-l/2),mc(this.inversePixelTransform,this.pixelTransform);const h=r1(this.pixelTransform);if(this.useContainer(e,h,this.getBackground(t)),!this.containerReused){const c=this.context.canvas;c.width!=o||c.height!=l?(c.width=o,c.height=l):this.context.clearRect(0,0,o,l),h!==c.style.transform&&(c.style.transform=h)}}dispatchRenderEvent_(t,e,n){const s=this.getLayer();if(s.hasListener(t)){const r=new _r(t,this.inversePixelTransform,n,e);s.dispatchEvent(r)}}preRender(t,e){this.frameState=e,!e.declutter&&this.dispatchRenderEvent_(Wt.PRERENDER,t,e)}postRender(t,e){e.declutter||this.dispatchRenderEvent_(Wt.POSTRENDER,t,e)}renderDeferredInternal(t){}getRenderContext(t){return t.declutter&&!this.deferredContext_&&(this.deferredContext_=new Eu),t.declutter?this.deferredContext_.getContext():this.context}renderDeferred(t){t.declutter&&(this.dispatchRenderEvent_(Wt.PRERENDER,this.context,t),t.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(t),this.dispatchRenderEvent_(Wt.POSTRENDER,this.context,t))}getRenderTransform(t,e,n,s,r,a,o){const l=r/2,h=a/2,c=s/e,u=-c,f=-t[0]+o,_=-t[1];return Ne(this.tempTransform,l,h,c,u,-n,f,_)}disposeInternal(){delete this.frameState,super.disposeInternal()}}class Mw extends vu{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){const e=t.layerStatesArray[t.layerIndex],n=t.pixelRatio,s=t.viewState,r=s.resolution,a=this.getLayer().getSource(),o=t.viewHints;let l=t.extent;if(e.extent!==void 0&&(l=Xt(l,Oe(e.extent,s.projection))),!o[bt.ANIMATING]&&!o[bt.INTERACTING]&&!Ri(l))if(a){const h=s.projection,c=a.getImage(l,r,n,h);c&&(this.loadImage(c)?this.image=c:c.getState()===K.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),s=kt(e.pixelToCoordinateTransform,t.slice()),r=n.getExtent();if(r&&!wi(r,s))return null;const a=this.image.getExtent(),o=this.image.getImage(),l=ot(a),h=Math.floor(o.width*((s[0]-a[0])/l));if(h<0||h>=o.width)return null;const c=It(a),u=Math.floor(o.height*((a[3]-s[1])/c));return u<0||u>=o.height?null:this.getImageData(o,h,u)}renderFrame(t,e){const n=this.image,s=n.getExtent(),r=n.getResolution(),[a,o]=Array.isArray(r)?r:[r,r],l=n.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],c=t.pixelRatio,u=t.viewState,f=u.center,_=u.resolution,g=c*a/(_*l),x=c*o/(_*l);this.prepareContainer(t,e);const y=this.context.canvas.width,w=this.context.canvas.height,d=this.getRenderContext(t);let p=!1,v=!0;if(h.extent){const I=Oe(h.extent,u.projection);v=Pt(I,t.extent),p=v&&!Xe(I,t.extent),p&&this.clipUnrotated(d,t,I)}const T=n.getImage(),R=Ne(this.tempTransform,y/2,w/2,g,x,0,l*(s[0]-f[0])/a,l*(f[1]-s[3])/o);this.renderedResolution=o*c/l;const C=T.width*R[0],b=T.height*R[3];if(this.getLayer().getSource().getInterpolate()||(d.imageSmoothingEnabled=!1),this.preRender(d,t),v&&C>=.5&&b>=.5){const I=R[4],P=R[5],G=h.opacity;G!==1&&(d.save(),d.globalAlpha=G),d.drawImage(T,0,0,+T.width,+T.height,I,P,C,b),G!==1&&d.restore()}return this.postRender(this.context,t),p&&d.restore(),d.imageSmoothingEnabled=!0,this.container}}class Cw extends ea{constructor(t){t=t||{},super(t)}}class bw extends Cw{constructor(t){super(t)}createRenderer(){return new Mw(this)}getData(t){return super.getData(t)}}class Mt{constructor(t){this.name=t}toString(){return this.name}}Mt.GeoTIFF=new Mt("GeoTIFF");Mt.ImageStatic=new Mt("ImageStatic");Mt.PMTilesRaster=new Mt("PMTilesRaster");Mt.PMTilesVector=new Mt("PMTilesVector");Mt.TileJSON=new Mt("TileJSON");Mt.TileWMS=new Mt("TileWMS");Mt.WMTS=new Mt("WMTS");Mt.XYZ=new Mt("XYZ");function Gh(i){return Array.isArray(i)?Math.min(...i):i}class Iw extends Bc{constructor(t,e,n,s,r,a,o){let l=t.getExtent();l&&t.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let h=e.getExtent();h&&e.canWrapX()&&(h=h.slice(),h[0]=-1/0,h[2]=1/0);const c=h?Xt(n,h):n,u=We(c),f=xo(t,e,u,s),_=Hc,g=new Kc(t,e,c,l,f*_,s),x=g.calculateSourceExtent(),y=Ri(x)?null:a(x,f,r),w=y?K.IDLE:K.EMPTY,d=y?y.getPixelRatio():1;super(n,s,d,w),this.targetProj_=e,this.maxSourceExtent_=l,this.triangulation_=g,this.targetResolution_=s,this.targetExtent_=n,this.sourceImage_=y,this.sourcePixelRatio_=d,this.interpolate_=o,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==K.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const t=this.sourceImage_.getState();if(t==K.LOADED){const e=ot(this.targetExtent_)/this.targetResolution_,n=It(this.targetExtent_)/this.targetResolution_;this.canvas_=v0(e,n,this.sourcePixelRatio_,Gh(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=t,this.changed()}load(){if(this.state==K.IDLE){this.state=K.LOADING,this.changed();const t=this.sourceImage_.getState();t==K.LOADED||t==K.ERROR?this.reproject_():(this.sourceListenerKey_=ct(this.sourceImage_,Y.CHANGE,e=>{const n=this.sourceImage_.getState();(n==K.LOADED||n==K.ERROR)&&(this.unlistenSource_(),this.reproject_())}),this.sourceImage_.load())}}unlistenSource_(){vt(this.sourceListenerKey_),this.sourceListenerKey_=null}}const rs=4,ql={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Aw extends Ke{constructor(t,e){super(t),this.image=e}}class Pw extends eu{constructor(t){super({attributions:t.attributions,projection:t.projection,state:t.state,interpolate:t.interpolate!==void 0?t.interpolate:!0}),this.on,this.once,this.un,this.loader=t.loader||null,this.resolutions_=t.resolutions!==void 0?t.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=t.loader?t.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(t){this.resolutions_=t}findNearestResolution(t){const e=this.getResolutions();if(e){const n=Do(e,t,0);t=e[n]}return t}getImage(t,e,n,s){const r=this.getProjection();if(!r||!s||Ge(r,s))return r&&(s=r),this.getImageInternal(t,e,n,s);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&Ge(this.reprojectedImage_.getProjection(),s)&&this.reprojectedImage_.getResolution()==e&&yn(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Iw(r,s,t,e,n,(a,o,l)=>this.getImageInternal(a,o,l,r),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(t,e,n,s){if(this.loader){const r=Ow(t,e,n,1),a=this.findNearestResolution(e);if(this.image&&(this.static_||this.wantedProjection_===s&&(this.wantedExtent_&&Xe(this.wantedExtent_,r)||Xe(this.image.getExtent(),r))&&(this.wantedResolution_&&Gh(this.wantedResolution_)===a||Gh(this.image.getResolution())===a)))return this.image;this.wantedProjection_=s,this.wantedExtent_=r,this.wantedResolution_=a,this.image=new Bc(r,a,n,this.loader),this.image.addEventListener(Y.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(t){const e=t.target;let n;switch(e.getState()){case K.LOADING:this.loading=!0,n=ql.IMAGELOADSTART;break;case K.LOADED:this.loading=!1,n=ql.IMAGELOADEND;break;case K.ERROR:this.loading=!1,n=ql.IMAGELOADERROR;break;default:return}this.hasListener(n)&&this.dispatchEvent(new Aw(n,e))}}function Lw(i,t){i.getImage().src=t}function Ow(i,t,e,n){const s=t/e,r=We(i),a=Ni(ot(i)/s,rs),o=Ni(It(i)/s,rs),l=Ni((n-1)*a/2,rs),h=a+2*l,c=Ni((n-1)*o/2,rs),u=o+2*c;return ro(r,s,0,[h,u])}function Fw(i){const t=i.load||s0,e=i.imageExtent,n=i.crossOrigin??null;return()=>{const s=new Image;return s.crossOrigin=n,t(s,i.url).then(r=>{const a=ot(e)/r.width,o=It(e)/r.height;return{image:r,extent:e,resolution:a!==o?[a,o]:o,pixelRatio:1}})}}class Dw extends Pw{constructor(t){const e=t.crossOrigin!==void 0?t.crossOrigin:null,n=t.imageLoadFunction!==void 0?t.imageLoadFunction:Lw;super({attributions:t.attributions,interpolate:t.interpolate,projection:lt(t.projection)}),this.url_=t.url,this.imageExtent_=t.imageExtent,this.image=null,this.image=new Bc(this.imageExtent_,void 0,1,Fw({url:t.url,imageExtent:t.imageExtent,crossOrigin:e,load:(s,r)=>(this.image.setImage(s),n(this.image,r),s0(s))})),this.image.addEventListener(Y.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(t,e,n,s){return Pt(t,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}function Gw(i,t,e,n){const s=document.createElement("script"),r="olc_"+Z(t);function a(){delete window[r],s.parentNode.removeChild(s)}s.async=!0,s.src=i+(i.includes("?")?"&":"?")+"callback="+r;const o=setTimeout(function(){a(),e&&e()},1e4);window[r]=function(l){clearTimeout(o),a(),t(l)},document.head.appendChild(s)}class Nw extends nl{constructor(t){if(super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:lt("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:"loading",tileLoadFunction:t.tileLoadFunction,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.tileJSON_=null,this.tileSize_=t.tileSize,t.url)if(t.jsonp)Gw(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",t.url),e.send()}else if(t.tileJSON)this.handleTileJSONResponse(t.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(t){const e=t.target;if(!e.status||e.status>=200&&e.status<300){let n;try{n=JSON.parse(e.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(t){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(t){const e=lt("EPSG:4326"),n=this.getProjection();let s;if(t.bounds!==void 0){const h=Yr(e,n);s=rc(t.bounds,h)}const r=tn(n),a=t.minzoom||0,o=t.maxzoom||22,l=Gs({extent:r,maxZoom:o,minZoom:a,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=O0(t.tiles,l),t.attribution&&!this.getAttributions()){const h=s!==void 0?s:r;this.setAttributions(function(c){return Pt(h,c.extent)?[t.attribution]:null})}this.tileJSON_=t,this.setState("ready")}handleTileJSONError(){this.setState("error")}}function Kl(i,t,e,n,s){return`${Z(i)},${t},${S0(e,n,s)}`}function Hl(i,t,e){if(!(e in i))return i[e]=new Set([t]),!0;const n=i[e],s=n.has(t);return s||n.add(t),!s}function kw(i,t,e){const n=i[e];return n?n.delete(t):!1}function gd(i,t){const e=i.layerStatesArray[i.layerIndex];e.extent&&(t=Xt(t,Oe(e.extent,i.viewState.projection)));const n=e.layer.getRenderSource();if(!n.getWrapX()){const s=n.getTileGridForProjection(i.viewState.projection).getExtent();s&&(t=Xt(t,s))}return t}class v_ extends vu{constructor(t,e){super(t),e=e||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=xe(),this.tempTileRange_=new el(0,0,0,0),this.tempTileCoord_=Cs(0,0,0);const n=e.cacheSize!==void 0?e.cacheSize:512;this.tileCache_=new T0(n),this.maxStaleKeys=n*.5}getTileCache(){return this.tileCache_}getOrCreateTile(t,e,n,s){const r=this.tileCache_,o=this.getLayer().getSource(),l=Kl(o,o.getKey(),t,e,n);let h;if(r.containsKey(l))h=r.get(l);else{if(h=o.getTile(t,e,n,s.pixelRatio,s.viewState.projection),!h)return null;r.set(l,h)}return h}getTile(t,e,n,s){const r=this.getOrCreateTile(t,e,n,s);return r||null}getData(t){const e=this.frameState;if(!e)return null;const n=this.getLayer(),s=kt(e.pixelToCoordinateTransform,t.slice()),r=n.getExtent();if(r&&!wi(r,s))return null;const a=e.viewState,o=n.getRenderSource(),l=o.getTileGridForProjection(a.projection),h=o.getTilePixelRatio(e.pixelRatio);for(let c=l.getZForResolution(a.resolution);c>=l.getMinZoom();--c){const u=l.getTileCoordForCoordAndZ(s,c),f=this.getTile(c,u[1],u[2],e);if(!f||f.getState()!==z.LOADED)continue;const _=l.getOrigin(c),g=Lt(l.getTileSize(c)),x=l.getResolution(c);let y;if(f instanceof tl||f instanceof Yc)y=f.getImage();else if(f instanceof Gr){if(y=Ms(f.getData()),!y)continue}else continue;const w=Math.floor(h*((s[0]-_[0])/x-u[1]*g[0])),d=Math.floor(h*((_[1]-s[1])/x-u[2]*g[1])),p=Math.round(h*o.getGutterForProjection(a.projection));return this.getImageData(y,w+p,d+p)}return null}prepareFrame(t){this.renderedProjection?t.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=t.viewState.projection):this.renderedProjection=t.viewState.projection;const e=this.getLayer().getSource();if(!e)return!1;const n=e.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==n&&(this.renderedSourceRevision_=n,this.renderedSourceKey_===e.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=n,!0}enqueueTiles(t,e,n,s,r){const a=t.viewState,o=this.getLayer(),l=o.getRenderSource(),h=l.getTileGridForProjection(a.projection),c=Z(l);c in t.wantedTiles||(t.wantedTiles[c]={});const u=t.wantedTiles[c],f=o.getMapInternal(),_=Math.max(n-r,h.getMinZoom(),h.getZForResolution(Math.min(o.getMaxResolution(),f?f.getView().getResolutionForZoom(Math.max(o.getMinZoom(),0)):h.getResolution(0)),l.zDirection)),g=a.rotation,x=g?sc(a.center,a.resolution,g,t.size):void 0;for(let y=n;y>=_;--y){const w=h.getTileRangeForExtentAndZ(e,y,this.tempTileRange_),d=h.getResolution(y);for(let p=w.minX;p<=w.maxX;++p)for(let v=w.minY;v<=w.maxY;++v){if(g&&!h.tileCoordIntersectsViewport([y,p,v],x))continue;const T=this.getTile(y,p,v,t);if(!T||!Hl(s,T,y))continue;const C=T.getKey();if(u[C]=!0,T.getState()===z.IDLE&&!t.tileQueue.isKeyQueued(C)){const b=Cs(y,p,v,this.tempTileCoord_);t.tileQueue.enqueue([T,c,h.getTileCoordCenter(b),d])}}}}findStaleTile_(t,e){const n=this.tileCache_,s=t[0],r=t[1],a=t[2],o=this.getStaleKeys();for(let l=0;l<o.length;++l){const h=Kl(this.getLayer().getSource(),o[l],s,r,a);if(n.containsKey(h)){const c=n.peek(h);if(c.getState()===z.LOADED)return c.endTransition(Z(this)),Hl(e,c,s),!0}}return!1}findAltTiles_(t,e,n,s){const r=t.getTileRangeForTileCoordAndZ(e,n,this.tempTileRange_);if(!r)return!1;let a=!0;const o=this.tileCache_,l=this.getLayer().getRenderSource(),h=l.getKey();for(let c=r.minX;c<=r.maxX;++c)for(let u=r.minY;u<=r.maxY;++u){const f=Kl(l,h,n,c,u);let _=!1;if(o.containsKey(f)){const g=o.peek(f);g.getState()===z.LOADED&&(Hl(s,g,n),_=!0)}_||(a=!1)}return a}renderFrame(t,e){this.renderComplete=!0;const n=t.layerStatesArray[t.layerIndex],s=t.viewState,r=s.projection,a=s.resolution,o=s.center,l=t.pixelRatio,h=this.getLayer(),c=h.getSource(),u=c.getTileGridForProjection(r),f=u.getZForResolution(a,c.zDirection),_=u.getResolution(f),g=c.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==g&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=g):this.renderedSourceKey_=g;let x=t.extent;const y=c.getTilePixelRatio(l);this.prepareContainer(t,e);const w=this.context.canvas.width,d=this.context.canvas.height,p=n.extent&&Oe(n.extent);p&&(x=Xt(x,Oe(n.extent)));const v=_*w/2/y,T=_*d/2/y,R=[o[0]-v,o[1]-T,o[0]+v,o[1]+T],C={};this.renderedTiles.length=0;const b=h.getPreload();if(t.nextExtent){const F=u.getZForResolution(s.nextResolution,c.zDirection),D=gd(t,t.nextExtent);this.enqueueTiles(t,D,F,C,b)}const I=gd(t,x);if(this.enqueueTiles(t,I,f,C,0),b>0&&setTimeout(()=>{this.enqueueTiles(t,I,f-1,C,b-1)},0),!(f in C))return this.container;const P=Z(this),G=t.time;for(const F of C[f]){const D=F.getState();if(D===z.EMPTY)continue;const k=F.tileCoord;if(D===z.LOADED&&F.getAlpha(P,G)===1){F.endTransition(P);continue}if(D!==z.ERROR&&(this.renderComplete=!1),this.findStaleTile_(k,C)){kw(C,F,f),t.animate=!0;continue}if(this.findAltTiles_(u,k,f+1,C))continue;const V=u.getMinZoom();for(let q=f-1;q>=V&&!this.findAltTiles_(u,k,q,C);--q);}const O=_/a*l/y,m=this.getRenderContext(t);Ne(this.tempTransform,w/2,d/2,O,O,0,-w/2,-d/2),n.extent&&this.clipUnrotated(m,t,p),c.getInterpolate()||(m.imageSmoothingEnabled=!1),this.preRender(m,t);const E=Object.keys(C).map(Number);E.sort(si);let S;const M=[],A=[];for(let F=E.length-1;F>=0;--F){const D=E[F],k=c.getTilePixelSize(D,l,r),U=u.getResolution(D)/_,V=k[0]*U*O,q=k[1]*U*O,W=u.getTileCoordForCoordAndZ(li(R),D),H=u.getTileCoordExtent(W),et=kt(this.tempTransform,[y*(H[0]-R[0])/_,y*(R[3]-H[3])/_]),mt=y*c.getGutterForProjection(r);for(const ht of C[D]){if(ht.getState()!==z.LOADED)continue;const dt=ht.tileCoord,St=W[1]-dt[1],Ut=Math.round(et[0]-(St-1)*V),Ft=W[2]-dt[2],jt=Math.round(et[1]-(Ft-1)*q),Dt=Math.round(et[0]-St*V),Jt=Math.round(et[1]-Ft*q),An=Ut-Dt,Pn=jt-Jt,Xs=E.length===1;let sn=!1;S=[Dt,Jt,Dt+An,Jt,Dt+An,Jt+Pn,Dt,Jt+Pn];for(let Ln=0,On=M.length;Ln<On;++Ln)if(!Xs&&D<A[Ln]){const Vt=M[Ln];Pt([Dt,Jt,Dt+An,Jt+Pn],[Vt[0],Vt[3],Vt[4],Vt[7]])&&(sn||(m.save(),sn=!0),m.beginPath(),m.moveTo(S[0],S[1]),m.lineTo(S[2],S[3]),m.lineTo(S[4],S[5]),m.lineTo(S[6],S[7]),m.moveTo(Vt[6],Vt[7]),m.lineTo(Vt[4],Vt[5]),m.lineTo(Vt[2],Vt[3]),m.lineTo(Vt[0],Vt[1]),m.clip())}M.push(S),A.push(D),this.drawTile(ht,t,Dt,Jt,An,Pn,mt,Xs),sn&&m.restore(),this.renderedTiles.unshift(ht),this.updateUsedTiles(t.usedTiles,c,ht)}}if(this.renderedResolution=_,this.extentChanged=!this.renderedExtent_||!yn(this.renderedExtent_,R),this.renderedExtent_=R,this.renderedPixelRatio=l,this.postRender(this.context,t),n.extent&&m.restore(),m.imageSmoothingEnabled=!0,this.renderComplete){const F=(D,k)=>{const B=Z(c),U=k.wantedTiles[B],V=U?Object.keys(U).length:0;this.updateCacheSize(V),this.tileCache_.expireCache()};t.postRenderFunctions.push(F)}return this.container}updateCacheSize(t){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,t*2)}drawTile(t,e,n,s,r,a,o,l){let h;if(t instanceof Gr){if(h=Ms(t.getData()),!h)throw new Error("Rendering array data is not yet supported")}else h=this.getTileImage(t);if(!h)return;const c=this.getRenderContext(e),u=Z(this),f=e.layerStatesArray[e.layerIndex],_=f.opacity*(l?t.getAlpha(u,e.time):1),g=_!==c.globalAlpha;g&&(c.save(),c.globalAlpha=_),c.drawImage(h,o,o,h.width-2*o,h.height-2*o,n,s,r,a),g&&c.restore(),_!==f.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}updateUsedTiles(t,e,n){const s=Z(e);s in t||(t[s]={}),t[s][n.getKey()]=!0}}class _d extends A0{constructor(t){super(t)}createRenderer(){return new v_(this,{cacheSize:this.getCacheSize()})}}class w_{drawCustom(t,e,n,s,r){}drawGeometry(t){}setStyle(t){}drawCircle(t,e,n){}drawFeature(t,e,n){}drawGeometryCollection(t,e,n){}drawLineString(t,e,n){}drawMultiLineString(t,e,n){}drawMultiPoint(t,e,n){}drawMultiPolygon(t,e,n){}drawPoint(t,e,n){}drawPolygon(t,e,n){}drawText(t,e,n){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}const J={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Ua=[J.FILL],Bi=[J.STROKE],gn=[J.BEGIN_PATH],md=[J.CLOSE_PATH];class ca extends w_{constructor(t,e,n,s){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=s,this.maxLineWidth=0,this.resolution=n,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})}appendFlatPointCoordinates(t,e){const n=this.getBufferedMaxExtent(),s=this.tmpCoordinate_,r=this.coordinates;let a=r.length;for(let o=0,l=t.length;o<l;o+=e)s[0]=t[o],s[1]=t[o+1],wi(n,s)&&(r[a++]=s[0],r[a++]=s[1]);return a}appendFlatLineCoordinates(t,e,n,s,r,a){const o=this.coordinates;let l=o.length;const h=this.getBufferedMaxExtent();a&&(e+=s);let c=t[e],u=t[e+1];const f=this.tmpCoordinate_;let _=!0,g,x,y;for(g=e+s;g<n;g+=s)f[0]=t[g],f[1]=t[g+1],y=lh(h,f),y!==x?(_&&(o[l++]=c,o[l++]=u,_=!1),o[l++]=f[0],o[l++]=f[1]):y===$t.INTERSECTING?(o[l++]=f[0],o[l++]=f[1],_=!1):_=!0,c=f[0],u=f[1],x=y;return(r&&_||g===e+s)&&(o[l++]=c,o[l++]=u),l}drawCustomCoordinates_(t,e,n,s,r){for(let a=0,o=n.length;a<o;++a){const l=n[a],h=this.appendFlatLineCoordinates(t,e,l,s,!1,!1);r.push(h),e=l}return e}drawCustom(t,e,n,s,r){this.beginGeometry(t,e,r);const a=t.getType(),o=t.getStride(),l=this.coordinates.length;let h,c,u,f,_;switch(a){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),f=[];const g=t.getEndss();_=0;for(let x=0,y=g.length;x<y;++x){const w=[];_=this.drawCustomCoordinates_(h,_,g[x],o,w),f.push(w)}this.instructions.push([J.CUSTOM,l,f,t,n,gh,r]),this.hitDetectionInstructions.push([J.CUSTOM,l,f,t,s||n,gh,r]);break;case"Polygon":case"MultiLineString":u=[],h=a=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),_=this.drawCustomCoordinates_(h,0,t.getEnds(),o,u),this.instructions.push([J.CUSTOM,l,u,t,n,Cr,r]),this.hitDetectionInstructions.push([J.CUSTOM,l,u,t,s||n,Cr,r]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),c=this.appendFlatLineCoordinates(h,0,h.length,o,!1,!1),this.instructions.push([J.CUSTOM,l,c,t,n,ki,r]),this.hitDetectionInstructions.push([J.CUSTOM,l,c,t,s||n,ki,r]);break;case"MultiPoint":h=t.getFlatCoordinates(),c=this.appendFlatPointCoordinates(h,o),c>l&&(this.instructions.push([J.CUSTOM,l,c,t,n,ki,r]),this.hitDetectionInstructions.push([J.CUSTOM,l,c,t,s||n,ki,r]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),c=this.coordinates.length,this.instructions.push([J.CUSTOM,l,c,t,n,void 0,r]),this.hitDetectionInstructions.push([J.CUSTOM,l,c,t,s||n,void 0,r]);break}this.endGeometry(e)}beginGeometry(t,e,n){this.beginGeometryInstruction1_=[J.BEGIN_GEOMETRY,e,0,t,n],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[J.BEGIN_GEOMETRY,e,0,t,n],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const n=t.length;let s,r,a=-1;for(e=0;e<n;++e)s=t[e],r=s[0],r==J.END_GEOMETRY?a=e:r==J.BEGIN_GEOMETRY&&(s[2]=e,Jm(this.hitDetectionInstructions,a,e),a=-1)}fillStyleToState(t,e={}){if(t){const n=t.getColor();e.fillPatternScale=n&&typeof n=="object"&&"src"in n?this.pixelRatio:1,e.fillStyle=ii(n||_e)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){const n=t.getColor();e.strokeStyle=ii(n||Pr);const s=t.getLineCap();e.lineCap=s!==void 0?s:Ss;const r=t.getLineDash();e.lineDash=r?r.slice():Ei;const a=t.getLineDashOffset();e.lineDashOffset=a||vi;const o=t.getLineJoin();e.lineJoin=o!==void 0?o:Rs;const l=t.getWidth();e.lineWidth=l!==void 0?l:Or;const h=t.getMiterLimit();e.miterLimit=h!==void 0?h:Ar,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){const n=this.state;this.fillStyleToState(t,n),this.strokeStyleToState(e,n)}createFill(t){const e=t.fillStyle,n=[J.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(t.fillPatternScale),n}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[J.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(this.instructions.push(e.call(this,t)),t.currentFillStyle=n)}updateStrokeStyle(t,e){const n=t.strokeStyle,s=t.lineCap,r=t.lineDash,a=t.lineDashOffset,o=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=s||r!=t.currentLineDash&&!Ji(t.currentLineDash,r)||t.currentLineDashOffset!=a||t.currentLineJoin!=o||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=s,t.currentLineDash=r,t.currentLineDashOffset=a,t.currentLineJoin=o,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[J.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=mg(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ai(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Uw extends ca{constructor(t,e,n,s){super(t,e,n,s),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,n){if(!this.image_||this.maxExtent&&!wi(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,n);const s=t.getFlatCoordinates(),r=t.getStride(),a=this.coordinates.length,o=this.appendFlatPointCoordinates(s,r);this.instructions.push([J.DRAW_IMAGE,a,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([J.DRAW_IMAGE,a,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,n){if(!this.image_)return;this.beginGeometry(t,e,n);const s=t.getFlatCoordinates(),r=[];for(let l=0,h=s.length;l<h;l+=t.getStride())(!this.maxExtent||wi(this.maxExtent,s.slice(l,l+2)))&&r.push(s[l],s[l+1]);const a=this.coordinates.length,o=this.appendFlatPointCoordinates(r,2);this.instructions.push([J.DRAW_IMAGE,a,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([J.DRAW_IMAGE,a,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const n=t.getAnchor(),s=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=s[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=s[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class Bw extends ca{constructor(t,e,n,s){super(t,e,n,s)}drawFlatCoordinates_(t,e,n,s){const r=this.coordinates.length,a=this.appendFlatLineCoordinates(t,e,n,s,!1,!1),o=[J.MOVE_TO_LINE_TO,r,a];return this.instructions.push(o),this.hitDetectionInstructions.push(o),n}drawLineString(t,e,n){const s=this.state,r=s.strokeStyle,a=s.lineWidth;if(r===void 0||a===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([J.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Ei,vi],gn);const o=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(o,0,o.length,l),this.hitDetectionInstructions.push(Bi),this.endGeometry(e)}drawMultiLineString(t,e,n){const s=this.state,r=s.strokeStyle,a=s.lineWidth;if(r===void 0||a===void 0)return;this.updateStrokeStyle(s,this.applyStroke),this.beginGeometry(t,e,n),this.hitDetectionInstructions.push([J.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Ei,vi],gn);const o=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,f=o.length;u<f;++u)c=this.drawFlatCoordinates_(l,c,o[u],h);this.hitDetectionInstructions.push(Bi),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Bi),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Bi),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(gn)}}class pd extends ca{constructor(t,e,n,s){super(t,e,n,s)}drawFlatCoordinatess_(t,e,n,s){const r=this.state,a=r.fillStyle!==void 0,o=r.strokeStyle!==void 0,l=n.length;this.instructions.push(gn),this.hitDetectionInstructions.push(gn);for(let h=0;h<l;++h){const c=n[h],u=this.coordinates.length,f=this.appendFlatLineCoordinates(t,e,c,s,!0,!o),_=[J.MOVE_TO_LINE_TO,u,f];this.instructions.push(_),this.hitDetectionInstructions.push(_),o&&(this.instructions.push(md),this.hitDetectionInstructions.push(md)),e=c}return a&&(this.instructions.push(Ua),this.hitDetectionInstructions.push(Ua)),o&&(this.instructions.push(Bi),this.hitDetectionInstructions.push(Bi)),e}drawCircle(t,e,n){const s=this.state,r=s.fillStyle,a=s.strokeStyle;if(r===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([J.SET_FILL_STYLE,_e]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([J.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Ei,vi]);const o=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,l,!1,!1);const c=[J.CIRCLE,h];this.instructions.push(gn,c),this.hitDetectionInstructions.push(gn,c),s.fillStyle!==void 0&&(this.instructions.push(Ua),this.hitDetectionInstructions.push(Ua)),s.strokeStyle!==void 0&&(this.instructions.push(Bi),this.hitDetectionInstructions.push(Bi)),this.endGeometry(e)}drawPolygon(t,e,n){const s=this.state,r=s.fillStyle,a=s.strokeStyle;if(r===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([J.SET_FILL_STYLE,_e]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([J.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Ei,vi]);const o=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,o,h),this.endGeometry(e)}drawMultiPolygon(t,e,n){const s=this.state,r=s.fillStyle,a=s.strokeStyle;if(r===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,n),s.fillStyle!==void 0&&this.hitDetectionInstructions.push([J.SET_FILL_STYLE,_e]),s.strokeStyle!==void 0&&this.hitDetectionInstructions.push([J.SET_STROKE_STYLE,s.strokeStyle,s.lineWidth,s.lineCap,s.lineJoin,s.miterLimit,Ei,vi]);const o=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let c=0;for(let u=0,f=o.length;u<f;++u)c=this.drawFlatCoordinatess_(l,c,o[u],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let n=0,s=e.length;n<s;++n)e[n]=ln(e[n],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;this.updateFillStyle(t,this.createFill),this.updateStrokeStyle(t,this.applyStroke)}}function zw(i,t,e,n,s){const r=[];let a=e,o=0,l=t.slice(e,2);for(;o<i&&a+s<n;){const[h,c]=l.slice(-2),u=t[a+s],f=t[a+s+1],_=Math.sqrt((u-h)*(u-h)+(f-c)*(f-c));if(o+=_,o>=i){const g=(i-o+_)/_,x=Te(h,u,g),y=Te(c,f,g);l.push(x,y),r.push(l),l=[x,y],o==i&&(a+=s),o=0}else if(o<i)l.push(t[a+s],t[a+s+1]),a+=s;else{const g=_-o,x=Te(h,u,g/_),y=Te(c,f,g/_);l.push(x,y),r.push(l),l=[x,y],o=0,a+=s}}return o>0&&r.push(l),r}function Xw(i,t,e,n,s){let r=e,a=e,o=0,l=0,h=e,c,u,f,_,g,x,y,w,d,p;for(u=e;u<n;u+=s){const v=t[u],T=t[u+1];g!==void 0&&(d=v-g,p=T-x,_=Math.sqrt(d*d+p*p),y!==void 0&&(l+=f,c=Math.acos((y*d+w*p)/(f*_)),c>i&&(l>o&&(o=l,r=h,a=u),l=0,h=u-s)),f=_,y=d,w=p),g=v,x=T}return l+=_,l>o?[h,u]:[r,a]}const So={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class jw extends ca{constructor(t,e,n,s){super(t,e,n,s),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[_e]={fillStyle:_e},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,n){const s=this.textFillState_,r=this.textStrokeState_,a=this.textState_;if(this.text_===""||!a||!s&&!r)return;const o=this.coordinates;let l=o.length;const h=t.getType();let c=null,u=t.getStride();if(a.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!Pt(this.maxExtent,t.getExtent()))return;let f;if(c=t.getFlatCoordinates(),h=="LineString")f=[c.length];else if(h=="MultiLineString")f=t.getEnds();else if(h=="Polygon")f=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const y=t.getEndss();f=[];for(let w=0,d=y.length;w<d;++w)f.push(y[w][0])}this.beginGeometry(t,e,n);const _=a.repeat,g=_?void 0:a.textAlign;let x=0;for(let y=0,w=f.length;y<w;++y){let d;_?d=zw(_*this.resolution,c,x,f[y],u):d=[c.slice(x,f[y])];for(let p=0,v=d.length;p<v;++p){const T=d[p];let R=0,C=T.length;if(g==null){const I=Xw(a.maxAngle,T,0,T.length,2);R=I[0],C=I[1]}for(let I=R;I<C;I+=u)o.push(T[I],T[I+1]);const b=o.length;x=f[y],this.drawChars_(l,b),l=b}}this.endGeometry(e)}else{let f=a.overflow?null:[];switch(h){case"Point":case"MultiPoint":c=t.getFlatCoordinates();break;case"LineString":c=t.getFlatMidpoint();break;case"Circle":c=t.getCenter();break;case"MultiLineString":c=t.getFlatMidpoints(),u=2;break;case"Polygon":c=t.getFlatInteriorPoint(),a.overflow||f.push(c[2]/this.resolution),u=3;break;case"MultiPolygon":const v=t.getFlatInteriorPoints();c=[];for(let T=0,R=v.length;T<R;T+=3)a.overflow||f.push(v[T+2]/this.resolution),c.push(v[T],v[T+1]);if(c.length===0)return;u=2;break}const _=this.appendFlatPointCoordinates(c,u);if(_===l)return;if(f&&(_-l)/2!==c.length/u){let v=l/2;f=f.filter((T,R)=>{const C=o[(v+R)*2]===c[R*u]&&o[(v+R)*2+1]===c[R*u+1];return C||--v,C})}this.saveTextStates_();const g=a.backgroundFill?this.createFill(this.fillStyleToState(a.backgroundFill)):null,x=a.backgroundStroke?this.createStroke(this.strokeStyleToState(a.backgroundStroke)):null;this.beginGeometry(t,e,n);let y=a.padding;if(y!=dn&&(a.scale[0]<0||a.scale[1]<0)){let v=a.padding[0],T=a.padding[1],R=a.padding[2],C=a.padding[3];a.scale[0]<0&&(T=-T,C=-C),a.scale[1]<0&&(v=-v,R=-R),y=[v,T,R,C]}const w=this.pixelRatio;this.instructions.push([J.DRAW_IMAGE,l,_,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,y==dn?dn:y.map(function(v){return v*w}),g,x,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);const d=1/w,p=g?g.slice(0):null;p&&(p[1]=_e),this.hitDetectionInstructions.push([J.DRAW_IMAGE,l,_,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[d,d],NaN,this.declutterMode_,this.declutterImageWithText_,y,p,x,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?_e:this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,s=this.strokeKey_;t&&(s in this.strokeStates||(this.strokeStates[s]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||Lr,justify:e.justify,textBaseline:e.textBaseline||_o,scale:e.scale});const a=this.fillKey_;n&&(a in this.fillStates||(this.fillStates[a]={fillStyle:n.fillStyle}))}drawChars_(t,e){const n=this.textStrokeState_,s=this.textState_,r=this.strokeKey_,a=this.textKey_,o=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=So[s.textBaseline],c=this.textOffsetY_*l,u=this.text_,f=n?n.lineWidth*Math.abs(s.scale[0])/2:0;this.instructions.push([J.DRAW_CHARS,t,e,h,s.overflow,o,s.maxAngle,l,c,r,f*l,u,a,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([J.DRAW_CHARS,t,e,h,s.overflow,o&&_e,s.maxAngle,l,c,r,f*l,u,a,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let n,s,r;if(!t)this.text_="";else{const a=t.getFill();a?(s=this.textFillState_,s||(s={},this.textFillState_=s),s.fillStyle=ii(a.getColor()||_e)):(s=null,this.textFillState_=s);const o=t.getStroke();if(!o)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const x=o.getLineDash(),y=o.getLineDashOffset(),w=o.getWidth(),d=o.getMiterLimit();r.lineCap=o.getLineCap()||Ss,r.lineDash=x?x.slice():Ei,r.lineDashOffset=y===void 0?vi:y,r.lineJoin=o.getLineJoin()||Rs,r.lineWidth=w===void 0?Or:w,r.miterLimit=d===void 0?Ar:d,r.strokeStyle=ii(o.getColor()||Pr)}n=this.textState_;const l=t.getFont()||a0;Qy(l);const h=t.getScaleArray();n.overflow=t.getOverflow(),n.font=l,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.repeat=t.getRepeat(),n.justify=t.getJustify(),n.textBaseline=t.getTextBaseline()||_o,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||dn,n.scale=h===void 0?[1,1]:h;const c=t.getOffsetX(),u=t.getOffsetY(),f=t.getRotateWithView(),_=t.getKeepUpright(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=u===void 0?0:u,this.textRotateWithView_=f===void 0?!1:f,this.textKeepUpright_=_===void 0?!0:_,this.textRotation_=g===void 0?0:g,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:Z(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.repeat||"?")+(n.justify||"?")+(n.textBaseline||"?"),this.fillKey_=s&&s.fillStyle?typeof s.fillStyle=="string"?s.fillStyle:"|"+Z(s.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Vw={Circle:pd,Default:ca,Image:Uw,LineString:Bw,Polygon:pd,Text:jw};class T_{constructor(t,e,n,s){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=s,this.resolution_=n,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const n=this.buildersByZIndex_[e];for(const s in n){const r=n[s].finish();t[e][s]=r}}return t}getBuilder(t,e){const n=t!==void 0?t.toString():"0";let s=this.buildersByZIndex_[n];s===void 0&&(s={},this.buildersByZIndex_[n]=s);let r=s[e];if(r===void 0){const a=Vw[e];r=new a(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),s[e]=r}return r}}function $w(i,t,e,n,s,r,a,o,l,h,c,u,f=!0){let _=i[t],g=i[t+1],x=0,y=0,w=0,d=0;function p(){x=_,y=g,t+=n,_=i[t],g=i[t+1],d+=w,w=Math.sqrt((_-x)*(_-x)+(g-y)*(g-y))}do p();while(t<e-n&&d+w<r);let v=w===0?0:(r-d)/w;const T=Te(x,_,v),R=Te(y,g,v),C=t-n,b=d,I=r+o*l(h,s,c);for(;t<e-n&&d+w<I;)p();v=w===0?0:(I-d)/w;const P=Te(x,_,v),G=Te(y,g,v);let O=!1;if(f)if(u){const A=[T,R,P,G];Pg(A,0,4,2,u,A,A),O=A[0]>A[2]}else O=T>P;const m=Math.PI,E=[],S=C+n===t;t=C,w=0,d=b,_=i[t],g=i[t+1];let M;if(S){p(),M=Math.atan2(g-y,_-x),O&&(M+=M>0?-m:m);const A=(P+T)/2,F=(G+R)/2;return E[0]=[A,F,(I-r)/2,M,s],E}s=s.replace(/\n/g," ");for(let A=0,F=s.length;A<F;){p();let D=Math.atan2(g-y,_-x);if(O&&(D+=D>0?-m:m),M!==void 0){let W=D-M;if(W+=W>m?-2*m:W<-m?2*m:0,Math.abs(W)>a)return null}M=D;const k=A;let B=0;for(;A<F;++A){const W=O?F-A-1:A,H=o*l(h,s[W],c);if(t+n<e&&d+w<r+B+H/2)break;B+=H}if(A===k)continue;const U=O?s.substring(F-k,F-A):s.substring(k,A);v=w===0?0:(r+B/2-d)/w;const V=Te(x,_,v),q=Te(y,g,v);E.push([V,q,B/2,D,U]),r+=B}return E}const Vn=xe(),Li=[],_i=[],mi=[],Oi=[];function yd(i){return i[3].declutterBox}const xd=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function Yl(i,t){return t==="start"?t=xd.test(i)?"right":"left":t==="end"&&(t=xd.test(i)?"left":"right"),So[t]}function Ww(i,t,e){return e>0&&i.push(`
`,""),i.push(t,""),i}function qw(i,t,e){return e%2===0&&(i+=t),i}class Kw{constructor(t,e,n,s,r){this.overlaps=n,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=s.instructions,this.coordinates=s.coordinates,this.coordinateCache_={},this.renderedTransform_=Zt(),this.hitDetectionInstructions=s.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=s.fillStates||{},this.strokeStates=s.strokeStates||{},this.textStates=s.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=r?new Eu:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,n,s){const r=t+e+n+s;if(this.labels_[r])return this.labels_[r];const a=s?this.strokeStates[s]:null,o=n?this.fillStates[n]:null,l=this.textStates[e],h=this.pixelRatio,c=[l.scale[0]*h,l.scale[1]*h],u=l.justify?So[l.justify]:Yl(Array.isArray(t)?t[0]:t,l.textAlign||Lr),f=s&&a.lineWidth?a.lineWidth:0,_=Array.isArray(t)?t:String(t).split(`
`).reduce(Ww,[]),{width:g,height:x,widths:y,heights:w,lineWidths:d}=tx(l,_),p=g+f,v=[],T=(p+2)*c[0],R=(x+f)*c[1],C={width:T<0?Math.floor(T):Math.ceil(T),height:R<0?Math.floor(R):Math.ceil(R),contextInstructions:v};(c[0]!=1||c[1]!=1)&&v.push("scale",c),s&&(v.push("strokeStyle",a.strokeStyle),v.push("lineWidth",f),v.push("lineCap",a.lineCap),v.push("lineJoin",a.lineJoin),v.push("miterLimit",a.miterLimit),v.push("setLineDash",[a.lineDash]),v.push("lineDashOffset",a.lineDashOffset)),n&&v.push("fillStyle",o.fillStyle),v.push("textBaseline","middle"),v.push("textAlign","center");const b=.5-u;let I=u*p+b*f;const P=[],G=[];let O=0,m=0,E=0,S=0,M;for(let A=0,F=_.length;A<F;A+=2){const D=_[A];if(D===`
`){m+=O,O=0,I=u*p+b*f,++S;continue}const k=_[A+1]||l.font;k!==M&&(s&&P.push("font",k),n&&G.push("font",k),M=k),O=Math.max(O,w[E]);const B=[D,I+b*y[E]+u*(y[E]-d[S]),.5*(f+O)+m];I+=y[E],s&&P.push("strokeText",B),n&&G.push("fillText",B),++E}return Array.prototype.push.apply(v,P),Array.prototype.push.apply(v,G),this.labels_[r]=C,C}replayTextBackground_(t,e,n,s,r,a,o){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,r),t.lineTo.apply(t,e),a&&(this.alignAndScaleFill_=a[2],t.fillStyle=a[1],this.fill_(t)),o&&(this.setStrokeStyle_(t,o),t.stroke())}calculateImageOrLabelDimensions_(t,e,n,s,r,a,o,l,h,c,u,f,_,g,x,y){o*=f[0],l*=f[1];let w=n-o,d=s-l;const p=r+h>t?t-h:r,v=a+c>e?e-c:a,T=g[3]+p*f[0]+g[1],R=g[0]+v*f[1]+g[2],C=w-g[3],b=d-g[0];(x||u!==0)&&(Li[0]=C,Oi[0]=C,Li[1]=b,_i[1]=b,_i[0]=C+T,mi[0]=_i[0],mi[1]=b+R,Oi[1]=mi[1]);let I;return u!==0?(I=Ne(Zt(),n,s,1,1,u,-n,-s),kt(I,Li),kt(I,_i),kt(I,mi),kt(I,Oi),Ti(Math.min(Li[0],_i[0],mi[0],Oi[0]),Math.min(Li[1],_i[1],mi[1],Oi[1]),Math.max(Li[0],_i[0],mi[0],Oi[0]),Math.max(Li[1],_i[1],mi[1],Oi[1]),Vn)):Ti(Math.min(C,C+T),Math.min(b,b+R),Math.max(C,C+T),Math.max(b,b+R),Vn),_&&(w=Math.round(w),d=Math.round(d)),{drawImageX:w,drawImageY:d,drawImageW:p,drawImageH:v,originX:h,originY:c,declutterBox:{minX:Vn[0],minY:Vn[1],maxX:Vn[2],maxY:Vn[3],value:y},canvasTransform:I,scale:f}}replayImageOrLabel_(t,e,n,s,r,a,o){const l=!!(a||o),h=s.declutterBox,c=o?o[2]*s.scale[0]/2:0;return h.minX-c<=e[0]&&h.maxX+c>=0&&h.minY-c<=e[1]&&h.maxY+c>=0&&(l&&this.replayTextBackground_(t,Li,_i,mi,Oi,a,o),ex(t,s.canvasTransform,r,n,s.originX,s.originY,s.drawImageW,s.drawImageH,s.drawImageX,s.drawImageY,s.scale)),!0}fill_(t){const e=this.alignAndScaleFill_;if(e){const n=kt(this.renderedTransform_,[0,0]),s=512*this.pixelRatio;t.save(),t.translate(n[0]%s,n[1]%s),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],e[1]&&(t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6]))}drawLabelWithPointPlacement_(t,e,n,s){const r=this.textStates[e],a=this.createLabel(t,e,s,n),o=this.strokeStates[n],l=this.pixelRatio,h=Yl(Array.isArray(t)?t[0]:t,r.textAlign||Lr),c=So[r.textBaseline||_o],u=o&&o.lineWidth?o.lineWidth:0,f=a.width/l-2*r.scale[0],_=h*f+2*(.5-h)*u,g=c*a.height/l+2*(.5-c)*u;return{label:a,anchorX:_,anchorY:g}}execute_(t,e,n,s,r,a,o,l){const h=this.zIndexContext_;let c;this.pixelCoordinates_&&Ji(n,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=Vi(this.coordinates,0,this.coordinates.length,2,n,this.pixelCoordinates_),e1(this.renderedTransform_,n));let u=0;const f=s.length;let _=0,g,x,y,w,d,p,v,T,R,C,b,I,P,G=0,O=0;const m=this.coordinateCache_,E=this.viewRotation_,S=Math.round(Math.atan2(-n[1],n[0])*1e12)/1e12,M={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:E},A=this.instructions!=s||this.overlaps?0:200;let F,D,k,B;for(;u<f;){const U=s[u];switch(U[0]){case J.BEGIN_GEOMETRY:F=U[1],B=U[3],F.getGeometry()?o!==void 0&&!Pt(o,B.getExtent())?u=U[2]+1:++u:u=U[2],h&&(h.zIndex=U[4]);break;case J.BEGIN_PATH:G>A&&(this.fill_(t),G=0),O>A&&(t.stroke(),O=0),!G&&!O&&(t.beginPath(),d=NaN,p=NaN),++u;break;case J.CIRCLE:_=U[1];const q=c[_],W=c[_+1],H=c[_+2],et=c[_+3],mt=H-q,ht=et-W,dt=Math.sqrt(mt*mt+ht*ht);t.moveTo(q+dt,W),t.arc(q,W,dt,0,2*Math.PI,!0),++u;break;case J.CLOSE_PATH:t.closePath(),++u;break;case J.CUSTOM:_=U[1],g=U[2];const St=U[3],Ut=U[4],Ft=U[5];M.geometry=St,M.feature=F,u in m||(m[u]=[]);const jt=m[u];Ft?Ft(c,_,g,2,jt):(jt[0]=c[_],jt[1]=c[_+1],jt.length=2),h&&(h.zIndex=U[6]),Ut(jt,M),++u;break;case J.DRAW_IMAGE:_=U[1],g=U[2],R=U[3],x=U[4],y=U[5];let Dt=U[6];const Jt=U[7],An=U[8],Pn=U[9],Xs=U[10];let sn=U[11];const Ln=U[12];let On=U[13];w=U[14]||"declutter";const Vt=U[15];if(!R&&U.length>=20){C=U[19],b=U[20],I=U[21],P=U[22];const Ce=this.drawLabelWithPointPlacement_(C,b,I,P);R=Ce.label,U[3]=R;const rn=U[23];x=(Ce.anchorX-rn)*this.pixelRatio,U[4]=x;const be=U[24];y=(Ce.anchorY-be)*this.pixelRatio,U[5]=y,Dt=R.height,U[6]=Dt,On=R.width,U[13]=On}let ul;U.length>25&&(ul=U[25]);let fl,ya,xa;U.length>17?(fl=U[16],ya=U[17],xa=U[18]):(fl=dn,ya=null,xa=null),Xs&&S?sn+=E:!Xs&&!S&&(sn-=E);let bm=0;for(;_<g;_+=2){if(ul&&ul[bm++]<On/this.pixelRatio)continue;const Ce=this.calculateImageOrLabelDimensions_(R.width,R.height,c[_],c[_+1],On,Dt,x,y,An,Pn,sn,Ln,r,fl,!!ya||!!xa,F),rn=[t,e,R,Ce,Jt,ya,xa];if(l){let be,Ye,Ie;if(Vt){const Gt=g-_;if(!Vt[Gt]){Vt[Gt]={args:rn,declutterMode:w};continue}const re=Vt[Gt];be=re.args,Ye=re.declutterMode,delete Vt[Gt],Ie=yd(be)}let ui,fi;if(be&&(Ye!=="declutter"||!l.collides(Ie))&&(ui=!0),(w!=="declutter"||!l.collides(Ce.declutterBox))&&(fi=!0),Ye==="declutter"&&w==="declutter"){const Gt=ui&&fi;ui=Gt,fi=Gt}ui&&(Ye!=="none"&&l.insert(Ie),this.replayImageOrLabel_.apply(this,be)),fi&&(w!=="none"&&l.insert(Ce.declutterBox),this.replayImageOrLabel_.apply(this,rn))}else this.replayImageOrLabel_.apply(this,rn)}++u;break;case J.DRAW_CHARS:const Bu=U[1],zu=U[2],dl=U[3],Im=U[4];P=U[5];const Am=U[6],Xu=U[7],ju=U[8];I=U[9];const gl=U[10];C=U[11],Array.isArray(C)&&(C=C.reduce(qw,"")),b=U[12];const Vu=[U[13],U[13]];w=U[14]||"declutter";const Pm=U[15],_l=this.textStates[b],js=_l.font,Vs=[_l.scale[0]*Xu,_l.scale[1]*Xu];let $s;js in this.widths_?$s=this.widths_[js]:($s={},this.widths_[js]=$s);const $u=ou(c,Bu,zu,2),Wu=Math.abs(Vs[0])*Pf(js,C,$s);if(Im||Wu<=$u){const Ce=this.textStates[b].textAlign,rn=($u-Wu)*Yl(C,Ce),be=$w(c,Bu,zu,2,C,rn,Am,Math.abs(Vs[0]),Pf,js,$s,S?0:this.viewRotation_,Pm);t:if(be){const Ye=[];let Ie,ui,fi,Gt,re;if(I)for(Ie=0,ui=be.length;Ie<ui;++Ie){re=be[Ie],fi=re[4],Gt=this.createLabel(fi,b,"",I),x=re[2]+(Vs[0]<0?-gl:gl),y=dl*Gt.height+(.5-dl)*2*gl*Vs[1]/Vs[0]-ju;const di=this.calculateImageOrLabelDimensions_(Gt.width,Gt.height,re[0],re[1],Gt.width,Gt.height,x,y,0,0,re[3],Vu,!1,dn,!1,F);if(l&&w==="declutter"&&l.collides(di.declutterBox))break t;Ye.push([t,e,Gt,di,1,null,null])}if(P)for(Ie=0,ui=be.length;Ie<ui;++Ie){re=be[Ie],fi=re[4],Gt=this.createLabel(fi,b,P,""),x=re[2],y=dl*Gt.height-ju;const di=this.calculateImageOrLabelDimensions_(Gt.width,Gt.height,re[0],re[1],Gt.width,Gt.height,x,y,0,0,re[3],Vu,!1,dn,!1,F);if(l&&w==="declutter"&&l.collides(di.declutterBox))break t;Ye.push([t,e,Gt,di,1,null,null])}l&&w!=="none"&&l.load(Ye.map(yd));for(let di=0,Lm=Ye.length;di<Lm;++di)this.replayImageOrLabel_.apply(this,Ye[di])}}++u;break;case J.END_GEOMETRY:if(a!==void 0){F=U[1];const Ce=a(F,B,w);if(Ce)return Ce}++u;break;case J.FILL:A?G++:this.fill_(t),++u;break;case J.MOVE_TO_LINE_TO:for(_=U[1],g=U[2],D=c[_],k=c[_+1],t.moveTo(D,k),d=D+.5|0,p=k+.5|0,_+=2;_<g;_+=2)D=c[_],k=c[_+1],v=D+.5|0,T=k+.5|0,(_==g-2||v!==d||T!==p)&&(t.lineTo(D,k),d=v,p=T);++u;break;case J.SET_FILL_STYLE:this.alignAndScaleFill_=U[2],G&&(this.fill_(t),G=0,O&&(t.stroke(),O=0)),t.fillStyle=U[1],++u;break;case J.SET_STROKE_STYLE:O&&(t.stroke(),O=0),this.setStrokeStyle_(t,U),++u;break;case J.STROKE:A?O++:t.stroke(),++u;break;default:++u;break}}G&&this.fill_(t),O&&t.stroke()}execute(t,e,n,s,r,a){this.viewRotation_=s,this.execute_(t,e,n,this.instructions,r,void 0,void 0,a)}executeHitDetection(t,e,n,s,r){return this.viewRotation_=n,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,s,r)}}const cn=["Polygon","Circle","LineString","Image","Text","Default"],Ro=["Image","Text"],Hw=cn.filter(i=>!Ro.includes(i));class S_{constructor(t,e,n,s,r,a,o){this.maxExtent_=t,this.overlaps_=s,this.pixelRatio_=n,this.resolution_=e,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Zt(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(r,o)}clip(t,e){const n=this.getClipCoords(e);t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(n[2],n[3]),t.lineTo(n[4],n[5]),t.lineTo(n[6],n[7]),t.clip()}createExecutors_(t,e){for(const n in t){let s=this.executorsByZIndex_[n];s===void 0&&(s={},this.executorsByZIndex_[n]=s);const r=t[n];for(const a in r){const o=r[a];s[a]=new Kw(this.resolution_,this.pixelRatio_,this.overlaps_,o,e)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const n=this.executorsByZIndex_[e];for(let s=0,r=t.length;s<r;++s)if(t[s]in n)return!0}return!1}forEachFeatureAtCoordinate(t,e,n,s,r,a){s=Math.round(s);const o=s*2+1,l=Ne(this.hitDetectionTransform_,s+.5,s+.5,1/e,-1/e,-n,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=Ot(o,o));const c=this.hitDetectionContext_;c.canvas.width!==o||c.canvas.height!==o?(c.canvas.width=o,c.canvas.height=o):h||c.clearRect(0,0,o,o);let u;this.renderBuffer_!==void 0&&(u=xe(),fr(u,t),ai(u,e*(this.renderBuffer_+s),u));const f=Yw(s);let _;function g(T,R,C){const b=c.getImageData(0,0,o,o).data;for(let I=0,P=f.length;I<P;I++)if(b[f[I]]>0){if(!a||C==="none"||_!=="Image"&&_!=="Text"||a.includes(T)){const G=(f[I]-3)/4,O=s-G%o,m=s-(G/o|0),E=r(T,R,O*O+m*m);if(E)return E}c.clearRect(0,0,o,o);break}}const x=Object.keys(this.executorsByZIndex_).map(Number);x.sort(si);let y,w,d,p,v;for(y=x.length-1;y>=0;--y){const T=x[y].toString();for(d=this.executorsByZIndex_[T],w=cn.length-1;w>=0;--w)if(_=cn[w],p=d[_],p!==void 0&&(v=p.executeHitDetection(c,l,n,g,u),v))return v}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const n=e[0],s=e[1],r=e[2],a=e[3],o=[n,s,n,a,r,a,r,s];return Vi(o,0,8,2,t,o),o}isEmpty(){return qi(this.executorsByZIndex_)}execute(t,e,n,s,r,a,o){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(o?ug:si),a=a||cn;const h=cn.length;for(let c=0,u=l.length;c<u;++c){const f=l[c].toString(),_=this.executorsByZIndex_[f];for(let g=0,x=a.length;g<x;++g){const y=a[g],w=_[y];if(w!==void 0){const d=o===null?void 0:w.getZIndexContext(),p=d?d.getContext():t,v=this.maxExtent_&&y!=="Image"&&y!=="Text";if(v&&(p.save(),this.clip(p,n)),!d||y==="Text"||y==="Image"?w.execute(p,e,n,s,r,o):d.pushFunction(T=>w.execute(T,e,n,s,r,o)),v&&p.restore(),d){d.offset();const T=l[c]*h+cn.indexOf(y);this.deferredZIndexContexts_[T]||(this.deferredZIndexContexts_[T]=[]),this.deferredZIndexContexts_[T].push(d)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(si);for(let n=0,s=e.length;n<s;++n)t[e[n]].forEach(r=>{r.draw(this.renderedContext_),r.clear()}),t[e[n]].length=0}}const Zl={};function Yw(i){if(Zl[i]!==void 0)return Zl[i];const t=i*2+1,e=i*i,n=new Array(e+1);for(let r=0;r<=i;++r)for(let a=0;a<=i;++a){const o=r*r+a*a;if(o>e)break;let l=n[o];l||(l=[],n[o]=l),l.push(((i+r)*t+(i+a))*4+3),r>0&&l.push(((i-r)*t+(i+a))*4+3),a>0&&(l.push(((i+r)*t+(i-a))*4+3),r>0&&l.push(((i-r)*t+(i-a))*4+3))}const s=[];for(let r=0,a=n.length;r<a;++r)n[r]&&s.push(...n[r]);return Zl[i]=s,s}class Zw extends w_{constructor(t,e,n,s,r,a,o){super(),this.context_=t,this.pixelRatio_=e,this.extent_=n,this.transform_=s,this.transformRotation_=s?Kr(Math.atan2(s[1],s[0]),10):0,this.viewRotation_=r,this.squaredTolerance_=a,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Zt()}drawImages_(t,e,n,s){if(!this.image_)return;const r=Vi(t,e,n,s,this.transform_,this.pixelCoordinates_),a=this.context_,o=this.tmpLocalTransform_,l=a.globalAlpha;this.imageOpacity_!=1&&(a.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.transformRotation_===0&&(h-=this.viewRotation_),this.imageRotateWithView_&&(h+=this.viewRotation_);for(let c=0,u=r.length;c<u;c+=2){const f=r[c]-this.imageAnchorX_,_=r[c+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const g=f+this.imageAnchorX_,x=_+this.imageAnchorY_;Ne(o,g,x,1,1,h,-g,-x),a.save(),a.transform.apply(a,o),a.translate(g,x),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.restore()}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,_,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(a.globalAlpha=l)}drawText_(t,e,n,s){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=Vi(t,e,n,s,this.transform_,this.pixelCoordinates_),a=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);e<n;e+=s){const l=r[e]+this.textOffsetX_,h=r[e+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(a.save(),a.translate(l-this.textOffsetX_,h-this.textOffsetY_),a.rotate(o),a.translate(this.textOffsetX_,this.textOffsetY_),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.restore()):(this.textStrokeState_&&a.strokeText(this.text_,l,h),this.textFillState_&&a.fillText(this.text_,l,h))}}moveToLineTo_(t,e,n,s,r){const a=this.context_,o=Vi(t,e,n,s,this.transform_,this.pixelCoordinates_);a.moveTo(o[0],o[1]);let l=o.length;r&&(l-=2);for(let h=2;h<l;h+=2)a.lineTo(o[h],o[h+1]);return r&&a.closePath(),n}drawRings_(t,e,n,s){for(let r=0,a=n.length;r<a;++r)e=this.moveToLineTo_(t,e,n[r],s,!0);return e}drawCircle(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Pt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=c1(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],s=e[3]-e[1],r=Math.sqrt(n*n+s*s),a=this.context_;a.beginPath(),a.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const n=e.getGeometryFunction()(t);n&&(this.setStyle(e),this.drawGeometry(n))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let n=0,s=e.length;n<s;++n)this.drawGeometry(e[n])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Pt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(Pt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const n=this.context_,s=t.getFlatCoordinates();let r=0;const a=t.getEnds(),o=t.getStride();n.beginPath();for(let l=0,h=a.length;l<h;++l)r=this.moveToLineTo_(s,r,a[l],o,!1);n.stroke()}if(this.text_!==""){const n=t.getFlatMidpoints();this.drawText_(n,0,n.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Pt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Pt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,n=t.getOrientedFlatCoordinates();let s=0;const r=t.getEndss(),a=t.getStride();e.beginPath();for(let o=0,l=r.length;o<l;++o){const h=r[o];s=this.drawRings_(n,s,h,a)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),Ji(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,n=this.contextTextState_,s=t.textAlign?t.textAlign:Lr;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=s&&(n.textAlign=s,e.textAlign=s),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=s,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:s,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const n=t.getColor();this.fillState_={fillStyle:ii(n||_e)}}if(!e)this.strokeState_=null;else{const n=e.getColor(),s=e.getLineCap(),r=e.getLineDash(),a=e.getLineDashOffset(),o=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),c=r||Ei;this.strokeState_={lineCap:s!==void 0?s:Ss,lineDash:this.pixelRatio_===1?c:c.map(u=>u*this.pixelRatio_),lineDashOffset:(a||vi)*this.pixelRatio_,lineJoin:o!==void 0?o:Rs,lineWidth:(l!==void 0?l:Or)*this.pixelRatio_,miterLimit:h!==void 0?h:Ar,strokeStyle:ii(n||Pr)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const n=t.getPixelRatio(this.pixelRatio_),s=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=s[0]*n,this.imageAnchorY_=s[1]*n,this.imageHeight_=e[1]*n,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const a=t.getScaleArray();this.imageScale_=[a[0]*this.pixelRatio_/n,a[1]*this.pixelRatio_/n],this.imageWidth_=e[0]*n}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const _=e.getColor();this.textFillState_={fillStyle:ii(_||_e)}}const n=t.getStroke();if(!n)this.textStrokeState_=null;else{const _=n.getColor(),g=n.getLineCap(),x=n.getLineDash(),y=n.getLineDashOffset(),w=n.getLineJoin(),d=n.getWidth(),p=n.getMiterLimit();this.textStrokeState_={lineCap:g!==void 0?g:Ss,lineDash:x||Ei,lineDashOffset:y||vi,lineJoin:w!==void 0?w:Rs,lineWidth:d!==void 0?d:Or,miterLimit:p!==void 0?p:Ar,strokeStyle:ii(_||Pr)}}const s=t.getFont(),r=t.getOffsetX(),a=t.getOffsetY(),o=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),c=t.getText(),u=t.getTextAlign(),f=t.getTextBaseline();this.textState_={font:s!==void 0?s:a0,textAlign:u!==void 0?u:Lr,textBaseline:f!==void 0?f:_o},this.text_=c!==void 0?Array.isArray(c)?c.reduce((_,g,x)=>_+=x%2?" ":g,""):c:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=a!==void 0?this.pixelRatio_*a:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const Me=.5;function R_(i,t,e,n,s,r,a,o,l){const h=l?jo(s):s,c=i[0]*Me,u=i[1]*Me,f=Ot(c,u);f.imageSmoothingEnabled=!1;const _=f.canvas,g=new Zw(f,Me,s,null,a,o,l?Yr(Jp(),l):null),x=e.length,y=Math.floor((256*256*256-1)/x),w={};for(let p=1;p<=x;++p){const v=e[p-1],T=v.getStyleFunction()||n;if(!T)continue;let R=T(v,r);if(!R)continue;Array.isArray(R)||(R=[R]);const b=(p*y).toString(16).padStart(7,"#00000");for(let I=0,P=R.length;I<P;++I){const G=R[I],O=G.getGeometryFunction()(v);if(!O||!Pt(h,O.getExtent()))continue;const m=G.clone(),E=m.getFill();E&&E.setColor(b);const S=m.getStroke();S&&(S.setColor(b),S.setLineDash(null)),m.setText(void 0);const M=G.getImage();if(M){const k=M.getImageSize();if(!k)continue;const B=Ot(k[0],k[1],void 0,{alpha:!1}),U=B.canvas;B.fillStyle=b,B.fillRect(0,0,U.width,U.height),m.setImage(new Zo({img:U,anchor:M.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:M.getOrigin(),opacity:1,size:M.getSize(),scale:M.getScale(),rotation:M.getRotation(),rotateWithView:M.getRotateWithView()}))}const A=m.getZIndex()||0;let F=w[A];F||(F={},w[A]=F,F.Polygon=[],F.Circle=[],F.LineString=[],F.Point=[]);const D=O.getType();if(D==="GeometryCollection"){const k=O.getGeometriesArrayRecursive();for(let B=0,U=k.length;B<U;++B){const V=k[B];F[V.getType().replace("Multi","")].push(V,m)}}else F[D.replace("Multi","")].push(O,m)}}const d=Object.keys(w).map(Number).sort(si);for(let p=0,v=d.length;p<v;++p){const T=w[d[p]];for(const R in T){const C=T[R];for(let b=0,I=C.length;b<I;b+=2){g.setStyle(C[b+1]);for(let P=0,G=t.length;P<G;++P)g.setTransform(t[P]),g.drawGeometry(C[b])}}}return f.getImageData(0,0,_.width,_.height)}function M_(i,t,e){const n=[];if(e){const s=Math.floor(Math.round(i[0])*Me),r=Math.floor(Math.round(i[1])*Me),a=(wt(s,0,e.width-1)+wt(r,0,e.height-1)*e.width)*4,o=e.data[a],l=e.data[a+1],c=e.data[a+2]+256*(l+256*o),u=Math.floor((256*256*256-1)/t.length);c&&c%u===0&&n.push(t[c/u-1])}return n}const Qw=.5,C_={Point:aT,LineString:nT,Polygon:lT,MultiPoint:oT,MultiLineString:sT,MultiPolygon:rT,GeometryCollection:iT,Circle:tT};function Jw(i,t){return parseInt(Z(i),10)-parseInt(Z(t),10)}function Nh(i,t){const e=b_(i,t);return e*e}function b_(i,t){return Qw*i/t}function tT(i,t,e,n,s){const r=e.getFill(),a=e.getStroke();if(r||a){const l=i.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(r,a),l.drawCircle(t,n,s)}const o=e.getText();if(o&&o.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,n)}}function Mo(i,t,e,n,s,r,a,o){const l=[],h=e.getImage();if(h){let f=!0;const _=h.getImageState();_==K.LOADED||_==K.ERROR?f=!1:_==K.IDLE&&h.load(),f&&l.push(h.ready())}const c=e.getFill();c&&c.loading()&&l.push(c.ready());const u=l.length>0;return u&&Promise.all(l).then(()=>s(null)),eT(i,t,e,n,r,a,o),u}function eT(i,t,e,n,s,r,a){const o=e.getGeometryFunction()(t);if(!o)return;const l=o.simplifyTransformed(n,s);if(e.getRenderer())I_(i,l,e,t,a);else{const c=C_[l.getType()];c(i,l,e,t,a,r)}}function I_(i,t,e,n,s){if(t.getType()=="GeometryCollection"){const a=t.getGeometries();for(let o=0,l=a.length;o<l;++o)I_(i,a[o],e,n,s);return}i.getBuilder(e.getZIndex(),"Default").drawCustom(t,n,e.getRenderer(),e.getHitDetectionRenderer(),s)}function iT(i,t,e,n,s,r){const a=t.getGeometriesArray();let o,l;for(o=0,l=a.length;o<l;++o){const h=C_[a[o].getType()];h(i,a[o],e,n,s,r)}}function nT(i,t,e,n,s){const r=e.getStroke();if(r){const o=i.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,r),o.drawLineString(t,n,s)}const a=e.getText();if(a&&a.getText()){const o=i.getBuilder(e.getZIndex(),"Text");o.setTextStyle(a),o.drawText(t,n,s)}}function sT(i,t,e,n,s){const r=e.getStroke();if(r){const o=i.getBuilder(e.getZIndex(),"LineString");o.setFillStrokeStyle(null,r),o.drawMultiLineString(t,n,s)}const a=e.getText();if(a&&a.getText()){const o=i.getBuilder(e.getZIndex(),"Text");o.setTextStyle(a),o.drawText(t,n,s)}}function rT(i,t,e,n,s){const r=e.getFill(),a=e.getStroke();if(a||r){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,a),l.drawMultiPolygon(t,n,s)}const o=e.getText();if(o&&o.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,n,s)}}function aT(i,t,e,n,s,r){const a=e.getImage(),o=e.getText(),l=o&&o.getText(),h=r&&a&&l?{}:void 0;if(a){if(a.getImageState()!=K.LOADED)return;const c=i.getBuilder(e.getZIndex(),"Image");c.setImageStyle(a,h),c.drawPoint(t,n,s)}if(l){const c=i.getBuilder(e.getZIndex(),"Text");c.setTextStyle(o,h),c.drawText(t,n,s)}}function oT(i,t,e,n,s,r){const a=e.getImage(),o=a&&a.getOpacity()!==0,l=e.getText(),h=l&&l.getText(),c=r&&o&&h?{}:void 0;if(o){if(a.getImageState()!=K.LOADED)return;const u=i.getBuilder(e.getZIndex(),"Image");u.setImageStyle(a,c),u.drawMultiPoint(t,n,s)}if(h){const u=i.getBuilder(e.getZIndex(),"Text");u.setTextStyle(l,c),u.drawText(t,n,s)}}function lT(i,t,e,n,s){const r=e.getFill(),a=e.getStroke();if(r||a){const l=i.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(r,a),l.drawPolygon(t,n,s)}const o=e.getText();if(o&&o.getText()){const l=i.getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,n,s)}}class hT extends vu{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=xe(),this.wrappedRenderedExtent_=xe(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(t,e,n){const s=e.extent,r=e.viewState,a=r.center,o=r.resolution,l=r.projection,h=r.rotation,c=l.getExtent(),u=this.getLayer().getSource(),f=this.getLayer().getDeclutter(),_=e.pixelRatio,g=e.viewHints,x=!(g[bt.ANIMATING]||g[bt.INTERACTING]),y=this.context,w=Math.round(ot(s)/o*_),d=Math.round(It(s)/o*_),p=u.getWrapX()&&l.canWrapX(),v=p?ot(c):null,T=p?Math.ceil((s[2]-c[2])/v)+1:1;let R=p?Math.floor((s[0]-c[0])/v):0;do{let C=this.getRenderTransform(a,o,0,_,w,d,R*v);e.declutter&&(C=C.slice(0)),t.execute(y,[y.canvas.width,y.canvas.height],C,h,x,n===void 0?cn:n?Ro:Hw,n?f&&e.declutter[f]:void 0)}while(++R<T)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Ot(this.context.canvas.width,this.context.canvas.height,dd))}resetDrawContext_(){if(this.opacity_!==1&&this.targetContext_){const t=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=t,Qr(this.context),dd.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(t){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,t,!0)}renderDeferredInternal(t){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(t,e){const n=t.layerStatesArray[t.layerIndex];this.opacity_=n.opacity;const s=t.viewState;this.prepareContainer(t,e);const r=this.context,a=this.replayGroup_;let o=a&&!a.isEmpty();if(!o&&!(this.getLayer().hasListener(Wt.PRERENDER)||this.getLayer().hasListener(Wt.POSTRENDER)))return this.container;if(this.setDrawContext_(),this.preRender(r,t),s.projection,this.clipped_=!1,o&&n.extent&&this.clipping){const l=Oe(n.extent);o=Pt(l,t.extent),this.clipped_=o&&!Xe(l,t.extent),this.clipped_&&this.clipUnrotated(r,t,l)}return o&&this.renderWorlds(a,t,this.getLayer().getDeclutter()?!1:void 0),!t.declutter&&this.clipped_&&r.restore(),this.postRender(r,t),this.renderedRotation_!==s.rotation&&(this.renderedRotation_=s.rotation,this.hitDetectionImageData_=null),t.declutter||this.resetDrawContext_(),this.container}getFeatures(t){return new Promise(e=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const n=this.frameState.size.slice(),s=this.renderedCenter_,r=this.renderedResolution_,a=this.renderedRotation_,o=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),c=[],u=n[0]*Me,f=n[1]*Me;c.push(this.getRenderTransform(s,r,a,Me,u,f,0).slice());const _=h.getSource(),g=o.getExtent();if(_.getWrapX()&&o.canWrapX()&&!Xe(g,l)){let x=l[0];const y=ot(g);let w=0,d;for(;x<g[0];)--w,d=y*w,c.push(this.getRenderTransform(s,r,a,Me,u,f,d).slice()),x+=y;for(w=0,x=l[2];x>g[2];)++w,d=y*w,c.push(this.getRenderTransform(s,r,a,Me,u,f,d).slice()),x-=y}this.hitDetectionImageData_=R_(n,c,this.renderedFeatures_,h.getStyleFunction(),l,r,a,Nh(r,this.renderedPixelRatio_),null)}e(M_(t,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(t,e,n,s,r){if(!this.replayGroup_)return;const a=e.viewState.resolution,o=e.viewState.rotation,l=this.getLayer(),h={},c=function(f,_,g){const x=Z(f),y=h[x];if(y){if(y!==!0&&g<y.distanceSq){if(g===0)return h[x]=!0,r.splice(r.lastIndexOf(y),1),s(f,l,_);y.geometry=_,y.distanceSq=g}}else{if(g===0)return h[x]=!0,s(f,l,_);r.push(h[x]={feature:f,layer:l,geometry:_,distanceSq:g,callback:s})}},u=this.getLayer().getDeclutter();return this.replayGroup_.forEachFeatureAtCoordinate(t,a,o,n,c,u?e.declutter?.[u]?.all().map(f=>f.value):null)}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),n=e.getSource();if(!n)return!1;const s=t.viewHints[bt.ANIMATING],r=t.viewHints[bt.INTERACTING],a=e.getUpdateWhileAnimating(),o=e.getUpdateWhileInteracting();if(this.ready&&!a&&s||!o&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,c=h.projection,u=h.resolution,f=t.pixelRatio,_=e.getRevision(),g=e.getRenderBuffer();let x=e.getRenderOrder();x===void 0&&(x=Jw);const y=h.center.slice(),w=ai(l,g*u),d=w.slice(),p=[w.slice()],v=c.getExtent();if(n.getWrapX()&&c.canWrapX()&&!Xe(v,t.extent)){const E=ot(v),S=Math.max(ot(w)/2,E);w[0]=v[0]-S,w[2]=v[2]+S,lc(y,c);const M=Eg(p[0],c);M[0]<v[0]&&M[2]<v[2]?p.push([M[0]+E,M[1],M[2]+E,M[3]]):M[0]>v[0]&&M[2]>v[2]&&p.push([M[0]-E,M[1],M[2]-E,M[3]])}if(this.ready&&this.renderedResolution_==u&&this.renderedRevision_==_&&this.renderedRenderOrder_==x&&this.renderedFrameDeclutter_===!!t.declutter&&Xe(this.wrappedRenderedExtent_,w))return Ji(this.renderedExtent_,d)||(this.hitDetectionImageData_=null,this.renderedExtent_=d),this.renderedCenter_=y,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const T=new T_(b_(u,f),w,u,f);let R;for(let E=0,S=p.length;E<S;++E)n.loadFeatures(p[E],u,c);const C=Nh(u,f);let b=!0;const I=(E,S)=>{let M;const A=E.getStyleFunction()||e.getStyleFunction();if(A&&(M=A(E,u)),M){const F=this.renderFeature(E,C,M,T,R,this.getLayer().getDeclutter(),S);b=b&&!F}},P=jo(w),G=n.getFeaturesInExtent(P);x&&G.sort(x);for(let E=0,S=G.length;E<S;++E)I(G[E],E);this.renderedFeatures_=G,this.ready=b;const O=T.finish(),m=new S_(w,u,f,n.getOverlaps(),O,e.getRenderBuffer(),!!t.declutter);return this.renderedResolution_=u,this.renderedRevision_=_,this.renderedRenderOrder_=x,this.renderedFrameDeclutter_=!!t.declutter,this.renderedExtent_=d,this.wrappedRenderedExtent_=w,this.renderedCenter_=y,this.renderedProjection_=c,this.renderedPixelRatio_=f,this.replayGroup_=m,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,n,s,r,a,o){if(!n)return!1;let l=!1;if(Array.isArray(n))for(let h=0,c=n.length;h<c;++h)l=Mo(s,t,n[h],e,this.boundHandleStyleImageChange_,r,a,o)||l;else l=Mo(s,t,n,e,this.boundHandleStyleImageChange_,r,a,o);return l}}class A_ extends Vc{constructor(t){super(t)}createRenderer(){return new hT(this)}}let cT=!1;function P_(i,t,e,n,s,r,a){const o=new XMLHttpRequest;o.open("GET",typeof i=="function"?i(e,n,s):i,!0),t.getType()=="arraybuffer"&&(o.responseType="arraybuffer"),o.withCredentials=cT,o.onload=function(l){if(!o.status||o.status>=200&&o.status<300){const h=t.getType();try{let c;h=="text"||h=="json"?c=o.responseText:h=="xml"?c=o.responseXML||o.responseText:h=="arraybuffer"&&(c=o.response),c?r(t.readFeatures(c,{extent:e,featureProjection:s}),t.readProjection(c)):a()}catch{a()}}else a()},o.onerror=a,o.send()}function Ed(i,t){return function(e,n,s,r,a){P_(i,t,e,n,s,(o,l)=>{this.addFeatures(o),r!==void 0&&r(o)},()=>{this.changed(),a!==void 0&&a()})}}function uT(i,t){return[[-1/0,-1/0,1/0,1/0]]}class vd{constructor(t){this.rbush_=new Qg(t),this.items_={}}insert(t,e){const n={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(n),this.items_[Z(e)]=n}load(t,e){const n=new Array(e.length);for(let s=0,r=e.length;s<r;s++){const a=t[s],o=e[s],l={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:o};n[s]=l,this.items_[Z(o)]=l}this.rbush_.load(n)}remove(t){const e=Z(t),n=this.items_[e];return delete this.items_[e],this.rbush_.remove(n)!==null}update(t,e){const n=this.items_[Z(e)],s=[n.minX,n.minY,n.maxX,n.maxY];yn(s,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(s){return s.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let n;for(let s=0,r=t.length;s<r;s++)if(n=e(t[s]),n)return n;return n}isEmpty(){return qi(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Ti(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}const Ae={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};class Fi extends Ke{constructor(t,e,n){super(t),this.feature=e,this.features=n}}class fT extends eu{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Rr,this.format_=t.format||null,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(ft(this.format_,"`format` must be set when `url` is set"),this.loader_=Ed(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:uT;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new vd:null,this.loadedExtentsRtree_=new vd,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let n,s;Array.isArray(t.features)?s=t.features:t.features&&(n=t.features,s=n.getArray()),!e&&n===void 0&&(n=new ei(s)),s!==void 0&&this.addFeaturesInternal(s),n!==void 0&&this.bindFeaturesCollection_(n)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=Z(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const n=t.getGeometry();if(n){const s=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(s,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Fi(Ae.ADDFEATURE,t))}setupChangeEvents_(t,e){e instanceof le||(this.featureChangeKeys_[t]=[ct(e,Y.CHANGE,this.handleFeatureChange_,this),ct(e,xs.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(t,e){let n=!0;if(e.getId()!==void 0){const s=String(e.getId());if(!(s in this.idIndex_))this.idIndex_[s]=e;else if(e instanceof le){const r=this.idIndex_[s];r instanceof le?Array.isArray(r)?r.push(e):this.idIndex_[s]=[r,e]:n=!1}else n=!1}return n&&(ft(!(t in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[t]=e),n}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],n=[],s=[];for(let r=0,a=t.length;r<a;r++){const o=t[r],l=Z(o);this.addToIndex_(l,o)&&n.push(o)}for(let r=0,a=n.length;r<a;r++){const o=n[r],l=Z(o);this.setupChangeEvents_(l,o);const h=o.getGeometry();if(h){const c=h.getExtent();e.push(c),s.push(o)}else this.nullGeometryFeatures_[l]=o}if(this.featuresRtree_&&this.featuresRtree_.load(e,s),this.hasListener(Ae.ADDFEATURE))for(let r=0,a=n.length;r<a;r++)this.dispatchEvent(new Fi(Ae.ADDFEATURE,n[r]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Ae.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(Ae.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(ge.ADD,n=>{e||(e=!0,this.addFeature(n.element),e=!1)}),t.addEventListener(ge.REMOVE,n=>{e||(e=!0,this.removeFeature(n.element),e=!1)}),this.featuresCollection_=t}clear(t){if(t){for(const n in this.featureChangeKeys_)this.featureChangeKeys_[n].forEach(vt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){this.featuresRtree_.forEach(n=>{this.removeFeatureInternal(n)});for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new Fi(Ae.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(s){const r=s.getGeometry();if(r instanceof le||r.intersectsCoordinate(t))return e(s)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(n){const s=n.getGeometry();if(s instanceof le||s.intersectsExtent(t)){const r=e(n);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),qi(this.nullGeometryFeatures_)||ri(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const s=ac(t,e);return[].concat(...s.map(r=>this.featuresRtree_.getInExtent(r)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const n=t[0],s=t[1];let r=null;const a=[NaN,NaN];let o=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||Sr,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const c=h.getGeometry(),u=o;if(o=c instanceof le?0:c.closestPointXY(n,s,a,o),o<u){r=h;const f=Math.sqrt(o);l[0]=n-f,l[1]=s-f,l[2]=n+f,l[3]=s+f}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,n=Z(e),s=e.getGeometry();if(!s)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{const a=s.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(a,e)):this.featuresRtree_&&this.featuresRtree_.update(a,e)}const r=e.getId();if(r!==void 0){const a=r.toString();this.idIndex_[a]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[a]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Fi(Ae.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:Z(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&qi(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,n){const s=this.loadedExtentsRtree_,r=this.strategy_(t,e,n);for(let a=0,o=r.length;a<o;++a){const l=r[a];s.forEachInExtent(l,function(c){return Xe(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Fi(Ae.FEATURESLOADSTART)),this.loader_.call(this,l,e,n,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new Fi(Ae.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Fi(Ae.FEATURESLOADERROR))}),s.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_,n=e.forEachInExtent(t,function(s){if(yn(s.extent,t))return s});n&&e.remove(n)}removeFeatures(t){let e=!1;for(let n=0,s=t.length;n<s;++n)e=this.removeFeatureInternal(t[n])||e;e&&this.changed()}removeFeature(t){if(!t)return;this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=Z(t);if(!(e in this.uidIndex_))return!1;e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.featureChangeKeys_[e]?.forEach(vt),delete this.featureChangeKeys_[e];const s=t.getId();if(s!==void 0){const r=s.toString(),a=this.idIndex_[r];a===t?delete this.idIndex_[r]:Array.isArray(a)&&(a.splice(a.indexOf(t),1),a.length===1&&(this.idIndex_[r]=a[0]))}return delete this.uidIndex_[e],this.hasListener(Ae.REMOVEFEATURE)&&this.dispatchEvent(new Fi(Ae.REMOVEFEATURE,t)),!0}removeFromIdIndex_(t){for(const e in this.idIndex_)if(this.idIndex_[e]===t){delete this.idIndex_[e];break}}setLoader(t){this.loader_=t}setUrl(t){ft(this.format_,"`format` must be set when `url` is set"),this.url_=t,this.setLoader(Ed(t,this.format_))}setOverlaps(t){this.overlaps_=t,this.changed()}}const dT={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},wd={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class gT extends v_{constructor(t,e){super(t,e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=Zt(),this.tileClipContexts_=null}drawTile(t,e,n,s,r,a,o,l){this.updateExecutorGroup_(t,e.pixelRatio,e.viewState.projection),this.tileImageNeedsRender_(t)&&this.renderTileImage_(t,e),super.drawTile(t,e,n,s,r,a,o,l)}getTile(t,e,n,s){const r=this.getOrCreateTile(t,e,n,s);if(!r)return null;const o=s.viewState.resolution,l=s.viewHints;return(!(l[bt.ANIMATING]||l[bt.INTERACTING])||!r.wantedResolution)&&(r.wantedResolution=o),r}prepareFrame(t){const e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),super.prepareFrame(t)}updateExecutorGroup_(t,e,n){const s=this.getLayer(),r=s.getRevision(),a=s.getRenderOrder()||null,o=t.wantedResolution,l=t.getReplayState(s);if(!l.dirty&&l.renderedResolution===o&&l.renderedRevision==r&&l.renderedRenderOrder==a)return;const h=s.getSource(),c=!!s.getDeclutter(),u=h.getTileGrid(),_=h.getTileGridForProjection(n).getTileCoordExtent(t.wrappedTileCoord),g=h.getSourceTiles(e,n,t),x=Z(s);delete t.hitDetectionImageData[x],t.executorGroups[x]=[],l.dirty=!1;for(let y=0,w=g.length;y<w;++y){const d=g[y];if(d.getState()!=z.LOADED)continue;const p=d.tileCoord,v=u.getTileCoordExtent(p),T=Xt(_,v),R=ai(T,s.getRenderBuffer()*o,this.tempExtent),C=yn(v,T)?null:R,b=new T_(0,T,o,e),I=Nh(o,e),P=function(S,M){let A;const F=S.getStyleFunction()||s.getStyleFunction();if(F&&(A=F(S,o)),A){const D=this.renderFeature(S,I,A,b,c,M);l.dirty=l.dirty||D}},G=d.getFeatures();a&&a!==l.renderedRenderOrder&&G.sort(a);for(let S=0,M=G.length;S<M;++S){const A=G[S];(!C||Pt(C,A.getGeometry().getExtent()))&&P.call(this,A,S)}const O=b.finish(),m=s.getRenderMode()!=="vector"&&c&&g.length===1?null:T,E=new S_(m,o,e,h.getOverlaps(),O,s.getRenderBuffer(),!0);t.executorGroups[x].push(E)}l.renderedRevision=r,l.renderedRenderOrder=a,l.renderedResolution=o}forEachFeatureAtCoordinate(t,e,n,s,r){const a=e.viewState.resolution,o=e.viewState.rotation;n=n??0;const l=this.getLayer(),c=l.getSource().getTileGridForProjection(e.viewState.projection),u=Es([t]);ai(u,a*n,u);const f={},_=function(p,v,T){let R=p.getId();R===void 0&&(R=Z(p));const C=f[R];if(C){if(C!==!0&&T<C.distanceSq){if(T===0)return f[R]=!0,r.splice(r.lastIndexOf(C),1),s(p,l,v);C.geometry=v,C.distanceSq=T}}else{if(T===0)return f[R]=!0,s(p,l,v);r.push(f[R]={feature:p,layer:l,geometry:v,distanceSq:T,callback:s})}},g=this.renderedTiles,x=Z(l),y=l.getDeclutter(),w=y?e.declutter?.[y]?.all().map(p=>p.value):null;let d;t:for(let p=0,v=g.length;p<v;++p){const T=g[p],R=c.getTileCoordExtent(T.wrappedTileCoord);if(!Pt(R,u))continue;const C=T.executorGroups[x];for(let b=0,I=C.length;b<I;++b)if(d=C[b].forEachFeatureAtCoordinate(t,a,o,n,_,w),d)break t}return d}getFeatures(t){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((e,n)=>{const s=this.getLayer(),r=s.getSource(),a=this.renderedProjection,o=a.getExtent(),l=this.renderedResolution,h=r.getTileGridForProjection(a),c=kt(this.renderedPixelToCoordinateTransform_,t.slice()),u=h.getTileCoordForCoordAndResolution(c,l).toString(),f=this.renderedTiles.find(p=>p.tileCoord.toString()===u&&p.getState()===z.LOADED);if(!f||f.loadingSourceTiles>0){e([]);return}r.getWrapX()&&a.canWrapX()&&!Xe(o,h.getTileCoordExtent(f.tileCoord))&&lc(c,a);const _=Z(s),g=h.getTileCoordExtent(f.wrappedTileCoord),x=li(g),y=[(c[0]-x[0])/l,(x[1]-c[1])/l],w=f.getSourceTiles().reduce((p,v)=>p.concat(v.getFeatures()),[]);let d=f.hitDetectionImageData[_];if(!d){const p=Lt(h.getTileSize(h.getZForResolution(l,r.zDirection))),v=this.renderedRotation_,T=[this.getRenderTransform(h.getTileCoordCenter(f.wrappedTileCoord),l,0,Me,p[0]*Me,p[1]*Me,0)];d=R_(p,T,w,s.getStyleFunction(),h.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(s).renderedResolution,v),f.hitDetectionImageData[_]=d}e(M_(y,w,d))})}getFeaturesInExtent(t){const e=[],n=this.getTileCache();if(n.getCount()===0)return e;const r=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),a=r.getZForResolution(this.renderedResolution),o={};return n.forEach(l=>{if(l.tileCoord[0]!==a||l.getState()!==z.LOADED)return;const h=l.getSourceTiles();for(let c=0,u=h.length;c<u;++c){const f=h[c],_=f.getKey();if(_ in o)continue;o[_]=!0;const g=f.tileCoord;if(Pt(t,r.getTileCoordExtent(g))){const x=f.getFeatures();if(x)for(let y=0,w=x.length;y<w;++y){const d=x[y],p=d.getGeometry();Pt(t,p.getExtent())&&e.push(d)}}}}),e}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.renderedLayerRevision_!==void 0&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}renderDeclutter(t,e){const n=this.context,s=n.globalAlpha;n.globalAlpha=e.opacity;const r=t.viewHints,a=!(r[bt.ANIMATING]||r[bt.INTERACTING]),o=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),h=l?t.declutter?.[l]:void 0,c=Z(this.getLayer()),u=this.renderedTiles;for(let f=0,_=u.length;f<_;++f){const g=u[f],x=g.executorGroups[c];if(x)for(let y=x.length-1;y>=0;--y)x[y].execute(this.context,o,this.getTileRenderTransform(g,t),t.viewState.rotation,a,Ro,h)}n.globalAlpha=s}renderDeferredInternal(t){const e=this.renderedTiles,n=Z(this.getLayer()),s=e.reduce((l,h,c)=>(h.executorGroups[n].forEach(u=>l.push({executorGroup:u,index:c})),l),[]),r=s.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),a={};for(let l=0,h=s.length;l<h;++l){const c=s[l].executorGroup.getDeferredZIndexContexts();for(const u in c)a[u]=!0}Object.keys(a).map(Number).sort(si).forEach(l=>{r.forEach((h,c)=>{h[l]&&(h[l].forEach(u=>{const{executorGroup:f,index:_}=s[c],g=f.getRenderedContext(),x=g.globalAlpha;g.globalAlpha=this.renderedOpacity_;const y=this.tileClipContexts_[_];y&&y.draw(g),u.draw(g),y&&g.restore(),g.globalAlpha=x,u.clear()}),h[l].length=0)})})}getTileRenderTransform(t,e){const n=e.pixelRatio,s=e.viewState,r=s.center,a=s.resolution,o=s.rotation,l=e.size,h=Math.round(l[0]*n),c=Math.round(l[1]*n),f=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),_=t.tileCoord,g=f.getTileCoordExtent(t.wrappedTileCoord),x=f.getTileCoordExtent(_,this.tempExtent)[0]-g[0];return Ts(dr(this.inversePixelTransform.slice(),1/n,1/n),this.getRenderTransform(r,a,o,n,h,c,x))}postRender(t,e){const n=e.viewHints,s=!(n[bt.ANIMATING]||n[bt.INTERACTING]);this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice(),this.renderedRotation_=e.viewState.rotation,this.renderedOpacity_=e.layerStatesArray[e.layerIndex].opacity;const r=this.getLayer(),a=r.getRenderMode(),o=t.globalAlpha;t.globalAlpha=this.renderedOpacity_;const l=r.getDeclutter(),h=l?wd[a].filter(T=>!Ro.includes(T)):wd[a],c=e.viewState,u=c.rotation,f=r.getSource(),g=f.getTileGridForProjection(c.projection).getZForResolution(c.resolution,f.zDirection),x=this.renderedTiles,y=[],w=[],d=[],p=Z(r);let v=!0;for(let T=x.length-1;T>=0;--T){const R=x[T];v=v&&!R.getReplayState(r).dirty;const C=R.executorGroups[p].filter(E=>E.hasExecutors(h));if(C.length===0)continue;const b=this.getTileRenderTransform(R,e),I=R.tileCoord[0];let P=!1;const G=C[0].getClipCoords(b);let O=t,m;if(G){m=new Eu,O=m.getContext();for(let E=0,S=y.length;E<S;++E)if(g!==I&&I<w[E]){const M=y[E];Pt([G[0],G[3],G[4],G[7]],[M[0],M[3],M[4],M[7]])&&(P||(O.save(),P=!0),O.beginPath(),O.moveTo(G[0],G[1]),O.lineTo(G[2],G[3]),O.lineTo(G[4],G[5]),O.lineTo(G[6],G[7]),O.moveTo(M[6],M[7]),O.lineTo(M[4],M[5]),O.lineTo(M[2],M[3]),O.lineTo(M[0],M[1]),O.clip())}y.push(G),w.push(I)}for(let E=0,S=C.length;E<S;++E)C[E].execute(t,[t.canvas.width,t.canvas.height],b,u,s,h,e.declutter?.[l]);P&&(O===t?O.restore():d[T]=m)}t.globalAlpha=o,this.ready=v,this.tileClipContexts_=d,e.declutter||this.renderDeferredInternal(e),super.postRender(t,e)}renderFeature(t,e,n,s,r,a){if(!n)return!1;let o=!1;if(Array.isArray(n))for(let l=0,h=n.length;l<h;++l)o=Mo(s,t,n[l],e,this.boundHandleStyleImageChange_,void 0,r,a)||o;else o=Mo(s,t,n,e,this.boundHandleStyleImageChange_,void 0,r,a);return o}tileImageNeedsRender_(t){const e=this.getLayer();if(e.getRenderMode()==="vector")return!1;const n=t.getReplayState(e),s=e.getRevision(),r=t.wantedResolution;return n.renderedTileResolution!==r||n.renderedTileRevision!==s}renderTileImage_(t,e){const n=this.getLayer(),s=t.getReplayState(n),r=n.getRevision(),a=t.executorGroups[Z(n)];s.renderedTileRevision=r;const o=t.wrappedTileCoord,l=o[0],h=n.getSource();let c=e.pixelRatio;const f=e.viewState.projection,_=h.getTileGridForProjection(f),g=_.getResolution(t.tileCoord[0]),x=e.pixelRatio/t.wantedResolution*g,y=_.getResolution(l),w=t.getContext();c=Math.round(Math.max(c,x/c));const d=h.getTilePixelSize(l,c,f);w.canvas.width=d[0],w.canvas.height=d[1];const p=c/x;if(p!==1){const C=dh(this.tmpTransform_);dr(C,p,p),w.setTransform.apply(w,C)}const v=_.getTileCoordExtent(o,this.tempExtent),T=x/y,R=dh(this.tmpTransform_);dr(R,T,-T),Ag(R,-v[0],-v[3]);for(let C=0,b=a.length;C<b;++C)a[C].execute(w,[w.canvas.width*p,w.canvas.height*p],R,0,!0,dT[n.getRenderMode()],null);s.renderedTileResolution=t.wantedResolution}}class _T extends Vc{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload;const n=t.cacheSize===void 0?0:t.cacheSize;delete t.cacheSize,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.cacheSize_=n;const s=t.renderMode||"hybrid";ft(s=="hybrid"||s=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=s,this.setPreload(t.preload?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new gT(this,{cacheSize:this.cacheSize_})}getFeatures(t){return super.getFeatures(t)}getFeaturesInExtent(t){return this.getRenderer().getFeaturesInExtent(t)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(Ui.PRELOAD)}getUseInterimTilesOnError(){return this.get(Ui.USE_INTERIM_TILES_ON_ERROR)}setPreload(t){this.set(Ui.PRELOAD,t)}setUseInterimTilesOnError(t){this.set(Ui.USE_INTERIM_TILES_ON_ERROR,t)}}const Td=[];class mT extends ra{constructor(t,e,n,s,r){super(t,e,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=s.bind(void 0,this),this.removeSourceTiles_=r,this.wrappedTileCoord=n}getContext(){return this.context_||(this.context_=Ot(1,1,Td)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(t){const e=Z(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]}load(){this.getSourceTiles()}release(){this.context_&&(Qr(this.context_),Td.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}}let pT=class extends ra{constructor(t,e,n,s,r,a){super(t,e,a),this.extent=null,this.format_=s,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=r,this.url_=n,this.key=n}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==z.IDLE&&(this.setState(z.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(t,e){this.setFeatures(t)}onError(){this.setState(z.ERROR)}setFeatures(t){this.features_=t,this.setState(z.LOADED)}setLoader(t){this.loader_=t}};class L_ extends il{constructor(t){const e=t.projection||"EPSG:3857",n=t.extent||tn(e),s=t.tileGrid||Gs({extent:n,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,projection:e,state:t.state,tileGrid:s,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:yT,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX===void 0?!0:t.wrapX,transition:t.transition,zDirection:t.zDirection===void 0?1:t.zDirection}),this.format_=t.format?t.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=t.overlaps==null?!0:t.overlaps,this.tileClass=t.tileClass?t.tileClass:pT,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(t,e,n){if(n.getState()===z.IDLE){n.setState(z.LOADING);const s=n.wrappedTileCoord,r=this.getTileGridForProjection(e),a=r.getTileCoordExtent(s),o=s[0],l=r.getResolution(o);ai(a,-l,a);const h=this.tileGrid,c=h.getExtent();c&&Xt(a,c,a);const u=h.getZForResolution(l,this.zDirection);h.forEachTileCoord(a,u,f=>{const _=this.tileUrlFunction(f,t,e);this.sourceTiles_[_]||(this.sourceTiles_[_]=new this.tileClass(f,_?z.IDLE:z.EMPTY,_,this.format_,this.tileLoadFunction));const g=this.sourceTiles_[_];n.sourceTiles.push(g),this.tileKeysBySourceTileUrl_[_]||(this.tileKeysBySourceTileUrl_[_]=[]),this.tileKeysBySourceTileUrl_[_].push(n.getKey());const x=g.getState();if(x<z.LOADED){const y=w=>{this.handleTileChange(w);const d=g.getState();if(d===z.LOADED||d===z.ERROR){const p=g.getKey();p in n.errorTileKeys?g.getState()===z.LOADED&&delete n.errorTileKeys[p]:n.loadingSourceTiles--,d===z.ERROR?n.errorTileKeys[p]=!0:g.removeEventListener(Y.CHANGE,y),n.loadingSourceTiles===0&&n.setState(qi(n.errorTileKeys)?z.LOADED:z.ERROR)}};g.addEventListener(Y.CHANGE,y),n.loadingSourceTiles++}x===z.IDLE&&(g.extent=h.getTileCoordExtent(f),g.projection=e,g.resolution=h.getResolution(f[0]),g.load())}),n.loadingSourceTiles||n.setState(n.sourceTiles.some(f=>f.getState()===z.ERROR)?z.ERROR:z.LOADED)}return n.sourceTiles}removeSourceTiles(t){const e=t.getKey(),n=t.sourceTiles;for(let s=0,r=n.length;s<r;++s){const a=n[s].getTileUrl();if(!this.tileKeysBySourceTileUrl_[a])return;const o=this.tileKeysBySourceTileUrl_[a].indexOf(e);o!==-1&&(this.tileKeysBySourceTileUrl_[a].splice(o,1),this.tileKeysBySourceTileUrl_[a].length===0&&(delete this.tileKeysBySourceTileUrl_[a],delete this.sourceTiles_[a]))}}getTile(t,e,n,s,r){const a=[t,e,n];let o=this.getTileCoordForTileUrlFunction(a,r);const l=this.getTileGrid().getExtent(),h=this.getTileGridForProjection(r);if(o&&l){const f=h.getTileCoordExtent(o);ai(f,-h.getResolution(t),f),Pt(l,f)||(o=null)}let c=!0;if(o!==null){const f=this.tileGrid,_=h.getResolution(t),g=f.getZForResolution(_,1),x=h.getTileCoordExtent(o);ai(x,-_,x),f.forEachTileCoord(x,g,y=>{c=c&&!this.tileUrlFunction(y,s,r)})}const u=new mT(a,c?z.EMPTY:z.IDLE,o,this.getSourceTiles.bind(this,s,r),this.removeSourceTiles.bind(this));return u.key=this.getKey(),u}getTileGridForProjection(t){const e=t.getCode();let n=this.tileGrids_[e];if(!n){const s=this.getProjection();ft(s===null||Ge(s,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection.");const r=this.tileGrid,a=r.getResolutions().slice(),o=a.map(function(c,u){return r.getOrigin(u)}),l=a.map(function(c,u){return r.getTileSize(u)}),h=Vg+1;for(let c=a.length;c<h;++c)a.push(a[c-1]/2),o.push(o[c-1]),l.push(l[c-1]);n=new aa({extent:r.getExtent(),origins:o,resolutions:a,tileSizes:l}),this.tileGrids_[e]=n}return n}getTilePixelRatio(t){return t}getTilePixelSize(t,e,n){const s=this.getTileGridForProjection(n),r=Lt(s.getTileSize(t),this.tmpSize);return[Math.round(r[0]*e),Math.round(r[1]*e)]}setOverlaps(t){this.overlaps_=t,this.changed()}}function yT(i,t){i.setLoader(function(e,n,s){P_(t,i.getFormat(),e,n,s,i.onLoad.bind(i),i.onError.bind(i))})}const kh="1.3.0";function xT(i,t,e,n,s){s.WIDTH=e[0],s.HEIGHT=e[1];const r=n.getAxisOrientation(),a=vg(s.VERSION,"1.3")>=0;s[a?"CRS":"SRS"]=n.getCode();const o=a&&r.startsWith("ne")?[t[1],t[0],t[3],t[2]]:t;return s.BBOX=o.join(","),vo(i,s)}function ET(i,t,e,n,s,r,a){r=Object.assign({REQUEST:"GetMap"},r);const o=t/e,l=[Qu(ot(i)/o,rs),Qu(It(i)/o,rs)];if(e!=1)switch(a){case"geoserver":const c=90*e+.5|0;"FORMAT_OPTIONS"in r?r.FORMAT_OPTIONS+=";dpi:"+c:r.FORMAT_OPTIONS="dpi:"+c;break;case"mapserver":r.MAP_RESOLUTION=90*e;break;case"carmentaserver":case"qgis":r.DPI=90*e;break;default:throw new Error("Unknown `serverType` configured")}return xT(s,i,l,n,r)}function Sd(i,t){return Object.assign({REQUEST:t,SERVICE:"WMS",VERSION:kh,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},i)}class vT extends nl{constructor(t){t=t||{};const e=Object.assign({},t.params);super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0,this.params_=e,this.v13_=!0,this.serverType_=t.serverType,this.hidpi_=t.hidpi!==void 0?t.hidpi:!0,this.tmpExtent_=xe(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(t,e,n,s){const r=lt(n),a=this.getProjection()||r;let o=this.getTileGrid();o||(o=this.getTileGridForProjection(a));const l=gc(t,r,a),h=xo(a,r,t,e),c=o.getZForResolution(h,this.zDirection),u=o.getResolution(c),f=o.getTileCoordForCoordAndZ(l,c);if(o.getResolutions().length<=f[0])return;let _=o.getTileCoordExtent(f,this.tmpExtent_);const g=this.gutter_;g!==0&&(_=ai(_,u*g,_));const x={QUERY_LAYERS:this.params_.LAYERS};Object.assign(x,Sd(this.params_,"GetFeatureInfo"),s);const y=Math.floor((l[0]-_[0])/u),w=Math.floor((_[3]-l[1])/u);return x[this.v13_?"I":"X"]=y,x[this.v13_?"J":"Y"]=w,this.getRequestUrl_(f,_,1,a||r,x)}getLegendUrl(t,e){if(this.urls[0]===void 0)return;const n={SERVICE:"WMS",VERSION:kh,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(e===void 0||e.LAYER===void 0){const s=this.params_.LAYERS;if(!(!Array.isArray(s)||s.length===1))return;n.LAYER=s}if(t!==void 0){const s=this.getProjection()?this.getProjection().getMetersPerUnit():1,r=28e-5;n.SCALE=t*s/r}return Object.assign(n,e),vo(this.urls[0],n)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(t,e,n,s,r){const a=this.urls;if(!a)return;let o;if(a.length==1)o=a[0];else{const l=mn(R0(t),a.length);o=a[l]}return ET(e,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(t[0]),n,s,o,r,this.serverType_)}getTilePixelRatio(t){return!this.hidpi_||this.serverType_===void 0?1:t}getKeyForParams_(){let t=0;const e=[];for(const n in this.params_)e[t++]=n+"-"+this.params_[n];return e.join("/")}setParams_(t){this.params_=t,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(t){this.setParams_(Object.assign({},t))}updateParams(t){this.setParams_(Object.assign(this.params_,t))}updateV13_(){const t=this.params_.VERSION||kh;this.v13_=vg(t,"1.3")>=0}tileUrlFunction(t,e,n){let s=this.getTileGrid();if(s||(s=this.getTileGridForProjection(n)),s.getResolutions().length<=t[0])return;e!=1&&(!this.hidpi_||this.serverType_===void 0)&&(e=1);const r=s.getResolution(t[0]);let a=s.getTileCoordExtent(t,this.tmpExtent_);const o=this.gutter_;o!==0&&(a=ai(a,r*o,a));const l=Object.assign({},Sd(this.params_,"GetMap"));return this.getRequestUrl_(t,a,e,n,l)}}class wT extends nl{constructor(t){const e=t.requestEncoding!==void 0?t.requestEncoding:"KVP",n=t.tileGrid;let s=t.urls;s===void 0&&t.url!==void 0&&(s=L0(t.url)),super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:n,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,urls:s,wrapX:t.wrapX!==void 0?t.wrapX:!1,transition:t.transition,zDirection:t.zDirection}),this.version_=t.version!==void 0?t.version:"1.0.0",this.format_=t.format!==void 0?t.format:"image/jpeg",this.dimensions_=t.dimensions!==void 0?t.dimensions:{},this.layer_=t.layer,this.matrixSet_=t.matrixSet,this.style_=t.style,this.requestEncoding_=e,this.setKey(this.getKeyForDimensions_()),s&&s.length>0&&(this.tileUrlFunction=Rh(s.map(this.createFromWMTSTemplate.bind(this))))}setUrls(t){this.urls=t;const e=t.join(`
`);this.setTileUrlFunction(Rh(t.map(this.createFromWMTSTemplate.bind(this))),e)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const t=this.urls?this.urls.slice(0):[];for(const e in this.dimensions_)t.push(e+"-"+this.dimensions_[e]);return t.join("/")}updateDimensions(t){Object.assign(this.dimensions_,t),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(t){const e=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};e=="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),t=e=="KVP"?vo(t,n):t.replace(/\{(\w+?)\}/g,function(a,o){return o.toLowerCase()in n?n[o.toLowerCase()]:a});const s=this.tileGrid,r=this.dimensions_;return function(a,o,l){if(!a)return;const h={TileMatrix:s.getMatrixId(a[0]),TileCol:a[1],TileRow:a[2]};Object.assign(h,r);let c=t;return e=="KVP"?c=vo(c,h):c=c.replace(/\{(\w+?)\}/g,function(u,f){return encodeURIComponent(h[f])}),c}}}function TT(i,t){const n=i.Contents.Layer?.find(function(O){return O.Identifier==t.layer});if(!n)return null;const s=i.Contents.TileMatrixSet;let r;n.TileMatrixSetLink.length>1?"projection"in t?r=n.TileMatrixSetLink.findIndex(function(O){const E=s.find(function(A){return A.Identifier==O.TileMatrixSet}).SupportedCRS,S=lt(E),M=lt(t.projection);return S&&M?Ge(S,M):E==t.projection}):r=n.TileMatrixSetLink.findIndex(function(O){return O.TileMatrixSet==t.matrixSet}):r=0,r<0&&(r=0);const a=n.TileMatrixSetLink[r].TileMatrixSet,o=n.TileMatrixSetLink[r].TileMatrixSetLimits;let l=n.Format[0];"format"in t&&(l=t.format),r=n.Style.findIndex(function(O){return"style"in t?O.Title==t.style:O.isDefault}),r<0&&(r=0);const h=n.Style[r].Identifier,c={};"Dimension"in n&&n.Dimension.forEach(function(O,m,E){const S=O.Identifier;let M=O.Default;M===void 0&&(M=O.Value[0]),c[S]=M});const f=i.Contents.TileMatrixSet.find(function(O){return O.Identifier==a});let _;const g=f.SupportedCRS;if(g&&(_=lt(g)),"projection"in t){const O=lt(t.projection);O&&(!_||Ge(O,_))&&(_=O)}let x=!1;const y=_.getAxisOrientation().startsWith("ne");let w=f.TileMatrix[0],d={MinTileCol:0,MinTileRow:0,MaxTileCol:w.MatrixWidth-1,MaxTileRow:w.MatrixHeight-1};if(o){d=o[o.length-1];const O=f.TileMatrix.find(m=>m.Identifier===d.TileMatrix||f.Identifier+":"+m.Identifier===d.TileMatrix);O&&(w=O)}const p=w.ScaleDenominator*28e-5/_.getMetersPerUnit(),v=y?[w.TopLeftCorner[1],w.TopLeftCorner[0]]:w.TopLeftCorner,T=w.TileWidth*p,R=w.TileHeight*p;let C=f.BoundingBox;C&&y&&(C=[C[1],C[0],C[3],C[2]]);let b=[v[0]+T*d.MinTileCol,v[1]-R*(1+d.MaxTileRow),v[0]+T*(1+d.MaxTileCol),v[1]-R*d.MinTileRow];if(C!==void 0&&!Xe(C,b)){const O=n.WGS84BoundingBox,m=lt("EPSG:4326").getExtent();if(b=C,O)x=O[0]===m[0]&&O[2]===m[2];else{const E=fh(C,f.SupportedCRS,"EPSG:4326");x=E[0]-1e-10<=m[0]&&E[2]+1e-10>=m[2]}}const I=mE(f,b,o),P=[];let G=t.requestEncoding;if(G=G!==void 0?G:"","OperationsMetadata"in i&&"GetTile"in i.OperationsMetadata){const O=i.OperationsMetadata.GetTile.DCP.HTTP.Get;for(let m=0,E=O.length;m<E;++m)if(O[m].Constraint){const M=O[m].Constraint.find(function(A){return A.name=="GetEncoding"}).AllowedValues.Value;if(G===""&&(G=M[0]),G==="KVP")M.includes("KVP")&&P.push(O[m].href);else break}else O[m].href&&(G="KVP",P.push(O[m].href))}return P.length===0&&(G="REST",n.ResourceURL.forEach(function(O){O.resourceType==="tile"&&(l=O.format,P.push(O.template))})),{urls:P,layer:t.layer,matrixSet:a,format:l,projection:_,requestEncoding:G,tileGrid:I,style:h,dimensions:c,wrapX:x,crossOrigin:t.crossOrigin}}function wu(i,t){return O_(i,t,[]).join("")}function O_(i,t,e){if(i.nodeType==Node.CDATA_SECTION_NODE||i.nodeType==Node.TEXT_NODE)e.push(i.nodeValue);else{let n;for(n=i.firstChild;n;n=n.nextSibling)O_(n,t,e)}return e}function ST(i){return"documentElement"in i}function RT(i){return new DOMParser().parseFromString(i,"application/xml")}function Uh(i,t){return function(e,n){const s=i.call(this,e,n);s!==void 0&&n[n.length-1].push(s)}}function me(i,t,e){return function(n,s){const r=i.call(this,n,s);if(r!==void 0){const a=s[s.length-1],o=n.localName;let l;o in a?l=a[o]:(l=[],a[o]=l),l.push(r)}}}function Q(i,t,e){return function(n,s){const r=i.call(this,n,s);if(r!==void 0){const a=s[s.length-1],o=n.localName;a[o]=r}}}function Et(i,t,e){e=e!==void 0?e:{};let n,s;for(n=0,s=i.length;n<s;++n)e[i[n]]=t;return e}function MT(i,t,e,n){let s;for(s=t.firstElementChild;s;s=s.nextElementSibling){const r=i[s.namespaceURI];if(r!==void 0){const a=r[s.localName];a!==void 0&&a.call(n,s,e)}}}function Rt(i,t,e,n,s){return n.push(i),MT(t,e,n,s),n.pop()}class F_{read(t){if(!t)return null;if(typeof t=="string"){const e=RT(t);return this.readFromDocument(e)}return ST(t)?this.readFromDocument(t):this.readFromNode(t)}readFromDocument(t){for(let e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null}readFromNode(t){tt()}}const CT="http://www.w3.org/1999/xlink";function Tu(i){return i.getAttributeNS(CT,"href")}function bT(i){const t=wu(i,!1);return IT(t)}function IT(i){const t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(i);if(t)return parseFloat(t[1])}function zi(i){const t=wu(i,!1);return AT(t)}function AT(i){const t=/^\s*(\d+)\s*$/.exec(i);if(t)return parseInt(t[1],10)}function ut(i){return wu(i,!1).trim()}const Ee=[null,"http://www.opengis.net/ows/1.1"],PT=Et(Ee,{ServiceIdentification:Q(iS),ServiceProvider:Q(sS),OperationsMetadata:Q(tS)});class LT extends F_{constructor(){super()}readFromNode(t){const e=Rt({},PT,t,[]);return e||null}}const OT=Et(Ee,{DeliveryPoint:Q(ut),City:Q(ut),AdministrativeArea:Q(ut),PostalCode:Q(ut),Country:Q(ut),ElectronicMailAddress:Q(ut)}),FT=Et(Ee,{Value:me(rS)}),DT=Et(Ee,{AllowedValues:Q(qT)}),GT=Et(Ee,{Phone:Q(eS),Address:Q(WT)}),NT=Et(Ee,{HTTP:Q(QT)}),kT=Et(Ee,{Get:me(ZT),Post:void 0}),UT=Et(Ee,{DCP:Q(YT)}),BT=Et(Ee,{Operation:JT}),zT=Et(Ee,{Voice:Q(ut),Facsimile:Q(ut)}),XT=Et(Ee,{Constraint:me(KT)}),jT=Et(Ee,{IndividualName:Q(ut),PositionName:Q(ut),ContactInfo:Q(HT)}),VT=Et(Ee,{Abstract:Q(ut),AccessConstraints:Q(ut),Fees:Q(ut),Title:Q(ut),ServiceTypeVersion:Q(ut),ServiceType:Q(ut)}),$T=Et(Ee,{ProviderName:Q(ut),ProviderSite:Q(Tu),ServiceContact:Q(nS)});function WT(i,t){return Rt({},OT,i,t)}function qT(i,t){return Rt({},FT,i,t)}function KT(i,t){const e=i.getAttribute("name");if(e)return Rt({name:e},DT,i,t)}function HT(i,t){return Rt({},GT,i,t)}function YT(i,t){return Rt({},NT,i,t)}function ZT(i,t){const e=Tu(i);if(e)return Rt({href:e},XT,i,t)}function QT(i,t){return Rt({},kT,i,t)}function JT(i,t){const e=i.getAttribute("name"),n=Rt({},UT,i,t);if(!n)return;const s=t[t.length-1];s[e]=n}function tS(i,t){return Rt({},BT,i,t)}function eS(i,t){return Rt({},zT,i,t)}function iS(i,t){return Rt({},VT,i,t)}function nS(i,t){return Rt({},jT,i,t)}function sS(i,t){return Rt({},$T,i,t)}function rS(i,t){return ut(i)}const ci=[null,"http://www.opengis.net/wmts/1.0"],Us=[null,"http://www.opengis.net/ows/1.1"],aS=Et(ci,{Contents:Q(pS)});class oS extends F_{constructor(){super(),this.owsParser_=new LT}readFromNode(t){let e=t.getAttribute("version");e&&(e=e.trim());let n=this.owsParser_.readFromNode(t);return n?(n.version=e,n=Rt(n,aS,t,[]),n||null):null}}const lS=Et(ci,{Layer:me(yS),TileMatrixSet:me(xS)}),hS=Et(ci,{Style:me(ES),Format:me(ut),TileMatrixSetLink:me(vS),Dimension:me(wS),ResourceURL:me(TS)},Et(Us,{Title:Q(ut),Abstract:Q(ut),WGS84BoundingBox:Q(G_),BoundingBox:me(SS),Identifier:Q(ut)})),cS=Et(ci,{LegendURL:me(RS)},Et(Us,{Title:Q(ut),Identifier:Q(ut)})),uS=Et(ci,{TileMatrixSet:Q(ut),TileMatrixSetLimits:Q(CS)}),fS=Et(ci,{TileMatrixLimits:Uh(bS)}),dS=Et(ci,{TileMatrix:Q(ut),MinTileRow:Q(zi),MaxTileRow:Q(zi),MinTileCol:Q(zi),MaxTileCol:Q(zi)}),gS=Et(ci,{Default:Q(ut),Value:me(ut)},Et(Us,{Identifier:Q(ut)})),D_=Et(Us,{LowerCorner:Uh(Bh),UpperCorner:Uh(Bh)}),_S=Et(ci,{WellKnownScaleSet:Q(ut),TileMatrix:me(MS)},Et(Us,{SupportedCRS:Q(ut),Identifier:Q(ut),BoundingBox:Q(G_)})),mS=Et(ci,{TopLeftCorner:Q(Bh),ScaleDenominator:Q(bT),TileWidth:Q(zi),TileHeight:Q(zi),MatrixWidth:Q(zi),MatrixHeight:Q(zi)},Et(Us,{Identifier:Q(ut)}));function pS(i,t){return Rt({},lS,i,t)}function yS(i,t){return Rt({},hS,i,t)}function xS(i,t){return Rt({},_S,i,t)}function ES(i,t){const e=Rt({},cS,i,t);if(!e)return;const n=i.getAttribute("isDefault")==="true";return e.isDefault=n,e}function vS(i,t){return Rt({},uS,i,t)}function wS(i,t){return Rt({},gS,i,t)}function TS(i,t){const e=i.getAttribute("format"),n=i.getAttribute("template"),s=i.getAttribute("resourceType"),r={};return e&&(r.format=e),n&&(r.template=n),s&&(r.resourceType=s),r}function G_(i,t){const e=Rt([],D_,i,t);if(e.length==2)return Es(e)}function SS(i,t){const e=i.getAttribute("crs"),n=Rt([],D_,i,t);if(n.length==2)return{extent:Es(n),crs:e}}function RS(i,t){const e={};return e.format=i.getAttribute("format"),e.href=Tu(i),e}function Bh(i,t){const e=ut(i).split(/\s+/);if(!e||e.length!=2)return;const n=+e[0],s=+e[1];if(!(isNaN(n)||isNaN(s)))return[n,s]}function MS(i,t){return Rt({},mS,i,t)}function CS(i,t){return Rt([],fS,i,t)}function bS(i,t){return Rt({},dS,i,t)}var Ka={exports:{}},IS=Ka.exports,Rd;function AS(){return Rd||(Rd=1,function(i,t){(function(e,n){i.exports=n()})(IS,function(){var e=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(u,f){return u.indexOf(f)===-1?u.length:u.indexOf(f)}function s(u){var f=u.replace(/^v/,"").replace(/\+.*$/,""),_=n(f,"-"),g=f.substring(0,_).split(".");return g.push(f.substring(_+1)),g}function r(u){return isNaN(Number(u))?u:Number(u)}function a(u){if(typeof u!="string")throw new TypeError("Invalid argument expected string");if(!e.test(u))throw new Error("Invalid argument not valid semver ('"+u+"' received)")}function o(u,f){[u,f].forEach(a);for(var _=s(u),g=s(f),x=0;x<Math.max(_.length-1,g.length-1);x++){var y=parseInt(_[x]||0,10),w=parseInt(g[x]||0,10);if(y>w)return 1;if(w>y)return-1}var d=_[_.length-1],p=g[g.length-1];if(d&&p){var v=d.split(".").map(r),T=p.split(".").map(r);for(x=0;x<Math.max(v.length,T.length);x++){if(v[x]===void 0||typeof T[x]=="string"&&typeof v[x]=="number")return-1;if(T[x]===void 0||typeof v[x]=="string"&&typeof T[x]=="number"||v[x]>T[x])return 1;if(T[x]>v[x])return-1}}else if(d||p)return d?-1:1;return 0}var l=[">",">=","=","<","<="],h={">":[1],">=":[0,1],"=":[0],"<=":[-1,0],"<":[-1]};function c(u){if(typeof u!="string")throw new TypeError("Invalid operator type, expected string but got "+typeof u);if(l.indexOf(u)===-1)throw new TypeError("Invalid operator, expected one of "+l.join("|"))}return o.validate=function(u){return typeof u=="string"&&e.test(u)},o.compare=function(u,f,_){c(_);var g=o(u,f);return h[_].indexOf(g)>-1},o})}(Ka)),Ka.exports}var Ql,Md;function PS(){if(Md)return Ql;Md=1;var i=AS();const t="1.1.0",e=!0,n={classification:"https://stac-extensions.github.io/classification/v2.0.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.2.0/schema.json",eo:"https://stac-extensions.github.io/eo/v2.0.0/schema.json",file:"https://stac-extensions.github.io/file/v2.1.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.2.0/schema.json",projection:"https://stac-extensions.github.io/projection/v2.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v2.0.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.1.0/schema.json",version:"https://stac-extensions.github.io/version/v1.2.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},s={itemAndCollection:{"classification:":n.classification,"cube:":n.datacube,"eo:":n.eo,"file:":n.file,"label:":n.label,"pc:":n.pointcloud,"processing:":n.processing,"proj:":n.projection,"raster:":n.raster,"sar:":n.sar,"sat:":n.sat,"sci:":n.scientific,"view:":n.view,version:n.version,deprecated:n.version,published:n.timestamps,expires:n.timestamps,unpublished:n.timestamps},catalog:{},collection:{},item:{}};s.collection=Object.assign(s.collection,s.itemAndCollection),s.item=Object.assign(s.item,s.itemAndCollection);var r={parseExtension(d){let p=d.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(p)return{id:p[1],version:p[2]};let v=d.match(/(\d+\.\d+(\.\d+)([a-z_.-][\w.-]+)?)/i);if(v)return{id:d,version:v[1]};if(d in n)return{id:d,version:"0.0.0"}}},a={version:t,extensions:{},set(d){if(typeof d.stac_version!="string"?a.version="0.6.0":a.version=d.stac_version,Array.isArray(d.stac_extensions))for(let p of d.stac_extensions){let v=r.parseExtension(p);v&&(a.extensions[v.id]=v.version)}},before(d,p=null){return a.compare("<",d,p)},compare(d,p,v=null){let T=v?a.extensions[v]:a.version;return typeof T>"u"?!1:i.compare(T,p,d)}},o={type(d){let p=typeof d;if(p==="object"){if(d===null)return"null";if(Array.isArray(d))return"array"}return p},is(d,p){return Array.isArray(p)?p.includes(o.type(d)):o.type(d)===p},isDefined(d){return typeof d<"u"},isObject(d){return typeof d=="object"&&d===Object(d)&&!Array.isArray(d)},rename(d,p,v){return typeof d[p]<"u"&&typeof d[v]>"u"?(d[v]=d[p],delete d[p],!0):!1},copy(d,p,v){return typeof d[p]<"u"&&typeof d[v]>"u"?(d[v]=d[p],!0):!1},forAll(d,p,v){if(d[p]&&typeof d[p]=="object")for(let T in d[p])v(d[p][T])},toArray(d,p){return typeof d[p]<"u"&&!Array.isArray(d[p])?(d[p]=[d[p]],!0):!1},flattenArray(d,p,v,T=!1){if(Array.isArray(d[p])){for(let R in d[p])if(typeof v[R]=="string"){let C=d[p][R];d[v[R]]=T?[C]:C}return delete d[p],!0}return!1},flattenOneElementArray(d,p,v=!1){return!v&&Array.isArray(d[p])?d[p].length===1?(d[p]=d[p][0],!0):!1:!0},removeFromArray(d,p,v){if(Array.isArray(d[p])){let T=d[p].indexOf(v);return T>-1&&d[p].splice(T,1),!0}return!1},pickFirst(d,p){return Array.isArray(d[p])&&d[p].length>0?(d[p]=d[p][0],!0):(delete d[p],!1)},ensure(d,p,v){return o.type(v)!==o.type(d[p])&&(d[p]=v),!0},upgradeExtension(d,p){let{id:v,version:T}=r.parseExtension(p),R=d.stac_extensions.findIndex(C=>{let b=r.parseExtension(C);return b&&b.id===v&&i.compare(b.version,T,"<")});return R!==-1?(d.stac_extensions[R]=p,!0):!1},addExtension(d,p){let{id:v,version:T}=r.parseExtension(p),R=d.stac_extensions.findIndex(C=>{if(C===p)return!0;let b=r.parseExtension(C);return!!(b&&b.id===v&&i.compare(b.version,T,"<"))});return R===-1?d.stac_extensions.push(p):d.stac_extensions[R]=p,d.stac_extensions.sort(),!0},removeExtension(d,p){return o.removeFromArray(d,"stac_extensions",p)},migrateExtensionShortnames(d){let p=Object.keys(n),v=Object.values(n);return o.mapValues(d,"stac_extensions",p,v)},populateExtensions(d,p){let v=[];(p=="catalog"||p=="collection")&&v.push(d),(p=="item"||p=="collection")&&o.isObject(d.assets)&&(v=v.concat(Object.values(d.assets))),p=="collection"&&o.isObject(d.item_assets)&&(v=v.concat(Object.values(d.item_assets))),p=="collection"&&o.isObject(d.summaries)&&v.push(d.summaries),p=="item"&&o.isObject(d.properties)&&v.push(d.properties),v.push(d.links);let T;for(;T=v.pop();)Object.keys(T).forEach(R=>{Array.isArray(T.bands)&&(v=v.concat(T.bands));let C=R.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(C)){let b=s[p][C[0]];o.is(b,"string")&&o.addExtension(d,b)}})},mapValues(d,p,v,T){let R=C=>{let b=v.indexOf(C);return b>=0?T[b]:C};return Array.isArray(d[p])?d[p]=d[p].map(R):typeof d[p]<"u"&&(d[p]=R(d[p])),!0},mapObject(d,p){for(let v in d)d[v]=p(d[v],v)},moveTo(d,p,v,T=!1,R=!1){let C;return T?R?C=b=>Array.isArray(b):C=b=>Array.isArray(b)&&b.length===1:C=o.isDefined,C(d[p])?(v[p]=T&&!R?d[p][0]:d[p],delete d[p],!0):!1},runAll(d,p,v,T){for(let R in d)R.startsWith("migrate")||d[R](p,v,T)},toUTC(d,p){if(o.is(d[p],"string"))try{return d[p]=this.toISOString(d[p]),!0}catch{}return delete d[p],!1},toISOString(d){return d instanceof Date||(d=new Date(d)),d.toISOString().replace(/\.0+(?=[-\+Z])/,"")},formatString(d,p,v){const T=R=>o.is(R,["string","number"])?v.replaceAll("{}",R):R;Array.isArray(d[p])?d[p]=d[p].map(T):d[p]=T(d[p])}},l={multihash:null,hexToUint8(d){if(d.length===0||d.length%2!==0)throw new Error(`The string "${d}" is not valid hex.`);return new Uint8Array(d.match(/.{1,2}/g).map(p=>parseInt(p,16)))},uint8ToHex(d){return d.reduce((p,v)=>p+v.toString(16).padStart(2,"0"),"")},toMultihash(d,p,v){if(!l.multihash||!o.is(d[p],"string"))return!1;try{const T=l.multihash.encode(l.hexToUint8(d[p]),v);return d[p]=l.uint8ToHex(T),!0}catch(T){return console.warn(T),!1}}},h={migrate(d,p=!0){return a.set(d),p&&(d.stac_version=t),d.type="Catalog",o.ensure(d,"stac_extensions",[]),a.before("1.0.0-rc.1")&&o.migrateExtensionShortnames(d),o.ensure(d,"id",""),o.ensure(d,"description",""),o.ensure(d,"links",[]),o.runAll(h,d,d),a.before("0.8.0")&&o.populateExtensions(d,"catalog"),d}},c={migrate(d,p=!0){return h.migrate(d,p),d.type="Collection",a.before("1.0.0-rc.1")&&o.migrateExtensionShortnames(d),o.ensure(d,"license","other"),o.ensure(d,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),o.runAll(c,d,d),o.isObject(d.properties)&&(o.removeFromArray(d,"stac_extensions","commons"),delete d.properties),a.before("0.8.0")&&o.populateExtensions(d,"collection"),a.before("1.0.0-beta.1")&&o.mapValues(d,"stac_extensions",["assets"],["item-assets"]),d},extent(d){if(o.ensure(d,"extent",{}),a.before("0.8.0")&&(Array.isArray(d.extent.spatial)&&(d.extent.spatial={bbox:[d.extent.spatial]}),Array.isArray(d.extent.temporal)&&(d.extent.temporal={interval:[d.extent.temporal]})),o.ensure(d.extent,"spatial",{}),o.ensure(d.extent.spatial,"bbox",[]),o.ensure(d.extent,"temporal",{}),o.ensure(d.extent.temporal,"interval",[]),a.before("1.0.0-rc.3")){if(d.extent.temporal.interval.length>1){let p,v;for(let T of d.extent.temporal.interval){if(T[0]===null)p=null;else if(typeof T[0]=="string"&&p!==null)try{let R=new Date(T[0]);(typeof p>"u"||R<p)&&(p=R)}catch{}if(T[1]===null)v=null;else if(typeof T[1]=="string"&&v!==null)try{let R=new Date(T[1]);(typeof v>"u"||R>v)&&(v=R)}catch{}}d.extent.temporal.interval.unshift([p?o.toISOString(p):null,v?o.toISOString(v):null])}if(d.extent.spatial.bbox.length>1){let p=d.extent.spatial.bbox.reduce((v,T)=>Array.isArray(T)?Math.max(T.length,v):v,4);if(p>=4){let v=new Array(p).fill(null),T=p/2;for(let R of d.extent.spatial.bbox){if(!Array.isArray(R)||R.length<4)break;for(let C in R){let b=R[C];v[C]===null?v[C]=b:C<T?v[C]=Math.min(b,v[C]):v[C]=Math.max(b,v[C])}}v.findIndex(R=>R===null)===-1&&d.extent.spatial.bbox.unshift(v)}}}},collectionAssets(d){a.before("1.0.0-rc.1")&&o.removeExtension(d,"collection-assets"),g.migrateAll(d)},itemAsset(d){a.before("1.0.0-beta.2")&&o.rename(d,"item_assets","assets"),o.removeExtension(d,n["item-assets"]),g.migrateAll(d,"item_assets")},summaries(d){if(o.ensure(d,"summaries",{}),a.before("0.8.0")&&o.isObject(d.other_properties)){for(let p in d.other_properties){let v=d.other_properties[p];Array.isArray(v.extent)&&v.extent.length===2?d.summaries[p]={minimum:v.extent[0],maximum:v.extent[1]}:Array.isArray(v.values)&&(v.values.filter(T=>Array.isArray(T)).length===v.values.length?d.summaries[p]=v.values.reduce((T,R)=>T.concat(R),[]):d.summaries[p]=v.values)}delete d.other_properties}if(a.before("1.0.0-beta.1")&&o.isObject(d.properties)&&!d.links.find(p=>["child","item"].includes(p.rel)))for(let p in d.properties){let v=d.properties[p];Array.isArray(v)||(v=[v]),d.summaries[p]=v}a.before("1.0.0-rc.1")&&o.mapObject(d.summaries,p=>(o.rename(p,"min","minimum"),o.rename(p,"max","maximum"),p)),y.migrate(d.summaries,d,!0),o.moveTo(d.summaries,"sci:doi",d,!0)&&o.addExtension(d,n.scientific),o.moveTo(d.summaries,"sci:publications",d,!0,!0)&&o.addExtension(d,n.scientific),o.moveTo(d.summaries,"sci:citation",d,!0)&&o.addExtension(d,n.scientific),o.moveTo(d.summaries,"cube:dimensions",d,!0)&&o.addExtension(d,n.datacube),Object.keys(d.summaries).length===0&&delete d.summaries}},u={migrate(d,p=null,v=!0){a.set(d),v&&(d.stac_version=t),o.ensure(d,"stac_extensions",[]),a.before("1.0.0-rc.1")&&o.migrateExtensionShortnames(d),o.ensure(d,"id",""),o.ensure(d,"type","Feature"),o.isObject(d.geometry)||(d.geometry=null),d.geometry!==null&&o.ensure(d,"bbox",[]),o.ensure(d,"properties",{}),o.ensure(d,"links",[]),o.ensure(d,"assets",{});let T=!1;return o.isObject(p)&&o.isObject(p.properties)&&(o.removeFromArray(d,"stac_extensions","commons"),d.properties=Object.assign({},p.properties,d.properties),T=!0),o.runAll(u,d,d),y.migrate(d.properties,d),g.migrateAll(d),(a.before("0.8.0")||T)&&o.populateExtensions(d,"item"),d}},f={migrate(d,p=!0){return o.ensure(d,"collections",[]),o.ensure(d,"links",[]),o.runAll(f,d,d),d.collections=d.collections.map(v=>c.migrate(v,p)),d}},_={migrate(d,p=!0){return o.ensure(d,"type","FeatureCollection"),o.ensure(d,"features",[]),o.ensure(d,"links",[]),o.runAll(_,d,d),d.features=d.features.map(v=>u.migrate(v,null,p)),d}},g={migrateAll(d,p="assets"){for(let v in d[p])g.migrate(d[p][v],d)},migrate(d,p){return o.runAll(g,d,p),y.migrate(d,p),d},mediaTypes(d){o.is(d.type,"string")&&o.mapValues(d,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])}},x={migrateAll(d,p){if(a.before("1.0.0")){const v=o.isObject(p.properties)&&Array.isArray(p.properties.bands)?p.properties.bands:[];if(Array.isArray(d["eo:bands"]))for(let T in d["eo:bands"]){let R=d["eo:bands"][T];o.is(R,"number")&&o.isObject(v[R])&&(R=v[R]),o.isObject(R)||(R={}),d["eo:bands"][T]=R}}if(a.before("1.1.0-beta.1")&&(Array.isArray(d["raster:bands"])||Array.isArray(d["eo:bands"]))){o.ensure(d,"bands",[]);const v=d["raster:bands"]||[],T=d["eo:bands"]||[],R=Math.max(v.length,T.length);for(let C=0;C<R;C++)o.ensure(d.bands,C,{}),Object.assign(d.bands[C],v[C],T[C]),d.bands[C]=x.migrate(d.bands[C],p);delete d["raster:bands"],delete d["eo:bands"]}},migrate(d,p){return o.runAll(x,d,p),y.migrate(d,p),d},eo(d){a.before("2.0.0-beta.1","eo")&&(o.rename(d,"common_name","eo:common_name"),o.rename(d,"center_wavelength","eo:center_wavelength"),o.rename(d,"full_width_half_max","eo:full_width_half_max"),o.rename(d,"solar_illumination","eo:solar_illumination"))},raster(d){a.before("2.0.0-beta.1","raster")&&(o.rename(d,"sampling","raster:sampling"),o.rename(d,"bits_per_sample","raster:bits_per_sample"),o.rename(d,"spatial_resolution","raster:spatial_resolution"),o.rename(d,"scale","raster:scale"),o.rename(d,"offset","raster:offset"),o.rename(d,"histogram","raster:histogram"))}},y={migrate(d,p,v=!1){return o.runAll(y,d,p,v),d},_commonMetadata(d,p){a.before("1.0.0-rc.3")&&(o.toUTC(d,"created"),o.toUTC(d,"updated")),x.migrateAll(d,p)},_timestamps(d,p){o.toUTC(d,"published"),o.toUTC(d,"expires"),o.toUTC(d,"unpublished"),o.upgradeExtension(p,n.timestamps)},_versioningIndicator(d,p){o.upgradeExtension(p,n.version)},checksum(d,p){a.before("0.9.0")&&l.multihash&&(o.rename(d,"checksum:md5","checksum:multihash")&&l.toMultihash(d,"checksum:multihash","md5"),o.rename(d,"checksum:sha1","checksum:multihash")&&l.toMultihash(d,"checksum:multihash","sha1"),o.rename(d,"checksum:sha2","checksum:multihash")&&l.toMultihash(d,"checksum:multihash","sha2-256"),o.rename(d,"checksum:sha3","checksum:multihash")&&l.toMultihash(d,"checksum:multihash","sha3-256")),a.before("1.0.0-rc.1")&&o.rename(d,"checksum:multihash","file:checksum")&&o.addExtension(p,n.file),o.removeExtension(p,"checksum")},classification(d,p){a.before("1.1.0","classification")&&o.forAll(d,"classification:classes",v=>o.rename(v,"color-hint","color_hint")),a.before("2.0.0","classification")&&o.forAll(d,"classification:classes",v=>o.ensure(v,"name",v.description)),o.upgradeExtension(p,n.classification)},cube(d,p){o.upgradeExtension(p,n.datacube)},dtr(d,p){a.before("0.9.0")&&(o.rename(d,"dtr:start_datetime","start_datetime"),o.rename(d,"dtr:end_datetime","end_datetime"),o.removeExtension(p,"datetime-range"))},eo(d,p){a.before("0.9.0")&&(o.rename(d,"eo:epsg","proj:epsg")&&o.addExtension(p,n.projection),o.rename(d,"eo:platform","platform"),o.rename(d,"eo:instrument","instruments")&&o.toArray(d,"instruments"),o.rename(d,"eo:constellation","constellation"),o.rename(d,"eo:off_nadir","view:off_nadir")&&o.addExtension(p,n.view),o.rename(d,"eo:azimuth","view:azimuth")&&o.addExtension(p,n.view),o.rename(d,"eo:incidence_angle","view:incidence_angle")&&o.addExtension(p,n.view),o.rename(d,"eo:sun_azimuth","view:sun_azimuth")&&o.addExtension(p,n.view),o.rename(d,"eo:sun_elevation","view:sun_elevation")&&o.addExtension(p,n.view)),a.before("1.0.0-beta.1")&&o.rename(d,"eo:gsd","gsd"),o.upgradeExtension(p,n.eo)},file(d,p,v){o.rename(d,"file:bits_per_sample","raster:bits_per_sample")&&o.addExtension(p,n.raster),o.rename(d,"file:data_type","data_type"),o.rename(d,"file:unit","unit"),Array.isArray(d["file:nodata"])&&d["file:nodata"].length>1&&o.copy(d,"file:nodata","nodata:values"),o.rename(d,"file:nodata","nodata")&&!v&&o.pickFirst(d,"nodata"),o.upgradeExtension(p,n.file)},label(d,p){a.before("0.8.0")&&(o.rename(d,"label:property","label:properties"),o.rename(d,"label:task","label:tasks"),o.rename(d,"label:overview","label:overviews")&&o.toArray(d,"label:overviews"),o.rename(d,"label:method","label:methods"),o.toArray(d,"label:classes")),o.upgradeExtension(p,n.label)},pc(d,p){a.before("0.8.0")&&o.rename(d,"pc:schema","pc:schemas"),o.upgradeExtension(p,n.pointcloud)},processing(d,p){o.upgradeExtension(p,n.processing)},proj(d,p){o.rename(d,"proj:epsg","proj:code")&&o.formatString(d,"proj:code","EPSG:{}"),o.upgradeExtension(p,n.projection)},raster(d,p){o.upgradeExtension(p,n.raster)},sar(d,p,v){o.rename(d,"sar:incidence_angle","view:incidence_angle")&&o.addExtension(p,n.view),o.rename(d,"sar:pass_direction","sat:orbit_state")&&o.mapValues(d,"sat:orbit_state",[null],["geostationary"])&&o.addExtension(p,n.sat),a.before("0.7.0")&&(o.flattenArray(d,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],v),o.flattenArray(d,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],v),o.flattenArray(d,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],v),o.rename(d,"sar:off_nadir","view:off_nadir")&&o.addExtension(p,n.view)),a.before("0.9.0")&&(o.rename(d,"sar:platform","platform"),o.rename(d,"sar:instrument","instruments")&&o.toArray(d,"instruments"),o.rename(d,"sar:constellation","constellation"),o.rename(d,"sar:type","sar:product_type"),o.rename(d,"sar:polarization","sar:polarizations"),o.flattenOneElementArray(d,"sar:absolute_orbit",v)&&o.rename(d,"sar:absolute_orbit","sat:absolute_orbit")&&o.addExtension(p,n.sat),o.flattenOneElementArray(d,"sar:relative_orbit",v)&&o.rename(d,"sar:relative_orbit","sat:relative_orbit")&&o.addExtension(p,n.sat)),o.upgradeExtension(p,n.sar)},sat(d,p){a.before("0.9.0")&&(o.rename(d,"sat:off_nadir_angle","sat:off_nadir"),o.rename(d,"sat:azimuth_angle","sat:azimuth"),o.rename(d,"sat:sun_azimuth_angle","sat:sun_azimuth"),o.rename(d,"sat:sun_elevation_angle","sat:sun_elevation")),o.upgradeExtension(p,n.sat)},sci(d,p){o.upgradeExtension(p,n.scientific)},item(d){a.before("0.8.0")&&(o.rename(d,"item:license","license"),o.rename(d,"item:providers","providers"))},table(d,p){o.upgradeExtension(p,n.table)},view(d,p){o.upgradeExtension(p,n.view)}},w={item(d,p=null,v=!0){return u.migrate(d,p,v)},catalog(d,p=!0){return h.migrate(d,p)},collection(d,p=!0){return c.migrate(d,p)},collectionCollection(d,p=!0){return f.migrate(d,p)},itemCollection(d,p=!0){return _.migrate(d,p)},stac(d,p=!0){return d.type==="Feature"?w.item(d,null,p):d.type==="FeatureCollection"?w.itemCollection(d,p):d.type==="Collection"||!d.type&&o.isDefined(d.extent)&&o.isDefined(d.license)?w.collection(d,p):!d.type&&Array.isArray(d.collections)?w.collectionCollection(d,p):w.catalog(d,p)},enableMultihash(d){l.multihash=d}};return Ql=w,Ql}var LS=PS();const OS=ol(LS);function he(i){return typeof i=="string"&&i.length>0}function as(i,t,e,n=1e-8){if(typeof i!="number")return null;const s=t-n,r=e+n;return i<s||i>r?null:Math.min(Math.max(i,t),e)}function se(i){return typeof i=="object"&&i===Object(i)&&!Array.isArray(i)}function FS(i){switch(i){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return i.startsWith("u")?0:null}function DS(i){switch(i){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}function N_(i){const t={minimum:null,maximum:null},e=l=>l.minimum!==null&&l.maximum!==null,n=i.getMetadata("statistics");if(se(n)&&(typeof n.minimum=="number"&&(t.minimum=n.minimum),typeof n.maximum=="number"&&(t.maximum=n.maximum),e(t)))return t;const s=i.getMetadata("raster:histogram");if(se(s)&&(typeof s.min=="number"&&(t.minimum=s.min),typeof s.max=="number"&&(t.maximum=s.max),e(t)))return t;const r=i.getMetadata("classification:classes");if(Array.isArray(r)&&(r.reduce((l,h)=>(l.minimum=Math.min(l.minimum,h.value),l.maximum=Math.max(l.maximum,h.value),l),t),e(t)))return t;const a=i.getMetadata("file:values");if(Array.isArray(a)&&(a.reduce((l,h)=>(l.minimum=Math.min(l.minimum,...h.values),l.maximum=Math.max(l.maximum,...h.values),l),t),e(t)))return t;const o=i.getMetadata("data_type");return o&&(t.minimum=FS(o),t.maximum=DS(o)),t}function k_(i){let t=[];const e=i.getMetadata("nodata");if(typeof e<"u")t.push(e);else{const n=i.getMetadata("file:nodata");if(typeof n<"u")t=n;else{const s=i.getMetadata("classification:classes");Array.isArray(s)&&(t=s.filter(r=>!!r.nodata).map(r=>r.value))}}return t.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}function Bs(i){let t=i.length>=6,e=i[0],n=i[t?3:2],s=i[1],r=i[t?4:3],a={west:e,east:n,south:s,north:r};return t&&(a.base=i[2],a.height=i[5]),a}function Jl(i){let{west:t,east:e,south:n,north:s}=Bs(i);return[[[t,s],[t,n],[e,n],[e,s],[t,s]]]}function GS(i){if(i=oi(i,!0),!i)return null;let t=Bs(i),e=[];if(z_(i)){let n=(t.west+360+t.east)/2;n>180&&(n-=360),e.push(n)}else e.push((t.west+t.east)/2);return e.push((t.south+t.north)/2),typeof t.base<"u"&&e.push((t.base+t.height)/2),e}function U_(i){if(Array.isArray(i[0]))return i.map(U_);const[t,e]=i;return[as(t,-180,180),as(e,-90,90)]}function Ha(i){return se(i)&&(i.bbox&&(i.bbox=oi(i.bbox)),i.type==="FeatureCollection"?i.features.forEach(t=>Ha(t)):i.type==="Feature"?i.geometry=Ha(i.geometry):i.type==="GeometryCollection"?i.geometries.forEach(t=>Ha(t)):i.coordinates&&(i.coordinates=U_(i.coordinates))),i}function B_(i){if(i.every(n=>typeof n=="number")&&(i=[i]),i=i.map(n=>oi(n)).filter(n=>n!==null),!Array.isArray(i)||i.length===0)return null;let t=i.reduce((n,s)=>{if(z_(s)){let{west:r,east:a,south:o,north:l}=Bs(s);n.push(Jl([-180,o,a,l])),n.push(Jl([r,o,180,l]))}else n.push(Jl(s));return n},[]),e=null;if(t.length===1?e={type:"Polygon",coordinates:t[0]}:t.length>1&&(e={type:"MultiPolygon",coordinates:t}),e)return{type:"Feature",geometry:e,properties:{}}}function oi(i,t=!1){if(!Array.isArray(i)||![4,6].includes(i.length))return null;let{west:e,east:n,south:s,north:r,base:a,height:o}=Bs(i);return e=as(e,-180,180),s=as(s,-90,90),n=as(n,-180,180),r=as(r,-90,90),t&&i.length===6?i=[e,s,a,n,r,o]:i=[e,s,n,r],i.some(l=>l===null)?null:i}function z_(i){if(i=oi(i),!i)return!1;let{west:t,east:e}=Bs(i);return t>e}function Su(i){if(!Array.isArray(i)||i.length===0)return null;let t={west:180,south:90,east:-180,north:-90};i.forEach(n=>{if(n=oi(n),!n)return;let s=Bs(n),r=["west","south"];for(let a in s){let o=r.includes(a)?Math.min:Math.max;t[a]=o(t[a],s[a])}});let e=[t.west,t.south,t.east,t.north];return oi(e)}class ua{constructor(t,e={},n=[]){if(!se(t))throw new Error("Given data is not an object");if(t instanceof ua){for(let s of n)this[s]=t[s];t=t.toJSON()}this._keyMap=e,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let s in t)typeof this[s]>"u"&&(s in e?this[s]=e[s](t[s],this):this[s]=t[s])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}isBand(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(t){return this[t]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return GS(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let t={};return Object.keys(this).forEach(e=>{if(typeof this[e]=="function"||this._privateKeys.includes(e))return;let n=this[e];if(e in this._keyMap){let s=Array.isArray(n)?[]:{};for(let r in n)typeof n[r].toJSON=="function"?s[r]=n[r].toJSON():s[r]=n[r];n=s}t[e]=n}),t}}var Ya={exports:{}},or={exports:{}};/*! https://mths.be/punycode v1.4.0 by @mathias */var NS=or.exports,Cd;function kS(){return Cd||(Cd=1,function(i,t){(function(e){var n=t&&!t.nodeType&&t,s=i&&!i.nodeType&&i,r=typeof td=="object"&&td;(r.global===r||r.window===r||r.self===r)&&(e=r);var a,o=2147483647,l=36,h=1,c=26,u=38,f=700,_=72,g=128,x="-",y=/^xn--/,w=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},v=l-h,T=Math.floor,R=String.fromCharCode,C;function b(k){throw new RangeError(p[k])}function I(k,B){for(var U=k.length,V=[];U--;)V[U]=B(k[U]);return V}function P(k,B){var U=k.split("@"),V="";U.length>1&&(V=U[0]+"@",k=U[1]),k=k.replace(d,".");var q=k.split("."),W=I(q,B).join(".");return V+W}function G(k){for(var B=[],U=0,V=k.length,q,W;U<V;)q=k.charCodeAt(U++),q>=55296&&q<=56319&&U<V?(W=k.charCodeAt(U++),(W&64512)==56320?B.push(((q&1023)<<10)+(W&1023)+65536):(B.push(q),U--)):B.push(q);return B}function O(k){return I(k,function(B){var U="";return B>65535&&(B-=65536,U+=R(B>>>10&1023|55296),B=56320|B&1023),U+=R(B),U}).join("")}function m(k){return k-48<10?k-22:k-65<26?k-65:k-97<26?k-97:l}function E(k,B){return k+22+75*(k<26)-((B!=0)<<5)}function S(k,B,U){var V=0;for(k=U?T(k/f):k>>1,k+=T(k/B);k>v*c>>1;V+=l)k=T(k/v);return T(V+(v+1)*k/(k+u))}function M(k){var B=[],U=k.length,V,q=0,W=g,H=_,et,mt,ht,dt,St,Ut,Ft,jt,Dt;for(et=k.lastIndexOf(x),et<0&&(et=0),mt=0;mt<et;++mt)k.charCodeAt(mt)>=128&&b("not-basic"),B.push(k.charCodeAt(mt));for(ht=et>0?et+1:0;ht<U;){for(dt=q,St=1,Ut=l;ht>=U&&b("invalid-input"),Ft=m(k.charCodeAt(ht++)),(Ft>=l||Ft>T((o-q)/St))&&b("overflow"),q+=Ft*St,jt=Ut<=H?h:Ut>=H+c?c:Ut-H,!(Ft<jt);Ut+=l)Dt=l-jt,St>T(o/Dt)&&b("overflow"),St*=Dt;V=B.length+1,H=S(q-dt,V,dt==0),T(q/V)>o-W&&b("overflow"),W+=T(q/V),q%=V,B.splice(q++,0,W)}return O(B)}function A(k){var B,U,V,q,W,H,et,mt,ht,dt,St,Ut=[],Ft,jt,Dt,Jt;for(k=G(k),Ft=k.length,B=g,U=0,W=_,H=0;H<Ft;++H)St=k[H],St<128&&Ut.push(R(St));for(V=q=Ut.length,q&&Ut.push(x);V<Ft;){for(et=o,H=0;H<Ft;++H)St=k[H],St>=B&&St<et&&(et=St);for(jt=V+1,et-B>T((o-U)/jt)&&b("overflow"),U+=(et-B)*jt,B=et,H=0;H<Ft;++H)if(St=k[H],St<B&&++U>o&&b("overflow"),St==B){for(mt=U,ht=l;dt=ht<=W?h:ht>=W+c?c:ht-W,!(mt<dt);ht+=l)Jt=mt-dt,Dt=l-dt,Ut.push(R(E(dt+Jt%Dt,0))),mt=T(Jt/Dt);Ut.push(R(E(mt,0))),W=S(U,jt,V==q),U=0,++V}++U,++B}return Ut.join("")}function F(k){return P(k,function(B){return y.test(B)?M(B.slice(4).toLowerCase()):B})}function D(k){return P(k,function(B){return w.test(B)?"xn--"+A(B):B})}if(a={version:"1.3.2",ucs2:{decode:G,encode:O},decode:M,encode:A,toASCII:D,toUnicode:F},n&&s)if(i.exports==n)s.exports=a;else for(C in a)a.hasOwnProperty(C)&&(n[C]=a[C]);else e.punycode=a})(NS)}(or,or.exports)),or.exports}var Za={exports:{}};/*!
 * URI.js - Mutating URLs
 * IPv6 Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var US=Za.exports,bd;function BS(){return bd||(bd=1,function(i){(function(t,e){i.exports?i.exports=e():t.IPv6=e(t)})(US,function(t){var e=t&&t.IPv6;function n(r){var a=r.toLowerCase(),o=a.split(":"),l=o.length,h=8;o[0]===""&&o[1]===""&&o[2]===""?(o.shift(),o.shift()):o[0]===""&&o[1]===""?o.shift():o[l-1]===""&&o[l-2]===""&&o.pop(),l=o.length,o[l-1].indexOf(".")!==-1&&(h=7);var c;for(c=0;c<l&&o[c]!=="";c++);if(c<h)for(o.splice(c,1,"0000");o.length<h;)o.splice(c,0,"0000");for(var u,f=0;f<h;f++){u=o[f].split("");for(var _=0;_<3&&(u[0]==="0"&&u.length>1);_++)u.splice(0,1);o[f]=u.join("")}var g=-1,x=0,y=0,w=-1,d=!1;for(f=0;f<h;f++)d?o[f]==="0"?y+=1:(d=!1,y>x&&(g=w,x=y)):o[f]==="0"&&(d=!0,w=f,y=1);y>x&&(g=w,x=y),x>1&&o.splice(g,x,""),l=o.length;var p="";for(o[0]===""&&(p=":"),f=0;f<l&&(p+=o[f],f!==l-1);f++)p+=":";return o[l-1]===""&&(p+=":"),p}function s(){return t.IPv6===this&&(t.IPv6=e),this}return{best:n,noConflict:s}})}(Za)),Za.exports}var Qa={exports:{}};/*!
 * URI.js - Mutating URLs
 * Second Level Domain (SLD) Support
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var zS=Qa.exports,Id;function XS(){return Id||(Id=1,function(i){(function(t,e){i.exports?i.exports=e():t.SecondLevelDomains=e(t)})(zS,function(t){var e=t&&t.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(s){var r=s.lastIndexOf(".");if(r<=0||r>=s.length-1)return!1;var a=s.lastIndexOf(".",r-1);if(a<=0||a>=r-1)return!1;var o=n.list[s.slice(r+1)];return o?o.indexOf(" "+s.slice(a+1,r)+" ")>=0:!1},is:function(s){var r=s.lastIndexOf(".");if(r<=0||r>=s.length-1)return!1;var a=s.lastIndexOf(".",r-1);if(a>=0)return!1;var o=n.list[s.slice(r+1)];return o?o.indexOf(" "+s.slice(0,r)+" ")>=0:!1},get:function(s){var r=s.lastIndexOf(".");if(r<=0||r>=s.length-1)return null;var a=s.lastIndexOf(".",r-1);if(a<=0||a>=r-1)return null;var o=n.list[s.slice(r+1)];return!o||o.indexOf(" "+s.slice(a+1,r)+" ")<0?null:s.slice(a+1)},noConflict:function(){return t.SecondLevelDomains===this&&(t.SecondLevelDomains=e),this}};return n})}(Qa)),Qa.exports}/*!
 * URI.js - Mutating URLs
 *
 * Version: 1.19.11
 *
 * Author: Rodney Rehm
 * Web: http://medialize.github.io/URI.js/
 *
 * Licensed under
 *   MIT License http://www.opensource.org/licenses/mit-license
 *
 */var jS=Ya.exports,Ad;function VS(){return Ad||(Ad=1,function(i){(function(t,e){i.exports?i.exports=e(kS(),BS(),XS()):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)})(jS,function(t,e,n,s){var r=s&&s.URI;function a(m,E){var S=arguments.length>=1,M=arguments.length>=2;if(!(this instanceof a))return S?M?new a(m,E):new a(m):new a;if(m===void 0){if(S)throw new TypeError("undefined is not a valid argument for URI");typeof location<"u"?m=location.href+"":m=""}if(m===null&&S)throw new TypeError("null is not a valid argument for URI");return this.href(m),E!==void 0?this.absoluteTo(E):this}function o(m){return/^[0-9]+$/.test(m)}a.version="1.19.11";var l=a.prototype,h=Object.prototype.hasOwnProperty;function c(m){return m.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function u(m){return m===void 0?"Undefined":String(Object.prototype.toString.call(m)).slice(8,-1)}function f(m){return u(m)==="Array"}function _(m,E){var S={},M,A;if(u(E)==="RegExp")S=null;else if(f(E))for(M=0,A=E.length;M<A;M++)S[E[M]]=!0;else S[E]=!0;for(M=0,A=m.length;M<A;M++){var F=S&&S[m[M]]!==void 0||!S&&E.test(m[M]);F&&(m.splice(M,1),A--,M--)}return m}function g(m,E){var S,M;if(f(E)){for(S=0,M=E.length;S<M;S++)if(!g(m,E[S]))return!1;return!0}var A=u(E);for(S=0,M=m.length;S<M;S++)if(A==="RegExp"){if(typeof m[S]=="string"&&m[S].match(E))return!0}else if(m[S]===E)return!0;return!1}function x(m,E){if(!f(m)||!f(E)||m.length!==E.length)return!1;m.sort(),E.sort();for(var S=0,M=m.length;S<M;S++)if(m[S]!==E[S])return!1;return!0}function y(m){var E=/^\/+|\/+$/g;return m.replace(E,"")}a._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:a.preventInvalidHostname,duplicateQueryParameters:a.duplicateQueryParameters,escapeQuerySpace:a.escapeQuerySpace}},a.preventInvalidHostname=!1,a.duplicateQueryParameters=!1,a.escapeQuerySpace=!0,a.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,a.idn_expression=/[^a-z0-9\._-]/i,a.punycode_expression=/(xn--)/i,a.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,a.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,a.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/ig,a.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},a.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,a.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,a.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},a.hostProtocols=["http","https"],a.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,a.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},a.getDomAttribute=function(m){if(!(!m||!m.nodeName)){var E=m.nodeName.toLowerCase();if(!(E==="input"&&m.type!=="image"))return a.domAttributes[E]}};function w(m){return escape(m)}function d(m){return encodeURIComponent(m).replace(/[!'()*]/g,w).replace(/\*/g,"%2A")}a.encode=d,a.decode=decodeURIComponent,a.iso8859=function(){a.encode=escape,a.decode=unescape},a.unicode=function(){a.encode=d,a.decode=decodeURIComponent},a.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/ig,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/ig,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/ig,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},a.encodeQuery=function(m,E){var S=a.encode(m+"");return E===void 0&&(E=a.escapeQuerySpace),E?S.replace(/%20/g,"+"):S},a.decodeQuery=function(m,E){m+="",E===void 0&&(E=a.escapeQuerySpace);try{return a.decode(E?m.replace(/\+/g,"%20"):m)}catch{return m}};var p={encode:"encode",decode:"decode"},v,T=function(m,E){return function(S){try{return a[E](S+"").replace(a.characters[m][E].expression,function(M){return a.characters[m][E].map[M]})}catch{return S}}};for(v in p)a[v+"PathSegment"]=T("pathname",p[v]),a[v+"UrnPathSegment"]=T("urnpath",p[v]);var R=function(m,E,S){return function(M){var A;S?A=function(B){return a[E](a[S](B))}:A=a[E];for(var F=(M+"").split(m),D=0,k=F.length;D<k;D++)F[D]=A(F[D]);return F.join(m)}};a.decodePath=R("/","decodePathSegment"),a.decodeUrnPath=R(":","decodeUrnPathSegment"),a.recodePath=R("/","encodePathSegment","decode"),a.recodeUrnPath=R(":","encodeUrnPathSegment","decode"),a.encodeReserved=T("reserved","encode"),a.parse=function(m,E){var S;return E||(E={preventInvalidHostname:a.preventInvalidHostname}),m=m.replace(a.leading_whitespace_expression,""),m=m.replace(a.ascii_tab_whitespace,""),S=m.indexOf("#"),S>-1&&(E.fragment=m.substring(S+1)||null,m=m.substring(0,S)),S=m.indexOf("?"),S>-1&&(E.query=m.substring(S+1)||null,m=m.substring(0,S)),m=m.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://"),m=m.replace(/^[/\\]{2,}/i,"//"),m.substring(0,2)==="//"?(E.protocol=null,m=m.substring(2),m=a.parseAuthority(m,E)):(S=m.indexOf(":"),S>-1&&(E.protocol=m.substring(0,S)||null,E.protocol&&!E.protocol.match(a.protocol_expression)?E.protocol=void 0:m.substring(S+1,S+3).replace(/\\/g,"/")==="//"?(m=m.substring(S+3),m=a.parseAuthority(m,E)):(m=m.substring(S+1),E.urn=!0))),E.path=m,E},a.parseHost=function(m,E){m||(m=""),m=m.replace(/\\/g,"/");var S=m.indexOf("/"),M,A;if(S===-1&&(S=m.length),m.charAt(0)==="[")M=m.indexOf("]"),E.hostname=m.substring(1,M)||null,E.port=m.substring(M+2,S)||null,E.port==="/"&&(E.port=null);else{var F=m.indexOf(":"),D=m.indexOf("/"),k=m.indexOf(":",F+1);k!==-1&&(D===-1||k<D)?(E.hostname=m.substring(0,S)||null,E.port=null):(A=m.substring(0,S).split(":"),E.hostname=A[0]||null,E.port=A[1]||null)}return E.hostname&&m.substring(S).charAt(0)!=="/"&&(S++,m="/"+m),E.preventInvalidHostname&&a.ensureValidHostname(E.hostname,E.protocol),E.port&&a.ensureValidPort(E.port),m.substring(S)||"/"},a.parseAuthority=function(m,E){return m=a.parseUserinfo(m,E),a.parseHost(m,E)},a.parseUserinfo=function(m,E){var S=m,M=m.indexOf("\\");M!==-1&&(m=m.replace(/\\/g,"/"));var A=m.indexOf("/"),F=m.lastIndexOf("@",A>-1?A:m.length-1),D;return F>-1&&(A===-1||F<A)?(D=m.substring(0,F).split(":"),E.username=D[0]?a.decode(D[0]):null,D.shift(),E.password=D[0]?a.decode(D.join(":")):null,m=S.substring(F+1)):(E.username=null,E.password=null),m},a.parseQuery=function(m,E){if(!m)return{};if(m=m.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!m)return{};for(var S={},M=m.split("&"),A=M.length,F,D,k,B=0;B<A;B++)F=M[B].split("="),D=a.decodeQuery(F.shift(),E),k=F.length?a.decodeQuery(F.join("="),E):null,D!=="__proto__"&&(h.call(S,D)?((typeof S[D]=="string"||S[D]===null)&&(S[D]=[S[D]]),S[D].push(k)):S[D]=k);return S},a.build=function(m){var E="",S=!1;return m.protocol&&(E+=m.protocol+":"),!m.urn&&(E||m.hostname)&&(E+="//",S=!0),E+=a.buildAuthority(m)||"",typeof m.path=="string"&&(m.path.charAt(0)!=="/"&&S&&(E+="/"),E+=m.path),typeof m.query=="string"&&m.query&&(E+="?"+m.query),typeof m.fragment=="string"&&m.fragment&&(E+="#"+m.fragment),E},a.buildHost=function(m){var E="";if(m.hostname)a.ip6_expression.test(m.hostname)?E+="["+m.hostname+"]":E+=m.hostname;else return"";return m.port&&(E+=":"+m.port),E},a.buildAuthority=function(m){return a.buildUserinfo(m)+a.buildHost(m)},a.buildUserinfo=function(m){var E="";return m.username&&(E+=a.encode(m.username)),m.password&&(E+=":"+a.encode(m.password)),E&&(E+="@"),E},a.buildQuery=function(m,E,S){var M="",A,F,D,k;for(F in m)if(F!=="__proto__"&&h.call(m,F))if(f(m[F]))for(A={},D=0,k=m[F].length;D<k;D++)m[F][D]!==void 0&&A[m[F][D]+""]===void 0&&(M+="&"+a.buildQueryParameter(F,m[F][D],S),E!==!0&&(A[m[F][D]+""]=!0));else m[F]!==void 0&&(M+="&"+a.buildQueryParameter(F,m[F],S));return M.substring(1)},a.buildQueryParameter=function(m,E,S){return a.encodeQuery(m,S)+(E!==null?"="+a.encodeQuery(E,S):"")},a.addQuery=function(m,E,S){if(typeof E=="object")for(var M in E)h.call(E,M)&&a.addQuery(m,M,E[M]);else if(typeof E=="string"){if(m[E]===void 0){m[E]=S;return}else typeof m[E]=="string"&&(m[E]=[m[E]]);f(S)||(S=[S]),m[E]=(m[E]||[]).concat(S)}else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter")},a.setQuery=function(m,E,S){if(typeof E=="object")for(var M in E)h.call(E,M)&&a.setQuery(m,M,E[M]);else if(typeof E=="string")m[E]=S===void 0?null:S;else throw new TypeError("URI.setQuery() accepts an object, string as the name parameter")},a.removeQuery=function(m,E,S){var M,A,F;if(f(E))for(M=0,A=E.length;M<A;M++)m[E[M]]=void 0;else if(u(E)==="RegExp")for(F in m)E.test(F)&&(m[F]=void 0);else if(typeof E=="object")for(F in E)h.call(E,F)&&a.removeQuery(m,F,E[F]);else if(typeof E=="string")S!==void 0?u(S)==="RegExp"?!f(m[E])&&S.test(m[E])?m[E]=void 0:m[E]=_(m[E],S):m[E]===String(S)&&(!f(S)||S.length===1)?m[E]=void 0:f(m[E])&&(m[E]=_(m[E],S)):m[E]=void 0;else throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter")},a.hasQuery=function(m,E,S,M){switch(u(E)){case"String":break;case"RegExp":for(var A in m)if(h.call(m,A)&&E.test(A)&&(S===void 0||a.hasQuery(m,A,S)))return!0;return!1;case"Object":for(var F in E)if(h.call(E,F)&&!a.hasQuery(m,F,E[F]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(u(S)){case"Undefined":return E in m;case"Boolean":var D=!!(f(m[E])?m[E].length:m[E]);return S===D;case"Function":return!!S(m[E],E,m);case"Array":if(!f(m[E]))return!1;var k=M?g:x;return k(m[E],S);case"RegExp":return f(m[E])?M?g(m[E],S):!1:!!(m[E]&&m[E].match(S));case"Number":S=String(S);case"String":return f(m[E])?M?g(m[E],S):!1:m[E]===S;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},a.joinPaths=function(){for(var m=[],E=[],S=0,M=0;M<arguments.length;M++){var A=new a(arguments[M]);m.push(A);for(var F=A.segment(),D=0;D<F.length;D++)typeof F[D]=="string"&&E.push(F[D]),F[D]&&S++}if(!E.length||!S)return new a("");var k=new a("").segment(E);return(m[0].path()===""||m[0].path().slice(0,1)==="/")&&k.path("/"+k.path()),k.normalize()},a.commonPath=function(m,E){var S=Math.min(m.length,E.length),M;for(M=0;M<S;M++)if(m.charAt(M)!==E.charAt(M)){M--;break}return M<1?m.charAt(0)===E.charAt(0)&&m.charAt(0)==="/"?"/":"":((m.charAt(M)!=="/"||E.charAt(M)!=="/")&&(M=m.substring(0,M).lastIndexOf("/")),m.substring(0,M+1))},a.withinString=function(m,E,S){S||(S={});var M=S.start||a.findUri.start,A=S.end||a.findUri.end,F=S.trim||a.findUri.trim,D=S.parens||a.findUri.parens,k=/[a-z0-9-]=["']?$/i;for(M.lastIndex=0;;){var B=M.exec(m);if(!B)break;var U=B.index;if(S.ignoreHtml){var V=m.slice(Math.max(U-3,0),U);if(V&&k.test(V))continue}for(var q=U+m.slice(U).search(A),W=m.slice(U,q),H=-1;;){var et=D.exec(W);if(!et)break;var mt=et.index+et[0].length;H=Math.max(H,mt)}if(H>-1?W=W.slice(0,H)+W.slice(H).replace(F,""):W=W.replace(F,""),!(W.length<=B[0].length)&&!(S.ignore&&S.ignore.test(W))){q=U+W.length;var ht=E(W,U,q,m);if(ht===void 0){M.lastIndex=q;continue}ht=String(ht),m=m.slice(0,U)+ht+m.slice(q),M.lastIndex=U+ht.length}}return M.lastIndex=0,m},a.ensureValidHostname=function(m,E){var S=!!m,M=!!E,A=!1;if(M&&(A=g(a.hostProtocols,E)),A&&!S)throw new TypeError("Hostname cannot be empty, if protocol is "+E);if(m&&m.match(a.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+m+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(t.toASCII(m).match(a.invalid_hostname_characters))throw new TypeError('Hostname "'+m+'" contains characters other than [A-Z0-9.-:_]')}},a.ensureValidPort=function(m){if(m){var E=Number(m);if(!(o(E)&&E>0&&E<65536))throw new TypeError('Port "'+m+'" is not a valid port')}},a.noConflict=function(m){if(m){var E={URI:this.noConflict()};return s.URITemplate&&typeof s.URITemplate.noConflict=="function"&&(E.URITemplate=s.URITemplate.noConflict()),s.IPv6&&typeof s.IPv6.noConflict=="function"&&(E.IPv6=s.IPv6.noConflict()),s.SecondLevelDomains&&typeof s.SecondLevelDomains.noConflict=="function"&&(E.SecondLevelDomains=s.SecondLevelDomains.noConflict()),E}else s.URI===this&&(s.URI=r);return this},l.build=function(m){return m===!0?this._deferred_build=!0:(m===void 0||this._deferred_build)&&(this._string=a.build(this._parts),this._deferred_build=!1),this},l.clone=function(){return new a(this)},l.valueOf=l.toString=function(){return this.build(!1)._string};function C(m){return function(E,S){return E===void 0?this._parts[m]||"":(this._parts[m]=E||null,this.build(!S),this)}}function b(m,E){return function(S,M){return S===void 0?this._parts[m]||"":(S!==null&&(S=S+"",S.charAt(0)===E&&(S=S.substring(1))),this._parts[m]=S,this.build(!M),this)}}l.protocol=C("protocol"),l.username=C("username"),l.password=C("password"),l.hostname=C("hostname"),l.port=C("port"),l.query=b("query","?"),l.fragment=b("fragment","#"),l.search=function(m,E){var S=this.query(m,E);return typeof S=="string"&&S.length?"?"+S:S},l.hash=function(m,E){var S=this.fragment(m,E);return typeof S=="string"&&S.length?"#"+S:S},l.pathname=function(m,E){if(m===void 0||m===!0){var S=this._parts.path||(this._parts.hostname?"/":"");return m?(this._parts.urn?a.decodeUrnPath:a.decodePath)(S):S}else return this._parts.urn?this._parts.path=m?a.recodeUrnPath(m):"":this._parts.path=m?a.recodePath(m):"/",this.build(!E),this},l.path=l.pathname,l.href=function(m,E){var S;if(m===void 0)return this.toString();this._string="",this._parts=a._parts();var M=m instanceof a,A=typeof m=="object"&&(m.hostname||m.path||m.pathname);if(m.nodeName){var F=a.getDomAttribute(m);m=m[F]||"",A=!1}if(!M&&A&&m.pathname!==void 0&&(m=m.toString()),typeof m=="string"||m instanceof String)this._parts=a.parse(String(m),this._parts);else if(M||A){var D=M?m._parts:m;for(S in D)S!=="query"&&h.call(this._parts,S)&&(this._parts[S]=D[S]);D.query&&this.query(D.query,!1)}else throw new TypeError("invalid input");return this.build(!E),this},l.is=function(m){var E=!1,S=!1,M=!1,A=!1,F=!1,D=!1,k=!1,B=!this._parts.urn;switch(this._parts.hostname&&(B=!1,S=a.ip4_expression.test(this._parts.hostname),M=a.ip6_expression.test(this._parts.hostname),E=S||M,A=!E,F=A&&n&&n.has(this._parts.hostname),D=A&&a.idn_expression.test(this._parts.hostname),k=A&&a.punycode_expression.test(this._parts.hostname)),m.toLowerCase()){case"relative":return B;case"absolute":return!B;case"domain":case"name":return A;case"sld":return F;case"ip":return E;case"ip4":case"ipv4":case"inet4":return S;case"ip6":case"ipv6":case"inet6":return M;case"idn":return D;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return k}return null};var I=l.protocol,P=l.port,G=l.hostname;l.protocol=function(m,E){if(m&&(m=m.replace(/:(\/\/)?$/,""),!m.match(a.protocol_expression)))throw new TypeError('Protocol "'+m+`" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]`);return I.call(this,m,E)},l.scheme=l.protocol,l.port=function(m,E){return this._parts.urn?m===void 0?"":this:(m!==void 0&&(m===0&&(m=null),m&&(m+="",m.charAt(0)===":"&&(m=m.substring(1)),a.ensureValidPort(m))),P.call(this,m,E))},l.hostname=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(m!==void 0){var S={preventInvalidHostname:this._parts.preventInvalidHostname},M=a.parseHost(m,S);if(M!=="/")throw new TypeError('Hostname "'+m+'" contains characters other than [A-Z0-9.-]');m=S.hostname,this._parts.preventInvalidHostname&&a.ensureValidHostname(m,this._parts.protocol)}return G.call(this,m,E)},l.origin=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(m===void 0){var S=this.protocol(),M=this.authority();return M?(S?S+"://":"")+this.authority():""}else{var A=a(m);return this.protocol(A.protocol()).authority(A.authority()).build(!E),this}},l.host=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(m===void 0)return this._parts.hostname?a.buildHost(this._parts):"";var S=a.parseHost(m,this._parts);if(S!=="/")throw new TypeError('Hostname "'+m+'" contains characters other than [A-Z0-9.-]');return this.build(!E),this},l.authority=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(m===void 0)return this._parts.hostname?a.buildAuthority(this._parts):"";var S=a.parseAuthority(m,this._parts);if(S!=="/")throw new TypeError('Hostname "'+m+'" contains characters other than [A-Z0-9.-]');return this.build(!E),this},l.userinfo=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(m===void 0){var S=a.buildUserinfo(this._parts);return S&&S.substring(0,S.length-1)}else return m[m.length-1]!=="@"&&(m+="@"),a.parseUserinfo(m,this._parts),this.build(!E),this},l.resource=function(m,E){var S;return m===void 0?this.path()+this.search()+this.hash():(S=a.parse(m),this._parts.path=S.path,this._parts.query=S.query,this._parts.fragment=S.fragment,this.build(!E),this)},l.subdomain=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(m===void 0){if(!this._parts.hostname||this.is("IP"))return"";var S=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,S)||""}else{var M=this._parts.hostname.length-this.domain().length,A=this._parts.hostname.substring(0,M),F=new RegExp("^"+c(A));if(m&&m.charAt(m.length-1)!=="."&&(m+="."),m.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");return m&&a.ensureValidHostname(m,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(F,m),this.build(!E),this}},l.domain=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(typeof m=="boolean"&&(E=m,m=void 0),m===void 0){if(!this._parts.hostname||this.is("IP"))return"";var S=this._parts.hostname.match(/\./g);if(S&&S.length<2)return this._parts.hostname;var M=this._parts.hostname.length-this.tld(E).length-1;return M=this._parts.hostname.lastIndexOf(".",M-1)+1,this._parts.hostname.substring(M)||""}else{if(!m)throw new TypeError("cannot set domain empty");if(m.indexOf(":")!==-1)throw new TypeError("Domains cannot contain colons");if(a.ensureValidHostname(m,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=m;else{var A=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(A,m)}return this.build(!E),this}},l.tld=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(typeof m=="boolean"&&(E=m,m=void 0),m===void 0){if(!this._parts.hostname||this.is("IP"))return"";var S=this._parts.hostname.lastIndexOf("."),M=this._parts.hostname.substring(S+1);return E!==!0&&n&&n.list[M.toLowerCase()]&&n.get(this._parts.hostname)||M}else{var A;if(m)if(m.match(/[^a-zA-Z0-9-]/))if(n&&n.is(m))A=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(A,m);else throw new TypeError('TLD "'+m+'" contains characters other than [A-Z0-9]');else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");A=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(A,m)}else throw new TypeError("cannot set TLD empty");return this.build(!E),this}},l.directory=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(m===void 0||m===!0){if(!this._parts.path&&!this._parts.hostname)return"";if(this._parts.path==="/")return"/";var S=this._parts.path.length-this.filename().length-1,M=this._parts.path.substring(0,S)||(this._parts.hostname?"/":"");return m?a.decodePath(M):M}else{var A=this._parts.path.length-this.filename().length,F=this._parts.path.substring(0,A),D=new RegExp("^"+c(F));return this.is("relative")||(m||(m="/"),m.charAt(0)!=="/"&&(m="/"+m)),m&&m.charAt(m.length-1)!=="/"&&(m+="/"),m=a.recodePath(m),this._parts.path=this._parts.path.replace(D,m),this.build(!E),this}},l.filename=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(typeof m!="string"){if(!this._parts.path||this._parts.path==="/")return"";var S=this._parts.path.lastIndexOf("/"),M=this._parts.path.substring(S+1);return m?a.decodePathSegment(M):M}else{var A=!1;m.charAt(0)==="/"&&(m=m.substring(1)),m.match(/\.?\//)&&(A=!0);var F=new RegExp(c(this.filename())+"$");return m=a.recodePath(m),this._parts.path=this._parts.path.replace(F,m),A?this.normalizePath(E):this.build(!E),this}},l.suffix=function(m,E){if(this._parts.urn)return m===void 0?"":this;if(m===void 0||m===!0){if(!this._parts.path||this._parts.path==="/")return"";var S=this.filename(),M=S.lastIndexOf("."),A,F;return M===-1?"":(A=S.substring(M+1),F=/^[a-z0-9%]+$/i.test(A)?A:"",m?a.decodePathSegment(F):F)}else{m.charAt(0)==="."&&(m=m.substring(1));var D=this.suffix(),k;if(D)m?k=new RegExp(c(D)+"$"):k=new RegExp(c("."+D)+"$");else{if(!m)return this;this._parts.path+="."+a.recodePath(m)}return k&&(m=a.recodePath(m),this._parts.path=this._parts.path.replace(k,m)),this.build(!E),this}},l.segment=function(m,E,S){var M=this._parts.urn?":":"/",A=this.path(),F=A.substring(0,1)==="/",D=A.split(M);if(m!==void 0&&typeof m!="number"&&(S=E,E=m,m=void 0),m!==void 0&&typeof m!="number")throw new Error('Bad segment "'+m+'", must be 0-based integer');if(F&&D.shift(),m<0&&(m=Math.max(D.length+m,0)),E===void 0)return m===void 0?D:D[m];if(m===null||D[m]===void 0)if(f(E)){D=[];for(var k=0,B=E.length;k<B;k++)!E[k].length&&(!D.length||!D[D.length-1].length)||(D.length&&!D[D.length-1].length&&D.pop(),D.push(y(E[k])))}else(E||typeof E=="string")&&(E=y(E),D[D.length-1]===""?D[D.length-1]=E:D.push(E));else E?D[m]=y(E):D.splice(m,1);return F&&D.unshift(""),this.path(D.join(M),S)},l.segmentCoded=function(m,E,S){var M,A,F;if(typeof m!="number"&&(S=E,E=m,m=void 0),E===void 0){if(M=this.segment(m,E,S),!f(M))M=M!==void 0?a.decode(M):void 0;else for(A=0,F=M.length;A<F;A++)M[A]=a.decode(M[A]);return M}if(!f(E))E=typeof E=="string"||E instanceof String?a.encode(E):E;else for(A=0,F=E.length;A<F;A++)E[A]=a.encode(E[A]);return this.segment(m,E,S)};var O=l.query;return l.query=function(m,E){if(m===!0)return a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof m=="function"){var S=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace),M=m.call(this,S);return this._parts.query=a.buildQuery(M||S,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!E),this}else return m!==void 0&&typeof m!="string"?(this._parts.query=a.buildQuery(m,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!E),this):O.call(this,m,E)},l.setQuery=function(m,E,S){var M=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if(typeof m=="string"||m instanceof String)M[m]=E!==void 0?E:null;else if(typeof m=="object")for(var A in m)h.call(m,A)&&(M[A]=m[A]);else throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");return this._parts.query=a.buildQuery(M,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof m!="string"&&(S=E),this.build(!S),this},l.addQuery=function(m,E,S){var M=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.addQuery(M,m,E===void 0?null:E),this._parts.query=a.buildQuery(M,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof m!="string"&&(S=E),this.build(!S),this},l.removeQuery=function(m,E,S){var M=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.removeQuery(M,m,E),this._parts.query=a.buildQuery(M,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),typeof m!="string"&&(S=E),this.build(!S),this},l.hasQuery=function(m,E,S){var M=a.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return a.hasQuery(M,m,E,S)},l.setSearch=l.setQuery,l.addSearch=l.addQuery,l.removeSearch=l.removeQuery,l.hasSearch=l.hasQuery,l.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},l.normalizeProtocol=function(m){return typeof this._parts.protocol=="string"&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!m)),this},l.normalizeHostname=function(m){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!m)),this},l.normalizePort=function(m){return typeof this._parts.protocol=="string"&&this._parts.port===a.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!m)),this},l.normalizePath=function(m){var E=this._parts.path;if(!E)return this;if(this._parts.urn)return this._parts.path=a.recodeUrnPath(this._parts.path),this.build(!m),this;if(this._parts.path==="/")return this;E=a.recodePath(E);var S,M="",A,F;for(E.charAt(0)!=="/"&&(S=!0,E="/"+E),(E.slice(-3)==="/.."||E.slice(-2)==="/.")&&(E+="/"),E=E.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),S&&(M=E.substring(1).match(/^(\.\.\/)+/)||"",M&&(M=M[0]));A=E.search(/\/\.\.(\/|$)/),A!==-1;){if(A===0){E=E.substring(3);continue}F=E.substring(0,A).lastIndexOf("/"),F===-1&&(F=A),E=E.substring(0,F)+E.substring(A+3)}return S&&this.is("relative")&&(E=M+E.substring(1)),this._parts.path=E,this.build(!m),this},l.normalizePathname=l.normalizePath,l.normalizeQuery=function(m){return typeof this._parts.query=="string"&&(this._parts.query.length?this.query(a.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!m)),this},l.normalizeFragment=function(m){return this._parts.fragment||(this._parts.fragment=null,this.build(!m)),this},l.normalizeSearch=l.normalizeQuery,l.normalizeHash=l.normalizeFragment,l.iso8859=function(){var m=a.encode,E=a.decode;a.encode=escape,a.decode=decodeURIComponent;try{this.normalize()}finally{a.encode=m,a.decode=E}return this},l.unicode=function(){var m=a.encode,E=a.decode;a.encode=d,a.decode=unescape;try{this.normalize()}finally{a.encode=m,a.decode=E}return this},l.readable=function(){var m=this.clone();m.username("").password("").normalize();var E="";if(m._parts.protocol&&(E+=m._parts.protocol+"://"),m._parts.hostname&&(m.is("punycode")&&t?(E+=t.toUnicode(m._parts.hostname),m._parts.port&&(E+=":"+m._parts.port)):E+=m.host()),m._parts.hostname&&m._parts.path&&m._parts.path.charAt(0)!=="/"&&(E+="/"),E+=m.path(!0),m._parts.query){for(var S="",M=0,A=m._parts.query.split("&"),F=A.length;M<F;M++){var D=(A[M]||"").split("=");S+="&"+a.decodeQuery(D[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),D[1]!==void 0&&(S+="="+a.decodeQuery(D[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}E+="?"+S.substring(1)}return E+=a.decodeQuery(m.hash(),!0),E},l.absoluteTo=function(m){var E=this.clone(),S=["protocol","username","password","hostname","port"],M,A,F;if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(m instanceof a||(m=new a(m)),E._parts.protocol||(E._parts.protocol=m._parts.protocol,this._parts.hostname))return E;for(A=0;F=S[A];A++)E._parts[F]=m._parts[F];return E._parts.path?(E._parts.path.substring(-2)===".."&&(E._parts.path+="/"),E.path().charAt(0)!=="/"&&(M=m.directory(),M=M||(m.path().indexOf("/")===0?"/":""),E._parts.path=(M?M+"/":"")+E._parts.path,E.normalizePath())):(E._parts.path=m._parts.path,E._parts.query||(E._parts.query=m._parts.query)),E.build(),E},l.relativeTo=function(m){var E=this.clone().normalize(),S,M,A,F,D;if(E._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(m=new a(m).normalize(),S=E._parts,M=m._parts,F=E.path(),D=m.path(),F.charAt(0)!=="/")throw new Error("URI is already relative");if(D.charAt(0)!=="/")throw new Error("Cannot calculate a URI relative to another relative URI");if(S.protocol===M.protocol&&(S.protocol=null),S.username!==M.username||S.password!==M.password||S.protocol!==null||S.username!==null||S.password!==null)return E.build();if(S.hostname===M.hostname&&S.port===M.port)S.hostname=null,S.port=null;else return E.build();if(F===D)return S.path="",E.build();if(A=a.commonPath(F,D),!A)return E.build();var k=M.path.substring(A.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return S.path=k+S.path.substring(A.length)||"./",E.build()},l.equals=function(m){var E=this.clone(),S=new a(m),M={},A={},F={},D,k,B;if(E.normalize(),S.normalize(),E.toString()===S.toString())return!0;if(D=E.query(),k=S.query(),E.query(""),S.query(""),E.toString()!==S.toString()||D.length!==k.length)return!1;M=a.parseQuery(D,this._parts.escapeQuerySpace),A=a.parseQuery(k,this._parts.escapeQuerySpace);for(B in M)if(h.call(M,B)){if(f(M[B])){if(!x(M[B],A[B]))return!1}else if(M[B]!==A[B])return!1;F[B]=!0}for(B in A)if(h.call(A,B)&&!F[B])return!1;return!0},l.preventInvalidHostname=function(m){return this._parts.preventInvalidHostname=!!m,this},l.duplicateQueryParameters=function(m){return this._parts.duplicateQueryParameters=!!m,this},l.escapeQuerySpace=function(m){return this._parts.escapeQuerySpace=!!m,this},a})}(Ya)),Ya.exports}var $S=VS();const zh=ol($S),Pd=["http","https"];function WS(i,t,e=!0){return qS(i,t,!1,e)}function qS(i,t=null,e=!1,n=!0){let s=zh(i);if(t&&s.is("relative")){let r=zh(t),a=r.path();!a.endsWith("/")&&!a.endsWith(".json")&&r.path(a+"/"),s=s.absoluteTo(r)}return s.normalize(),e&&(s.query(""),s.fragment("")),n?s.toString():s}const Xh="application/geo+json",KS=["application/json",Xh,"text/json"],Ld=["image/gif","image/jpeg","image/apng","image/png","image/webp"],X_=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],j_=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(X_);function Ru(i,t,e=!1){return Array.isArray(t)||(t=[t]),e&&typeof i>"u"?!0:typeof i!="string"?!1:(t=t.map(n=>n.toLowerCase()),t.includes(i.toLowerCase()))}function HS(i,t=!1){return Ru(i,KS,t)}class V_ extends ua{constructor(t,e=null,n={},s=[]){super(t,n,["_context"].concat(s)),this._context||(this._context=e)}getAbsoluteUrl(t=!0){return this._context?WS(this.href,this._context.getAbsoluteUrl(),t):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(t=!1){if(typeof this.href!="string")return!1;if(!t&&typeof this.type>"u")return!1;let e=new zh(this.href),n=e.protocol().toLowerCase(),s=e.suffix().toLowerCase();return he(n)&&!Pd.includes(n)?!1:he(this.type)&&Ld.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&he(s)&&(s==="jpg"||Ld.includes("image/"+s)))}isType(t){return he(this.type)&&Ru(this.type,t)}isGeoTIFF(){return this.isType(j_)}isCOG(){return this.isType(X_)}isHTTP(){let e=this.getAbsoluteUrl(!1).protocol().toLowerCase();return he(e)&&Pd.includes(e)}isPreview(){return!1}}class Mu extends V_{constructor(t,e=null){super(t,e)}isLink(){return!0}getObjectType(){return"Link"}isPreview(){return this.rel==="preview"}static fromLinks(t,e=null){return Array.isArray(t)?t.map(n=>se(n)?new Mu(n,e):n):[]}}class $_ extends ua{constructor(t,e=null,n={},s=[]){if(super(t,Object.assign({links:Mu.fromLinks},n),["_url"].concat(s)),!this._url&&(this._url=e,!this._url)){let r=this.getSelfLink();r&&(this._url=r.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(t){this._url=t}getStacLinksWithRel(t,e=!0){return this.getLinksWithRels([t]).filter(n=>HS(n.type,e))}getStacLinkWithRel(t,e=!0){const n=this.getStacLinksWithRel(t,e);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(t=>se(t)&&he(t.href)):[]}getLinkWithRel(t){return this.getLinks().find(e=>e.rel===t)||null}getLinksWithRels(t){return this.getLinks().filter(e=>t.includes(e.rel))}getLinksWithOtherRels(t){return this.getLinks().filter(e=>!t.includes(e.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class Cu extends $_{constructor(t,e=null,n={},s=[]){super(t,e,n,s)}getAll(){return[]}}class fa extends ua{constructor(t,e=null,n=null){super(t,{},["_index","_context"]),typeof this._index!="number"&&(this._index=typeof e=="string"?parseInt(e,10):e),this._context||(this._context=n)}getContext(){return this._context}getObjectType(){return"Band"}isBand(){return!0}getIndex(){return this._index}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context)return this._context.getMetadata(t)}getMinMaxValues(){return N_(this)}getNoDataValues(){return k_(this)}static fromBands(t,e=null){let n=[];if(Array.isArray(t))for(let s in t)n[s]=new fa(t[s],s,e);return n}}const YS=["created","updated","published","expires","unpublished","bands"];class je extends V_{constructor(t,e=null,n=null){const s={bands:fa.fromBands,alternate:je.fromAssets};super(t,n,s,["_key"]),this._key||(this._key=e)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(t=!0){return this.isDefinition()?null:super.getAbsoluteUrl(t)}getKey(){return this._key}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context instanceof je)return this._context.getMetadata(t);if(this._context&&!YS.includes(t))return this._context.getMetadata(t)}getBands(){return this.bands||[]}findVisualBands(){const t={red:null,green:null,blue:null},e=this.getBands();for(const s in e){const r=parseInt(s,10),a=e[r];se(a)&&he(a["eo:common_name"])&&a["eo:common_name"]in t&&(t[a["eo:common_name"]]=a)}return Object.values(t).every(s=>s!==null)?t:null}findBand(t,e="name"){Array.isArray(t)||(t=[t]);const n=this.getBands(),s=n.findIndex(r=>se(r)&&t.includes(r[e]));return s>=0?n[s]:null}getBand(t){return se(t)||t===null?t:this.getBands()[t]||null}getMinMaxValues(){return N_(this)}getNoDataValues(){return k_(this)}isDefinition(){return!he(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}isPreview(){const t=["thumbnail","overview"];return t.includes(this.getKey())?!0:Array.isArray(this.roles)&&this.roles.some(e=>t.includes(e))}hasRole(t,e=!1){return Array.isArray(t)||(t=[t]),e&&t.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>t.includes(n))}static fromAssets(t,e=null){let n={};if(se(t))for(let s in t)n[s]=new je(t[s],s,e);return n}}function W_(i){if(!i)return;const t=String(i),e=t.indexOf("@"),n=e!==-1?t.substr(e+1):void 0,s=e!==-1?t.substr(0,e):t,r=String(s).replace(/-/g,"_").split("_");if(!r.length||r.length>4)return;const a=r.shift();if(!a)return;const o={keyword:n,language:a.toLowerCase()};if(!r.length)return o;if(r.length===3){const c=r.pop();c&&(o.variant=c.toUpperCase())}let l=r.pop();if(l.length>3&&(o.keyword=l,l=r.pop()),l&&(o.country=l.toUpperCase()),!r.length)return o;const h=r.pop();return typeof h=="string"&&h.length>=1&&(o.script=h[0].toUpperCase()+h.substring(1).toLowerCase()),o}function ZS(i){const t={};return i.forEach(e=>{const{language:n,country:s}=W_(e);if(!n)throw new Error(`Locale ${e} is not parsable`);t[n]||(t[n]={countries:{},firstCountry:void 0,main:void 0});const r=t[n];s?(r.countries[s]=e,r.firstCountry||(r.firstCountry=e)):r.main=e}),t}function jh(i,t,e,n){const s=Array.isArray(i)?ZS(i):i;if(!t&&e)return jh(i,e,void 0);if(!t)return;const{language:r,country:a}=W_(t);if(!r)return e;if(!s[r])return t===e?void 0:jh(i,e,null);const{countries:o,main:l=e,firstCountry:h}=s[r];return!o||!a?l:o[a]?o[a]:l}class ze extends $_{constructor(t,e=null,n={},s=[]){super(t,e,n,s)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getLocaleLink(t,e=null){let n=this.getStacLinksWithRel("alternate").filter(a=>he(a.hreflang)),s;Array.isArray(this.languages)?s=this.languages.map(a=>a.code):s=n.map(a=>a.hreflang);let r=jh(s,t,e);return n.find(a=>a.hreflang===r)||null}getIcons(t=!0){return this.getLinksWithRels(["icon"]).filter(e=>e.canBrowserDisplayImage(t))}getThumbnails(t=!0,e=null){let n=this.getAssets().filter(s=>s.isPreview());if(n.length===0&&(n=this.getLinks().filter(s=>s.isPreview())),t&&(n=n.filter(s=>s.canBrowserDisplayImage())),n.length===0){const s=this.getAsset("thumbnail");s&&n.push(s)}if(e&&n.length>1){let s=r=>Array.isArray(r.roles)&&r.roles.includes(e)||r.getKey()===e;n=n.filter(s).concat(n.filter(r=>!s(r)))}return n}getDefaultGeoTIFF(t=!0,e=!1){return this.rankGeoTIFFs(t,e)[0]?.asset}rankGeoTIFFs(t=!0,e=!1,n=null,s=null){se(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let r=[],a=this.getAssetsByTypes(j_);t&&(a=a.filter(l=>l.isHTTP()&&(!e||l.isCOG())));let o=Object.entries(n);for(let l of a){let h=0;if(o.length>0){let c=o.filter(([u])=>l.hasRole(u,!0)).map(([,u])=>u);c.length>0&&(h+=Math.max(...c))}!e&&l.isCOG()&&(h+=2),l.findVisualBands()&&(h+=1),typeof s=="function"&&(h+=s(l)),r.push({asset:l,score:h})}return r.sort((l,h)=>h.score-l.score),r}findVisualAssets(){let t={red:null,green:null,blue:null},e=Object.keys(t),n=this.getAssets();for(let r of n){let a=r.findBand(e,"eo:common_name");a&&(t[a["eo:common_name"]]=r)}return Object.values(t).every(r=>r!==null)?t:null}getAsset(t){return se(this.assets)&&this.assets[t]||null}getAssets(){return se(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(t,e=!1){return this.getAssets().filter(n=>n.hasRole(t,e))}getAssetWithRole(t,e=!1){return this.getAssetsWithRoles([t],e)[0]||null}getAssetsByTypes(t){return this.getAssets().filter(e=>Ru(e.type,t))}equals(t){return this===t?!0:!(t instanceof ze)||this.getObjectType()!==t.getObjectType()?!1:!!(this.id&&this.id===t.id)}supportsExtension(t){if(!Array.isArray(this.stac_extensions))return!1;let e=new RegExp("^"+t.replaceAll("*","[^/]+")+"$");return this.stac_extensions.some(n=>e.test(n))}}class q_ extends ze{constructor(t,e=null,n={},s=[]){super(t,e,n,s)}getObjectType(){return this.type}getSearchLink(t=null){let e=this.getStacLinksWithRel("search");return t?e[0]||null:e.find(n=>n.method===t||!t&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class QS extends q_{constructor(t,e=null){super(t,e)}}function lr(i){if(he(i)&&i.length>=10)try{let e=i.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(n=>parseInt(n,10));return new Date(Date.UTC(e[0],e[1]-1,e[2],e[3],e[4],e[5],e[6]||0))}catch{return null}return null}function JS(i,t){return new Date(i.valueOf()+(t-i)/2)}function K_(i){if(!Array.isArray(i)||i.length===0)return null;let t,e;const n=(s,r,a)=>typeof s>"u"?r:s===null||r===null?null:a(s,r);return i.forEach(([s,r])=>{t=n(t,s,Math.min),e=n(e,r,Math.max)}),[t===null?null:new Date(t),e===null?null:new Date(e)]}class H_ extends q_{constructor(t,e=null){const n={assets:je.fromAssets,item_assets:je.fromAssets};super(t,e,n)}toGeoJSON(){let t=B_(this.getBoundingBoxes());return t&&(t.id=this.id),t}getBoundingBox(){let t=this.getRawBoundingBoxes();return t.length>0?oi(t[0]):null}getBoundingBoxes(){let t=this.getRawBoundingBoxes();return t.length===1?[oi(t[0])]:t.length>1?t.slice(1).map(oi):null}getRawBoundingBoxes(){let t=this.extent?.spatial?.bbox;return Array.isArray(t)&&t.length>0?t:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=this.extent?.temporal?.interval;return Array.isArray(t)&&t.length>0?t.filter(e=>Array.isArray(e)&&(he(e[0])||he(e[1]))).map(e=>e.map(n=>lr(n))):[]}getSummary(t){if(se(this.summaries))return this.summaries[t]}getBands(){let t=this.getMetadata("bands");return Array.isArray(t)||(t=this.getSummary("bands")),Array.isArray(t)?fa.fromBands(t,this):[]}}class tR extends Cu{constructor(t,e=null){const n={collections:s=>s.map(r=>new H_(r))};super(t,e,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(e=>e.toGeoJSON()).filter(e=>e!==null)}}getBoundingBox(){return Su(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(t=>t.getBoundingBox())}getTemporalExtent(){return K_(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(t=>t.getTemporalExtent())}}class bu extends ze{constructor(t,e=null){super(t,e,{assets:je.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return oi(this.bbox)}getBoundingBoxes(){const t=this.getBoundingBox();return t?[t]:[]}getDateTime(){let t=lr(this.properties.datetime);if(!t){let e=lr(this.properties.start_datetime),n=lr(this.properties.end_datetime);return e&&n?JS(e,n):e||n}return t}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=[];return he(this.properties.start_datetime)||he(this.properties.end_datetime)?t=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:he(this.properties.datetime)&&(t=[[this.properties.datetime,this.properties.datetime]]),t.map(e=>e.map(n=>lr(n)))}getMetadata(t){return this.properties[t]}getBands(){const t=this.getMetadata("bands");return Array.isArray(t)?fa.fromBands(t,this):[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class Y_ extends Cu{constructor(t,e=null){const n={features:s=>s.map(r=>new bu(r))};super(t,e,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Su(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(t=>t.getBoundingBox())}getTemporalExtent(){return K_(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(t=>t.getTemporalExtent())}}function Ba(i,t=!0,e=!1){return t&&(i=OS.stac(i,e)),i.type==="Feature"?new bu(i):i.type==="FeatureCollection"?new Y_(i):i.type==="Collection"||!i.type&&typeof i.extent<"u"&&typeof i.license<"u"?new H_(i):!i.type&&Array.isArray(i.collections)?new tR(i):new QS(i)}let Iu=null;function eR(){return!!Iu}function Z_(i){Iu=i;const t=Object.keys(i.defs),e=t.length;let n,s;for(n=0;n<e;++n){const r=t[n];if(!us(r)){const a=i.defs(r);let o=a.units;!o&&a.projName==="longlat"&&(o="degrees"),ho(new xn({code:r,axisOrientation:a.axis,metersPerUnit:a.to_meter,units:o}))}}for(n=0;n<e;++n){const r=t[n],a=us(r);for(s=0;s<e;++s){const o=t[s],l=us(o);if(!Wa(r,o))if(i.defs[r]===i.defs[o])uh([a,l]);else{const h=i(r,o);Zp(a,l,ff(a,l,h.forward),ff(l,a,h.inverse))}}}}let iR=async function(i){const t=await fetch(`https://epsg.io/${i}.proj4`);if(!t.ok)throw new Error(`Unexpected response from epsg.io: ${t.status}`);return t.text()};async function nR(i){typeof i=="string"&&(i=parseInt(i.split(":").pop(),10));const t=Iu;if(!t)throw new Error("Proj4 must be registered first with register(proj4)");const e="EPSG:"+i;return t.defs(e)||(t.defs(e,await iR(i)),Z_(t)),us(e)}const sR="https://stac-extensions.github.io/label/v1.*/schema.json",Q_=new In({color:"rgba(0,0,0,0)"});function J_(i,t,e="rgba(255,255,255,0.4)",n=5){let s=Q_;e&&(s=new In({color:e}));const r=new na({color:i,width:t});return new $i({image:new ia({fill:s,stroke:r,radius:n}),fill:s,stroke:r})}const rR=J_("#3399CC",3),Od=J_("#ff9933",2,null);async function aR(i,t=null,e=null,n=0){const s=new Set;return i.map.forEachFeatureAtPixel(i.pixel,(r,a)=>{e&&e.push(r),s.add(a.get("stac"))},{hitTolerance:n,layerFilter(r){if(r instanceof A_&&r.get("bounds")===!0){const a=r.get("stac");if(a instanceof ze&&(!t||!a.equals(t)))return!0}return!1}}),[...s]}function oR(i,t){const e={url:i.getAbsoluteUrl()};let n=i;i.getBands().length===1&&(n=i.getBand(0));const{minimum:s,maximum:r}=n.getMinMaxValues();typeof s=="number"&&(e.min=s),typeof r=="number"&&(e.max=r);const a=n.getNoDataValues();return a.length>0&&(e.nodata=a[0]),t.length>0&&(e.bands=t),e}async function Fd(i,t=void 0){let e=t;if(eR()){const n=i.getMetadata("proj:code");if(n)try{if(n.startsWith("EPSG:")){const s=parseInt(n.replace("EPSG:",""),10);e=await nR(s)}}catch{}}return e}function Dd(i,t){const e=i.clone();return t.hasOnlyBounds()||e.setFill(Q_),e}function lR(i){let t=i.href;if(t.includes("{s}"))if(Array.isArray(i["href:servers"])&&i["href:servers"].length>0){const e=Math.random()*i["href:servers"].length|0;t=t.replace("{s}",i["href:servers"][e])}else return null;return t}const Vh=65536*65536,Gd=1/Vh,hR=12,Nd=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),th=0,za=1,Qs=2,Xa=5;class cR{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,e,n=this.length){for(;this.pos<n;){const s=this.readVarint(),r=s>>3,a=this.pos;this.type=s&7,t(r,e,this),this.pos===a&&this.skip(s)}return e}readMessage(t,e){return this.readFields(t,e,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Vh;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Vh;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const e=this.buf;let n,s;return s=e[this.pos++],n=s&127,s<128||(s=e[this.pos++],n|=(s&127)<<7,s<128)||(s=e[this.pos++],n|=(s&127)<<14,s<128)||(s=e[this.pos++],n|=(s&127)<<21,s<128)?n:(s=e[this.pos],n|=(s&15)<<28,uR(n,t,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2===1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=hR&&Nd?Nd.decode(this.buf.subarray(e,t)):SR(this.buf,e,t)}readBytes(){const t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e}readPackedVarint(t=[],e){const n=this.readPackedEnd();for(;this.pos<n;)t.push(this.readVarint(e));return t}readPackedSVarint(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const e=this.readPackedEnd();for(;this.pos<e;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===Qs?this.readVarint()+this.pos:this.pos+1}skip(t){const e=t&7;if(e===th)for(;this.buf[this.pos++]>127;);else if(e===Qs)this.pos=this.readVarint()+this.pos;else if(e===Xa)this.pos+=4;else if(e===za)this.pos+=8;else throw new Error(`Unimplemented type: ${e}`)}writeTag(t,e){this.writeVarint(t<<3|e)}realloc(t){let e=this.length||16;for(;e<this.pos+t;)e*=2;if(e!==this.length){const n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.dataView=new DataView(n.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Gd),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,t&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Gd),!0),this.pos+=8}writeVarint(t){if(t=+t||0,t>268435455||t<0){fR(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))}writeSVarint(t){this.writeVarint(t<0?-t*2-1:t*2)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(t.length*4),this.pos++;const e=this.pos;this.pos=RR(this.buf,t,this.pos);const n=this.pos-e;n>=128&&kd(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const e=t.length;this.writeVarint(e),this.realloc(e);for(let n=0;n<e;n++)this.buf[this.pos++]=t[n]}writeRawMessage(t,e){this.pos++;const n=this.pos;t(e,this);const s=this.pos-n;s>=128&&kd(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s}writeMessage(t,e,n){this.writeTag(t,Qs),this.writeRawMessage(e,n)}writePackedVarint(t,e){e.length&&this.writeMessage(t,_R,e)}writePackedSVarint(t,e){e.length&&this.writeMessage(t,mR,e)}writePackedBoolean(t,e){e.length&&this.writeMessage(t,xR,e)}writePackedFloat(t,e){e.length&&this.writeMessage(t,pR,e)}writePackedDouble(t,e){e.length&&this.writeMessage(t,yR,e)}writePackedFixed32(t,e){e.length&&this.writeMessage(t,ER,e)}writePackedSFixed32(t,e){e.length&&this.writeMessage(t,vR,e)}writePackedFixed64(t,e){e.length&&this.writeMessage(t,wR,e)}writePackedSFixed64(t,e){e.length&&this.writeMessage(t,TR,e)}writeBytesField(t,e){this.writeTag(t,Qs),this.writeBytes(e)}writeFixed32Field(t,e){this.writeTag(t,Xa),this.writeFixed32(e)}writeSFixed32Field(t,e){this.writeTag(t,Xa),this.writeSFixed32(e)}writeFixed64Field(t,e){this.writeTag(t,za),this.writeFixed64(e)}writeSFixed64Field(t,e){this.writeTag(t,za),this.writeSFixed64(e)}writeVarintField(t,e){this.writeTag(t,th),this.writeVarint(e)}writeSVarintField(t,e){this.writeTag(t,th),this.writeSVarint(e)}writeStringField(t,e){this.writeTag(t,Qs),this.writeString(e)}writeFloatField(t,e){this.writeTag(t,Xa),this.writeFloat(e)}writeDoubleField(t,e){this.writeTag(t,za),this.writeDouble(e)}writeBooleanField(t,e){this.writeVarintField(t,+e)}}function uR(i,t,e){const n=e.buf;let s,r;if(r=n[e.pos++],s=(r&112)>>4,r<128||(r=n[e.pos++],s|=(r&127)<<3,r<128)||(r=n[e.pos++],s|=(r&127)<<10,r<128)||(r=n[e.pos++],s|=(r&127)<<17,r<128)||(r=n[e.pos++],s|=(r&127)<<24,r<128)||(r=n[e.pos++],s|=(r&1)<<31,r<128))return $n(i,s,t);throw new Error("Expected varint not more than 10 bytes")}function $n(i,t,e){return e?t*4294967296+(i>>>0):(t>>>0)*4294967296+(i>>>0)}function fR(i,t){let e,n;if(i>=0?(e=i%4294967296|0,n=i/4294967296|0):(e=~(-i%4294967296),n=~(-i/4294967296),e^4294967295?e=e+1|0:(e=0,n=n+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),dR(e,n,t),gR(n,t)}function dR(i,t,e){e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos++]=i&127|128,i>>>=7,e.buf[e.pos]=i&127}function gR(i,t){const e=(i&7)<<4;t.buf[t.pos++]|=e|((i>>>=3)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127|((i>>>=7)?128:0),i&&(t.buf[t.pos++]=i&127)))))}function kd(i,t,e){const n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));e.realloc(n);for(let s=e.pos-1;s>=i;s--)e.buf[s+n]=e.buf[s]}function _R(i,t){for(let e=0;e<i.length;e++)t.writeVarint(i[e])}function mR(i,t){for(let e=0;e<i.length;e++)t.writeSVarint(i[e])}function pR(i,t){for(let e=0;e<i.length;e++)t.writeFloat(i[e])}function yR(i,t){for(let e=0;e<i.length;e++)t.writeDouble(i[e])}function xR(i,t){for(let e=0;e<i.length;e++)t.writeBoolean(i[e])}function ER(i,t){for(let e=0;e<i.length;e++)t.writeFixed32(i[e])}function vR(i,t){for(let e=0;e<i.length;e++)t.writeSFixed32(i[e])}function wR(i,t){for(let e=0;e<i.length;e++)t.writeFixed64(i[e])}function TR(i,t){for(let e=0;e<i.length;e++)t.writeSFixed64(i[e])}function SR(i,t,e){let n="",s=t;for(;s<e;){const r=i[s];let a=null,o=r>239?4:r>223?3:r>191?2:1;if(s+o>e)break;let l,h,c;o===1?r<128&&(a=r):o===2?(l=i[s+1],(l&192)===128&&(a=(r&31)<<6|l&63,a<=127&&(a=null))):o===3?(l=i[s+1],h=i[s+2],(l&192)===128&&(h&192)===128&&(a=(r&15)<<12|(l&63)<<6|h&63,(a<=2047||a>=55296&&a<=57343)&&(a=null))):o===4&&(l=i[s+1],h=i[s+2],c=i[s+3],(l&192)===128&&(h&192)===128&&(c&192)===128&&(a=(r&15)<<18|(l&63)<<12|(h&63)<<6|c&63,(a<=65535||a>=1114112)&&(a=null))),a===null?(a=65533,o=1):a>65535&&(a-=65536,n+=String.fromCharCode(a>>>10&1023|55296),a=56320|a&1023),n+=String.fromCharCode(a),s+=o}return n}function RR(i,t,e){for(let n=0,s,r;n<t.length;n++){if(s=t.charCodeAt(n),s>55295&&s<57344)if(r)if(s<56320){i[e++]=239,i[e++]=191,i[e++]=189,r=s;continue}else s=r-55296<<10|s-56320|65536,r=null;else{s>56319||n+1===t.length?(i[e++]=239,i[e++]=191,i[e++]=189):r=s;continue}else r&&(i[e++]=239,i[e++]=191,i[e++]=189,r=null);s<128?i[e++]=s:(s<2048?i[e++]=s>>6|192:(s<65536?i[e++]=s>>12|224:(i[e++]=s>>18|240,i[e++]=s>>12&63|128),i[e++]=s>>6&63|128),i[e++]=s&63|128)}return e}class MR extends t_{constructor(t){super(),t=t||{},this.dataProjection=new xn({code:"",units:"tile-pixels"}),this.featureClass=t.featureClass?t.featureClass:le,this.geometryName_=t.geometryName,this.layerName_=t.layerName?t.layerName:"layer",this.layers_=t.layers?t.layers:null,this.idProperty_=t.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(t,e,n,s){t.pos=e.geometry;const r=t.readVarint()+t.pos;let a=1,o=0,l=0,h=0,c=0,u=0;for(;t.pos<r;){if(!o){const f=t.readVarint();a=f&7,o=f>>3}if(o--,a===1||a===2)l+=t.readSVarint(),h+=t.readSVarint(),a===1&&c>u&&(s.push(c),u=c),n.push(l,h),c+=2;else if(a===7)c>u&&(n.push(n[u],n[u+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>u&&(s.push(c),u=c)}createFeature_(t,e,n){const s=e.type;if(s===0)return null;let r;const a=e.properties;let o;this.idProperty_?(o=a[this.idProperty_],delete a[this.idProperty_]):o=e.id,a[this.layerName_]=e.layer.name;const l=[],h=[];this.readRawGeometry_(t,e,l,h);const c=PR(s,h.length);if(this.featureClass===le)r=new this.featureClass(c,l,h,2,a,o),r.transform(n.dataProjection);else{let u;if(c=="Polygon"){const g=jg(l,h);u=g.length>1?new Br(l,"XY",g):new Si(l,"XY",h)}else u=c==="Point"?new Ir(l,"XY"):c==="LineString"?new vn(l,"XY"):c==="MultiPoint"?new la(l,"XY"):c==="MultiLineString"?new Ur(l,"XY",h):null;const f=this.featureClass;r=new f,this.geometryName_&&r.setGeometryName(this.geometryName_);const _=al(u,!1,n);r.setGeometry(_),o!==void 0&&r.setId(o),r.setProperties(a,!0)}return r}getType(){return"arraybuffer"}readFeatures(t,e){const n=this.layers_;e=this.adaptOptions(e);const s=lt(e.dataProjection);s.setWorldExtent(e.extent),e.dataProjection=s;const r=new cR(t),a=r.readFields(CR,{}),o=[];for(const l in a){if(n&&!n.includes(l))continue;const h=a[l],c=h?[0,0,h.extent,h.extent]:null;s.setExtent(c);for(let u=0,f=h.length;u<f;++u){const _=AR(r,h,u),g=this.createFeature_(r,_,e);g!==null&&o.push(g)}}return o}readProjection(t){return this.dataProjection}setLayers(t){this.layers_=t}}function CR(i,t,e){if(i===3){const n={keys:[],values:[],features:[]},s=e.readVarint()+e.pos;e.readFields(bR,n,s),n.length=n.features.length,n.length&&(t[n.name]=n)}}function bR(i,t,e){if(i===15)t.version=e.readVarint();else if(i===1)t.name=e.readString();else if(i===5)t.extent=e.readVarint();else if(i===2)t.features.push(e.pos);else if(i===3)t.keys.push(e.readString());else if(i===4){let n=null;const s=e.readVarint()+e.pos;for(;e.pos<s;)i=e.readVarint()>>3,n=i===1?e.readString():i===2?e.readFloat():i===3?e.readDouble():i===4?e.readVarint64():i===5?e.readVarint():i===6?e.readSVarint():i===7?e.readBoolean():null;t.values.push(n)}}function IR(i,t,e){if(i==1)t.id=e.readVarint();else if(i==2){const n=e.readVarint()+e.pos;for(;e.pos<n;){const s=t.layer.keys[e.readVarint()],r=t.layer.values[e.readVarint()];t.properties[s]=r}}else i==3?t.type=e.readVarint():i==4&&(t.geometry=e.pos)}function AR(i,t,e){i.pos=t.features[e];const n=i.readVarint()+i.pos,s={layer:t,type:0,properties:{}};return i.readFields(IR,s,n),s}function PR(i,t){let e;return i===1?e=t===1?"Point":"MultiPoint":i===2?e=t===1?"LineString":"MultiLineString":i===3&&(e="Polygon"),e}var tm=Object.defineProperty,Ud=Object.getOwnPropertySymbols,LR=Object.prototype.hasOwnProperty,OR=Object.prototype.propertyIsEnumerable,Bd=(i,t,e)=>t in i?tm(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,Co=(i,t)=>{for(var e in t||(t={}))LR.call(t,e)&&Bd(i,e,t[e]);if(Ud)for(var e of Ud(t))OR.call(t,e)&&Bd(i,e,t[e]);return i},hl=(i,t)=>tm(i,"name",{value:t,configurable:!0}),FR=(i,t,e)=>new Promise((n,s)=>{var r=l=>{try{o(e.next(l))}catch(h){s(h)}},a=l=>{try{o(e.throw(l))}catch(h){s(h)}},o=l=>l.done?n(l.value):Promise.resolve(l.value).then(r,a);o((e=e.apply(i,t)).next())}),em=class extends x_{constructor(t){super(Co(Co({},t),{state:"loading"})),this.loadImage=hl(n=>new Promise((s,r)=>{const a=new Image;a.addEventListener("load",()=>s(a)),a.addEventListener("error",()=>r(new Error("load failed"))),a.src=n}),"loadImage");const e=new kr(t.url);e.getHeader().then(n=>{const s=t.projection===void 0?"EPSG:3857":t.projection;this.tileGrid=t.tileGrid||Gs({extent:tn(s),maxResolution:t.maxResolution,minZoom:n.minZoom,maxZoom:n.maxZoom,tileSize:t.tileSize}),this.setLoader((r,a,o)=>FR(this,null,function*(){const l=yield e.getZxy(r,a,o);if(!l)return new Uint8Array;const h=URL.createObjectURL(new Blob([l.data])),c=yield this.loadImage(h);return URL.revokeObjectURL(h),c})),this.setState("ready")})}};hl(em,"PMTilesRasterSource");var zd=em,im=class extends L_{constructor(t){super(Co(Co({},t),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:t.format||new MR})),this.tileLoadFunction=hl((e,n)=>{const s=e,r=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),a=n.match(r);if(!(a&&a.length>=4))throw Error("Could not parse tile URL");const o=+a[1],l=+a[2],h=+a[3];s.setLoader((c,u,f)=>{this.pmtiles_.getZxy(o,l,h).then(_=>{if(_){const g=s.getFormat();s.setFeatures(g.readFeatures(_.data,{extent:c,featureProjection:f})),s.setState(z.LOADED)}else s.setFeatures([]),s.setState(z.EMPTY)}).catch(_=>{s.setFeatures([]),s.setState(z.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new kr(t.url),this.pmtiles_.getHeader().then(e=>{const n=t.projection||"EPSG:3857",s=t.extent||tn(n);this.tileGrid=t.tileGrid||Gs({extent:s,maxResolution:t.maxResolution,maxZoom:t.maxZoom!==void 0?t.maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:t.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};hl(im,"PMTilesVectorSource");var DR=im;class bo extends Cn{constructor(t){const e={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(n=>e[n]=t[n]),super(e),this.getSourceOptions_=t.getSourceOptions,this.children_=null,this.childrenOptions_=t.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=t.crossOrigin||null,this.displayFootprint_=t.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!t.displayGeoTiffByDefault,this.displayPreview_=!!t.displayPreview,this.displayOverview_=t.displayOverview!==!1,this.displayWebMapLink_=t.displayWebMapLink||!1,this.buildTileUrlTemplate_=t.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=t.useTileLayerAsFallback||!1,this.boundsStyle_=t.boundsStyle||rR,this.collectionStyle_=t.collectionStyle||Od,this.boundsLayer_=null,this.disableMigration_=t.disableMigration||!1,this.map_=null,this.eventQueue_=[],t.httpRequestFn&&(this.fetch_=t.httpRequestFn),t.data){try{this.configure_(t.data,t.url,t.children,t.assets,t.bands)}catch(n){this.handleError_(n)}return}if(!t.url)throw new Error("Either url or data must be provided");this.fetch_(t.url).then(n=>this.configure_(n,t.url,t.children,t.assets,t.bands)).catch(n=>this.handleError_(n))}async fetch_(t,e="json"){const n=await fetch(t);if(!n.ok)throw new Error(`Unexpected response from ${t}: ${n.status}`);return e==="json"?await n.json():e==="text"?await n.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var t;if(this.getLayers().getLength()>1)return!1;const n=(t=this.getData())===null||t===void 0?void 0:t.getBoundingBox();return!n||Ri(n)?!0:!this.boundsLayer_||!this.displayFootprint_}handleError_(t){this.dispatch_(new rv(t))}configure_(t,e=null,n=null,s=null,r=[]){let a;t instanceof je||t instanceof ze?a=t:a=Ba(t,!this.disableMigration_),e&&e.includes("://")&&a instanceof ze&&a.setAbsoluteUrl(e),this.set("stac",a),this.bands_=r,this.boundsLayer_=this.addFootprint_();const o=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Dd(this.boundsStyle_,this))};this.getLayers().on("add",o),this.getLayers().on("remove",o);const l=u=>this.handleError_(u),h=this.setChildren(n).catch(l),c=this.setAssets(s).catch(l);Promise.all([h,c]).then(()=>this.dispatch_("layersready")),this.dispatch_("sourceready")}dispatch_(t){this.eventQueue_.push(t),this.flush_()}flush_(){if(this.map_){for(const t of this.eventQueue_)this.dispatchEvent(t);this.eventQueue_=[]}}setMap_(t){this.map_!==t&&(this.map_=t,this.flush_())}async addChildren_(t,e={}){const n=t.map(s=>{const r={data:s,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},a=new bo(Object.assign(r,e));return a.on("sourceready",()=>{a.map_&&this.setMap_(a.map_)}),this.addLayer_(a,null),a});return await Promise.all(n)}async addPreviewImage_(t){const e=await Fd(t,"EPSG:4326"),n=t.getContext().getBoundingBoxes();if(n.length!==1)return;const s=n[0];let r={url:t.getAbsoluteUrl(),projection:e,imageExtent:fh(s,"EPSG:4326",e),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(r=await this.getSourceOptions_(Mt.ImageStatic,r,t));const a=new bw({source:new Dw(r)});return this.addLayer_(a,t),a}async addLayerForLink(t){const e=lR(t);if(!e)return;const n={attributions:t.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:e},s=async(a,o)=>(this.getSourceOptions_&&(o=await this.getSourceOptions_(a,o,t)),o),r=[];switch(t.rel){case"pmtiles":const o=await new kr(n.url).getHeader();let l;switch(o.tileType){case Qn.Mvt:l=new DR(await s(Mt.PMTilesVector,n));break;case Qn.Avif:case Qn.Jpeg:case Qn.Png:case Qn.Webp:l=new zd(await s(Mt.PMTilesRaster,n));break;default:return}r.push(l);break;case"tilejson":r.push(new Nw(await s(Mt.TileJSON,n)));break;case"wms":if(!Array.isArray(t["wms:layers"]))break;for(const u in t["wms:layers"]){const f=t["wms:layers"][u]||"";let _="";Array.isArray(t["wms:styles"])&&typeof t["wms:styles"][u]=="string"&&(_=t["wms:styles"][u]);const g=Object.assign({LAYERS:f,STYLES:_},t["wms:dimensions"]);typeof t["wms:transparent"]=="boolean"&&(g.TRANSPARENT=String(t["wms:transparent"])),typeof t.type=="string"&&t.type.startsWith("image/")&&(g.FORMAT=t.type);const x=await s(Mt.TileWMS,Object.assign({},n,{params:g}));r.push(new vT(x))}break;case"wmts":const h=await this.getWmtsCapabilities_(e);if(!h)return;const c=Array.isArray(t["wmts:layer"])?t["wmts:layer"]:[t["wmts:layer"]];for(const u of c){let f=Object.assign({},n,{layer:u});typeof t.type=="string"&&t.type.startsWith("image/")&&(f.format=t.type),f=await s(Mt.WMTS,f),r.push(new wT(TT(h,f)))}break;case"xyz":r.push(new Mh(await s(Mt.XYZ,n)));break;default:return}return r.map(a=>{let o;return a instanceof L_?o=new _T({source:a,declutter:!0}):a instanceof zd?o=new Eo({source:a}):o=new _d({source:a}),this.addLayer_(o,t),o})}async addGeoTiff_(t){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(t);let n={sources:[oR(t,this.bands_)]};const s=await Fd(t);s&&(n.projection=s),this.getSourceOptions_&&(n=await this.getSourceOptions_(Mt.GeoTIFF,n,t));const r=new E_(n),a=new Promise((o,l)=>{r.on("error",l),r.on("change",()=>{r.getState()==="error"?l(r.getError()):o()})});try{await a;const o=new Eo({source:r});return this.addLayer_(o,t),o}catch(o){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(t);this.handleError_(o)}}async addTileLayerForImagery_(t){let e=this.buildTileUrlTemplate_(t);e instanceof Promise&&(e=await e);let n={crossOrigin:this.crossOrigin_,url:e};this.getSourceOptions_&&(n=await this.getSourceOptions_(Mt.XYZ,n,t));const s=new _d({source:new Mh(n)});return this.addLayer_(s,t),s}addLayer_(t,e=null,n=0){e&&t.set("stac",e),t.setZIndex(n),this.getLayers().push(t)}addFootprint_(){let t=null;const e=this.getData();if(e.isItemCollection()||e.isCollectionCollection()?t=B_(e.getBoundingBox()):t=e.toGeoJSON(),t){const n=this.createGeoJsonLayer_(t,Dd(this.boundsStyle_,this),this.displayFootprint_);return n.set("bounds",!0),n.on("change",()=>this.setMap_(n.getMapInternal())),this.addLayer_(n,e,1),n}return null}async addGeoJson_(t){try{const e=await this.fetch_(t.getAbsoluteUrl()),n=this.createGeoJsonLayer_(e);return this.addLayer_(n,t),n}catch(e){this.handleError_(e)}}createGeoJsonLayer_(t,e=null,n=!0){const s=new uv,r=new fT({format:s,loader:(a,o,l)=>{t=Ha(t);const h=s.readFeatures(t,{featureProjection:l});r.addFeatures(h)}});return e||(e=Od),new A_({source:r,style:e,visible:n})}async addLabelExtension_(){const t=this.getData();if(!(t instanceof bu))return;let e=t.getAssetsWithRoles(["labels","labels-vector"],!0),n;e.length>1&&(n=e.find(r=>r.roles.includes("labels-vector"))),n||(n=t.getAsset("vector_labels")),n||(e=t.getAssets().filter(r=>r.type===Xh&&!r.roles),e.length===1&&(n=e[0]));const s=t.getLinksWithRels(["source"]);if(n&&s.length>0){const r=s.map(async o=>{try{const l=await this.fetch_(o.getAbsoluteUrl());return Ba(l)}catch(l){return this.handleError_(l),null}}),a=(await Promise.all(r)).filter(o=>o instanceof ze);await this.addChildren_(a,{displayFootprint:!1})}try{await this.addGeoJson_(n)}catch(r){this.handleError_(r)}}async updateLayers_(){const t=this.getLayers();for(let s=t.getLength()-1;s>=0;s--){const r=t.item(s);r.get("stac")&&!r.get("bounds")&&t.removeAt(s)}const e=this.getData();if(Array.isArray(this.displayWebMapLink_)){const s=this.getWebMapLinks().map(async r=>await this.addLayerForLink(r));await Promise.all(s)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const n=this.getAssets();if(n){const s=n.map(async r=>{if(r){if(r.type===Xh)return await this.addGeoJson_(r);if(r.isGeoTIFF())return await this.addGeoTiff_(r);if(r.canBrowserDisplayImage())return await this.addPreviewImage_(r)}});await Promise.all(s)}if(this.hasOnlyBounds()){if(e instanceof Cu)await this.addChildren_(e.getAll(),this.childrenOptions_);else if(e instanceof ze){if(e.isItem()&&e.supportsExtension(sR)&&e.getMetadata("label:type")==="vector"){await this.addLabelExtension_();return}const s=this.getWebMapLinks();if(s.length>0)await this.addLayerForLink(s[0]);else{const r=e.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let a;if(r&&this.displayOverview_&&(a=await this.addGeoTiff_(r)),this.displayPreview_&&(!r||!a)){const o=e.getThumbnails(!0,"overview");o.length>0&&await this.addPreviewImage_(o[0])}}}}}hasOnlyBounds(){const t=this.getBoundsLayer();return typeof this.getLayersArray().find(n=>n!==t)>"u"}getWebMapLinks(){const t=this.getData();if(t instanceof je)return[];let e=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(e=[this.displayWebMapLink_]);let n=t.getLinksWithRels(e);return Array.isArray(this.displayWebMapLink_)?n=this.displayWebMapLink_.map(s=>{if(typeof s=="string"){const r=n.find(a=>a.id===s);return r||null}return s}).filter(s=>!!s):n.sort((s,r)=>{const a=e.indexOf(s.rel),o=e.indexOf(r.rel);return a-o}),n}async setAssets(t){if(Array.isArray(t)){const e=this.getData();this.assets_=t.map(n=>e instanceof ze&&typeof n=="string"?e.getAsset(n):n instanceof je?n:new je(n))}else this.assets_=null;await this.updateLayers_()}async setChildren(t,e=null){t instanceof Y_?this.children_=t.getAll():se(t)&&t.type==="FeatureCollection"?this.children_=Ba(t,!this.disableMigration_).getAll():Array.isArray(t)?this.children_=t.map(n=>n instanceof ze?n:Ba(n,!this.disableMigration_)):this.children_=null,this.children_&&this.children_.length===0&&(this.children_=null),this.children_&&se(e)&&(this.childrenOptions_=e),await this.updateLayers_()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const t=this.map_.getView();if(!t)return;let e;const n=this.getData();n&&(e=n.getBoundingBox());const s=this.getChildren();if(!e&&s){const r=s.map(a=>a.getBoundingBox());e=Su(r)}if(e)return fh(e,"EPSG:4326",t.getProjection())}getAttributions(){const t=[],e=this.getData();if(e){const n=e.getMetadata("attribution");n&&n.push(n)}return t}getSource(){return null}async getWmtsCapabilities_(t){try{const e=new URL(t);e.searchParams.set("service","wmts"),e.searchParams.set("request","GetCapabilities");const n=await this.fetch_(e.toString(),"text");return new oS().read(n)}catch{return null}}}function GR(i){i("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),i("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),i("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs");for(var t=1;t<=60;++t)i("EPSG:"+(32600+t),"+proj=utm +zone="+t+" +datum=WGS84 +units=m"),i("EPSG:"+(32700+t),"+proj=utm +zone="+t+" +south +datum=WGS84 +units=m");i.WGS84=i["EPSG:4326"],i["EPSG:3785"]=i["EPSG:3857"],i.GOOGLE=i["EPSG:3857"],i["EPSG:900913"]=i["EPSG:3857"],i["EPSG:102113"]=i["EPSG:3857"]}var wn=1,Tn=2,ps=3,NR=4,$h=5,Xd=6378137,kR=6356752314e-3,jd=.0066943799901413165,xr=484813681109536e-20,X=Math.PI/2,UR=.16666666666666666,BR=.04722222222222222,zR=.022156084656084655,j=1e-10,Ht=.017453292519943295,ni=57.29577951308232,yt=Math.PI/4,Xr=Math.PI*2,Bt=3.14159265359,ve={};ve.greenwich=0;ve.lisbon=-9.131906111111;ve.paris=2.337229166667;ve.bogota=-74.080916666667;ve.madrid=-3.687938888889;ve.rome=12.452333333333;ve.bern=7.439583333333;ve.jakarta=106.807719444444;ve.ferro=-17.666666666667;ve.brussels=4.367975;ve.stockholm=18.058277777778;ve.athens=23.7163375;ve.oslo=10.722916666667;const XR={mm:{to_meter:.001},cm:{to_meter:.01},ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937},fath:{to_meter:1.8288},kmi:{to_meter:1852},"us-ch":{to_meter:20.1168402336805},"us-mi":{to_meter:1609.34721869444},km:{to_meter:1e3},"ind-ft":{to_meter:.30479841},"ind-yd":{to_meter:.91439523},mi:{to_meter:1609.344},yd:{to_meter:.9144},ch:{to_meter:20.1168},link:{to_meter:.201168},dm:{to_meter:.1},in:{to_meter:.0254},"ind-ch":{to_meter:20.11669506},"us-in":{to_meter:.025400050800101},"us-yd":{to_meter:.914401828803658}};var Vd=/[\s_\-\/\(\)]/g;function Yi(i,t){if(i[t])return i[t];for(var e=Object.keys(i),n=t.toLowerCase().replace(Vd,""),s=-1,r,a;++s<e.length;)if(r=e[s],a=r.toLowerCase().replace(Vd,""),a===n)return i[r]}function Wh(i){var t={},e=i.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,l){var h=l.split("=");return h.push(!0),o[h[0].toLowerCase()]=h[1],o},{}),n,s,r,a={proj:"projName",datum:"datumCode",rf:function(o){t.rf=parseFloat(o)},lat_0:function(o){t.lat0=o*Ht},lat_1:function(o){t.lat1=o*Ht},lat_2:function(o){t.lat2=o*Ht},lat_ts:function(o){t.lat_ts=o*Ht},lon_0:function(o){t.long0=o*Ht},lon_1:function(o){t.long1=o*Ht},lon_2:function(o){t.long2=o*Ht},alpha:function(o){t.alpha=parseFloat(o)*Ht},gamma:function(o){t.rectified_grid_angle=parseFloat(o)*Ht},lonc:function(o){t.longc=o*Ht},x_0:function(o){t.x0=parseFloat(o)},y_0:function(o){t.y0=parseFloat(o)},k_0:function(o){t.k0=parseFloat(o)},k:function(o){t.k0=parseFloat(o)},a:function(o){t.a=parseFloat(o)},b:function(o){t.b=parseFloat(o)},r:function(o){t.a=t.b=parseFloat(o)},r_a:function(){t.R_A=!0},zone:function(o){t.zone=parseInt(o,10)},south:function(){t.utmSouth=!0},towgs84:function(o){t.datum_params=o.split(",").map(function(l){return parseFloat(l)})},to_meter:function(o){t.to_meter=parseFloat(o)},units:function(o){t.units=o;var l=Yi(XR,o);l&&(t.to_meter=l.to_meter)},from_greenwich:function(o){t.from_greenwich=o*Ht},pm:function(o){var l=Yi(ve,o);t.from_greenwich=(l||parseFloat(o))*Ht},nadgrids:function(o){o==="@null"?t.datumCode="none":t.nadgrids=o},axis:function(o){var l="ewnsud";o.length===3&&l.indexOf(o.substr(0,1))!==-1&&l.indexOf(o.substr(1,1))!==-1&&l.indexOf(o.substr(2,1))!==-1&&(t.axis=o)},approx:function(){t.approx=!0}};for(n in e)s=e[n],n in a?(r=a[n],typeof r=="function"?r(s):t[r]=s):t[n]=s;return typeof t.datumCode=="string"&&t.datumCode!=="WGS84"&&(t.datumCode=t.datumCode.toLowerCase()),t}class nm{static getId(t){const e=t.find(n=>Array.isArray(n)&&n[0]==="ID");return e&&e.length>=3?{authority:e[1],code:parseInt(e[2],10)}:null}static convertUnit(t,e="unit"){if(!t||t.length<3)return{type:e,name:"unknown",conversion_factor:null};const n=t[1],s=parseFloat(t[2])||null,r=t.find(o=>Array.isArray(o)&&o[0]==="ID"),a=r?{authority:r[1],code:parseInt(r[2],10)}:null;return{type:e,name:n,conversion_factor:s,id:a}}static convertAxis(t){const e=t[1]||"Unknown";let n;const s=e.match(/^\((.)\)$/);if(s){const h=s[1].toUpperCase();if(h==="E")n="east";else if(h==="N")n="north";else if(h==="U")n="up";else throw new Error(`Unknown axis abbreviation: ${h}`)}else n=t[2]?t[2].toLowerCase():"unknown";const r=t.find(h=>Array.isArray(h)&&h[0]==="ORDER"),a=r?parseInt(r[1],10):null,o=t.find(h=>Array.isArray(h)&&(h[0]==="LENGTHUNIT"||h[0]==="ANGLEUNIT"||h[0]==="SCALEUNIT")),l=this.convertUnit(o);return{name:e,direction:n,unit:l,order:a}}static extractAxes(t){return t.filter(e=>Array.isArray(e)&&e[0]==="AXIS").map(e=>this.convertAxis(e)).sort((e,n)=>(e.order||0)-(n.order||0))}static convert(t,e={}){switch(t[0]){case"PROJCRS":e.type="ProjectedCRS",e.name=t[1],e.base_crs=t.find(f=>Array.isArray(f)&&f[0]==="BASEGEOGCRS")?this.convert(t.find(f=>Array.isArray(f)&&f[0]==="BASEGEOGCRS")):null,e.conversion=t.find(f=>Array.isArray(f)&&f[0]==="CONVERSION")?this.convert(t.find(f=>Array.isArray(f)&&f[0]==="CONVERSION")):null;const n=t.find(f=>Array.isArray(f)&&f[0]==="CS");n&&(e.coordinate_system={type:n[1],axis:this.extractAxes(t)});const s=t.find(f=>Array.isArray(f)&&f[0]==="LENGTHUNIT");if(s){const f=this.convertUnit(s);e.coordinate_system.unit=f}e.id=this.getId(t);break;case"BASEGEOGCRS":case"GEOGCRS":e.type="GeographicCRS",e.name=t[1];const r=t.find(f=>Array.isArray(f)&&(f[0]==="DATUM"||f[0]==="ENSEMBLE"));if(r){const f=this.convert(r);r[0]==="ENSEMBLE"?e.datum_ensemble=f:e.datum=f;const _=t.find(g=>Array.isArray(g)&&g[0]==="PRIMEM");_&&_[1]!=="Greenwich"&&(f.prime_meridian={name:_[1],longitude:parseFloat(_[2])})}e.coordinate_system={type:"ellipsoidal",axis:this.extractAxes(t)},e.id=this.getId(t);break;case"DATUM":e.type="GeodeticReferenceFrame",e.name=t[1],e.ellipsoid=t.find(f=>Array.isArray(f)&&f[0]==="ELLIPSOID")?this.convert(t.find(f=>Array.isArray(f)&&f[0]==="ELLIPSOID")):null;break;case"ENSEMBLE":e.type="DatumEnsemble",e.name=t[1],e.members=t.filter(f=>Array.isArray(f)&&f[0]==="MEMBER").map(f=>({type:"DatumEnsembleMember",name:f[1],id:this.getId(f)}));const a=t.find(f=>Array.isArray(f)&&f[0]==="ENSEMBLEACCURACY");a&&(e.accuracy=parseFloat(a[1]));const o=t.find(f=>Array.isArray(f)&&f[0]==="ELLIPSOID");o&&(e.ellipsoid=this.convert(o)),e.id=this.getId(t);break;case"ELLIPSOID":e.type="Ellipsoid",e.name=t[1],e.semi_major_axis=parseFloat(t[2]),e.inverse_flattening=parseFloat(t[3]),t.find(f=>Array.isArray(f)&&f[0]==="LENGTHUNIT")&&this.convert(t.find(f=>Array.isArray(f)&&f[0]==="LENGTHUNIT"),e);break;case"CONVERSION":e.type="Conversion",e.name=t[1],e.method=t.find(f=>Array.isArray(f)&&f[0]==="METHOD")?this.convert(t.find(f=>Array.isArray(f)&&f[0]==="METHOD")):null,e.parameters=t.filter(f=>Array.isArray(f)&&f[0]==="PARAMETER").map(f=>this.convert(f));break;case"METHOD":e.type="Method",e.name=t[1],e.id=this.getId(t);break;case"PARAMETER":e.type="Parameter",e.name=t[1],e.value=parseFloat(t[2]),e.unit=this.convertUnit(t.find(f=>Array.isArray(f)&&(f[0]==="LENGTHUNIT"||f[0]==="ANGLEUNIT"||f[0]==="SCALEUNIT"))),e.id=this.getId(t);break;case"BOUNDCRS":e.type="BoundCRS";const l=t.find(f=>Array.isArray(f)&&f[0]==="SOURCECRS");if(l){const f=l.find(_=>Array.isArray(_));e.source_crs=f?this.convert(f):null}const h=t.find(f=>Array.isArray(f)&&f[0]==="TARGETCRS");if(h){const f=h.find(_=>Array.isArray(_));e.target_crs=f?this.convert(f):null}const c=t.find(f=>Array.isArray(f)&&f[0]==="ABRIDGEDTRANSFORMATION");c?e.transformation=this.convert(c):e.transformation=null;break;case"ABRIDGEDTRANSFORMATION":if(e.type="Transformation",e.name=t[1],e.method=t.find(f=>Array.isArray(f)&&f[0]==="METHOD")?this.convert(t.find(f=>Array.isArray(f)&&f[0]==="METHOD")):null,e.parameters=t.filter(f=>Array.isArray(f)&&(f[0]==="PARAMETER"||f[0]==="PARAMETERFILE")).map(f=>{if(f[0]==="PARAMETER")return this.convert(f);if(f[0]==="PARAMETERFILE")return{name:f[1],value:f[2],id:{authority:"EPSG",code:8656}}}),e.parameters.length===7){const f=e.parameters[6];f.name==="Scale difference"&&(f.value=Math.round((f.value-1)*1e12)/1e6)}e.id=this.getId(t);break;case"AXIS":e.coordinate_system||(e.coordinate_system={type:"unspecified",axis:[]}),e.coordinate_system.axis.push(this.convertAxis(t));break;case"LENGTHUNIT":const u=this.convertUnit(t,"LinearUnit");e.coordinate_system&&e.coordinate_system.axis&&e.coordinate_system.axis.forEach(f=>{f.unit||(f.unit=u)}),u.conversion_factor&&u.conversion_factor!==1&&e.semi_major_axis&&(e.semi_major_axis={value:e.semi_major_axis,unit:u});break;default:e.keyword=t[0];break}return e}}class jR extends nm{static convert(t,e={}){return super.convert(t,e),e.coordinate_system&&e.coordinate_system.subtype==="Cartesian"&&delete e.coordinate_system,e.usage&&delete e.usage,e}}class VR extends nm{static convert(t,e={}){super.convert(t,e);const n=t.find(r=>Array.isArray(r)&&r[0]==="CS");n&&(e.coordinate_system={subtype:n[1],axis:this.extractAxes(t)});const s=t.find(r=>Array.isArray(r)&&r[0]==="USAGE");if(s){const r=s.find(l=>Array.isArray(l)&&l[0]==="SCOPE"),a=s.find(l=>Array.isArray(l)&&l[0]==="AREA"),o=s.find(l=>Array.isArray(l)&&l[0]==="BBOX");e.usage={},r&&(e.usage.scope=r[1]),a&&(e.usage.area=a[1]),o&&(e.usage.bbox=o.slice(1))}return e}}function $R(i){return i.find(t=>Array.isArray(t)&&t[0]==="USAGE")?"2019":(i.find(t=>Array.isArray(t)&&t[0]==="CS")||i[0]==="BOUNDCRS"||i[0]==="PROJCRS"||i[0]==="GEOGCRS","2015")}function WR(i){return($R(i)==="2019"?VR:jR).convert(i)}function qR(i){const t=i.toUpperCase();return t.includes("PROJCRS")||t.includes("GEOGCRS")||t.includes("BOUNDCRS")||t.includes("VERTCRS")||t.includes("LENGTHUNIT")||t.includes("ANGLEUNIT")||t.includes("SCALEUNIT")?"WKT2":(t.includes("PROJCS")||t.includes("GEOGCS")||t.includes("LOCAL_CS")||t.includes("VERT_CS")||t.includes("UNIT"),"WKT1")}var jr=1,sm=2,rm=3,Io=4,am=5,Au=-1,KR=/\s/,HR=/[A-Za-z]/,YR=/[A-Za-z84_]/,cl=/[,\]]/,om=/[\d\.E\-\+]/;function Ci(i){if(typeof i!="string")throw new Error("not a string");this.text=i.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=jr}Ci.prototype.readCharicter=function(){var i=this.text[this.place++];if(this.state!==Io)for(;KR.test(i);){if(this.place>=this.text.length)return;i=this.text[this.place++]}switch(this.state){case jr:return this.neutral(i);case sm:return this.keyword(i);case Io:return this.quoted(i);case am:return this.afterquote(i);case rm:return this.number(i);case Au:return}};Ci.prototype.afterquote=function(i){if(i==='"'){this.word+='"',this.state=Io;return}if(cl.test(i)){this.word=this.word.trim(),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in afterquote yet, index '+this.place)};Ci.prototype.afterItem=function(i){if(i===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=jr;return}if(i==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=jr,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Au);return}};Ci.prototype.number=function(i){if(om.test(i)){this.word+=i;return}if(cl.test(i)){this.word=parseFloat(this.word),this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in number yet, index '+this.place)};Ci.prototype.quoted=function(i){if(i==='"'){this.state=am;return}this.word+=i};Ci.prototype.keyword=function(i){if(YR.test(i)){this.word+=i;return}if(i==="["){var t=[];t.push(this.word),this.level++,this.root===null?this.root=t:this.currentObject.push(t),this.stack.push(this.currentObject),this.currentObject=t,this.state=jr;return}if(cl.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in keyword yet, index '+this.place)};Ci.prototype.neutral=function(i){if(HR.test(i)){this.word=i,this.state=sm;return}if(i==='"'){this.word="",this.state=Io;return}if(om.test(i)){this.word=i,this.state=rm;return}if(cl.test(i)){this.afterItem(i);return}throw new Error(`havn't handled "`+i+'" in neutral yet, index '+this.place)};Ci.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Au)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function ZR(i){var t=new Ci(i);return t.output()}function eh(i,t,e){Array.isArray(t)&&(e.unshift(t),t=null);var n=t?{}:i,s=e.reduce(function(r,a){return os(a,r),r},n);t&&(i[t]=s)}function os(i,t){if(!Array.isArray(i)){t[i]=!0;return}var e=i.shift();if(e==="PARAMETER"&&(e=i.shift()),i.length===1){if(Array.isArray(i[0])){t[e]={},os(i[0],t[e]);return}t[e]=i[0];return}if(!i.length){t[e]=!0;return}if(e==="TOWGS84"){t[e]=i;return}if(e==="AXIS"){e in t||(t[e]=[]),t[e].push(i);return}Array.isArray(e)||(t[e]={});var n;switch(e){case"UNIT":case"PRIMEM":case"VERT_DATUM":t[e]={name:i[0].toLowerCase(),convert:i[1]},i.length===3&&os(i[2],t[e]);return;case"SPHEROID":case"ELLIPSOID":t[e]={name:i[0],a:i[1],rf:i[2]},i.length===4&&os(i[3],t[e]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":i[0]=["name",i[0]],eh(t,e,i);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":i[0]=["name",i[0]],eh(t,e,i),t[e].type=e;return;default:for(n=-1;++n<i.length;)if(!Array.isArray(i[n]))return os(i,t[e]);return eh(t,e,i)}}var QR=.017453292519943295;function Be(i){return i*QR}function lm(i){const t=(i.projName||"").toLowerCase().replace(/_/g," ");!i.long0&&i.longc&&(t==="albers conic equal area"||t==="lambert azimuthal equal area")&&(i.long0=i.longc),!i.lat_ts&&i.lat1&&(t==="stereographic south pole"||t==="polar stereographic (variant b)")?(i.lat0=Be(i.lat1>0?90:-90),i.lat_ts=i.lat1,delete i.lat1):!i.lat_ts&&i.lat0&&(t==="polar stereographic"||t==="polar stereographic (variant a)")&&(i.lat_ts=i.lat0,i.lat0=Be(i.lat0>0?90:-90),delete i.lat1)}function $d(i){let t={units:null,to_meter:void 0};return typeof i=="string"?(t.units=i.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.units==="meter"&&(t.to_meter=1)):i&&i.name&&(t.units=i.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.to_meter=i.conversion_factor),t}function Wd(i){return typeof i=="object"?i.value*i.unit.conversion_factor:i}function qd(i,t){i.ellipsoid.radius?(t.a=i.ellipsoid.radius,t.rf=0):(t.a=Wd(i.ellipsoid.semi_major_axis),i.ellipsoid.inverse_flattening!==void 0?t.rf=i.ellipsoid.inverse_flattening:i.ellipsoid.semi_major_axis!==void 0&&i.ellipsoid.semi_minor_axis!==void 0&&(t.rf=t.a/(t.a-Wd(i.ellipsoid.semi_minor_axis))))}function Ao(i,t={}){return!i||typeof i!="object"?i:i.type==="BoundCRS"?(Ao(i.source_crs,t),i.transformation&&(i.transformation.method&&i.transformation.method.name==="NTv2"?t.nadgrids=i.transformation.parameters[0].value:t.datum_params=i.transformation.parameters.map(e=>e.value)),t):(Object.keys(i).forEach(e=>{const n=i[e];if(n!==null)switch(e){case"name":if(t.srsCode)break;t.name=n,t.srsCode=n;break;case"type":n==="GeographicCRS"?t.projName="longlat":n==="ProjectedCRS"&&i.conversion&&i.conversion.method&&(t.projName=i.conversion.method.name);break;case"datum":case"datum_ensemble":n.ellipsoid&&(t.ellps=n.ellipsoid.name,qd(n,t)),n.prime_meridian&&(t.from_greenwich=n.prime_meridian.longitude*Math.PI/180);break;case"ellipsoid":t.ellps=n.name,qd(n,t);break;case"prime_meridian":t.long0=(n.longitude||0)*Math.PI/180;break;case"coordinate_system":if(n.axis){if(t.axis=n.axis.map(s=>{const r=s.direction;if(r==="east")return"e";if(r==="north")return"n";if(r==="west")return"w";if(r==="south")return"s";throw new Error(`Unknown axis direction: ${r}`)}).join("")+"u",n.unit){const{units:s,to_meter:r}=$d(n.unit);t.units=s,t.to_meter=r}else if(n.axis[0]&&n.axis[0].unit){const{units:s,to_meter:r}=$d(n.axis[0].unit);t.units=s,t.to_meter=r}}break;case"id":n.authority&&n.code&&(t.title=n.authority+":"+n.code);break;case"conversion":n.method&&n.method.name&&(t.projName=n.method.name),n.parameters&&n.parameters.forEach(s=>{const r=s.name.toLowerCase().replace(/\s+/g,"_"),a=s.value;s.unit&&s.unit.conversion_factor?t[r]=a*s.unit.conversion_factor:s.unit==="degree"?t[r]=a*Math.PI/180:t[r]=a});break;case"unit":n.name&&(t.units=n.name.toLowerCase(),t.units==="metre"&&(t.units="meter")),n.conversion_factor&&(t.to_meter=n.conversion_factor);break;case"base_crs":Ao(n,t),t.datumCode=n.id?n.id.authority+"_"+n.id.code:n.name;break}}),t.latitude_of_false_origin!==void 0&&(t.lat0=t.latitude_of_false_origin),t.longitude_of_false_origin!==void 0&&(t.long0=t.longitude_of_false_origin),t.latitude_of_standard_parallel!==void 0&&(t.lat0=t.latitude_of_standard_parallel,t.lat1=t.latitude_of_standard_parallel),t.latitude_of_1st_standard_parallel!==void 0&&(t.lat1=t.latitude_of_1st_standard_parallel),t.latitude_of_2nd_standard_parallel!==void 0&&(t.lat2=t.latitude_of_2nd_standard_parallel),t.latitude_of_projection_centre!==void 0&&(t.lat0=t.latitude_of_projection_centre),t.longitude_of_projection_centre!==void 0&&(t.longc=t.longitude_of_projection_centre),t.easting_at_false_origin!==void 0&&(t.x0=t.easting_at_false_origin),t.northing_at_false_origin!==void 0&&(t.y0=t.northing_at_false_origin),t.latitude_of_natural_origin!==void 0&&(t.lat0=t.latitude_of_natural_origin),t.longitude_of_natural_origin!==void 0&&(t.long0=t.longitude_of_natural_origin),t.longitude_of_origin!==void 0&&(t.long0=t.longitude_of_origin),t.false_easting!==void 0&&(t.x0=t.false_easting),t.easting_at_projection_centre&&(t.x0=t.easting_at_projection_centre),t.false_northing!==void 0&&(t.y0=t.false_northing),t.northing_at_projection_centre&&(t.y0=t.northing_at_projection_centre),t.standard_parallel_1!==void 0&&(t.lat1=t.standard_parallel_1),t.standard_parallel_2!==void 0&&(t.lat2=t.standard_parallel_2),t.scale_factor_at_natural_origin!==void 0&&(t.k0=t.scale_factor_at_natural_origin),t.scale_factor_at_projection_centre!==void 0&&(t.k0=t.scale_factor_at_projection_centre),t.scale_factor_on_pseudo_standard_parallel!==void 0&&(t.k0=t.scale_factor_on_pseudo_standard_parallel),t.azimuth!==void 0&&(t.alpha=t.azimuth),t.azimuth_at_projection_centre!==void 0&&(t.alpha=t.azimuth_at_projection_centre),t.angle_from_rectified_to_skew_grid&&(t.rectified_grid_angle=t.angle_from_rectified_to_skew_grid),lm(t),t)}var JR=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function tM(i,t){var e=t[0],n=t[1];!(e in i)&&n in i&&(i[e]=i[n],t.length===3&&(i[e]=t[2](i[e])))}function hm(i){for(var t=Object.keys(i),e=0,n=t.length;e<n;++e){var s=t[e];JR.indexOf(s)!==-1&&eM(i[s]),typeof i[s]=="object"&&hm(i[s])}}function eM(i){if(i.AUTHORITY){var t=Object.keys(i.AUTHORITY)[0];t&&t in i.AUTHORITY&&(i.title=t+":"+i.AUTHORITY[t])}if(i.type==="GEOGCS"?i.projName="longlat":i.type==="LOCAL_CS"?(i.projName="identity",i.local=!0):typeof i.PROJECTION=="object"?i.projName=Object.keys(i.PROJECTION)[0]:i.projName=i.PROJECTION,i.AXIS){for(var e="",n=0,s=i.AXIS.length;n<s;++n){var r=[i.AXIS[n][0].toLowerCase(),i.AXIS[n][1].toLowerCase()];r[0].indexOf("north")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="north"?e+="n":r[0].indexOf("south")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="south"?e+="s":r[0].indexOf("east")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="east"?e+="e":(r[0].indexOf("west")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(i.axis=e)}i.UNIT&&(i.units=i.UNIT.name.toLowerCase(),i.units==="metre"&&(i.units="meter"),i.UNIT.convert&&(i.type==="GEOGCS"?i.DATUM&&i.DATUM.SPHEROID&&(i.to_meter=i.UNIT.convert*i.DATUM.SPHEROID.a):i.to_meter=i.UNIT.convert));var a=i.GEOGCS;i.type==="GEOGCS"&&(a=i),a&&(a.DATUM?i.datumCode=a.DATUM.name.toLowerCase():i.datumCode=a.name.toLowerCase(),i.datumCode.slice(0,2)==="d_"&&(i.datumCode=i.datumCode.slice(2)),i.datumCode==="new_zealand_1949"&&(i.datumCode="nzgd49"),(i.datumCode==="wgs_1984"||i.datumCode==="world_geodetic_system_1984")&&(i.PROJECTION==="Mercator_Auxiliary_Sphere"&&(i.sphere=!0),i.datumCode="wgs84"),i.datumCode==="belge_1972"&&(i.datumCode="rnb72"),a.DATUM&&a.DATUM.SPHEROID&&(i.ellps=a.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),i.ellps.toLowerCase().slice(0,13)==="international"&&(i.ellps="intl"),i.a=a.DATUM.SPHEROID.a,i.rf=parseFloat(a.DATUM.SPHEROID.rf,10)),a.DATUM&&a.DATUM.TOWGS84&&(i.datum_params=a.DATUM.TOWGS84),~i.datumCode.indexOf("osgb_1936")&&(i.datumCode="osgb36"),~i.datumCode.indexOf("osni_1952")&&(i.datumCode="osni52"),(~i.datumCode.indexOf("tm65")||~i.datumCode.indexOf("geodetic_datum_of_1965"))&&(i.datumCode="ire65"),i.datumCode==="ch1903+"&&(i.datumCode="ch1903"),~i.datumCode.indexOf("israel")&&(i.datumCode="isr93")),i.b&&!isFinite(i.b)&&(i.b=i.a),i.rectified_grid_angle&&(i.rectified_grid_angle=Be(i.rectified_grid_angle));function o(c){var u=i.to_meter||1;return c*u}var l=function(c){return tM(i,c)},h=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Be],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Be],["x0","false_easting",o],["y0","false_northing",o],["long0","central_meridian",Be],["lat0","latitude_of_origin",Be],["lat0","standard_parallel_1",Be],["lat1","standard_parallel_1",Be],["lat2","standard_parallel_2",Be],["azimuth","Azimuth"],["alpha","azimuth",Be],["srsCode","name"]];h.forEach(l),lm(i)}function qh(i){if(typeof i=="object")return Ao(i);const t=qR(i);var e=ZR(i);if(t==="WKT2"){const r=WR(e);return Ao(r)}var n=e[0],s={};return os(e,s),hm(s),s[n]}function ae(i){var t=this;if(arguments.length===2){var e=arguments[1];typeof e=="string"?e.charAt(0)==="+"?ae[i]=Wh(arguments[1]):ae[i]=qh(arguments[1]):ae[i]=e}else if(arguments.length===1){if(Array.isArray(i))return i.map(function(n){return Array.isArray(n)?ae.apply(t,n):ae(n)});if(typeof i=="string"){if(i in ae)return ae[i]}else"EPSG"in i?ae["EPSG:"+i.EPSG]=i:"ESRI"in i?ae["ESRI:"+i.ESRI]=i:"IAU2000"in i?ae["IAU2000:"+i.IAU2000]=i:console.log(i);return}}GR(ae);function iM(i){return typeof i=="string"}function nM(i){return i in ae}function sM(i){return i.indexOf("+")!==0&&i.indexOf("[")!==-1||typeof i=="object"&&!("srsCode"in i)}var rM=["3857","900913","3785","102113"];function aM(i){var t=Yi(i,"authority");if(t){var e=Yi(t,"epsg");return e&&rM.indexOf(e)>-1}}function oM(i){var t=Yi(i,"extension");if(t)return Yi(t,"proj4")}function lM(i){return i[0]==="+"}function hM(i){if(iM(i)){if(nM(i))return ae[i];if(sM(i)){var t=qh(i);if(aM(t))return ae["EPSG:3857"];var e=oM(t);return e?Wh(e):t}if(lM(i))return Wh(i)}else return"projName"in i?i:qh(i)}function Kd(i,t){i=i||{};var e,n;if(!t)return i;for(n in t)e=t[n],e!==void 0&&(i[n]=e);return i}function hi(i,t,e){var n=i*t;return e/Math.sqrt(1-n*n)}function da(i){return i<0?-1:1}function $(i){return Math.abs(i)<=Bt?i:i-da(i)*Xr}function Ve(i,t,e){var n=i*e,s=.5*i;return n=Math.pow((1-n)/(1+n),s),Math.tan(.5*(X-t))/n}function Vr(i,t){for(var e=.5*i,n,s,r=X-2*Math.atan(t),a=0;a<=15;a++)if(n=i*Math.sin(r),s=X-2*Math.atan(t*Math.pow((1-n)/(1+n),e))-r,r+=s,Math.abs(s)<=1e-10)return r;return-9999}function cM(){var i=this.b/this.a;this.es=1-i*i,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=hi(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function uM(i){var t=i.x,e=i.y;if(e*ni>90&&e*ni<-90&&t*ni>180&&t*ni<-180)return null;var n,s;if(Math.abs(Math.abs(e)-X)<=j)return null;if(this.sphere)n=this.x0+this.a*this.k0*$(t-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(yt+.5*e));else{var r=Math.sin(e),a=Ve(this.e,e,r);n=this.x0+this.a*this.k0*$(t-this.long0),s=this.y0-this.a*this.k0*Math.log(a)}return i.x=n,i.y=s,i}function fM(i){var t=i.x-this.x0,e=i.y-this.y0,n,s;if(this.sphere)s=X-2*Math.atan(Math.exp(-e/(this.a*this.k0)));else{var r=Math.exp(-e/(this.a*this.k0));if(s=Vr(this.e,r),s===-9999)return null}return n=$(this.long0+t/(this.a*this.k0)),i.x=n,i.y=s,i}var dM=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","Mercator_Variant_A","merc"];const gM={init:cM,forward:uM,inverse:fM,names:dM};function _M(){}function Hd(i){return i}var mM=["longlat","identity"];const pM={init:_M,forward:Hd,inverse:Hd,names:mM};var yM=[gM,pM],hn={},ls=[];function cm(i,t){var e=ls.length;return i.names?(ls[e]=i,i.names.forEach(function(n){hn[n.toLowerCase()]=e}),this):(console.log(t),!0)}function um(i){return i.replace(/[-\(\)\s]+/g," ").trim().replace(/ /g,"_")}function xM(i){if(!i)return!1;var t=i.toLowerCase();if(typeof hn[t]<"u"&&ls[hn[t]]||(t=um(t),t in hn&&ls[hn[t]]))return ls[hn[t]]}function EM(){yM.forEach(cm)}const vM={start:EM,add:cm,get:xM};var fm={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"},andrae:{a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"},clrk80:{a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk80ign:{a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"},clrk58:{a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:63558348467e-4,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};const wM=fm.WGS84;function TM(i,t,e,n){var s=i*i,r=t*t,a=(s-r)/s,o=0;n?(i*=1-a*(UR+a*(BR+a*zR)),s=i*i,a=0):o=Math.sqrt(a);var l=(s-r)/r;return{es:a,e:o,ep2:l}}function SM(i,t,e,n,s){if(!i){var r=Yi(fm,n);r||(r=wM),i=r.a,t=r.b,e=r.rf}return e&&!t&&(t=(1-1/e)*i),(e===0||Math.abs(i-t)<j)&&(s=!0,t=i),{a:i,b:t,rf:e,sphere:s}}var Ja={wgs84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ch1903:{towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ggrs87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},nad83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},nad27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"},mgi:{towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"},osni52:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},rassadiran:{towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},osgb36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Ordnance Survey of Great Britain 1936"},s_jtsk:{towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},beduaram:{towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},gunung_segara:{towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},rnb72:{towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},EPSG_5451:{towgs84:"6.41,-49.05,-11.28,1.5657,0.5242,6.9718,-5.7649"},IGNF_LURESG:{towgs84:"-192.986,13.673,-39.309,-0.4099,-2.9332,2.6881,0.43"},EPSG_4614:{towgs84:"-119.4248,-303.65872,-11.00061,1.164298,0.174458,1.096259,3.657065"},EPSG_4615:{towgs84:"-494.088,-312.129,279.877,-1.423,-1.013,1.59,-0.748"},ESRI_37241:{towgs84:"-76.822,257.457,-12.817,2.136,-0.033,-2.392,-0.031"},ESRI_37249:{towgs84:"-440.296,58.548,296.265,1.128,10.202,4.559,-0.438"},ESRI_37245:{towgs84:"-511.151,-181.269,139.609,1.05,2.703,1.798,3.071"},EPSG_4178:{towgs84:"24.9,-126.4,-93.2,-0.063,-0.247,-0.041,1.01"},EPSG_4622:{towgs84:"-472.29,-5.63,-304.12,0.4362,-0.8374,0.2563,1.8984"},EPSG_4625:{towgs84:"126.93,547.94,130.41,-2.7867,5.1612,-0.8584,13.8227"},EPSG_5252:{towgs84:"0.023,0.036,-0.068,0.00176,0.00912,-0.01136,0.00439"},EPSG_4314:{towgs84:"597.1,71.4,412.1,0.894,0.068,-1.563,7.58"},EPSG_4282:{towgs84:"-178.3,-316.7,-131.5,5.278,6.077,10.979,19.166"},EPSG_4231:{towgs84:"-83.11,-97.38,-117.22,0.0276,-0.2167,0.2147,0.1218"},EPSG_4274:{towgs84:"-230.994,102.591,25.199,0.633,-0.239,0.9,1.95"},EPSG_4134:{towgs84:"-180.624,-225.516,173.919,-0.81,-1.898,8.336,16.71006"},EPSG_4254:{towgs84:"18.38,192.45,96.82,0.056,-0.142,-0.2,-0.0013"},EPSG_4159:{towgs84:"-194.513,-63.978,-25.759,-3.4027,3.756,-3.352,-0.9175"},EPSG_4687:{towgs84:"0.072,-0.507,-0.245,0.0183,-0.0003,0.007,-0.0093"},EPSG_4227:{towgs84:"-83.58,-397.54,458.78,-17.595,-2.847,4.256,3.225"},EPSG_4746:{towgs84:"599.4,72.4,419.2,-0.062,-0.022,-2.723,6.46"},EPSG_4745:{towgs84:"612.4,77,440.2,-0.054,0.057,-2.797,2.55"},EPSG_6311:{towgs84:"8.846,-4.394,-1.122,-0.00237,-0.146528,0.130428,0.783926"},EPSG_4289:{towgs84:"565.7381,50.4018,465.2904,-1.91514,1.60363,-9.09546,4.07244"},EPSG_4230:{towgs84:"-68.863,-134.888,-111.49,-0.53,-0.14,0.57,-3.4"},EPSG_4154:{towgs84:"-123.02,-158.95,-168.47"},EPSG_4156:{towgs84:"570.8,85.7,462.8,4.998,1.587,5.261,3.56"},EPSG_4299:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4179:{towgs84:"33.4,-146.6,-76.3,-0.359,-0.053,0.844,-0.84"},EPSG_4313:{towgs84:"-106.8686,52.2978,-103.7239,0.3366,-0.457,1.8422,-1.2747"},EPSG_4194:{towgs84:"163.511,127.533,-159.789"},EPSG_4195:{towgs84:"105,326,-102.5"},EPSG_4196:{towgs84:"-45,417,-3.5"},EPSG_4611:{towgs84:"-162.619,-276.959,-161.764,0.067753,-2.243649,-1.158827,-1.094246"},EPSG_4633:{towgs84:"137.092,131.66,91.475,-1.9436,-11.5993,-4.3321,-7.4824"},EPSG_4641:{towgs84:"-408.809,366.856,-412.987,1.8842,-0.5308,2.1655,-121.0993"},EPSG_4643:{towgs84:"-480.26,-438.32,-643.429,16.3119,20.1721,-4.0349,-111.7002"},EPSG_4300:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4188:{towgs84:"482.5,-130.6,564.6,-1.042,-0.214,-0.631,8.15"},EPSG_4660:{towgs84:"982.6087,552.753,-540.873,32.39344,-153.25684,-96.2266,16.805"},EPSG_4662:{towgs84:"97.295,-263.247,310.882,-1.5999,0.8386,3.1409,13.3259"},EPSG_3906:{towgs84:"577.88891,165.22205,391.18289,4.9145,-0.94729,-13.05098,7.78664"},EPSG_4307:{towgs84:"-209.3622,-87.8162,404.6198,0.0046,3.4784,0.5805,-1.4547"},EPSG_6892:{towgs84:"-76.269,-16.683,68.562,-6.275,10.536,-4.286,-13.686"},EPSG_4690:{towgs84:"221.597,152.441,176.523,2.403,1.3893,0.884,11.4648"},EPSG_4691:{towgs84:"218.769,150.75,176.75,3.5231,2.0037,1.288,10.9817"},EPSG_4629:{towgs84:"72.51,345.411,79.241,-1.5862,-0.8826,-0.5495,1.3653"},EPSG_4630:{towgs84:"165.804,216.213,180.26,-0.6251,-0.4515,-0.0721,7.4111"},EPSG_4692:{towgs84:"217.109,86.452,23.711,0.0183,-0.0003,0.007,-0.0093"},EPSG_9333:{towgs84:"0,0,0,-8.393,0.749,-10.276,0"},EPSG_9059:{towgs84:"0,0,0"},EPSG_4312:{towgs84:"601.705,84.263,485.227,4.7354,1.3145,5.393,-2.3887"},EPSG_4123:{towgs84:"-96.062,-82.428,-121.753,4.801,0.345,-1.376,1.496"},EPSG_4309:{towgs84:"-124.45,183.74,44.64,-0.4384,0.5446,-0.9706,-2.1365"},ESRI_104106:{towgs84:"-283.088,-70.693,117.445,-1.157,0.059,-0.652,-4.058"},EPSG_4281:{towgs84:"-219.247,-73.802,269.529"},EPSG_4322:{towgs84:"0,0,4.5"},EPSG_4324:{towgs84:"0,0,1.9"},EPSG_4284:{towgs84:"43.822,-108.842,-119.585,1.455,-0.761,0.737,0.549"},EPSG_4277:{towgs84:"446.448,-125.157,542.06,0.15,0.247,0.842,-20.489"},EPSG_4207:{towgs84:"-282.1,-72.2,120,-1.529,0.145,-0.89,-4.46"},EPSG_4688:{towgs84:"347.175,1077.618,2623.677,33.9058,-70.6776,9.4013,186.0647"},EPSG_4689:{towgs84:"410.793,54.542,80.501,-2.5596,-2.3517,-0.6594,17.3218"},EPSG_4720:{towgs84:"0,0,4.5"},EPSG_4273:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},EPSG_4240:{towgs84:"204.64,834.74,293.8"},EPSG_4817:{towgs84:"278.3,93,474.5,7.889,0.05,-6.61,6.21"},ESRI_104131:{towgs84:"426.62,142.62,460.09,4.98,4.49,-12.42,-17.1"},EPSG_4265:{towgs84:"-104.1,-49.1,-9.9,0.971,-2.917,0.714,-11.68"},EPSG_4263:{towgs84:"-111.92,-87.85,114.5,1.875,0.202,0.219,0.032"},EPSG_4298:{towgs84:"-689.5937,623.84046,-65.93566,-0.02331,1.17094,-0.80054,5.88536"},EPSG_4270:{towgs84:"-253.4392,-148.452,386.5267,0.15605,0.43,-0.1013,-0.0424"},EPSG_4229:{towgs84:"-121.8,98.1,-10.7"},EPSG_4220:{towgs84:"-55.5,-348,-229.2"},EPSG_4214:{towgs84:"12.646,-155.176,-80.863"},EPSG_4232:{towgs84:"-345,3,223"},EPSG_4238:{towgs84:"-1.977,-13.06,-9.993,0.364,0.254,0.689,-1.037"},EPSG_4168:{towgs84:"-170,33,326"},EPSG_4131:{towgs84:"199,931,318.9"},EPSG_4152:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_5228:{towgs84:"572.213,85.334,461.94,4.9732,1.529,5.2484,3.5378"},EPSG_8351:{towgs84:"485.021,169.465,483.839,7.786342,4.397554,4.102655,0"},EPSG_4683:{towgs84:"-127.62,-67.24,-47.04,-3.068,4.903,1.578,-1.06"},EPSG_4133:{towgs84:"0,0,0"},EPSG_7373:{towgs84:"0.819,-0.5762,-1.6446,-0.00378,-0.03317,0.00318,0.0693"},EPSG_9075:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9072:{towgs84:"-0.9102,2.0141,0.5602,0.029039,0.010065,0.010101,0"},EPSG_9294:{towgs84:"1.16835,-1.42001,-2.24431,-0.00822,-0.05508,0.01818,0.23388"},EPSG_4212:{towgs84:"-267.434,173.496,181.814,-13.4704,8.7154,7.3926,14.7492"},EPSG_4191:{towgs84:"-44.183,-0.58,-38.489,2.3867,2.7072,-3.5196,-8.2703"},EPSG_4237:{towgs84:"52.684,-71.194,-13.975,-0.312,-0.1063,-0.3729,1.0191"},EPSG_4740:{towgs84:"-1.08,-0.27,-0.9"},EPSG_4124:{towgs84:"419.3836,99.3335,591.3451,0.850389,1.817277,-7.862238,-0.99496"},EPSG_5681:{towgs84:"584.9636,107.7175,413.8067,1.1155,0.2824,-3.1384,7.9922"},EPSG_4141:{towgs84:"23.772,17.49,17.859,-0.3132,-1.85274,1.67299,-5.4262"},EPSG_4204:{towgs84:"-85.645,-273.077,-79.708,2.289,-1.421,2.532,3.194"},EPSG_4319:{towgs84:"226.702,-193.337,-35.371,-2.229,-4.391,9.238,0.9798"},EPSG_4200:{towgs84:"24.82,-131.21,-82.66"},EPSG_4130:{towgs84:"0,0,0"},EPSG_4127:{towgs84:"-82.875,-57.097,-156.768,-2.158,1.524,-0.982,-0.359"},EPSG_4149:{towgs84:"674.374,15.056,405.346"},EPSG_4617:{towgs84:"-0.991,1.9072,0.5129,1.25033e-7,4.6785e-8,5.6529e-8,0"},EPSG_4663:{towgs84:"-210.502,-66.902,-48.476,2.094,-15.067,-5.817,0.485"},EPSG_4664:{towgs84:"-211.939,137.626,58.3,-0.089,0.251,0.079,0.384"},EPSG_4665:{towgs84:"-105.854,165.589,-38.312,-0.003,-0.026,0.024,-0.048"},EPSG_4666:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},EPSG_4756:{towgs84:"-192.873,-39.382,-111.202,-0.00205,-0.0005,0.00335,0.0188"},EPSG_4723:{towgs84:"-179.483,-69.379,-27.584,-7.862,8.163,6.042,-13.925"},EPSG_4726:{towgs84:"8.853,-52.644,180.304,-0.393,-2.323,2.96,-24.081"},EPSG_4267:{towgs84:"-8.0,160.0,176.0"},EPSG_5365:{towgs84:"-0.16959,0.35312,0.51846,0.03385,-0.16325,0.03446,0.03693"},EPSG_4218:{towgs84:"304.5,306.5,-318.1"},EPSG_4242:{towgs84:"-33.722,153.789,94.959,-8.581,-4.478,4.54,8.95"},EPSG_4216:{towgs84:"-292.295,248.758,429.447,4.9971,2.99,6.6906,1.0289"},ESRI_104105:{towgs84:"631.392,-66.551,481.442,1.09,-4.445,-4.487,-4.43"},ESRI_104129:{towgs84:"0,0,0"},EPSG_4673:{towgs84:"174.05,-25.49,112.57"},EPSG_4202:{towgs84:"-124,-60,154"},EPSG_4203:{towgs84:"-117.763,-51.51,139.061,0.292,0.443,0.277,-0.191"},EPSG_3819:{towgs84:"595.48,121.69,515.35,4.115,-2.9383,0.853,-3.408"},EPSG_8694:{towgs84:"-93.799,-132.737,-219.073,-1.844,0.648,-6.37,-0.169"},EPSG_4145:{towgs84:"275.57,676.78,229.6"},EPSG_4283:{towgs84:"61.55,-10.87,-40.19,39.4924,32.7221,32.8979,-9.994"},EPSG_4317:{towgs84:"2.3287,-147.0425,-92.0802,-0.3092483,0.32482185,0.49729934,5.68906266"},EPSG_4272:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993"},EPSG_4248:{towgs84:"-307.7,265.3,-363.5"},EPSG_5561:{towgs84:"24,-121,-76"},EPSG_5233:{towgs84:"-0.293,766.95,87.713,0.195704,1.695068,3.473016,-0.039338"},ESRI_104130:{towgs84:"-86,-98,-119"},ESRI_104102:{towgs84:"682,-203,480"},ESRI_37207:{towgs84:"7,-10,-26"},EPSG_4675:{towgs84:"59.935,118.4,-10.871"},ESRI_104109:{towgs84:"-89.121,-348.182,260.871"},ESRI_104112:{towgs84:"-185.583,-230.096,281.361"},ESRI_104113:{towgs84:"25.1,-275.6,222.6"},IGNF_WGS72G:{towgs84:"0,12,6"},IGNF_NTFG:{towgs84:"-168,-60,320"},IGNF_EFATE57G:{towgs84:"-127,-769,472"},IGNF_PGP50G:{towgs84:"324.8,153.6,172.1"},IGNF_REUN47G:{towgs84:"94,-948,-1262"},IGNF_CSG67G:{towgs84:"-186,230,110"},IGNF_GUAD48G:{towgs84:"-467,-16,-300"},IGNF_TAHI51G:{towgs84:"162,117,154"},IGNF_TAHAAG:{towgs84:"65,342,77"},IGNF_NUKU72G:{towgs84:"84,274,65"},IGNF_PETRELS72G:{towgs84:"365,194,166"},IGNF_WALL78G:{towgs84:"253,-133,-127"},IGNF_MAYO50G:{towgs84:"-382,-59,-262"},IGNF_TANNAG:{towgs84:"-139,-967,436"},IGNF_IGN72G:{towgs84:"-13,-348,292"},IGNF_ATIGG:{towgs84:"1118,23,66"},IGNF_FANGA84G:{towgs84:"150.57,158.33,118.32"},IGNF_RUSAT84G:{towgs84:"202.13,174.6,-15.74"},IGNF_KAUE70G:{towgs84:"126.74,300.1,-75.49"},IGNF_MOP90G:{towgs84:"-10.8,-1.8,12.77"},IGNF_MHPF67G:{towgs84:"338.08,212.58,-296.17"},IGNF_TAHI79G:{towgs84:"160.61,116.05,153.69"},IGNF_ANAA92G:{towgs84:"1.5,3.84,4.81"},IGNF_MARQUI72G:{towgs84:"330.91,-13.92,58.56"},IGNF_APAT86G:{towgs84:"143.6,197.82,74.05"},IGNF_TUBU69G:{towgs84:"237.17,171.61,-77.84"},IGNF_STPM50G:{towgs84:"11.363,424.148,373.13"},EPSG_4150:{towgs84:"674.374,15.056,405.346"},EPSG_4754:{towgs84:"-208.4058,-109.8777,-2.5764"},ESRI_104101:{towgs84:"374,150,588"},EPSG_4693:{towgs84:"0,-0.15,0.68"},EPSG_6207:{towgs84:"293.17,726.18,245.36"},EPSG_4153:{towgs84:"-133.63,-157.5,-158.62"},EPSG_4132:{towgs84:"-241.54,-163.64,396.06"},EPSG_4221:{towgs84:"-154.5,150.7,100.4"},EPSG_4266:{towgs84:"-80.7,-132.5,41.1"},EPSG_4193:{towgs84:"-70.9,-151.8,-41.4"},EPSG_5340:{towgs84:"-0.41,0.46,-0.35"},EPSG_4246:{towgs84:"-294.7,-200.1,525.5"},EPSG_4318:{towgs84:"-3.2,-5.7,2.8"},EPSG_4121:{towgs84:"-199.87,74.79,246.62"},EPSG_4223:{towgs84:"-260.1,5.5,432.2"},EPSG_4158:{towgs84:"-0.465,372.095,171.736"},EPSG_4285:{towgs84:"-128.16,-282.42,21.93"},EPSG_4613:{towgs84:"-404.78,685.68,45.47"},EPSG_4607:{towgs84:"195.671,332.517,274.607"},EPSG_4475:{towgs84:"-381.788,-57.501,-256.673"},EPSG_4208:{towgs84:"-157.84,308.54,-146.6"},EPSG_4743:{towgs84:"70.995,-335.916,262.898"},EPSG_4710:{towgs84:"-323.65,551.39,-491.22"},EPSG_7881:{towgs84:"-0.077,0.079,0.086"},EPSG_4682:{towgs84:"283.729,735.942,261.143"},EPSG_4739:{towgs84:"-156,-271,-189"},EPSG_4679:{towgs84:"-80.01,253.26,291.19"},EPSG_4750:{towgs84:"-56.263,16.136,-22.856"},EPSG_4644:{towgs84:"-10.18,-350.43,291.37"},EPSG_4695:{towgs84:"-103.746,-9.614,-255.95"},EPSG_4292:{towgs84:"-355,21,72"},EPSG_4302:{towgs84:"-61.702,284.488,472.052"},EPSG_4143:{towgs84:"-124.76,53,466.79"},EPSG_4606:{towgs84:"-153,153,307"},EPSG_4699:{towgs84:"-770.1,158.4,-498.2"},EPSG_4247:{towgs84:"-273.5,110.6,-357.9"},EPSG_4160:{towgs84:"8.88,184.86,106.69"},EPSG_4161:{towgs84:"-233.43,6.65,173.64"},EPSG_9251:{towgs84:"-9.5,122.9,138.2"},EPSG_9253:{towgs84:"-78.1,101.6,133.3"},EPSG_4297:{towgs84:"-198.383,-240.517,-107.909"},EPSG_4269:{towgs84:"0,0,0"},EPSG_4301:{towgs84:"-147,506,687"},EPSG_4618:{towgs84:"-59,-11,-52"},EPSG_4612:{towgs84:"0,0,0"},EPSG_4678:{towgs84:"44.585,-131.212,-39.544"},EPSG_4250:{towgs84:"-130,29,364"},EPSG_4144:{towgs84:"214,804,268"},EPSG_4147:{towgs84:"-17.51,-108.32,-62.39"},EPSG_4259:{towgs84:"-254.1,-5.36,-100.29"},EPSG_4164:{towgs84:"-76,-138,67"},EPSG_4211:{towgs84:"-378.873,676.002,-46.255"},EPSG_4182:{towgs84:"-422.651,-172.995,84.02"},EPSG_4224:{towgs84:"-143.87,243.37,-33.52"},EPSG_4225:{towgs84:"-205.57,168.77,-4.12"},EPSG_5527:{towgs84:"-67.35,3.88,-38.22"},EPSG_4752:{towgs84:"98,390,-22"},EPSG_4310:{towgs84:"-30,190,89"},EPSG_9248:{towgs84:"-192.26,65.72,132.08"},EPSG_4680:{towgs84:"124.5,-63.5,-281"},EPSG_4701:{towgs84:"-79.9,-158,-168.9"},EPSG_4706:{towgs84:"-146.21,112.63,4.05"},EPSG_4805:{towgs84:"682,-203,480"},EPSG_4201:{towgs84:"-165,-11,206"},EPSG_4210:{towgs84:"-157,-2,-299"},EPSG_4183:{towgs84:"-104,167,-38"},EPSG_4139:{towgs84:"11,72,-101"},EPSG_4668:{towgs84:"-86,-98,-119"},EPSG_4717:{towgs84:"-2,151,181"},EPSG_4732:{towgs84:"102,52,-38"},EPSG_4280:{towgs84:"-377,681,-50"},EPSG_4209:{towgs84:"-138,-105,-289"},EPSG_4261:{towgs84:"31,146,47"},EPSG_4658:{towgs84:"-73,46,-86"},EPSG_4721:{towgs84:"265.025,384.929,-194.046"},EPSG_4222:{towgs84:"-136,-108,-292"},EPSG_4601:{towgs84:"-255,-15,71"},EPSG_4602:{towgs84:"725,685,536"},EPSG_4603:{towgs84:"72,213.7,93"},EPSG_4605:{towgs84:"9,183,236"},EPSG_4621:{towgs84:"137,248,-430"},EPSG_4657:{towgs84:"-28,199,5"},EPSG_4316:{towgs84:"103.25,-100.4,-307.19"},EPSG_4642:{towgs84:"-13,-348,292"},EPSG_4698:{towgs84:"145,-187,103"},EPSG_4192:{towgs84:"-206.1,-174.7,-87.7"},EPSG_4311:{towgs84:"-265,120,-358"},EPSG_4135:{towgs84:"58,-283,-182"},ESRI_104138:{towgs84:"198,-226,-347"},EPSG_4245:{towgs84:"-11,851,5"},EPSG_4142:{towgs84:"-125,53,467"},EPSG_4213:{towgs84:"-106,-87,188"},EPSG_4253:{towgs84:"-133,-77,-51"},EPSG_4129:{towgs84:"-132,-110,-335"},EPSG_4713:{towgs84:"-77,-128,142"},EPSG_4239:{towgs84:"217,823,299"},EPSG_4146:{towgs84:"295,736,257"},EPSG_4155:{towgs84:"-83,37,124"},EPSG_4165:{towgs84:"-173,253,27"},EPSG_4672:{towgs84:"175,-38,113"},EPSG_4236:{towgs84:"-637,-549,-203"},EPSG_4251:{towgs84:"-90,40,88"},EPSG_4271:{towgs84:"-2,374,172"},EPSG_4175:{towgs84:"-88,4,101"},EPSG_4716:{towgs84:"298,-304,-375"},EPSG_4315:{towgs84:"-23,259,-9"},EPSG_4744:{towgs84:"-242.2,-144.9,370.3"},EPSG_4244:{towgs84:"-97,787,86"},EPSG_4293:{towgs84:"616,97,-251"},EPSG_4714:{towgs84:"-127,-769,472"},EPSG_4736:{towgs84:"260,12,-147"},EPSG_6883:{towgs84:"-235,-110,393"},EPSG_6894:{towgs84:"-63,176,185"},EPSG_4205:{towgs84:"-43,-163,45"},EPSG_4256:{towgs84:"41,-220,-134"},EPSG_4262:{towgs84:"639,405,60"},EPSG_4604:{towgs84:"174,359,365"},EPSG_4169:{towgs84:"-115,118,426"},EPSG_4620:{towgs84:"-106,-129,165"},EPSG_4184:{towgs84:"-203,141,53"},EPSG_4616:{towgs84:"-289,-124,60"},EPSG_9403:{towgs84:"-307,-92,127"},EPSG_4684:{towgs84:"-133,-321,50"},EPSG_4708:{towgs84:"-491,-22,435"},EPSG_4707:{towgs84:"114,-116,-333"},EPSG_4709:{towgs84:"145,75,-272"},EPSG_4712:{towgs84:"-205,107,53"},EPSG_4711:{towgs84:"124,-234,-25"},EPSG_4718:{towgs84:"230,-199,-752"},EPSG_4719:{towgs84:"211,147,111"},EPSG_4724:{towgs84:"208,-435,-229"},EPSG_4725:{towgs84:"189,-79,-202"},EPSG_4735:{towgs84:"647,1777,-1124"},EPSG_4722:{towgs84:"-794,119,-298"},EPSG_4728:{towgs84:"-307,-92,127"},EPSG_4734:{towgs84:"-632,438,-609"},EPSG_4727:{towgs84:"912,-58,1227"},EPSG_4729:{towgs84:"185,165,42"},EPSG_4730:{towgs84:"170,42,84"},EPSG_4733:{towgs84:"276,-57,149"},ESRI_37218:{towgs84:"230,-199,-752"},ESRI_37240:{towgs84:"-7,215,225"},ESRI_37221:{towgs84:"252,-209,-751"},ESRI_4305:{towgs84:"-123,-206,219"},ESRI_104139:{towgs84:"-73,-247,227"},EPSG_4748:{towgs84:"51,391,-36"},EPSG_4219:{towgs84:"-384,664,-48"},EPSG_4255:{towgs84:"-333,-222,114"},EPSG_4257:{towgs84:"-587.8,519.75,145.76"},EPSG_4646:{towgs84:"-963,510,-359"},EPSG_6881:{towgs84:"-24,-203,268"},EPSG_6882:{towgs84:"-183,-15,273"},EPSG_4715:{towgs84:"-104,-129,239"},IGNF_RGF93GDD:{towgs84:"0,0,0"},IGNF_RGM04GDD:{towgs84:"0,0,0"},IGNF_RGSPM06GDD:{towgs84:"0,0,0"},IGNF_RGTAAF07GDD:{towgs84:"0,0,0"},IGNF_RGFG95GDD:{towgs84:"0,0,0"},IGNF_RGNCG:{towgs84:"0,0,0"},IGNF_RGPFGDD:{towgs84:"0,0,0"},IGNF_ETRS89G:{towgs84:"0,0,0"},IGNF_RGR92GDD:{towgs84:"0,0,0"},EPSG_4173:{towgs84:"0,0,0"},EPSG_4180:{towgs84:"0,0,0"},EPSG_4619:{towgs84:"0,0,0"},EPSG_4667:{towgs84:"0,0,0"},EPSG_4075:{towgs84:"0,0,0"},EPSG_6706:{towgs84:"0,0,0"},EPSG_7798:{towgs84:"0,0,0"},EPSG_4661:{towgs84:"0,0,0"},EPSG_4669:{towgs84:"0,0,0"},EPSG_8685:{towgs84:"0,0,0"},EPSG_4151:{towgs84:"0,0,0"},EPSG_9702:{towgs84:"0,0,0"},EPSG_4758:{towgs84:"0,0,0"},EPSG_4761:{towgs84:"0,0,0"},EPSG_4765:{towgs84:"0,0,0"},EPSG_8997:{towgs84:"0,0,0"},EPSG_4023:{towgs84:"0,0,0"},EPSG_4670:{towgs84:"0,0,0"},EPSG_4694:{towgs84:"0,0,0"},EPSG_4148:{towgs84:"0,0,0"},EPSG_4163:{towgs84:"0,0,0"},EPSG_4167:{towgs84:"0,0,0"},EPSG_4189:{towgs84:"0,0,0"},EPSG_4190:{towgs84:"0,0,0"},EPSG_4176:{towgs84:"0,0,0"},EPSG_4659:{towgs84:"0,0,0"},EPSG_3824:{towgs84:"0,0,0"},EPSG_3889:{towgs84:"0,0,0"},EPSG_4046:{towgs84:"0,0,0"},EPSG_4081:{towgs84:"0,0,0"},EPSG_4558:{towgs84:"0,0,0"},EPSG_4483:{towgs84:"0,0,0"},EPSG_5013:{towgs84:"0,0,0"},EPSG_5264:{towgs84:"0,0,0"},EPSG_5324:{towgs84:"0,0,0"},EPSG_5354:{towgs84:"0,0,0"},EPSG_5371:{towgs84:"0,0,0"},EPSG_5373:{towgs84:"0,0,0"},EPSG_5381:{towgs84:"0,0,0"},EPSG_5393:{towgs84:"0,0,0"},EPSG_5489:{towgs84:"0,0,0"},EPSG_5593:{towgs84:"0,0,0"},EPSG_6135:{towgs84:"0,0,0"},EPSG_6365:{towgs84:"0,0,0"},EPSG_5246:{towgs84:"0,0,0"},EPSG_7886:{towgs84:"0,0,0"},EPSG_8431:{towgs84:"0,0,0"},EPSG_8427:{towgs84:"0,0,0"},EPSG_8699:{towgs84:"0,0,0"},EPSG_8818:{towgs84:"0,0,0"},EPSG_4757:{towgs84:"0,0,0"},EPSG_9140:{towgs84:"0,0,0"},EPSG_8086:{towgs84:"0,0,0"},EPSG_4686:{towgs84:"0,0,0"},EPSG_4737:{towgs84:"0,0,0"},EPSG_4702:{towgs84:"0,0,0"},EPSG_4747:{towgs84:"0,0,0"},EPSG_4749:{towgs84:"0,0,0"},EPSG_4674:{towgs84:"0,0,0"},EPSG_4755:{towgs84:"0,0,0"},EPSG_4759:{towgs84:"0,0,0"},EPSG_4762:{towgs84:"0,0,0"},EPSG_4763:{towgs84:"0,0,0"},EPSG_4764:{towgs84:"0,0,0"},EPSG_4166:{towgs84:"0,0,0"},EPSG_4170:{towgs84:"0,0,0"},EPSG_5546:{towgs84:"0,0,0"},EPSG_7844:{towgs84:"0,0,0"},EPSG_4818:{towgs84:"589,76,480"}};for(var RM in Ja){var ih=Ja[RM];ih.datumName&&(Ja[ih.datumName]=ih)}function MM(i,t,e,n,s,r,a){var o={};return i===void 0||i==="none"?o.datum_type=$h:o.datum_type=NR,t&&(o.datum_params=t.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=wn),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=Tn,o.datum_params[3]*=xr,o.datum_params[4]*=xr,o.datum_params[5]*=xr,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=ps,o.grids=a),o.a=e,o.b=n,o.es=s,o.ep2=r,o}var Pu={};function CM(i,t,e){return t instanceof ArrayBuffer?bM(i,t,e):{ready:IM(i,t)}}function bM(i,t,e){var n=!0;e!==void 0&&e.includeErrorFields===!1&&(n=!1);var s=new DataView(t),r=LM(s),a=OM(s,r),o=FM(s,a,r,n),l={header:a,subgrids:o};return Pu[i]=l,l}async function IM(i,t){for(var e=[],n=await t.getImageCount(),s=n-1;s>=0;s--){var r=await t.getImage(s),a=await r.readRasters(),o=a,l=[r.getWidth(),r.getHeight()],h=r.getBoundingBox().map(Yd),c=[r.fileDirectory.ModelPixelScale[0],r.fileDirectory.ModelPixelScale[1]].map(Yd),u=h[0]+(l[0]-1)*c[0],f=h[3]-(l[1]-1)*c[1],_=o[0],g=o[1],x=[];for(let d=l[1]-1;d>=0;d--)for(let p=l[0]-1;p>=0;p--){var y=d*l[0]+p;x.push([-Xi(g[y]),Xi(_[y])])}e.push({del:c,lim:l,ll:[-u,f],cvs:x})}var w={header:{nSubgrids:n},subgrids:e};return Pu[i]=w,w}function AM(i){if(i===void 0)return null;var t=i.split(",");return t.map(PM)}function PM(i){if(i.length===0)return null;var t=i[0]==="@";return t&&(i=i.slice(1)),i==="null"?{name:"null",mandatory:!t,grid:null,isNull:!0}:{name:i,mandatory:!t,grid:Pu[i]||null,isNull:!1}}function Yd(i){return i*Math.PI/180}function Xi(i){return i/3600*Math.PI/180}function LM(i){var t=i.getInt32(8,!1);return t===11?!1:(t=i.getInt32(8,!0),t!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function OM(i,t){return{nFields:i.getInt32(8,t),nSubgridFields:i.getInt32(24,t),nSubgrids:i.getInt32(40,t),shiftType:Kh(i,56,64).trim(),fromSemiMajorAxis:i.getFloat64(120,t),fromSemiMinorAxis:i.getFloat64(136,t),toSemiMajorAxis:i.getFloat64(152,t),toSemiMinorAxis:i.getFloat64(168,t)}}function Kh(i,t,e){return String.fromCharCode.apply(null,new Uint8Array(i.buffer.slice(t,e)))}function FM(i,t,e,n){for(var s=176,r=[],a=0;a<t.nSubgrids;a++){var o=GM(i,s,e),l=NM(i,s,o,e,n),h=Math.round(1+(o.upperLongitude-o.lowerLongitude)/o.longitudeInterval),c=Math.round(1+(o.upperLatitude-o.lowerLatitude)/o.latitudeInterval);r.push({ll:[Xi(o.lowerLongitude),Xi(o.lowerLatitude)],del:[Xi(o.longitudeInterval),Xi(o.latitudeInterval)],lim:[h,c],count:o.gridNodeCount,cvs:DM(l)});var u=16;n===!1&&(u=8),s+=176+o.gridNodeCount*u}return r}function DM(i){return i.map(function(t){return[Xi(t.longitudeShift),Xi(t.latitudeShift)]})}function GM(i,t,e){return{name:Kh(i,t+8,t+16).trim(),parent:Kh(i,t+24,t+24+8).trim(),lowerLatitude:i.getFloat64(t+72,e),upperLatitude:i.getFloat64(t+88,e),lowerLongitude:i.getFloat64(t+104,e),upperLongitude:i.getFloat64(t+120,e),latitudeInterval:i.getFloat64(t+136,e),longitudeInterval:i.getFloat64(t+152,e),gridNodeCount:i.getInt32(t+168,e)}}function NM(i,t,e,n,s){var r=t+176,a=16;s===!1&&(a=8);for(var o=[],l=0;l<e.gridNodeCount;l++){var h={latitudeShift:i.getFloat32(r+l*a,n),longitudeShift:i.getFloat32(r+l*a+4,n)};s!==!1&&(h.latitudeAccuracy=i.getFloat32(r+l*a+8,n),h.longitudeAccuracy=i.getFloat32(r+l*a+12,n)),o.push(h)}return o}function $e(i,t){if(!(this instanceof $e))return new $e(i);this.forward=null,this.inverse=null,this.init=null,this.name,this.names=null,this.title,t=t||function(h){if(h)throw h};var e=hM(i);if(typeof e!="object"){t("Could not parse to valid json: "+i);return}var n=$e.projections.get(e.projName);if(!n){t("Could not get projection name from: "+i);return}if(e.datumCode&&e.datumCode!=="none"){var s=Yi(Ja,e.datumCode);s&&(e.datum_params=e.datum_params||(s.towgs84?s.towgs84.split(","):null),e.ellps=s.ellipse,e.datumName=s.datumName?s.datumName:e.datumCode)}e.k0=e.k0||1,e.axis=e.axis||"enu",e.ellps=e.ellps||"wgs84",e.lat1=e.lat1||e.lat0;var r=SM(e.a,e.b,e.rf,e.ellps,e.sphere),a=TM(r.a,r.b,r.rf,e.R_A),o=AM(e.nadgrids),l=e.datum||MM(e.datumCode,e.datum_params,r.a,r.b,a.es,a.ep2,o);Kd(this,e),Kd(this,n),this.a=r.a,this.b=r.b,this.rf=r.rf,this.sphere=r.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=l,"init"in this&&typeof this.init=="function"&&this.init(),t(null,this)}$e.projections=vM;$e.projections.start();function kM(i,t){return i.datum_type!==t.datum_type||i.a!==t.a||Math.abs(i.es-t.es)>5e-11?!1:i.datum_type===wn?i.datum_params[0]===t.datum_params[0]&&i.datum_params[1]===t.datum_params[1]&&i.datum_params[2]===t.datum_params[2]:i.datum_type===Tn?i.datum_params[0]===t.datum_params[0]&&i.datum_params[1]===t.datum_params[1]&&i.datum_params[2]===t.datum_params[2]&&i.datum_params[3]===t.datum_params[3]&&i.datum_params[4]===t.datum_params[4]&&i.datum_params[5]===t.datum_params[5]&&i.datum_params[6]===t.datum_params[6]:!0}function dm(i,t,e){var n=i.x,s=i.y,r=i.z?i.z:0,a,o,l,h;if(s<-X&&s>-1.001*X)s=-X;else if(s>X&&s<1.001*X)s=X;else{if(s<-X)return{x:-1/0,y:-1/0,z:i.z};if(s>X)return{x:1/0,y:1/0,z:i.z}}return n>Math.PI&&(n-=2*Math.PI),o=Math.sin(s),h=Math.cos(s),l=o*o,a=e/Math.sqrt(1-t*l),{x:(a+r)*h*Math.cos(n),y:(a+r)*h*Math.sin(n),z:(a*(1-t)+r)*o}}function gm(i,t,e,n){var s=1e-12,r=s*s,a=30,o,l,h,c,u,f,_,g,x,y,w,d,p,v=i.x,T=i.y,R=i.z?i.z:0,C,b,I;if(o=Math.sqrt(v*v+T*T),l=Math.sqrt(v*v+T*T+R*R),o/e<s){if(C=0,l/e<s)return b=X,I=-n,{x:i.x,y:i.y,z:i.z}}else C=Math.atan2(T,v);h=R/l,c=o/l,u=1/Math.sqrt(1-t*(2-t)*c*c),g=c*(1-t)*u,x=h*u,p=0;do p++,_=e/Math.sqrt(1-t*x*x),I=o*g+R*x-_*(1-t*x*x),f=t*_/(_+I),u=1/Math.sqrt(1-f*(2-f)*c*c),y=c*(1-f)*u,w=h*u,d=w*g-y*x,g=y,x=w;while(d*d>r&&p<a);return b=Math.atan(w/Math.abs(y)),{x:C,y:b,z:I}}function UM(i,t,e){if(t===wn)return{x:i.x+e[0],y:i.y+e[1],z:i.z+e[2]};if(t===Tn){var n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],l=e[5],h=e[6];return{x:h*(i.x-l*i.y+o*i.z)+n,y:h*(l*i.x+i.y-a*i.z)+s,z:h*(-o*i.x+a*i.y+i.z)+r}}}function BM(i,t,e){if(t===wn)return{x:i.x-e[0],y:i.y-e[1],z:i.z-e[2]};if(t===Tn){var n=e[0],s=e[1],r=e[2],a=e[3],o=e[4],l=e[5],h=e[6],c=(i.x-n)/h,u=(i.y-s)/h,f=(i.z-r)/h;return{x:c+l*u-o*f,y:-l*c+u+a*f,z:o*c-a*u+f}}}function ja(i){return i===wn||i===Tn}function zM(i,t,e){if(kM(i,t)||i.datum_type===$h||t.datum_type===$h)return e;var n=i.a,s=i.es;if(i.datum_type===ps){var r=Zd(i,!1,e);if(r!==0)return;n=Xd,s=jd}var a=t.a,o=t.b,l=t.es;if(t.datum_type===ps&&(a=Xd,o=kR,l=jd),s===l&&n===a&&!ja(i.datum_type)&&!ja(t.datum_type))return e;if(e=dm(e,s,n),ja(i.datum_type)&&(e=UM(e,i.datum_type,i.datum_params)),ja(t.datum_type)&&(e=BM(e,t.datum_type,t.datum_params)),e=gm(e,l,a,o),t.datum_type===ps){var h=Zd(t,!0,e);if(h!==0)return}return e}function Zd(i,t,e){if(i.grids===null||i.grids.length===0)return console.log("Grid shift grids not found"),-1;var n={x:-e.x,y:e.y},s={x:Number.NaN,y:Number.NaN},r=[];t:for(var a=0;a<i.grids.length;a++){var o=i.grids[a];if(r.push(o.name),o.isNull){s=n;break}if(o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var l=o.grid.subgrids,h=0,c=l.length;h<c;h++){var u=l[h],f=(Math.abs(u.del[1])+Math.abs(u.del[0]))/1e4,_=u.ll[0]-f,g=u.ll[1]-f,x=u.ll[0]+(u.lim[0]-1)*u.del[0]+f,y=u.ll[1]+(u.lim[1]-1)*u.del[1]+f;if(!(g>n.y||_>n.x||y<n.y||x<n.x)&&(s=XM(n,t,u),!isNaN(s.x)))break t}}return isNaN(s.x)?(console.log("Failed to find a grid shift table for location '"+-n.x*ni+" "+n.y*ni+" tried: '"+r+"'"),-1):(e.x=-s.x,e.y=s.y,0)}function XM(i,t,e){var n={x:Number.NaN,y:Number.NaN};if(isNaN(i.x))return n;var s={x:i.x,y:i.y};s.x-=e.ll[0],s.y-=e.ll[1],s.x=$(s.x-Math.PI)+Math.PI;var r=Qd(s,e);if(t){if(isNaN(r.x))return n;r.x=s.x-r.x,r.y=s.y-r.y;var a=9,o=1e-12,l,h;do{if(h=Qd(r,e),isNaN(h.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}l={x:s.x-(h.x+r.x),y:s.y-(h.y+r.y)},r.x+=l.x,r.y+=l.y}while(a--&&Math.abs(l.x)>o&&Math.abs(l.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),n;n.x=$(r.x+e.ll[0]),n.y=r.y+e.ll[1]}else isNaN(r.x)||(n.x=i.x+r.x,n.y=i.y+r.y);return n}function Qd(i,t){var e={x:i.x/t.del[0],y:i.y/t.del[1]},n={x:Math.floor(e.x),y:Math.floor(e.y)},s={x:e.x-1*n.x,y:e.y-1*n.y},r={x:Number.NaN,y:Number.NaN},a;if(n.x<0||n.x>=t.lim[0]||n.y<0||n.y>=t.lim[1])return r;a=n.y*t.lim[0]+n.x;var o={x:t.cvs[a][0],y:t.cvs[a][1]};a++;var l={x:t.cvs[a][0],y:t.cvs[a][1]};a+=t.lim[0];var h={x:t.cvs[a][0],y:t.cvs[a][1]};a--;var c={x:t.cvs[a][0],y:t.cvs[a][1]},u=s.x*s.y,f=s.x*(1-s.y),_=(1-s.x)*(1-s.y),g=(1-s.x)*s.y;return r.x=_*o.x+f*l.x+g*c.x+u*h.x,r.y=_*o.y+f*l.y+g*c.y+u*h.y,r}function Jd(i,t,e){var n=e.x,s=e.y,r=e.z||0,a,o,l,h={};for(l=0;l<3;l++)if(!(t&&l===2&&e.z===void 0))switch(l===0?(a=n,"ew".indexOf(i.axis[l])!==-1?o="x":o="y"):l===1?(a=s,"ns".indexOf(i.axis[l])!==-1?o="y":o="x"):(a=r,o="z"),i.axis[l]){case"e":h[o]=a;break;case"w":h[o]=-a;break;case"n":h[o]=a;break;case"s":h[o]=-a;break;case"u":e[o]!==void 0&&(h.z=a);break;case"d":e[o]!==void 0&&(h.z=-a);break;default:return null}return h}function _m(i){var t={x:i[0],y:i[1]};return i.length>2&&(t.z=i[2]),i.length>3&&(t.m=i[3]),t}function jM(i){tg(i.x),tg(i.y)}function tg(i){if(typeof Number.isFinite=="function"){if(Number.isFinite(i))return;throw new TypeError("coordinates must be finite numbers")}if(typeof i!="number"||i!==i||!isFinite(i))throw new TypeError("coordinates must be finite numbers")}function VM(i,t){return(i.datum.datum_type===wn||i.datum.datum_type===Tn||i.datum.datum_type===ps)&&t.datumCode!=="WGS84"||(t.datum.datum_type===wn||t.datum.datum_type===Tn||t.datum.datum_type===ps)&&i.datumCode!=="WGS84"}function Po(i,t,e,n){var s;Array.isArray(e)?e=_m(e):e={x:e.x,y:e.y,z:e.z,m:e.m};var r=e.z!==void 0;if(jM(e),i.datum&&t.datum&&VM(i,t)&&(s=new $e("WGS84"),e=Po(i,s,e,n),i=s),n&&i.axis!=="enu"&&(e=Jd(i,!1,e)),i.projName==="longlat")e={x:e.x*Ht,y:e.y*Ht,z:e.z||0};else if(i.to_meter&&(e={x:e.x*i.to_meter,y:e.y*i.to_meter,z:e.z||0}),e=i.inverse(e),!e)return;if(i.from_greenwich&&(e.x+=i.from_greenwich),e=zM(i.datum,t.datum,e),!!e)return e=e,t.from_greenwich&&(e={x:e.x-t.from_greenwich,y:e.y,z:e.z||0}),t.projName==="longlat"?e={x:e.x*ni,y:e.y*ni,z:e.z||0}:(e=t.forward(e),t.to_meter&&(e={x:e.x/t.to_meter,y:e.y/t.to_meter,z:e.z||0})),n&&t.axis!=="enu"?Jd(t,!0,e):(e&&!r&&delete e.z,e)}var eg=$e("WGS84");function nh(i,t,e,n){var s,r,a;return Array.isArray(e)?(s=Po(i,t,e,n)||{x:NaN,y:NaN},e.length>2?typeof i.name<"u"&&i.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"?typeof s.z=="number"?[s.x,s.y,s.z].concat(e.slice(3)):[s.x,s.y,e[2]].concat(e.slice(3)):[s.x,s.y].concat(e.slice(2)):[s.x,s.y]):(r=Po(i,t,e,n),a=Object.keys(e),a.length===2||a.forEach(function(o){if(typeof i.name<"u"&&i.name==="geocent"||typeof t.name<"u"&&t.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;r[o]=e[o]}),r)}function Va(i){return i instanceof $e?i:typeof i=="object"&&"oProj"in i?i.oProj:$e(i)}function $M(i,t,e){var n,s,r=!1,a;return typeof t>"u"?(s=Va(i),n=eg,r=!0):(typeof t.x<"u"||Array.isArray(t))&&(e=t,s=Va(i),n=eg,r=!0),n||(n=Va(i)),s||(s=Va(t)),e?nh(n,s,e):(a={forward:function(o,l){return nh(n,s,o,l)},inverse:function(o,l){return nh(s,n,o,l)}},r&&(a.oProj=s),a)}var ig=6,mm="AJSAJS",pm="AFAFAF",hs=65,de=73,Le=79,hr=86,cr=90;const WM={forward:ym,inverse:qM,toPoint:xm};function ym(i,t){return t=t||5,YM(KM({lat:i[1],lon:i[0]}),t)}function qM(i){var t=Lu(vm(i.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat,t.lon,t.lat]:[t.left,t.bottom,t.right,t.top]}function xm(i){var t=Lu(vm(i.toUpperCase()));return t.lat&&t.lon?[t.lon,t.lat]:[(t.left+t.right)/2,(t.top+t.bottom)/2]}function sh(i){return i*(Math.PI/180)}function ng(i){return 180*(i/Math.PI)}function KM(i){var t=i.lat,e=i.lon,n=6378137,s=.00669438,r=.9996,a,o,l,h,c,u,f,_=sh(t),g=sh(e),x,y;y=Math.floor((e+180)/6)+1,e===180&&(y=60),t>=56&&t<64&&e>=3&&e<12&&(y=32),t>=72&&t<84&&(e>=0&&e<9?y=31:e>=9&&e<21?y=33:e>=21&&e<33?y=35:e>=33&&e<42&&(y=37)),a=(y-1)*6-180+3,x=sh(a),o=s/(1-s),l=n/Math.sqrt(1-s*Math.sin(_)*Math.sin(_)),h=Math.tan(_)*Math.tan(_),c=o*Math.cos(_)*Math.cos(_),u=Math.cos(_)*(g-x),f=n*((1-s/4-3*s*s/64-5*s*s*s/256)*_-(3*s/8+3*s*s/32+45*s*s*s/1024)*Math.sin(2*_)+(15*s*s/256+45*s*s*s/1024)*Math.sin(4*_)-35*s*s*s/3072*Math.sin(6*_));var w=r*l*(u+(1-h+c)*u*u*u/6+(5-18*h+h*h+72*c-58*o)*u*u*u*u*u/120)+5e5,d=r*(f+l*Math.tan(_)*(u*u/2+(5-h+9*c+4*c*c)*u*u*u*u/24+(61-58*h+h*h+600*c-330*o)*u*u*u*u*u*u/720));return t<0&&(d+=1e7),{northing:Math.round(d),easting:Math.round(w),zoneNumber:y,zoneLetter:HM(t)}}function Lu(i){var t=i.northing,e=i.easting,n=i.zoneLetter,s=i.zoneNumber;if(s<0||s>60)return null;var r=.9996,a=6378137,o=.00669438,l,h=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),c,u,f,_,g,x,y,w,d,p=e-5e5,v=t;n<"N"&&(v-=1e7),y=(s-1)*6-180+3,l=o/(1-o),x=v/r,w=x/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),d=w+(3*h/2-27*h*h*h/32)*Math.sin(2*w)+(21*h*h/16-55*h*h*h*h/32)*Math.sin(4*w)+151*h*h*h/96*Math.sin(6*w),c=a/Math.sqrt(1-o*Math.sin(d)*Math.sin(d)),u=Math.tan(d)*Math.tan(d),f=l*Math.cos(d)*Math.cos(d),_=a*(1-o)/Math.pow(1-o*Math.sin(d)*Math.sin(d),1.5),g=p/(c*r);var T=d-c*Math.tan(d)/_*(g*g/2-(5+3*u+10*f-4*f*f-9*l)*g*g*g*g/24+(61+90*u+298*f+45*u*u-252*l-3*f*f)*g*g*g*g*g*g/720);T=ng(T);var R=(g-(1+2*u+f)*g*g*g/6+(5-2*f+28*u-3*f*f+8*l+24*u*u)*g*g*g*g*g/120)/Math.cos(d);R=y+ng(R);var C;if(i.accuracy){var b=Lu({northing:i.northing+i.accuracy,easting:i.easting+i.accuracy,zoneLetter:i.zoneLetter,zoneNumber:i.zoneNumber});C={top:b.lat,right:b.lon,bottom:T,left:R}}else C={lat:T,lon:R};return C}function HM(i){var t="Z";return 84>=i&&i>=72?t="X":72>i&&i>=64?t="W":64>i&&i>=56?t="V":56>i&&i>=48?t="U":48>i&&i>=40?t="T":40>i&&i>=32?t="S":32>i&&i>=24?t="R":24>i&&i>=16?t="Q":16>i&&i>=8?t="P":8>i&&i>=0?t="N":0>i&&i>=-8?t="M":-8>i&&i>=-16?t="L":-16>i&&i>=-24?t="K":-24>i&&i>=-32?t="J":-32>i&&i>=-40?t="H":-40>i&&i>=-48?t="G":-48>i&&i>=-56?t="F":-56>i&&i>=-64?t="E":-64>i&&i>=-72?t="D":-72>i&&i>=-80&&(t="C"),t}function YM(i,t){var e="00000"+i.easting,n="00000"+i.northing;return i.zoneNumber+i.zoneLetter+ZM(i.easting,i.northing,i.zoneNumber)+e.substr(e.length-5,t)+n.substr(n.length-5,t)}function ZM(i,t,e){var n=Em(e),s=Math.floor(i/1e5),r=Math.floor(t/1e5)%20;return QM(s,r,n)}function Em(i){var t=i%ig;return t===0&&(t=ig),t}function QM(i,t,e){var n=e-1,s=mm.charCodeAt(n),r=pm.charCodeAt(n),a=s+i-1,o=r+t,l=!1;a>cr&&(a=a-cr+hs-1,l=!0),(a===de||s<de&&a>de||(a>de||s<de)&&l)&&a++,(a===Le||s<Le&&a>Le||(a>Le||s<Le)&&l)&&(a++,a===de&&a++),a>cr&&(a=a-cr+hs-1),o>hr?(o=o-hr+hs-1,l=!0):l=!1,(o===de||r<de&&o>de||(o>de||r<de)&&l)&&o++,(o===Le||r<Le&&o>Le||(o>Le||r<Le)&&l)&&(o++,o===de&&o++),o>hr&&(o=o-hr+hs-1);var h=String.fromCharCode(a)+String.fromCharCode(o);return h}function vm(i){if(i&&i.length===0)throw"MGRSPoint coverting from nothing";for(var t=i.length,e=null,n="",s,r=0;!/[A-Z]/.test(s=i.charAt(r));){if(r>=2)throw"MGRSPoint bad conversion from: "+i;n+=s,r++}var a=parseInt(n,10);if(r===0||r+3>t)throw"MGRSPoint bad conversion from: "+i;var o=i.charAt(r++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+i;e=i.substring(r,r+=2);for(var l=Em(a),h=JM(e.charAt(0),l),c=tC(e.charAt(1),l);c<eC(o);)c+=2e6;var u=t-r;if(u%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+i;var f=u/2,_=0,g=0,x,y,w,d,p;return f>0&&(x=1e5/Math.pow(10,f),y=i.substring(r,r+f),_=parseFloat(y)*x,w=i.substring(r+f),g=parseFloat(w)*x),d=_+h,p=g+c,{easting:d,northing:p,zoneLetter:o,zoneNumber:a,accuracy:x}}function JM(i,t){for(var e=mm.charCodeAt(t-1),n=1e5,s=!1;e!==i.charCodeAt(0);){if(e++,e===de&&e++,e===Le&&e++,e>cr){if(s)throw"Bad character: "+i;e=hs,s=!0}n+=1e5}return n}function tC(i,t){if(i>"V")throw"MGRSPoint given invalid Northing "+i;for(var e=pm.charCodeAt(t-1),n=0,s=!1;e!==i.charCodeAt(0);){if(e++,e===de&&e++,e===Le&&e++,e>hr){if(s)throw"Bad character: "+i;e=hs,s=!0}n+=1e5}return n}function eC(i){var t;switch(i){case"C":t=11e5;break;case"D":t=2e6;break;case"E":t=28e5;break;case"F":t=37e5;break;case"G":t=46e5;break;case"H":t=55e5;break;case"J":t=64e5;break;case"K":t=73e5;break;case"L":t=82e5;break;case"M":t=91e5;break;case"N":t=0;break;case"P":t=8e5;break;case"Q":t=17e5;break;case"R":t=26e5;break;case"S":t=35e5;break;case"T":t=44e5;break;case"U":t=53e5;break;case"V":t=62e5;break;case"W":t=7e6;break;case"X":t=79e5;break;default:t=-1}if(t>=0)return t;throw"Invalid zone letter: "+i}function As(i,t,e){if(!(this instanceof As))return new As(i,t,e);if(Array.isArray(i))this.x=i[0],this.y=i[1],this.z=i[2]||0;else if(typeof i=="object")this.x=i.x,this.y=i.y,this.z=i.z||0;else if(typeof i=="string"&&typeof t>"u"){var n=i.split(",");this.x=parseFloat(n[0]),this.y=parseFloat(n[1]),this.z=parseFloat(n[2])||0}else this.x=i,this.y=t,this.z=e||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}As.fromMGRS=function(i){return new As(xm(i))};As.prototype.toMGRS=function(i){return ym([this.x,this.y],i)};var iC=1,nC=.25,sg=.046875,rg=.01953125,ag=.01068115234375,sC=.75,rC=.46875,aC=.013020833333333334,oC=.007120768229166667,lC=.3645833333333333,hC=.005696614583333333,cC=.3076171875;function Ou(i){var t=[];t[0]=iC-i*(nC+i*(sg+i*(rg+i*ag))),t[1]=i*(sC-i*(sg+i*(rg+i*ag)));var e=i*i;return t[2]=e*(rC-i*(aC+i*oC)),e*=i,t[3]=e*(lC-i*hC),t[4]=e*i*cC,t}function zs(i,t,e,n){return e*=t,t*=t,n[0]*i-e*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))}var uC=20;function Fu(i,t,e){for(var n=1/(1-t),s=i,r=uC;r;--r){var a=Math.sin(s),o=1-t*a*a;if(o=(zs(s,a,Math.cos(s),e)-i)*(o*Math.sqrt(o))*n,s-=o,Math.abs(o)<j)return s}return s}function fC(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=Ou(this.es),this.ml0=zs(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function dC(i){var t=i.x,e=i.y,n=$(t-this.long0),s,r,a,o=Math.sin(e),l=Math.cos(e);if(this.es){var c=l*n,u=Math.pow(c,2),f=this.ep2*Math.pow(l,2),_=Math.pow(f,2),g=Math.abs(l)>j?Math.tan(e):0,x=Math.pow(g,2),y=Math.pow(x,2);s=1-this.es*Math.pow(o,2),c=c/Math.sqrt(s);var w=zs(e,o,l,this.en);r=this.a*(this.k0*c*(1+u/6*(1-x+f+u/20*(5-18*x+y+14*f-58*x*f+u/42*(61+179*y-y*x-479*x)))))+this.x0,a=this.a*(this.k0*(w-this.ml0+o*n*c/2*(1+u/12*(5-x+9*f+4*_+u/30*(61+y-58*x+270*f-330*x*f+u/56*(1385+543*y-y*x-3111*x))))))+this.y0}else{var h=l*Math.sin(n);if(Math.abs(Math.abs(h)-1)<j)return 93;if(r=.5*this.a*this.k0*Math.log((1+h)/(1-h))+this.x0,a=l*Math.cos(n)/Math.sqrt(1-Math.pow(h,2)),h=Math.abs(a),h>=1){if(h-1>j)return 93;a=0}else a=Math.acos(a);e<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return i.x=r,i.y=a,i}function gC(i){var t,e,n,s,r=(i.x-this.x0)*(1/this.a),a=(i.y-this.y0)*(1/this.a);if(this.es)if(t=this.ml0+a/this.k0,e=Fu(t,this.es,this.en),Math.abs(e)<X){var u=Math.sin(e),f=Math.cos(e),_=Math.abs(f)>j?Math.tan(e):0,g=this.ep2*Math.pow(f,2),x=Math.pow(g,2),y=Math.pow(_,2),w=Math.pow(y,2);t=1-this.es*Math.pow(u,2);var d=r*Math.sqrt(t)/this.k0,p=Math.pow(d,2);t=t*_,n=e-t*p/(1-this.es)*.5*(1-p/12*(5+3*y-9*g*y+g-4*x-p/30*(61+90*y-252*g*y+45*w+46*g-p/56*(1385+3633*y+4095*w+1574*w*y)))),s=$(this.long0+d*(1-p/6*(1+2*y+g-p/20*(5+28*y+24*w+8*g*y+6*g-p/42*(61+662*y+1320*w+720*w*y))))/f)}else n=X*da(a),s=0;else{var o=Math.exp(r/this.k0),l=.5*(o-1/o),h=this.lat0+a/this.k0,c=Math.cos(h);t=Math.sqrt((1-Math.pow(c,2))/(1+Math.pow(l,2))),n=Math.asin(t),a<0&&(n=-n),l===0&&c===0?s=0:s=$(Math.atan2(l,c)+this.long0)}return i.x=s,i.y=n,i}var _C=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const to={init:fC,forward:dC,inverse:gC,names:_C};function wm(i){var t=Math.exp(i);return t=(t-1/t)/2,t}function ye(i,t){i=Math.abs(i),t=Math.abs(t);var e=Math.max(i,t),n=Math.min(i,t)/(e||1);return e*Math.sqrt(1+Math.pow(n,2))}function mC(i){var t=1+i,e=t-1;return e===0?i:i*Math.log(t)/e}function pC(i){var t=Math.abs(i);return t=mC(t*(1+t/(ye(1,t)+1))),i<0?-t:t}function Du(i,t){for(var e=2*Math.cos(2*t),n=i.length-1,s=i[n],r=0,a;--n>=0;)a=-r+e*s+i[n],r=s,s=a;return t+a*Math.sin(2*t)}function yC(i,t){for(var e=2*Math.cos(t),n=i.length-1,s=i[n],r=0,a;--n>=0;)a=-r+e*s+i[n],r=s,s=a;return Math.sin(t)*a}function xC(i){var t=Math.exp(i);return t=(t+1/t)/2,t}function Tm(i,t,e){for(var n=Math.sin(t),s=Math.cos(t),r=wm(e),a=xC(e),o=2*s*a,l=-2*n*r,h=i.length-1,c=i[h],u=0,f=0,_=0,g,x;--h>=0;)g=f,x=u,f=c,u=_,c=-g+o*f-l*u+i[h],_=-x+l*f+o*u;return o=n*a,l=s*r,[o*c-l*_,o*_+l*c]}function EC(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(to.init.apply(this),this.forward=to.forward,this.inverse=to.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var i=this.es/(1+Math.sqrt(1-this.es)),t=i/(2-i),e=t;this.cgb[0]=t*(2+t*(-2/3+t*(-2+t*(116/45+t*(26/45+t*(-2854/675)))))),this.cbg[0]=t*(-2+t*(2/3+t*(4/3+t*(-82/45+t*(32/45+t*(4642/4725)))))),e=e*t,this.cgb[1]=e*(7/3+t*(-8/5+t*(-227/45+t*(2704/315+t*(2323/945))))),this.cbg[1]=e*(5/3+t*(-16/15+t*(-13/9+t*(904/315+t*(-1522/945))))),e=e*t,this.cgb[2]=e*(56/15+t*(-136/35+t*(-1262/105+t*(73814/2835)))),this.cbg[2]=e*(-26/15+t*(34/21+t*(8/5+t*(-12686/2835)))),e=e*t,this.cgb[3]=e*(4279/630+t*(-332/35+t*(-399572/14175))),this.cbg[3]=e*(1237/630+t*(-12/5+t*(-24832/14175))),e=e*t,this.cgb[4]=e*(4174/315+t*(-144838/6237)),this.cbg[4]=e*(-734/315+t*(109598/31185)),e=e*t,this.cgb[5]=e*(601676/22275),this.cbg[5]=e*(444337/155925),e=Math.pow(t,2),this.Qn=this.k0/(1+t)*(1+e*(1/4+e*(1/64+e/256))),this.utg[0]=t*(-.5+t*(2/3+t*(-37/96+t*(1/360+t*(81/512+t*(-96199/604800)))))),this.gtu[0]=t*(.5+t*(-2/3+t*(5/16+t*(41/180+t*(-127/288+t*(7891/37800)))))),this.utg[1]=e*(-1/48+t*(-1/15+t*(437/1440+t*(-46/105+t*(1118711/3870720))))),this.gtu[1]=e*(13/48+t*(-3/5+t*(557/1440+t*(281/630+t*(-1983433/1935360))))),e=e*t,this.utg[2]=e*(-17/480+t*(37/840+t*(209/4480+t*(-5569/90720)))),this.gtu[2]=e*(61/240+t*(-103/140+t*(15061/26880+t*(167603/181440)))),e=e*t,this.utg[3]=e*(-4397/161280+t*(11/504+t*(830251/7257600))),this.gtu[3]=e*(49561/161280+t*(-179/168+t*(6601661/7257600))),e=e*t,this.utg[4]=e*(-4583/161280+t*(108847/3991680)),this.gtu[4]=e*(34729/80640+t*(-3418889/1995840)),e=e*t,this.utg[5]=e*(-20648693/638668800),this.gtu[5]=e*(212378941/319334400);var n=Du(this.cbg,this.lat0);this.Zb=-this.Qn*(n+yC(this.gtu,2*n))}function vC(i){var t=$(i.x-this.long0),e=i.y;e=Du(this.cbg,e);var n=Math.sin(e),s=Math.cos(e),r=Math.sin(t),a=Math.cos(t);e=Math.atan2(n,a*s),t=Math.atan2(r*s,ye(n,s*a)),t=pC(Math.tan(t));var o=Tm(this.gtu,2*e,2*t);e=e+o[0],t=t+o[1];var l,h;return Math.abs(t)<=2.623395162778?(l=this.a*(this.Qn*t)+this.x0,h=this.a*(this.Qn*e+this.Zb)+this.y0):(l=1/0,h=1/0),i.x=l,i.y=h,i}function wC(i){var t=(i.x-this.x0)*(1/this.a),e=(i.y-this.y0)*(1/this.a);e=(e-this.Zb)/this.Qn,t=t/this.Qn;var n,s;if(Math.abs(t)<=2.623395162778){var r=Tm(this.utg,2*e,2*t);e=e+r[0],t=t+r[1],t=Math.atan(wm(t));var a=Math.sin(e),o=Math.cos(e),l=Math.sin(t),h=Math.cos(t);e=Math.atan2(a*h,ye(l,h*o)),t=Math.atan2(l,h*o),n=$(t+this.long0),s=Du(this.cgb,e)}else n=1/0,s=1/0;return i.x=n,i.y=s,i}var TC=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const eo={init:EC,forward:vC,inverse:wC,names:TC};function SC(i,t){if(i===void 0){if(i=Math.floor(($(t)+Math.PI)*30/Math.PI)+1,i<0)return 0;if(i>60)return 60}return i}var RC="etmerc";function MC(){var i=SC(this.zone,this.long0);if(i===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(i)-183)*Ht,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,eo.init.apply(this),this.forward=eo.forward,this.inverse=eo.inverse}var CC=["Universal Transverse Mercator System","utm"];const bC={init:MC,names:CC,dependsOn:RC};function Gu(i,t){return Math.pow((1-i)/(1+i),t)}var IC=20;function AC(){var i=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t,this.rc=Math.sqrt(1-this.es)/(1-this.es*i*i),this.C=Math.sqrt(1+this.es*t*t/(1-this.es)),this.phic0=Math.asin(i/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+yt)/(Math.pow(Math.tan(.5*this.lat0+yt),this.C)*Gu(this.e*i,this.ratexp))}function PC(i){var t=i.x,e=i.y;return i.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*e+yt),this.C)*Gu(this.e*Math.sin(e),this.ratexp))-X,i.x=this.C*t,i}function LC(i){for(var t=1e-14,e=i.x/this.C,n=i.y,s=Math.pow(Math.tan(.5*n+yt)/this.K,1/this.C),r=IC;r>0&&(n=2*Math.atan(s*Gu(this.e*Math.sin(i.y),-.5*this.e))-X,!(Math.abs(n-i.y)<t));--r)i.y=n;return r?(i.x=e,i.y=n,i):null}const Nu={init:AC,forward:PC,inverse:LC};function OC(){Nu.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function FC(i){var t,e,n,s;return i.x=$(i.x-this.long0),Nu.forward.apply(this,[i]),t=Math.sin(i.y),e=Math.cos(i.y),n=Math.cos(i.x),s=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*e*n),i.x=s*e*Math.sin(i.x),i.y=s*(this.cosc0*t-this.sinc0*e*n),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function DC(i){var t,e,n,s,r;if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,r=ye(i.x,i.y)){var a=2*Math.atan2(r,this.R2);t=Math.sin(a),e=Math.cos(a),s=Math.asin(e*this.sinc0+i.y*t*this.cosc0/r),n=Math.atan2(i.x*t,r*this.cosc0*e-i.y*this.sinc0*t)}else s=this.phic0,n=0;return i.x=n,i.y=s,Nu.inverse.apply(this,[i]),i.x=$(i.x+this.long0),i}var GC=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const NC={init:OC,forward:FC,inverse:DC,names:GC};function ku(i,t,e){return t*=e,Math.tan(.5*(X+i))*Math.pow((1-t)/(1+t),.5*e)}function kC(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=j&&(this.k0=.5*(1+da(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=j&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=j&&Math.abs(Math.cos(this.lat_ts))>j&&(this.k0=.5*this.cons*hi(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Ve(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=hi(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(ku(this.lat0,this.sinlat0,this.e))-X,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function UC(i){var t=i.x,e=i.y,n=Math.sin(e),s=Math.cos(e),r,a,o,l,h,c,u=$(t-this.long0);return Math.abs(Math.abs(t-this.long0)-Math.PI)<=j&&Math.abs(e+this.lat0)<=j?(i.x=NaN,i.y=NaN,i):this.sphere?(r=2*this.k0/(1+this.sinlat0*n+this.coslat0*s*Math.cos(u)),i.x=this.a*r*s*Math.sin(u)+this.x0,i.y=this.a*r*(this.coslat0*n-this.sinlat0*s*Math.cos(u))+this.y0,i):(a=2*Math.atan(ku(e,n,this.e))-X,l=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=j?(h=Ve(this.e,e*this.con,this.con*n),c=2*this.a*this.k0*h/this.cons,i.x=this.x0+c*Math.sin(t-this.long0),i.y=this.y0-this.con*c*Math.cos(t-this.long0),i):(Math.abs(this.sinlat0)<j?(r=2*this.a*this.k0/(1+l*Math.cos(u)),i.y=r*o):(r=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*l*Math.cos(u))),i.y=r*(this.cosX0*o-this.sinX0*l*Math.cos(u))+this.y0),i.x=r*l*Math.sin(u)+this.x0,i))}function BC(i){i.x-=this.x0,i.y-=this.y0;var t,e,n,s,r,a=Math.sqrt(i.x*i.x+i.y*i.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return t=this.long0,e=this.lat0,a<=j?(i.x=t,i.y=e,i):(e=Math.asin(Math.cos(o)*this.sinlat0+i.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<j?this.lat0>0?t=$(this.long0+Math.atan2(i.x,-1*i.y)):t=$(this.long0+Math.atan2(i.x,i.y)):t=$(this.long0+Math.atan2(i.x*Math.sin(o),a*this.coslat0*Math.cos(o)-i.y*this.sinlat0*Math.sin(o))),i.x=t,i.y=e,i)}else if(Math.abs(this.coslat0)<=j){if(a<=j)return e=this.lat0,t=this.long0,i.x=t,i.y=e,i;i.x*=this.con,i.y*=this.con,n=a*this.cons/(2*this.a*this.k0),e=this.con*Vr(this.e,n),t=this.con*$(this.con*this.long0+Math.atan2(i.x,-1*i.y))}else s=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),t=this.long0,a<=j?r=this.X0:(r=Math.asin(Math.cos(s)*this.sinX0+i.y*Math.sin(s)*this.cosX0/a),t=$(this.long0+Math.atan2(i.x*Math.sin(s),a*this.cosX0*Math.cos(s)-i.y*this.sinX0*Math.sin(s)))),e=-1*Vr(this.e,Math.tan(.5*(X+r)));return i.x=t,i.y=e,i}var zC=["stere","Stereographic_South_Pole","Polar_Stereographic_variant_A","Polar_Stereographic_variant_B","Polar_Stereographic"];const XC={init:kC,forward:UC,inverse:BC,names:zC,ssfn_:ku};function jC(){var i=this.lat0;this.lambda0=this.long0;var t=Math.sin(i),e=this.a,n=this.rf,s=1/n,r=2*s-Math.pow(s,2),a=this.e=Math.sqrt(r);this.R=this.k0*e*Math.sqrt(1-r)/(1-r*Math.pow(t,2)),this.alpha=Math.sqrt(1+r/(1-r)*Math.pow(Math.cos(i),4)),this.b0=Math.asin(t/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),l=Math.log(Math.tan(Math.PI/4+i/2)),h=Math.log((1+a*t)/(1-a*t));this.K=o-this.alpha*l+this.alpha*a/2*h}function VC(i){var t=Math.log(Math.tan(Math.PI/4-i.y/2)),e=this.e/2*Math.log((1+this.e*Math.sin(i.y))/(1-this.e*Math.sin(i.y))),n=-this.alpha*(t+e)+this.K,s=2*(Math.atan(Math.exp(n))-Math.PI/4),r=this.alpha*(i.x-this.lambda0),a=Math.atan(Math.sin(r)/(Math.sin(this.b0)*Math.tan(s)+Math.cos(this.b0)*Math.cos(r))),o=Math.asin(Math.cos(this.b0)*Math.sin(s)-Math.sin(this.b0)*Math.cos(s)*Math.cos(r));return i.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,i.x=this.R*a+this.x0,i}function $C(i){for(var t=i.x-this.x0,e=i.y-this.y0,n=t/this.R,s=2*(Math.atan(Math.exp(e/this.R))-Math.PI/4),r=Math.asin(Math.cos(this.b0)*Math.sin(s)+Math.sin(this.b0)*Math.cos(s)*Math.cos(n)),a=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(s))),o=this.lambda0+a/this.alpha,l=0,h=r,c=-1e3,u=0;Math.abs(h-c)>1e-7;){if(++u>20)return;l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+r/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(h))/2)),c=h,h=2*Math.atan(Math.exp(l))-Math.PI/2}return i.x=o,i.y=h,i}var WC=["somerc"];const qC={init:jC,forward:VC,inverse:$C,names:WC};var ts=1e-7;function KC(i){var t=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],e=typeof i.projName=="object"?Object.keys(i.projName)[0]:i.projName;return"no_uoff"in i||"no_off"in i||t.indexOf(e)!==-1||t.indexOf(um(e))!==-1}function HC(){var i,t,e,n,s,r,a,o,l,h,c=0,u,f=0,_=0,g=0,x=0,y=0,w=0;this.no_off=KC(this),this.no_rot="no_rot"in this;var d=!1;"alpha"in this&&(d=!0);var p=!1;if("rectified_grid_angle"in this&&(p=!0),d&&(w=this.alpha),p&&(c=this.rectified_grid_angle),d||p)f=this.longc;else if(_=this.long1,x=this.lat1,g=this.long2,y=this.lat2,Math.abs(x-y)<=ts||(i=Math.abs(x))<=ts||Math.abs(i-X)<=ts||Math.abs(Math.abs(this.lat0)-X)<=ts||Math.abs(Math.abs(y)-X)<=ts)throw new Error;var v=1-this.es;t=Math.sqrt(v),Math.abs(this.lat0)>j?(o=Math.sin(this.lat0),e=Math.cos(this.lat0),i=1-this.es*o*o,this.B=e*e,this.B=Math.sqrt(1+this.es*this.B*this.B/v),this.A=this.B*this.k0*t/i,n=this.B*t/(e*Math.sqrt(i)),s=n*n-1,s<=0?s=0:(s=Math.sqrt(s),this.lat0<0&&(s=-s)),this.E=s+=n,this.E*=Math.pow(Ve(this.e,this.lat0,o),this.B)):(this.B=1/t,this.A=this.k0,this.E=n=s=1),d||p?(d?(u=Math.asin(Math.sin(w)/n),p||(c=w)):(u=c,w=Math.asin(n*Math.sin(u))),this.lam0=f-Math.asin(.5*(s-1/s)*Math.tan(u))/this.B):(r=Math.pow(Ve(this.e,x,Math.sin(x)),this.B),a=Math.pow(Ve(this.e,y,Math.sin(y)),this.B),s=this.E/r,l=(a-r)/(a+r),h=this.E*this.E,h=(h-a*r)/(h+a*r),i=_-g,i<-Math.PI?g-=Xr:i>Math.PI&&(g+=Xr),this.lam0=$(.5*(_+g)-Math.atan(h*Math.tan(.5*this.B*(_-g))/l)/this.B),u=Math.atan(2*Math.sin(this.B*$(_-this.lam0))/(s-1/s)),c=w=Math.asin(n*Math.sin(u))),this.singam=Math.sin(u),this.cosgam=Math.cos(u),this.sinrot=Math.sin(c),this.cosrot=Math.cos(c),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(n*n-1)/Math.cos(w))),this.lat0<0&&(this.u_0=-this.u_0)),s=.5*u,this.v_pole_n=this.ArB*Math.log(Math.tan(yt-s)),this.v_pole_s=this.ArB*Math.log(Math.tan(yt+s))}function YC(i){var t={},e,n,s,r,a,o,l,h;if(i.x=i.x-this.lam0,Math.abs(Math.abs(i.y)-X)>j){if(a=this.E/Math.pow(Ve(this.e,i.y,Math.sin(i.y)),this.B),o=1/a,e=.5*(a-o),n=.5*(a+o),r=Math.sin(this.B*i.x),s=(e*this.singam-r*this.cosgam)/n,Math.abs(Math.abs(s)-1)<j)throw new Error;h=.5*this.ArB*Math.log((1-s)/(1+s)),o=Math.cos(this.B*i.x),Math.abs(o)<ts?l=this.A*i.x:l=this.ArB*Math.atan2(e*this.cosgam+r*this.singam,o)}else h=i.y>0?this.v_pole_n:this.v_pole_s,l=this.ArB*i.y;return this.no_rot?(t.x=l,t.y=h):(l-=this.u_0,t.x=h*this.cosrot+l*this.sinrot,t.y=l*this.cosrot-h*this.sinrot),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t}function ZC(i){var t,e,n,s,r,a,o,l={};if(i.x=(i.x-this.x0)*(1/this.a),i.y=(i.y-this.y0)*(1/this.a),this.no_rot?(e=i.y,t=i.x):(e=i.x*this.cosrot-i.y*this.sinrot,t=i.y*this.cosrot+i.x*this.sinrot+this.u_0),n=Math.exp(-this.BrA*e),s=.5*(n-1/n),r=.5*(n+1/n),a=Math.sin(this.BrA*t),o=(a*this.cosgam+s*this.singam)/r,Math.abs(Math.abs(o)-1)<j)l.x=0,l.y=o<0?-X:X;else{if(l.y=this.E/Math.sqrt((1+o)/(1-o)),l.y=Vr(this.e,Math.pow(l.y,1/this.B)),l.y===1/0)throw new Error;l.x=-this.rB*Math.atan2(s*this.cosgam-a*this.singam,Math.cos(this.BrA*t))}return l.x+=this.lam0,l}var QC=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_variant_A","Hotine_Oblique_Mercator_Variant_B","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const JC={init:HC,forward:YC,inverse:ZC,names:QC};function tb(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<j)){var i=this.b/this.a;this.e=Math.sqrt(1-i*i);var t=Math.sin(this.lat1),e=Math.cos(this.lat1),n=hi(this.e,t,e),s=Ve(this.e,this.lat1,t),r=Math.sin(this.lat2),a=Math.cos(this.lat2),o=hi(this.e,r,a),l=Ve(this.e,this.lat2,r),h=Math.abs(Math.abs(this.lat0)-X)<j?0:Ve(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>j?this.ns=Math.log(n/o)/Math.log(s/l):this.ns=t,isNaN(this.ns)&&(this.ns=t),this.f0=n/(this.ns*Math.pow(s,this.ns)),this.rh=this.a*this.f0*Math.pow(h,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function eb(i){var t=i.x,e=i.y;Math.abs(2*Math.abs(e)-Math.PI)<=j&&(e=da(e)*(X-2*j));var n=Math.abs(Math.abs(e)-X),s,r;if(n>j)s=Ve(this.e,e,Math.sin(e)),r=this.a*this.f0*Math.pow(s,this.ns);else{if(n=e*this.ns,n<=0)return null;r=0}var a=this.ns*$(t-this.long0);return i.x=this.k0*(r*Math.sin(a))+this.x0,i.y=this.k0*(this.rh-r*Math.cos(a))+this.y0,i}function ib(i){var t,e,n,s,r,a=(i.x-this.x0)/this.k0,o=this.rh-(i.y-this.y0)/this.k0;this.ns>0?(t=Math.sqrt(a*a+o*o),e=1):(t=-Math.sqrt(a*a+o*o),e=-1);var l=0;if(t!==0&&(l=Math.atan2(e*a,e*o)),t!==0||this.ns>0){if(e=1/this.ns,n=Math.pow(t/(this.a*this.f0),e),s=Vr(this.e,n),s===-9999)return null}else s=-X;return r=$(l/this.ns+this.long0),i.x=r,i.y=s,i}var nb=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const sb={init:tb,forward:eb,inverse:ib,names:nb};function rb(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function ab(i){var t,e,n,s,r,a,o,l=i.x,h=i.y,c=$(l-this.long0);return t=Math.pow((1+this.e*Math.sin(h))/(1-this.e*Math.sin(h)),this.alfa*this.e/2),e=2*(Math.atan(this.k*Math.pow(Math.tan(h/2+this.s45),this.alfa)/t)-this.s45),n=-c*this.alfa,s=Math.asin(Math.cos(this.ad)*Math.sin(e)+Math.sin(this.ad)*Math.cos(e)*Math.cos(n)),r=Math.asin(Math.cos(e)*Math.sin(n)/Math.cos(s)),a=this.n*r,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(s/2+this.s45),this.n),i.y=o*Math.cos(a)/1,i.x=o*Math.sin(a)/1,this.czech||(i.y*=-1,i.x*=-1),i}function ob(i){var t,e,n,s,r,a,o,l,h=i.x;i.x=i.y,i.y=h,this.czech||(i.y*=-1,i.x*=-1),a=Math.sqrt(i.x*i.x+i.y*i.y),r=Math.atan2(i.y,i.x),s=r/Math.sin(this.s0),n=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(s)),e=Math.asin(Math.cos(n)*Math.sin(s)/Math.cos(t)),i.x=this.long0-e/this.alfa,o=t,l=0;var c=0;do i.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-i.y)<1e-10&&(l=1),o=i.y,c+=1;while(l===0&&c<15);return c>=15?null:i}var lb=["Krovak","krovak"];const hb={init:rb,forward:ab,inverse:ob,names:lb};function ce(i,t,e,n,s){return i*s-t*Math.sin(2*s)+e*Math.sin(4*s)-n*Math.sin(6*s)}function ga(i){return 1-.25*i*(1+i/16*(3+1.25*i))}function _a(i){return .375*i*(1+.25*i*(1+.46875*i))}function ma(i){return .05859375*i*i*(1+.75*i)}function pa(i){return i*i*i*(35/3072)}function Uu(i,t,e){var n=t*e;return i/Math.sqrt(1-n*n)}function nn(i){return Math.abs(i)<X?i:i-da(i)*Math.PI}function Lo(i,t,e,n,s){var r,a;r=i/t;for(var o=0;o<15;o++)if(a=(i-(t*r-e*Math.sin(2*r)+n*Math.sin(4*r)-s*Math.sin(6*r)))/(t-2*e*Math.cos(2*r)+4*n*Math.cos(4*r)-6*s*Math.cos(6*r)),r+=a,Math.abs(a)<=1e-10)return r;return NaN}function cb(){this.sphere||(this.e0=ga(this.es),this.e1=_a(this.es),this.e2=ma(this.es),this.e3=pa(this.es),this.ml0=this.a*ce(this.e0,this.e1,this.e2,this.e3,this.lat0))}function ub(i){var t,e,n=i.x,s=i.y;if(n=$(n-this.long0),this.sphere)t=this.a*Math.asin(Math.cos(s)*Math.sin(n)),e=this.a*(Math.atan2(Math.tan(s),Math.cos(n))-this.lat0);else{var r=Math.sin(s),a=Math.cos(s),o=Uu(this.a,this.e,r),l=Math.tan(s)*Math.tan(s),h=n*Math.cos(s),c=h*h,u=this.es*a*a/(1-this.es),f=this.a*ce(this.e0,this.e1,this.e2,this.e3,s);t=o*h*(1-c*l*(1/6-(8-l+8*u)*c/120)),e=f-this.ml0+o*r/a*c*(.5+(5-l+6*u)*c/24)}return i.x=t+this.x0,i.y=e+this.y0,i}function fb(i){i.x-=this.x0,i.y-=this.y0;var t=i.x/this.a,e=i.y/this.a,n,s;if(this.sphere){var r=e+this.lat0;n=Math.asin(Math.sin(r)*Math.cos(t)),s=Math.atan2(Math.tan(t),Math.cos(r))}else{var a=this.ml0/this.a+e,o=Lo(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-X)<=j)return i.x=this.long0,i.y=X,e<0&&(i.y*=-1),i;var l=Uu(this.a,this.e,Math.sin(o)),h=l*l*l/this.a/this.a*(1-this.es),c=Math.pow(Math.tan(o),2),u=t*this.a/l,f=u*u;n=o-l*Math.tan(o)/h*u*u*(.5-(1+3*c)*u*u/24),s=u*(1-f*(c/3+(1+3*c)*c*f/15))/Math.cos(o)}return i.x=$(s+this.long0),i.y=nn(n),i}var db=["Cassini","Cassini_Soldner","cass"];const gb={init:cb,forward:ub,inverse:fb,names:db};function Wi(i,t){var e;return i>1e-7?(e=i*t,(1-i*i)*(t/(1-e*e)-.5/i*Math.log((1-e)/(1+e)))):2*t}var Hh=1,Yh=2,Zh=3,io=4;function _b(){var i=Math.abs(this.lat0);if(Math.abs(i-X)<j?this.mode=this.lat0<0?Hh:Yh:Math.abs(i)<j?this.mode=Zh:this.mode=io,this.es>0){var t;switch(this.qp=Wi(this.e,1),this.mmf=.5/(1-this.es),this.apa=Sb(this.es),this.mode){case Yh:this.dd=1;break;case Hh:this.dd=1;break;case Zh:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case io:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=Wi(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===io&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function mb(i){var t,e,n,s,r,a,o,l,h,c,u=i.x,f=i.y;if(u=$(u-this.long0),this.sphere){if(r=Math.sin(f),c=Math.cos(f),n=Math.cos(u),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e=this.mode===this.EQUIT?1+c*n:1+this.sinph0*r+this.cosph0*c*n,e<=j)return null;e=Math.sqrt(2/e),t=e*c*Math.sin(u),e*=this.mode===this.EQUIT?r:this.cosph0*r-this.sinph0*c*n}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(n=-n),Math.abs(f+this.lat0)<j)return null;e=yt-f*.5,e=2*(this.mode===this.S_POLE?Math.cos(e):Math.sin(e)),t=e*Math.sin(u),e*=n}}else{switch(o=0,l=0,h=0,n=Math.cos(u),s=Math.sin(u),r=Math.sin(f),a=Wi(this.e,r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,l=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:h=1+this.sinb1*o+this.cosb1*l*n;break;case this.EQUIT:h=1+l*n;break;case this.N_POLE:h=X+f,a=this.qp-a;break;case this.S_POLE:h=f-X,a=this.qp+a;break}if(Math.abs(h)<j)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h),this.mode===this.OBLIQ?e=this.ymf*h*(this.cosb1*o-this.sinb1*l*n):e=(h=Math.sqrt(2/(1+l*n)))*o*this.ymf,t=this.xmf*h*l*s;break;case this.N_POLE:case this.S_POLE:a>=0?(t=(h=Math.sqrt(a))*s,e=n*(this.mode===this.S_POLE?h:-h)):t=e=0;break}}return i.x=this.a*t+this.x0,i.y=this.a*e+this.y0,i}function pb(i){i.x-=this.x0,i.y-=this.y0;var t=i.x/this.a,e=i.y/this.a,n,s,r,a,o,l,h;if(this.sphere){var c=0,u,f=0;if(u=Math.sqrt(t*t+e*e),s=u*.5,s>1)return null;switch(s=2*Math.asin(s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(f=Math.sin(s),c=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(u)<=j?0:Math.asin(e*f/u),t*=f,e=c*u;break;case this.OBLIQ:s=Math.abs(u)<=j?this.lat0:Math.asin(c*this.sinph0+e*f*this.cosph0/u),t*=f*this.cosph0,e=(c-Math.sin(s)*this.sinph0)*u;break;case this.N_POLE:e=-e,s=X-s;break;case this.S_POLE:s-=X;break}n=e===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(t,e)}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t/=this.dd,e*=this.dd,l=Math.sqrt(t*t+e*e),l<j)return i.x=this.long0,i.y=this.lat0,i;a=2*Math.asin(.5*l/this.rq),r=Math.cos(a),t*=a=Math.sin(a),this.mode===this.OBLIQ?(h=r*this.sinb1+e*a*this.cosb1/l,o=this.qp*h,e=l*this.cosb1*r-e*this.sinb1*a):(h=e*a/l,o=this.qp*h,e=l*r)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),o=t*t+e*e,!o)return i.x=this.long0,i.y=this.lat0,i;h=1-o/this.qp,this.mode===this.S_POLE&&(h=-h)}n=Math.atan2(t,e),s=Rb(Math.asin(h),this.apa)}return i.x=$(this.long0+n),i.y=s,i}var yb=.3333333333333333,xb=.17222222222222222,Eb=.10257936507936508,vb=.06388888888888888,wb=.0664021164021164,Tb=.016415012942191543;function Sb(i){var t,e=[];return e[0]=i*yb,t=i*i,e[0]+=t*xb,e[1]=t*vb,t*=i,e[0]+=t*Eb,e[1]+=t*wb,e[2]=t*Tb,e}function Rb(i,t){var e=i+i;return i+t[0]*Math.sin(e)+t[1]*Math.sin(e+e)+t[2]*Math.sin(e+e+e)}var Mb=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const Cb={init:_b,forward:mb,inverse:pb,names:Mb,S_POLE:Hh,N_POLE:Yh,EQUIT:Zh,OBLIQ:io};function Zi(i){return Math.abs(i)>1&&(i=i>1?1:-1),Math.asin(i)}function bb(){Math.abs(this.lat1+this.lat2)<j||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=hi(this.e3,this.sin_po,this.cos_po),this.qs1=Wi(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=hi(this.e3,this.sin_po,this.cos_po),this.qs2=Wi(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=Wi(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>j?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function Ib(i){var t=i.x,e=i.y;this.sin_phi=Math.sin(e),this.cos_phi=Math.cos(e);var n=Wi(this.e3,this.sin_phi),s=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,r=this.ns0*$(t-this.long0),a=s*Math.sin(r)+this.x0,o=this.rh-s*Math.cos(r)+this.y0;return i.x=a,i.y=o,i}function Ab(i){var t,e,n,s,r,a;return i.x-=this.x0,i.y=this.rh-i.y+this.y0,this.ns0>=0?(t=Math.sqrt(i.x*i.x+i.y*i.y),n=1):(t=-Math.sqrt(i.x*i.x+i.y*i.y),n=-1),s=0,t!==0&&(s=Math.atan2(n*i.x,n*i.y)),n=t*this.ns0/this.a,this.sphere?a=Math.asin((this.c-n*n)/(2*this.ns0)):(e=(this.c-n*n)/this.ns0,a=this.phi1z(this.e3,e)),r=$(s/this.ns0+this.long0),i.x=r,i.y=a,i}function Pb(i,t){var e,n,s,r,a,o=Zi(.5*t);if(i<j)return o;for(var l=i*i,h=1;h<=25;h++)if(e=Math.sin(o),n=Math.cos(o),s=i*e,r=1-s*s,a=.5*r*r/n*(t/(1-l)-e/r+.5/i*Math.log((1-s)/(1+s))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var Lb=["Albers_Conic_Equal_Area","Albers_Equal_Area","Albers","aea"];const Ob={init:bb,forward:Ib,inverse:Ab,names:Lb,phi1z:Pb};function Fb(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function Db(i){var t,e,n,s,r,a,o,l,h=i.x,c=i.y;return n=$(h-this.long0),t=Math.sin(c),e=Math.cos(c),s=Math.cos(n),a=this.sin_p14*t+this.cos_p14*e*s,r=1,a>0||Math.abs(a)<=j?(o=this.x0+this.a*r*e*Math.sin(n)/a,l=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*e*s)/a):(o=this.x0+this.infinity_dist*e*Math.sin(n),l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*e*s)),i.x=o,i.y=l,i}function Gb(i){var t,e,n,s,r,a;return i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,i.x/=this.k0,i.y/=this.k0,(t=Math.sqrt(i.x*i.x+i.y*i.y))?(s=Math.atan2(t,this.rc),e=Math.sin(s),n=Math.cos(s),a=Zi(n*this.sin_p14+i.y*e*this.cos_p14/t),r=Math.atan2(i.x*e,t*this.cos_p14*n-i.y*this.sin_p14*e),r=$(this.long0+r)):(a=this.phic0,r=0),i.x=r,i.y=a,i}var Nb=["gnom"];const kb={init:Fb,forward:Db,inverse:Gb,names:Nb};function Ub(i,t){var e=1-(1-i*i)/(2*i)*Math.log((1-i)/(1+i));if(Math.abs(Math.abs(t)-e)<1e-6)return t<0?-1*X:X;for(var n=Math.asin(.5*t),s,r,a,o,l=0;l<30;l++)if(r=Math.sin(n),a=Math.cos(n),o=i*r,s=Math.pow(1-o*o,2)/(2*a)*(t/(1-i*i)-r/(1-o*o)+.5/i*Math.log((1-o)/(1+o))),n+=s,Math.abs(s)<=1e-10)return n;return NaN}function Bb(){this.sphere||(this.k0=hi(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function zb(i){var t=i.x,e=i.y,n,s,r=$(t-this.long0);if(this.sphere)n=this.x0+this.a*r*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(e)/Math.cos(this.lat_ts);else{var a=Wi(this.e,Math.sin(e));n=this.x0+this.a*this.k0*r,s=this.y0+this.a*a*.5/this.k0}return i.x=n,i.y=s,i}function Xb(i){i.x-=this.x0,i.y-=this.y0;var t,e;return this.sphere?(t=$(this.long0+i.x/this.a/Math.cos(this.lat_ts)),e=Math.asin(i.y/this.a*Math.cos(this.lat_ts))):(e=Ub(this.e,2*i.y*this.k0/this.a),t=$(this.long0+i.x/(this.a*this.k0))),i.x=t,i.y=e,i}var jb=["cea"];const Vb={init:Bb,forward:zb,inverse:Xb,names:jb};function $b(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function Wb(i){var t=i.x,e=i.y,n=$(t-this.long0),s=nn(e-this.lat0);return i.x=this.x0+this.a*n*this.rc,i.y=this.y0+this.a*s,i}function qb(i){var t=i.x,e=i.y;return i.x=$(this.long0+(t-this.x0)/(this.a*this.rc)),i.y=nn(this.lat0+(e-this.y0)/this.a),i}var Kb=["Equirectangular","Equidistant_Cylindrical","Equidistant_Cylindrical_Spherical","eqc"];const Hb={init:$b,forward:Wb,inverse:qb,names:Kb};var og=20;function Yb(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ga(this.es),this.e1=_a(this.es),this.e2=ma(this.es),this.e3=pa(this.es),this.ml0=this.a*ce(this.e0,this.e1,this.e2,this.e3,this.lat0)}function Zb(i){var t=i.x,e=i.y,n,s,r,a=$(t-this.long0);if(r=a*Math.sin(e),this.sphere)Math.abs(e)<=j?(n=this.a*a,s=-1*this.a*this.lat0):(n=this.a*Math.sin(r)/Math.tan(e),s=this.a*(nn(e-this.lat0)+(1-Math.cos(r))/Math.tan(e)));else if(Math.abs(e)<=j)n=this.a*a,s=-1*this.ml0;else{var o=Uu(this.a,this.e,Math.sin(e))/Math.tan(e);n=o*Math.sin(r),s=this.a*ce(this.e0,this.e1,this.e2,this.e3,e)-this.ml0+o*(1-Math.cos(r))}return i.x=n+this.x0,i.y=s+this.y0,i}function Qb(i){var t,e,n,s,r,a,o,l,h;if(n=i.x-this.x0,s=i.y-this.y0,this.sphere)if(Math.abs(s+this.a*this.lat0)<=j)t=$(n/this.a+this.long0),e=0;else{a=this.lat0+s/this.a,o=n*n/this.a/this.a+a*a,l=a;var c;for(r=og;r;--r)if(c=Math.tan(l),h=-1*(a*(l*c+1)-l-.5*(l*l+o)*c)/((l-a)/c-1),l+=h,Math.abs(h)<=j){e=l;break}t=$(this.long0+Math.asin(n*Math.tan(l)/this.a)/Math.sin(e))}else if(Math.abs(s+this.ml0)<=j)e=0,t=$(this.long0+n/this.a);else{a=(this.ml0+s)/this.a,o=n*n/this.a/this.a+a*a,l=a;var u,f,_,g,x;for(r=og;r;--r)if(x=this.e*Math.sin(l),u=Math.sqrt(1-x*x)*Math.tan(l),f=this.a*ce(this.e0,this.e1,this.e2,this.e3,l),_=this.e0-2*this.e1*Math.cos(2*l)+4*this.e2*Math.cos(4*l)-6*this.e3*Math.cos(6*l),g=f/this.a,h=(a*(u*g+1)-g-.5*u*(g*g+o))/(this.es*Math.sin(2*l)*(g*g+o-2*a*g)/(4*u)+(a-g)*(u*_-2/Math.sin(2*l))-_),l-=h,Math.abs(h)<=j){e=l;break}u=Math.sqrt(1-this.es*Math.pow(Math.sin(e),2))*Math.tan(e),t=$(this.long0+Math.asin(n*u/this.a)/Math.sin(e))}return i.x=t,i.y=e,i}var Jb=["Polyconic","American_Polyconic","poly"];const tI={init:Yb,forward:Zb,inverse:Qb,names:Jb};function eI(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function iI(i){var t,e=i.x,n=i.y,s=n-this.lat0,r=e-this.long0,a=s/xr*1e-5,o=r,l=1,h=0;for(t=1;t<=10;t++)l=l*a,h=h+this.A[t]*l;var c=h,u=o,f=1,_=0,g,x,y=0,w=0;for(t=1;t<=6;t++)g=f*c-_*u,x=_*c+f*u,f=g,_=x,y=y+this.B_re[t]*f-this.B_im[t]*_,w=w+this.B_im[t]*f+this.B_re[t]*_;return i.x=w*this.a+this.x0,i.y=y*this.a+this.y0,i}function nI(i){var t,e=i.x,n=i.y,s=e-this.x0,r=n-this.y0,a=r/this.a,o=s/this.a,l=1,h=0,c,u,f=0,_=0;for(t=1;t<=6;t++)c=l*a-h*o,u=h*a+l*o,l=c,h=u,f=f+this.C_re[t]*l-this.C_im[t]*h,_=_+this.C_im[t]*l+this.C_re[t]*h;for(var g=0;g<this.iterations;g++){var x=f,y=_,w,d,p=a,v=o;for(t=2;t<=6;t++)w=x*f-y*_,d=y*f+x*_,x=w,y=d,p=p+(t-1)*(this.B_re[t]*x-this.B_im[t]*y),v=v+(t-1)*(this.B_im[t]*x+this.B_re[t]*y);x=1,y=0;var T=this.B_re[1],R=this.B_im[1];for(t=2;t<=6;t++)w=x*f-y*_,d=y*f+x*_,x=w,y=d,T=T+t*(this.B_re[t]*x-this.B_im[t]*y),R=R+t*(this.B_im[t]*x+this.B_re[t]*y);var C=T*T+R*R;f=(p*T+v*R)/C,_=(v*T-p*R)/C}var b=f,I=_,P=1,G=0;for(t=1;t<=9;t++)P=P*b,G=G+this.D[t]*P;var O=this.lat0+G*xr*1e5,m=this.long0+I;return i.x=m,i.y=O,i}var sI=["New_Zealand_Map_Grid","nzmg"];const rI={init:eI,forward:iI,inverse:nI,names:sI};function aI(){}function oI(i){var t=i.x,e=i.y,n=$(t-this.long0),s=this.x0+this.a*n,r=this.y0+this.a*Math.log(Math.tan(Math.PI/4+e/2.5))*1.25;return i.x=s,i.y=r,i}function lI(i){i.x-=this.x0,i.y-=this.y0;var t=$(this.long0+i.x/this.a),e=2.5*(Math.atan(Math.exp(.8*i.y/this.a))-Math.PI/4);return i.x=t,i.y=e,i}var hI=["Miller_Cylindrical","mill"];const cI={init:aI,forward:oI,inverse:lI,names:hI};var uI=20;function fI(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=Ou(this.es)}function dI(i){var t,e,n=i.x,s=i.y;if(n=$(n-this.long0),this.sphere){if(!this.m)s=this.n!==1?Math.asin(this.n*Math.sin(s)):s;else for(var r=this.n*Math.sin(s),a=uI;a;--a){var o=(this.m*s+Math.sin(s)-r)/(this.m+Math.cos(s));if(s-=o,Math.abs(o)<j)break}t=this.a*this.C_x*n*(this.m+Math.cos(s)),e=this.a*this.C_y*s}else{var l=Math.sin(s),h=Math.cos(s);e=this.a*zs(s,l,h,this.en),t=this.a*n*h/Math.sqrt(1-this.es*l*l)}return i.x=t,i.y=e,i}function gI(i){var t,e,n,s;return i.x-=this.x0,n=i.x/this.a,i.y-=this.y0,t=i.y/this.a,this.sphere?(t/=this.C_y,n=n/(this.C_x*(this.m+Math.cos(t))),this.m?t=Zi((this.m*t+Math.sin(t))/this.n):this.n!==1&&(t=Zi(Math.sin(t)/this.n)),n=$(n+this.long0),t=nn(t)):(t=Fu(i.y/this.a,this.es,this.en),s=Math.abs(t),s<X?(s=Math.sin(t),e=this.long0+i.x*Math.sqrt(1-this.es*s*s)/(this.a*Math.cos(t)),n=$(e)):s-j<X&&(n=this.long0)),i.x=n,i.y=t,i}var _I=["Sinusoidal","sinu"];const mI={init:fI,forward:dI,inverse:gI,names:_I};function pI(){}function yI(i){for(var t=i.x,e=i.y,n=$(t-this.long0),s=e,r=Math.PI*Math.sin(e);;){var a=-(s+Math.sin(s)-r)/(1+Math.cos(s));if(s+=a,Math.abs(a)<j)break}s/=2,Math.PI/2-Math.abs(e)<j&&(n=0);var o=.900316316158*this.a*n*Math.cos(s)+this.x0,l=1.4142135623731*this.a*Math.sin(s)+this.y0;return i.x=o,i.y=l,i}function xI(i){var t,e;i.x-=this.x0,i.y-=this.y0,e=i.y/(1.4142135623731*this.a),Math.abs(e)>.999999999999&&(e=.999999999999),t=Math.asin(e);var n=$(this.long0+i.x/(.900316316158*this.a*Math.cos(t)));n<-Math.PI&&(n=-Math.PI),n>Math.PI&&(n=Math.PI),e=(2*t+Math.sin(2*t))/Math.PI,Math.abs(e)>1&&(e=1);var s=Math.asin(e);return i.x=n,i.y=s,i}var EI=["Mollweide","moll"];const vI={init:pI,forward:yI,inverse:xI,names:EI};function wI(){Math.abs(this.lat1+this.lat2)<j||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=ga(this.es),this.e1=_a(this.es),this.e2=ma(this.es),this.e3=pa(this.es),this.sin_phi=Math.sin(this.lat1),this.cos_phi=Math.cos(this.lat1),this.ms1=hi(this.e,this.sin_phi,this.cos_phi),this.ml1=ce(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<j?this.ns=this.sin_phi:(this.sin_phi=Math.sin(this.lat2),this.cos_phi=Math.cos(this.lat2),this.ms2=hi(this.e,this.sin_phi,this.cos_phi),this.ml2=ce(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=ce(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function TI(i){var t=i.x,e=i.y,n;if(this.sphere)n=this.a*(this.g-e);else{var s=ce(this.e0,this.e1,this.e2,this.e3,e);n=this.a*(this.g-s)}var r=this.ns*$(t-this.long0),a=this.x0+n*Math.sin(r),o=this.y0+this.rh-n*Math.cos(r);return i.x=a,i.y=o,i}function SI(i){i.x-=this.x0,i.y=this.rh-i.y+this.y0;var t,e,n,s;this.ns>=0?(e=Math.sqrt(i.x*i.x+i.y*i.y),t=1):(e=-Math.sqrt(i.x*i.x+i.y*i.y),t=-1);var r=0;if(e!==0&&(r=Math.atan2(t*i.x,t*i.y)),this.sphere)return s=$(this.long0+r/this.ns),n=nn(this.g-e/this.a),i.x=s,i.y=n,i;var a=this.g-e/this.a;return n=Lo(a,this.e0,this.e1,this.e2,this.e3),s=$(this.long0+r/this.ns),i.x=s,i.y=n,i}var RI=["Equidistant_Conic","eqdc"];const MI={init:wI,forward:TI,inverse:SI,names:RI};function CI(){this.R=this.a}function bI(i){var t=i.x,e=i.y,n=$(t-this.long0),s,r;Math.abs(e)<=j&&(s=this.x0+this.R*n,r=this.y0);var a=Zi(2*Math.abs(e/Math.PI));(Math.abs(n)<=j||Math.abs(Math.abs(e)-X)<=j)&&(s=this.x0,e>=0?r=this.y0+Math.PI*this.R*Math.tan(.5*a):r=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/n-n/Math.PI),l=o*o,h=Math.sin(a),c=Math.cos(a),u=c/(h+c-1),f=u*u,_=u*(2/h-1),g=_*_,x=Math.PI*this.R*(o*(u-g)+Math.sqrt(l*(u-g)*(u-g)-(g+l)*(f-g)))/(g+l);n<0&&(x=-x),s=this.x0+x;var y=l+u;return x=Math.PI*this.R*(_*y-o*Math.sqrt((g+l)*(l+1)-y*y))/(g+l),e>=0?r=this.y0+x:r=this.y0-x,i.x=s,i.y=r,i}function II(i){var t,e,n,s,r,a,o,l,h,c,u,f,_;return i.x-=this.x0,i.y-=this.y0,u=Math.PI*this.R,n=i.x/u,s=i.y/u,r=n*n+s*s,a=-Math.abs(s)*(1+r),o=a-2*s*s+n*n,l=-2*a+1+2*s*s+r*r,_=s*s/l+(2*o*o*o/l/l/l-9*a*o/l/l)/27,h=(a-o*o/3/l)/l,c=2*Math.sqrt(-h/3),u=3*_/h/c,Math.abs(u)>1&&(u>=0?u=1:u=-1),f=Math.acos(u)/3,i.y>=0?e=(-c*Math.cos(f+Math.PI/3)-o/3/l)*Math.PI:e=-(-c*Math.cos(f+Math.PI/3)-o/3/l)*Math.PI,Math.abs(n)<j?t=this.long0:t=$(this.long0+Math.PI*(r-1+Math.sqrt(1+2*(n*n-s*s)+r*r))/2/n),i.x=t,i.y=e,i}var AI=["Van_der_Grinten_I","VanDerGrinten","Van_der_Grinten","vandg"];const PI={init:CI,forward:bI,inverse:II,names:AI};function LI(i,t,e,n,s,r){const a=n-t,o=Math.atan((1-r)*Math.tan(i)),l=Math.atan((1-r)*Math.tan(e)),h=Math.sin(o),c=Math.cos(o),u=Math.sin(l),f=Math.cos(l);let _=a,g,x=100,y,w,d,p,v,T,R,C,b,I,P,G,O,m;do{if(y=Math.sin(_),w=Math.cos(_),d=Math.sqrt(f*y*(f*y)+(c*u-h*f*w)*(c*u-h*f*w)),d===0)return{azi1:0,s12:0};p=h*u+c*f*w,v=Math.atan2(d,p),T=c*f*y/d,R=1-T*T,C=R!==0?p-2*h*u/R:0,b=r/16*R*(4+r*(4-3*R)),g=_,_=a+(1-b)*r*T*(v+b*d*(C+b*p*(-1+2*C*C)))}while(Math.abs(_-g)>1e-12&&--x>0);return x===0?{azi1:NaN,s12:NaN}:(I=R*(s*s-s*(1-r)*(s*(1-r)))/(s*(1-r)*(s*(1-r))),P=1+I/16384*(4096+I*(-768+I*(320-175*I))),G=I/1024*(256+I*(-128+I*(74-47*I))),O=G*d*(C+G/4*(p*(-1+2*C*C)-G/6*C*(-3+4*d*d)*(-3+4*C*C))),m=s*(1-r)*P*(v-O),{azi1:Math.atan2(f*y,c*u-h*f*w),s12:m})}function OI(i,t,e,n,s,r){const a=Math.atan((1-r)*Math.tan(i)),o=Math.sin(a),l=Math.cos(a),h=Math.sin(e),c=Math.cos(e),u=Math.atan2(o,l*c),f=l*h,_=1-f*f,g=_*(s*s-s*(1-r)*(s*(1-r)))/(s*(1-r)*(s*(1-r))),x=1+g/16384*(4096+g*(-768+g*(320-175*g))),y=g/1024*(256+g*(-128+g*(74-47*g)));let w=n/(s*(1-r)*x),d,p=100,v,T,R,C;do v=Math.cos(2*u+w),T=Math.sin(w),R=Math.cos(w),C=y*T*(v+y/4*(R*(-1+2*v*v)-y/6*v*(-3+4*T*T)*(-3+4*v*v))),d=w,w=n/(s*(1-r)*x)+C;while(Math.abs(w-d)>1e-12&&--p>0);if(p===0)return{lat2:NaN,lon2:NaN};const b=o*T-l*R*c,I=Math.atan2(o*R+l*T*c,(1-r)*Math.sqrt(f*f+b*b)),P=Math.atan2(T*h,l*R-o*T*c),G=r/16*_*(4+r*(4-3*_)),O=P-(1-G)*r*f*(w+G*T*(v+G*R*(-1+2*v*v))),m=t+O;return{lat2:I,lon2:m}}function FI(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0),this.f=this.es/(1+Math.sqrt(1-this.es))}function DI(i){var t=i.x,e=i.y,n=Math.sin(i.y),s=Math.cos(i.y),r=$(t-this.long0),a,o,l,h,c,u,f,_,g,x,y;return this.sphere?Math.abs(this.sin_p12-1)<=j?(i.x=this.x0+this.a*(X-e)*Math.sin(r),i.y=this.y0-this.a*(X-e)*Math.cos(r),i):Math.abs(this.sin_p12+1)<=j?(i.x=this.x0+this.a*(X+e)*Math.sin(r),i.y=this.y0+this.a*(X+e)*Math.cos(r),i):(g=this.sin_p12*n+this.cos_p12*s*Math.cos(r),f=Math.acos(g),_=f?f/Math.sin(f):1,i.x=this.x0+this.a*_*s*Math.sin(r),i.y=this.y0+this.a*_*(this.cos_p12*n-this.sin_p12*s*Math.cos(r)),i):(a=ga(this.es),o=_a(this.es),l=ma(this.es),h=pa(this.es),Math.abs(this.sin_p12-1)<=j?(c=this.a*ce(a,o,l,h,X),u=this.a*ce(a,o,l,h,e),i.x=this.x0+(c-u)*Math.sin(r),i.y=this.y0-(c-u)*Math.cos(r),i):Math.abs(this.sin_p12+1)<=j?(c=this.a*ce(a,o,l,h,X),u=this.a*ce(a,o,l,h,e),i.x=this.x0+(c+u)*Math.sin(r),i.y=this.y0+(c+u)*Math.cos(r),i):Math.abs(t)<j&&Math.abs(e-this.lat0)<j?(i.x=i.y=0,i):(x=LI(this.lat0,this.long0,e,t,this.a,this.f),y=x.azi1,i.x=x.s12*Math.sin(y),i.y=x.s12*Math.cos(y),i))}function GI(i){i.x-=this.x0,i.y-=this.y0;var t,e,n,s,r,a,o,l,h,c,u,f,_,g,x,y;return this.sphere?(t=Math.sqrt(i.x*i.x+i.y*i.y),t>2*X*this.a?void 0:(e=t/this.a,n=Math.sin(e),s=Math.cos(e),r=this.long0,Math.abs(t)<=j?a=this.lat0:(a=Zi(s*this.sin_p12+i.y*n*this.cos_p12/t),o=Math.abs(this.lat0)-X,Math.abs(o)<=j?this.lat0>=0?r=$(this.long0+Math.atan2(i.x,-i.y)):r=$(this.long0-Math.atan2(-i.x,i.y)):r=$(this.long0+Math.atan2(i.x*n,t*this.cos_p12*s-i.y*this.sin_p12*n))),i.x=r,i.y=a,i)):(l=ga(this.es),h=_a(this.es),c=ma(this.es),u=pa(this.es),Math.abs(this.sin_p12-1)<=j?(f=this.a*ce(l,h,c,u,X),t=Math.sqrt(i.x*i.x+i.y*i.y),_=f-t,a=Lo(_/this.a,l,h,c,u),r=$(this.long0+Math.atan2(i.x,-1*i.y)),i.x=r,i.y=a,i):Math.abs(this.sin_p12+1)<=j?(f=this.a*ce(l,h,c,u,X),t=Math.sqrt(i.x*i.x+i.y*i.y),_=t-f,a=Lo(_/this.a,l,h,c,u),r=$(this.long0+Math.atan2(i.x,i.y)),i.x=r,i.y=a,i):(g=Math.atan2(i.x,i.y),x=Math.sqrt(i.x*i.x+i.y*i.y),y=OI(this.lat0,this.long0,g,x,this.a,this.f),i.x=y.lon2,i.y=y.lat2,i))}var NI=["Azimuthal_Equidistant","aeqd"];const kI={init:FI,forward:DI,inverse:GI,names:NI};function UI(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function BI(i){var t,e,n,s,r,a,o,l,h=i.x,c=i.y;return n=$(h-this.long0),t=Math.sin(c),e=Math.cos(c),s=Math.cos(n),a=this.sin_p14*t+this.cos_p14*e*s,r=1,(a>0||Math.abs(a)<=j)&&(o=this.a*r*e*Math.sin(n),l=this.y0+this.a*r*(this.cos_p14*t-this.sin_p14*e*s)),i.x=o,i.y=l,i}function zI(i){var t,e,n,s,r,a,o;return i.x-=this.x0,i.y-=this.y0,t=Math.sqrt(i.x*i.x+i.y*i.y),e=Zi(t/this.a),n=Math.sin(e),s=Math.cos(e),a=this.long0,Math.abs(t)<=j?(o=this.lat0,i.x=a,i.y=o,i):(o=Zi(s*this.sin_p14+i.y*n*this.cos_p14/t),r=Math.abs(this.lat0)-X,Math.abs(r)<=j?(this.lat0>=0?a=$(this.long0+Math.atan2(i.x,-i.y)):a=$(this.long0-Math.atan2(-i.x,i.y)),i.x=a,i.y=o,i):(a=$(this.long0+Math.atan2(i.x*n,t*this.cos_p14*s-i.y*this.sin_p14*n)),i.x=a,i.y=o,i))}var XI=["ortho"];const jI={init:UI,forward:BI,inverse:zI,names:XI};var At={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},xt={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function VI(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=X-yt/2?this.face=At.TOP:this.lat0<=-(X-yt/2)?this.face=At.BOTTOM:Math.abs(this.long0)<=yt?this.face=At.FRONT:Math.abs(this.long0)<=X+yt?this.face=this.long0>0?At.RIGHT:At.LEFT:this.face=At.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function $I(i){var t={x:0,y:0},e,n,s,r,a,o,l={value:0};if(i.x-=this.long0,this.es!==0?e=Math.atan(this.one_minus_f_squared*Math.tan(i.y)):e=i.y,n=i.x,this.face===At.TOP)r=X-e,n>=yt&&n<=X+yt?(l.value=xt.AREA_0,s=n-X):n>X+yt||n<=-(X+yt)?(l.value=xt.AREA_1,s=n>0?n-Bt:n+Bt):n>-(X+yt)&&n<=-yt?(l.value=xt.AREA_2,s=n+X):(l.value=xt.AREA_3,s=n);else if(this.face===At.BOTTOM)r=X+e,n>=yt&&n<=X+yt?(l.value=xt.AREA_0,s=-n+X):n<yt&&n>=-yt?(l.value=xt.AREA_1,s=-n):n<-yt&&n>=-(X+yt)?(l.value=xt.AREA_2,s=-n-X):(l.value=xt.AREA_3,s=n>0?-n+Bt:-n-Bt);else{var h,c,u,f,_,g,x;this.face===At.RIGHT?n=ys(n,+X):this.face===At.BACK?n=ys(n,+Bt):this.face===At.LEFT&&(n=ys(n,-X)),f=Math.sin(e),_=Math.cos(e),g=Math.sin(n),x=Math.cos(n),h=_*x,c=_*g,u=f,this.face===At.FRONT?(r=Math.acos(h),s=$a(r,u,c,l)):this.face===At.RIGHT?(r=Math.acos(c),s=$a(r,u,-h,l)):this.face===At.BACK?(r=Math.acos(-h),s=$a(r,u,-c,l)):this.face===At.LEFT?(r=Math.acos(-c),s=$a(r,u,h,l)):(r=s=0,l.value=xt.AREA_0)}return o=Math.atan(12/Bt*(s+Math.acos(Math.sin(s)*Math.cos(yt))-X)),a=Math.sqrt((1-Math.cos(r))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(s))))),l.value===xt.AREA_1?o+=X:l.value===xt.AREA_2?o+=Bt:l.value===xt.AREA_3&&(o+=1.5*Bt),t.x=a*Math.cos(o),t.y=a*Math.sin(o),t.x=t.x*this.a+this.x0,t.y=t.y*this.a+this.y0,i.x=t.x,i.y=t.y,i}function WI(i){var t={lam:0,phi:0},e,n,s,r,a,o,l,h,c,u={value:0};if(i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a,n=Math.atan(Math.sqrt(i.x*i.x+i.y*i.y)),e=Math.atan2(i.y,i.x),i.x>=0&&i.x>=Math.abs(i.y)?u.value=xt.AREA_0:i.y>=0&&i.y>=Math.abs(i.x)?(u.value=xt.AREA_1,e-=X):i.x<0&&-i.x>=Math.abs(i.y)?(u.value=xt.AREA_2,e=e<0?e+Bt:e-Bt):(u.value=xt.AREA_3,e+=X),c=Bt/12*Math.tan(e),a=Math.sin(c)/(Math.cos(c)-1/Math.sqrt(2)),o=Math.atan(a),s=Math.cos(e),r=Math.tan(n),l=1-s*s*r*r*(1-Math.cos(Math.atan(1/Math.cos(o)))),l<-1?l=-1:l>1&&(l=1),this.face===At.TOP)h=Math.acos(l),t.phi=X-h,u.value===xt.AREA_0?t.lam=o+X:u.value===xt.AREA_1?t.lam=o<0?o+Bt:o-Bt:u.value===xt.AREA_2?t.lam=o-X:t.lam=o;else if(this.face===At.BOTTOM)h=Math.acos(l),t.phi=h-X,u.value===xt.AREA_0?t.lam=-o+X:u.value===xt.AREA_1?t.lam=-o:u.value===xt.AREA_2?t.lam=-o-X:t.lam=o<0?-o-Bt:-o+Bt;else{var f,_,g;f=l,c=f*f,c>=1?g=0:g=Math.sqrt(1-c)*Math.sin(o),c+=g*g,c>=1?_=0:_=Math.sqrt(1-c),u.value===xt.AREA_1?(c=_,_=-g,g=c):u.value===xt.AREA_2?(_=-_,g=-g):u.value===xt.AREA_3&&(c=_,_=g,g=-c),this.face===At.RIGHT?(c=f,f=-_,_=c):this.face===At.BACK?(f=-f,_=-_):this.face===At.LEFT&&(c=f,f=_,_=-c),t.phi=Math.acos(-g)-X,t.lam=Math.atan2(_,f),this.face===At.RIGHT?t.lam=ys(t.lam,-X):this.face===At.BACK?t.lam=ys(t.lam,-Bt):this.face===At.LEFT&&(t.lam=ys(t.lam,+X))}if(this.es!==0){var x,y,w;x=t.phi<0?1:0,y=Math.tan(t.phi),w=this.b/Math.sqrt(y*y+this.one_minus_f_squared),t.phi=Math.atan(Math.sqrt(this.a*this.a-w*w)/(this.one_minus_f*w)),x&&(t.phi=-t.phi)}return t.lam+=this.long0,i.x=t.lam,i.y=t.phi,i}function $a(i,t,e,n){var s;return i<j?(n.value=xt.AREA_0,s=0):(s=Math.atan2(t,e),Math.abs(s)<=yt?n.value=xt.AREA_0:s>yt&&s<=X+yt?(n.value=xt.AREA_1,s-=X):s>X+yt||s<=-(X+yt)?(n.value=xt.AREA_2,s=s>=0?s-Bt:s+Bt):(n.value=xt.AREA_3,s+=X)),s}function ys(i,t){var e=i+t;return e<-Bt?e+=Xr:e>+Bt&&(e-=Xr),e}var qI=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const KI={init:VI,forward:$I,inverse:WI,names:qI};var Qh=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],ur=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],Sm=.8487,Rm=1.3523,Mm=ni/5,HI=1/Mm,cs=18,Oo=function(i,t){return i[0]+t*(i[1]+t*(i[2]+t*i[3]))},YI=function(i,t){return i[1]+t*(2*i[2]+t*3*i[3])};function ZI(i,t,e,n){for(var s=t;n;--n){var r=i(s);if(s-=r,Math.abs(r)<e)break}return s}function QI(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function JI(i){var t=$(i.x-this.long0),e=Math.abs(i.y),n=Math.floor(e*Mm);n<0?n=0:n>=cs&&(n=cs-1),e=ni*(e-HI*n);var s={x:Oo(Qh[n],e)*t,y:Oo(ur[n],e)};return i.y<0&&(s.y=-s.y),s.x=s.x*this.a*Sm+this.x0,s.y=s.y*this.a*Rm+this.y0,s}function tA(i){var t={x:(i.x-this.x0)/(this.a*Sm),y:Math.abs(i.y-this.y0)/(this.a*Rm)};if(t.y>=1)t.x/=Qh[cs][0],t.y=i.y<0?-X:X;else{var e=Math.floor(t.y*cs);for(e<0?e=0:e>=cs&&(e=cs-1);;)if(ur[e][0]>t.y)--e;else if(ur[e+1][0]<=t.y)++e;else break;var n=ur[e],s=5*(t.y-n[0])/(ur[e+1][0]-n[0]);s=ZI(function(r){return(Oo(n,r)-t.y)/YI(n,r)},s,j,100),t.x/=Oo(Qh[e],s),t.y=(5*e+s)*Ht,i.y<0&&(t.y=-t.y)}return t.x=$(t.x+this.long0),t}var eA=["Robinson","robin"];const iA={init:QI,forward:JI,inverse:tA,names:eA};function nA(){this.name="geocent"}function sA(i){var t=dm(i,this.es,this.a);return t}function rA(i){var t=gm(i,this.es,this.a,this.b);return t}var aA=["Geocentric","geocentric","geocent","Geocent"];const oA={init:nA,forward:sA,inverse:rA,names:aA};var ie={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},Js={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function lA(){if(Object.keys(Js).forEach((function(e){if(typeof this[e]>"u")this[e]=Js[e].def;else{if(Js[e].num&&isNaN(this[e]))throw new Error("Invalid parameter value, must be numeric "+e+" = "+this[e]);Js[e].num&&(this[e]=parseFloat(this[e]))}Js[e].degrees&&(this[e]=this[e]*Ht)}).bind(this)),Math.abs(Math.abs(this.lat0)-X)<j?this.mode=this.lat0<0?ie.S_POLE:ie.N_POLE:Math.abs(this.lat0)<j?this.mode=ie.EQUIT:(this.mode=ie.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var i=this.tilt,t=this.azi;this.cg=Math.cos(t),this.sg=Math.sin(t),this.cw=Math.cos(i),this.sw=Math.sin(i)}function hA(i){i.x-=this.long0;var t=Math.sin(i.y),e=Math.cos(i.y),n=Math.cos(i.x),s,r;switch(this.mode){case ie.OBLIQ:r=this.sinph0*t+this.cosph0*e*n;break;case ie.EQUIT:r=e*n;break;case ie.S_POLE:r=-t;break;case ie.N_POLE:r=t;break}switch(r=this.pn1/(this.p-r),s=r*e*Math.sin(i.x),this.mode){case ie.OBLIQ:r*=this.cosph0*t-this.sinph0*e*n;break;case ie.EQUIT:r*=t;break;case ie.N_POLE:r*=-(e*n);break;case ie.S_POLE:r*=e*n;break}var a,o;return a=r*this.cg+s*this.sg,o=1/(a*this.sw*this.h1+this.cw),s=(s*this.cg-r*this.sg)*this.cw*o,r=a*o,i.x=s*this.a,i.y=r*this.a,i}function cA(i){i.x/=this.a,i.y/=this.a;var t={x:i.x,y:i.y},e,n,s;s=1/(this.pn1-i.y*this.sw),e=this.pn1*i.x*s,n=this.pn1*i.y*this.cw*s,i.x=e*this.cg+n*this.sg,i.y=n*this.cg-e*this.sg;var r=ye(i.x,i.y);if(Math.abs(r)<j)t.x=0,t.y=i.y;else{var a,o;switch(o=1-r*r*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/r+r/this.pn1),a=Math.sqrt(1-o*o),this.mode){case ie.OBLIQ:t.y=Math.asin(a*this.sinph0+i.y*o*this.cosph0/r),i.y=(a-this.sinph0*Math.sin(t.y))*r,i.x*=o*this.cosph0;break;case ie.EQUIT:t.y=Math.asin(i.y*o/r),i.y=a*r,i.x*=o;break;case ie.N_POLE:t.y=Math.asin(a),i.y=-i.y;break;case ie.S_POLE:t.y=-Math.asin(a);break}t.x=Math.atan2(i.x,i.y)}return i.x=t.x+this.long0,i.y=t.y,i}var uA=["Tilted_Perspective","tpers"];const fA={init:lA,forward:hA,inverse:cA,names:uA};function dA(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var i=1-this.es,t=1/i;this.radius_p=Math.sqrt(i),this.radius_p2=i,this.radius_p_inv2=t,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function gA(i){var t=i.x,e=i.y,n,s,r,a;if(t=t-this.long0,this.shape==="ellipse"){e=Math.atan(this.radius_p2*Math.tan(e));var o=this.radius_p/ye(this.radius_p*Math.cos(e),Math.sin(e));if(s=o*Math.cos(t)*Math.cos(e),r=o*Math.sin(t)*Math.cos(e),a=o*Math.sin(e),(this.radius_g-s)*s-r*r-a*a*this.radius_p_inv2<0)return i.x=Number.NaN,i.y=Number.NaN,i;n=this.radius_g-s,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/ye(a,n)),i.y=this.radius_g_1*Math.atan(a/n)):(i.x=this.radius_g_1*Math.atan(r/n),i.y=this.radius_g_1*Math.atan(a/ye(r,n)))}else this.shape==="sphere"&&(n=Math.cos(e),s=Math.cos(t)*n,r=Math.sin(t)*n,a=Math.sin(e),n=this.radius_g-s,this.flip_axis?(i.x=this.radius_g_1*Math.atan(r/ye(a,n)),i.y=this.radius_g_1*Math.atan(a/n)):(i.x=this.radius_g_1*Math.atan(r/n),i.y=this.radius_g_1*Math.atan(a/ye(r,n))));return i.x=i.x*this.a,i.y=i.y*this.a,i}function _A(i){var t=-1,e=0,n=0,s,r,a,o;if(i.x=i.x/this.a,i.y=i.y/this.a,this.shape==="ellipse"){this.flip_axis?(n=Math.tan(i.y/this.radius_g_1),e=Math.tan(i.x/this.radius_g_1)*ye(1,n)):(e=Math.tan(i.x/this.radius_g_1),n=Math.tan(i.y/this.radius_g_1)*ye(1,e));var l=n/this.radius_p;if(s=e*e+l*l+t*t,r=2*this.radius_g*t,a=r*r-4*s*this.C,a<0)return i.x=Number.NaN,i.y=Number.NaN,i;o=(-r-Math.sqrt(a))/(2*s),t=this.radius_g+o*t,e*=o,n*=o,i.x=Math.atan2(e,t),i.y=Math.atan(n*Math.cos(i.x)/t),i.y=Math.atan(this.radius_p_inv2*Math.tan(i.y))}else if(this.shape==="sphere"){if(this.flip_axis?(n=Math.tan(i.y/this.radius_g_1),e=Math.tan(i.x/this.radius_g_1)*Math.sqrt(1+n*n)):(e=Math.tan(i.x/this.radius_g_1),n=Math.tan(i.y/this.radius_g_1)*Math.sqrt(1+e*e)),s=e*e+n*n+t*t,r=2*this.radius_g*t,a=r*r-4*s*this.C,a<0)return i.x=Number.NaN,i.y=Number.NaN,i;o=(-r-Math.sqrt(a))/(2*s),t=this.radius_g+o*t,e*=o,n*=o,i.x=Math.atan2(e,t),i.y=Math.atan(n*Math.cos(i.x)/t)}return i.x=i.x+this.long0,i}var mA=["Geostationary Satellite View","Geostationary_Satellite","geos"];const pA={init:dA,forward:gA,inverse:_A,names:mA};var Er=1.340264,vr=-.081106,wr=893e-6,Tr=.003796,Fo=Math.sqrt(3)/2;function yA(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function xA(i){var t=$(i.x-this.long0),e=i.y,n=Math.asin(Fo*Math.sin(e)),s=n*n,r=s*s*s;return i.x=t*Math.cos(n)/(Fo*(Er+3*vr*s+r*(7*wr+9*Tr*s))),i.y=n*(Er+vr*s+r*(wr+Tr*s)),i.x=this.a*i.x+this.x0,i.y=this.a*i.y+this.y0,i}function EA(i){i.x=(i.x-this.x0)/this.a,i.y=(i.y-this.y0)/this.a;var t=1e-9,e=12,n=i.y,s,r,a,o,l,h;for(h=0;h<e&&(s=n*n,r=s*s*s,a=n*(Er+vr*s+r*(wr+Tr*s))-i.y,o=Er+3*vr*s+r*(7*wr+9*Tr*s),n-=l=a/o,!(Math.abs(l)<t));++h);return s=n*n,r=s*s*s,i.x=Fo*i.x*(Er+3*vr*s+r*(7*wr+9*Tr*s))/Math.cos(n),i.y=Math.asin(Math.sin(n)/Fo),i.x=$(i.x+this.long0),i}var vA=["eqearth","Equal Earth","Equal_Earth"];const wA={init:yA,forward:xA,inverse:EA,names:vA};var $r=1e-10;function TA(){var i;if(this.phi1=this.lat1,Math.abs(this.phi1)<$r)throw new Error;this.es?(this.en=Ou(this.es),this.m1=zs(this.phi1,this.am1=Math.sin(this.phi1),i=Math.cos(this.phi1),this.en),this.am1=i/(Math.sqrt(1-this.es*this.am1*this.am1)*this.am1),this.inverse=RA,this.forward=SA):(Math.abs(this.phi1)+$r>=X?this.cphi1=0:this.cphi1=1/Math.tan(this.phi1),this.inverse=CA,this.forward=MA)}function SA(i){var t=$(i.x-(this.long0||0)),e=i.y,n,s,r;return n=this.am1+this.m1-zs(e,s=Math.sin(e),r=Math.cos(e),this.en),s=r*t/(n*Math.sqrt(1-this.es*s*s)),i.x=n*Math.sin(s),i.y=this.am1-n*Math.cos(s),i.x=this.a*i.x+(this.x0||0),i.y=this.a*i.y+(this.y0||0),i}function RA(i){i.x=(i.x-(this.x0||0))/this.a,i.y=(i.y-(this.y0||0))/this.a;var t,e,n,s;if(e=ye(i.x,i.y=this.am1-i.y),s=Fu(this.am1+this.m1-e,this.es,this.en),(t=Math.abs(s))<X)t=Math.sin(s),n=e*Math.atan2(i.x,i.y)*Math.sqrt(1-this.es*t*t)/Math.cos(s);else if(Math.abs(t-X)<=$r)n=0;else throw new Error;return i.x=$(n+(this.long0||0)),i.y=nn(s),i}function MA(i){var t=$(i.x-(this.long0||0)),e=i.y,n,s;return s=this.cphi1+this.phi1-e,Math.abs(s)>$r?(i.x=s*Math.sin(n=t*Math.cos(e)/s),i.y=this.cphi1-s*Math.cos(n)):i.x=i.y=0,i.x=this.a*i.x+(this.x0||0),i.y=this.a*i.y+(this.y0||0),i}function CA(i){i.x=(i.x-(this.x0||0))/this.a,i.y=(i.y-(this.y0||0))/this.a;var t,e,n=ye(i.x,i.y=this.cphi1-i.y);if(e=this.cphi1+this.phi1-n,Math.abs(e)>X)throw new Error;return Math.abs(Math.abs(e)-X)<=$r?t=0:t=n*Math.atan2(i.x,i.y)/Math.cos(e),i.x=$(t+(this.long0||0)),i.y=nn(e),i}var bA=["bonne","Bonne (Werner lat_1=90)"];const IA={init:TA,names:bA};function AA(i){i.Proj.projections.add(to),i.Proj.projections.add(eo),i.Proj.projections.add(bC),i.Proj.projections.add(NC),i.Proj.projections.add(XC),i.Proj.projections.add(qC),i.Proj.projections.add(JC),i.Proj.projections.add(sb),i.Proj.projections.add(hb),i.Proj.projections.add(gb),i.Proj.projections.add(Cb),i.Proj.projections.add(Ob),i.Proj.projections.add(kb),i.Proj.projections.add(Vb),i.Proj.projections.add(Hb),i.Proj.projections.add(tI),i.Proj.projections.add(rI),i.Proj.projections.add(cI),i.Proj.projections.add(mI),i.Proj.projections.add(vI),i.Proj.projections.add(MI),i.Proj.projections.add(PI),i.Proj.projections.add(kI),i.Proj.projections.add(jI),i.Proj.projections.add(KI),i.Proj.projections.add(iA),i.Proj.projections.add(oA),i.Proj.projections.add(fA),i.Proj.projections.add(pA),i.Proj.projections.add(wA),i.Proj.projections.add(IA)}const Cm=Object.assign($M,{defaultDatum:"WGS84",Proj:$e,WGS84:new $e("WGS84"),Point:As,toPoint:_m,defs:ae,nadgrid:CM,transform:Po,mgrs:WM,version:"__VERSION__"});AA(Cm);const PA={class:"q-pa-md"},LA={class:"progress-bar"},OA=8,FA={__name:"MapView",setup(i){Z_(Cm);const t=Km(),e=gi(),n=gi(1),s=gi(!1),r=gi(),a=gi(),o=gi(),l=gi(),h=gi(),c=gi(),u=Yt(()=>t.extent),f=Yt(()=>t.rasterLayers),_=Yt(()=>t.capellaStacUrl),g=Yt(()=>t.wyvernStacUrl);function x(){b();const I=R("1"),P=new Eo({source:new Mh({attributions:I.attribution,url:I.url})});e.value=new Tx({target:"map",overlays:[c.value],layers:[P],view:new ti({center:[-1.8950737469211568e6,2574370324744003e-9],zoom:1,extent:u.value})}),e.value.on("loadstart",async function(){s.value=!0}),e.value.on("loadend",async function(){s.value=!1}),e.value.on("moveend",function(){const O=e.value.getView().getZoom();n.value=O}),e.value.on("singleclick",async function(G){if(c.value.setPosition(void 0),n.value<OA)return;const O=await aR(G);if(O.length>0){const m=O[0],E=G.coordinate;a.value.innerHTML=`<div class=text-wrap style='word-wrap: break-word;'>${m.id}</div>`,c.value.setPosition(E)}})}function y(I){return new bo({url:I,transition:0,minZoom:5,buildTileUrlTemplate:G=>"https://tiles.rdnt.io/tiles/{z}/{x}/{y}@2x?url="+encodeURIComponent(G.getAbsoluteUrl())})}function w(I){c.value.setPosition(void 0),I===""?(e.value.removeLayer(l.value),l.value=null):(l.value=y(I),l.value.on("sourceready",()=>{e.value.getView().fit(l.value.getExtent(),{padding:[20,20,20,20]})}))}function d(I){return new bo({url:I,assets:["Overview image"],minZoom:5})}function p(I){c.value.setPosition(void 0),I===""?(e.value.removeLayer(h.value),h.value=null):(h.value=d(I),h.value.on("sourceready",()=>{e.value.getView().fit(h.value.getExtent(),{padding:[20,20,20,20]})}))}function v(){e.value.removeLayer(l.value),e.value.removeLayer(h.value),h.value&&e.value.addLayer(h.value),l.value&&e.value.addLayer(l.value)}function T(){r.value=document.getElementById("popup"),a.value=document.getElementById("popup-content"),o.value=document.getElementById("popup-closer"),c.value=new CE({element:r.value,autoPan:{animation:{duration:250}}}),o.value.onclick=function(){return c.value.setPosition(void 0),o.value.blur(),!1}}function R(I){return f.value.find(G=>G.id===I)}function C(){e.value&&(e.value.getLayers().clear(),e.value.setTarget(null),e.value.dispose(),e.value=null)}function b(){const I=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=function(P,G={}){return P==="2d"&&(G.willReadFrequently=!0),I.call(this,P,G)}}return ml(_,I=>{w(I)}),ml(g,I=>{p(I)}),ml([l,h],()=>{v()}),Dm(()=>{T(),x(),document.createElement("canvas").getContext("2d",{willReadFrequently:!0})}),Gm(()=>{C()}),(I,P)=>(rh(),Nm("div",PA,[Ws("div",LA,[s.value?(rh(),cg(Zm,{key:0,indeterminate:"",color:"primary"})):km("",!0)]),P[0]||(P[0]=Ws("div",{id:"map"},null,-1)),P[1]||(P[1]=Ws("div",{id:"popup",class:"ol-popup"},[Ws("a",{href:"#",id:"popup-closer",class:"ol-popup-closer"}),Ws("div",{id:"popup-content"})],-1))]))}},DA=qm(FA,[["__scopeId","data-v-389c43d6"]]),GA={__name:"IndexPage",setup(i){return(t,e)=>(rh(),cg(Hm,null,{default:Um(()=>[Bm(DA)]),_:1}))}},iP=Object.freeze(Object.defineProperty({__proto__:null,default:GA},Symbol.toStringTag,{value:"Module"}));export{iP as I,ZA as L,QA as a,ol as g};
